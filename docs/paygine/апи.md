P2P Marketplace Services
Version 2.20.2
Санкт-Петербург, 2025 г.
/Confidential
Версия Дата Описание
1.1 26.07.2017
- В параметры запроса Complete добавлен параметр – currency (валюта);
- Изменения в расчете подписи запросов PayIn, PayInDebit, PayOut, Transfer,
TransferDebit, Complete – в число параметров, участвующих в расчете подписи
добавлен параметр currency.
1.2 28.07.2017 - Для сервиса PayOut параметр token переименован в token2.
1.3 31.07.2017 - Для сервисов Complete, Reverse порядок параметров, участвующих в подписи:
sector, id, amount, currency, client_ref, password.
1.4 05.08.2017 - Добавлены сервисы Register, UserAuthorize, Complete, UserPurchase, Reverse.
1.5 29.11.2017
- Для расчета подписи сервиса PayOut вместо token используется
token2. Изменился порядок параметров, участвующих в подписи PayOut (если они
используются в запросе): sector, id, from_client_ref, to_client_ref, amount, currency,
token2, password;
- Для сервисов PayIn, PayOut параметр fee переименован в fee_value;
- Добавлен сервис PayOut2 — аналог сервиса PayOut, возвращающий xml;
- GetBalance возвращает дополнительный параметр – Active (статус пользователя).
1.6 09.01.2018
- Приведены в актуальное состояние описание сервисов webapi/Register,
webapi/UserAuthorize, webapi/Complete, webapi/UserPurchase, webapi/Reverse;
- Сделаны мелкие несущественные правки в описании других сервисов.
1.7 08.05.2018 - Добавлено описание для сервиса b2puser/CreditUser.
1.8 28.11.2018 - Добавлено описание для сервиса b2puser/Statement.
1.9 20.05.2019
- Добавлено описание для сервисов b2puser/Vcard, b2puser/SetPhoneVCard,
b2puser/SetAllowedParams, b2puser/SetRestrictedParams, b2puser/SetCardCrLimit,
b2puser/VcardBlock.
1.9 20.05.2019
- Добавлено описание для сервисов b2puser/Vcard, b2puser/SetPhoneVCard,
b2puser/SetAllowedParams, b2puser/SetRestrictedParams, b2puser/SetCardCrLimit,
b2puser/VcardBlock.
1.10 01.08.2019 - Добавлено описание для сервиса b2puser/IdentificationStatus.
1.11 20.11.2019 - Добавлено описание для сервиса b2puser/VcardUnblock.
1.12 18.02.2020 - Добавлено описание для сервиса b2puser/GetPayload.
1.14 28.07.2020 - Проведена актуализация материала, инструкция приведена в соответствие с
Руководством по стилю технической документации компании Paygine.
1.15 20.10.2020 - Добавлено описание для сервиса webapi/AuthorizeByUser;
- Сделаны мелкие несущественные правки в описании других сервисов.
1.16 13.01.2021 - Актуализированы ответы для сервисов b2puser/Register и b2puser/Info.
1.17 17.02.2021
- Добавлено описание для сервиса b2puser/P2PIn;
- Добавлен xml-пример ответа при смене значения статуса пользователя active на
“1” в общем описании процесса.
1.18 19.05.2021
- Добавлено описание для сервисов СБП: b2puser/GetSBPBankList,
b2puser/GetDefaultSBPBank, b2puser/PayOutSBPPrecheck и b2puser/PayOutSBP;
- Добавлен параметр payer_id в описание сервисов b2puser/PayIn и
b2puser/PayInDebit.
1.19 07.06.2021
- Добавлено Приложение №1. Коды и описания ошибок;
- Добавлено Приложение №2. Формирование и проверка цифровой подписи;
- Для сервиса b2puser/SetPhoneVCard добавлены параметры passphrase и
repassphrase;
- Изменился набор параметров, участвующих в подписи b2puser/SetPhoneVCard (если
они используются в запросе): sector, client_ref, phone, passphrase, password;
- Добавлен логотип в правом верхнем углу главной страницы.
1.19.1 30.06.2021 - Актуализирована информация о работе сервисов b2puser/PayIn и b2puser/P2Pin.
ИЗМЕНЕНИЯ В ДОКУМЕНТЕ
P 2 P M a r k e t С т р а н и ц а 2 | 1 7 2
1.19.2 30.07.2021
- Исправлен набор параметров, участвующих в подписи b2puser/CheckPhoneService;
- Добавлен параметр to_client_ref_stock в описание сервиса b2puser/Complete;
- Добавлен параметр yandexCryptogram в описание сервисов b2puser/PayIn и
b2puser/PayInDebit;
- Добавлен параметр trancode_list в описание сервисов b2puser/SetAllowedParams и
b2puser/SetRestrictedParams.
1.19.3 26.08.2021
- Добавлен дополнительный тип callback (Приложение №3);
- Добавлены примеры запросов для сервисов b2puser/CheckPhoneService,
b2puser/SetPhoneService;
- Добавлены ссылки на Приложение №2 в описании параметра signature для всех
запросов;
- Изменено цветовое оформление вставок кода.
1.20 23.09.2021
- Добавлено описание для сервисов gateweb/b2puser/CheckPhone,
gateweb/b2puser/SetPhone и CheckLimit;
- Добавлено описание формата Запроса в обзор терминов;
- Добавлен типовой callback от ПЦ (Приложение №3);
- Актуализирован набор параметров для сервисов b2puser/CheckPhoneService и
b2puser/SetPhoneService.
2.0 11.11.2021
- Добавлено описание новых методов SDPayInDebit, SDComplete, SDPayIn, SDPayOut,
SDPurchase, SDReverse;
- Актуализировано описание сервиса b2puser/Statement;
- Добавлен параметр client_ref в описание сервиса b2puser/GetDefaultSBPBank;
- Удалён параметр fee в описании метода b2puser/PayOutSBPPrecheck;
- Добавлены новые коды ошибок;
- Сделаны мелкие несущественные правки в описании других сервисов.
2.0.1 21.12.2021 - Актуализировано описание сервиса b2puser/GetPayload;
- Сделаны мелкие несущественные правки в описании других сервисов.
2.1 03.02.2022
- Произведено переразбиение сервисов на логические блоки;
- Добавлено описание для сервисов b2puser/UpdateCardMetadata,
b2puser/SDGetBalance;
- Добавлен параметр sd_ref в описание сервисов раздела «Кубышка»;
- Сделаны мелкие несущественные правки в описании других сервисов.
2.2 18.02.2022
- Произведена актуализация раздела «Обзор терминов и сервисов» в соответствии с
текущим функционалом;
- Актуализировано описание сервисов раздела «Кубышка»;
- Произведена коррекция форматирования отдельных элементов документации
согласно общему стилю документации Paygine.
2.2.1 01.04.2022
- Добавлен параметр smscode в описание сервиса b2puser/SetPhoneService;
- Изменен состав подписи для сервиса b2puser/sd-services/SDPayOut;
- Изменено описание параметра P108 и добавлен комментарий касательно
настройки платежа по свободным реквизитам для сервиса b2puser/sd-
services/SDPurchase;
- Внесена корректировка описания параметров applePaymentData,
applePaymentToken, googleCryptogram, yandexCryptogram, samsung_ref_id;
- Внесена корректировка комментариев в описании условно-обязательных
параметров.
2.3 11.08.2022
- Добавлено описание новых методов SDPayOutPage, SDPayInSBP, SDPayInSBPQRLink;
- Изменен состав подписи для сервиса b2puser/sd-services/SDPayOut;
- Обновлен список методов, использующих id Заказа, предварительно
зарегистрированного с помощью webapi/Register;
- Добавлена расшифровка типового колбэка от ПЦ (Приложение №3);
- Сделаны мелкие несущественные правки касательно формата документа.
2.4 21.10.2022
- Добавлен сервис test/SBPTestCase;
- Добавлен сервис SDPayInSberPay;
- Разделено и скорректировано описание сервисов b2puser/Modify и
b2puser/ModifyPage.
/Confidential
- Изменено цветовое оформление вставок кода.
P 2 P M a r k e t С т р а н и ц а 3 | 1 7 2
/Confidential
- Сделаны мелкие несущественные правки в описании других сервисов.
- Сделаны мелкие несущественные правки в описании других сервисов.
- Сделаны мелкие несущественные правки в описании других сервисов.
2.5 02.12.2021
- Название Приложения №1 изменено на Описание форматов xml-сообщений от
ПЦ;
- В Приложение №1 добавлены примеры xml-ответов на запросы webapi/Register,
webapi/b2puser/Statement и по результатам выполнения операций;
- В Приложение №3 добавлены примеры колбэков об операциях через СБП и об
изменении статуса идентификации юзера;
- Удалено описание сервисов PayInFee, PayOutFee и TransferFee;
- Добавлены примеры запросов и ответов для всех сервисов.
2.5.1 10.03.2023 - Добавлены параметры fiscalData, acc_number, contract, payer_id, email в описание
сервиса webapi/Register.
2.5.2 16.03.2023
- Удалены параметры amount, currency, description из описания сервиса
SDPayOutPage, параметр id переведен в обязательные;
- Добавлены параметры originator_id, sd_ref в описание сервиса webapi/Register.
2.6 05.04.2023 - Добавлен сервис SDRelocateFunds;
- Удалено описание сервиса webapi/GetApplePaySession.
2.7 30.05.2023 - Добавлены сервисы SDPayOutSBPPrecheck и SDPayOutSBP;
- Добавлен код ошибки 198.
2.8 28.07.2023
- Добавлены сервисы SDPayInByAdvice и SDPayInByUser;
- Внесена корректировка длины параметров client_ref, to_client_ref, from_client_ref и
payer_id.
2.9 14.09.2023
- Добавлены сервисы SDPayInByLoan и SDStatement;
- Добавлен новый статус пользователя 4(locked);
- Сделаны мелкие несущественные правки в описании других сервисов.
2.9.1 10.10.2023
- Добавлен комментарий касательно создания Кубышки для сервиса b2puser/sd-
services/SDGetBalance;
- Добавлены разделы Организация обмена данными, Настройки для интеграции,
Общие сведения о проведении операций;
- Дополнен раздел Обзор терминов и сервисов.
2.10 03.11.2023
- Добавлены сервисы SDPayInDebit2, SDPayInSBPByToken и webapi/CheckToken;
- Добавлен параметр get_token в описание сервисов SDPayInQRLink и SDPayInSBP;
- Добавлен пример уведомления об изменении статуса СБП-привязки;
- Сделаны мелкие несущественные правки в описании других сервисов.
2.11 07.12.2023
- Добавлены сервисы webapi/CardEnroll и webapi/Operation;
- Скорректировано описание сервиса webapi/b2puser/CardEnroll;
- Добавлен параметр unique_key в описание сервисов SDReverse,
webapi/b2puser/Reverse, webapi/Reverse;
- Добавлены параметры tips, token2, client_ref в описание сервисов SDPayInDebit,
SDPayInDebit2 и SDPayIn;
- Сделаны мелкие несущественные правки в описании других сервисов.
2.12 22.12.2023
- Добавлены сервисы SDPayInMobilePrecheck и SDPayInMobile;
- Добавлены новые коды ошибок;
- Сделаны мелкие несущественные правки в описании других сервисов.
2.12.1 13.02.2024
- Актуализирована длина параметров, принимающих в себя идентификаторы
секторов, заказов и операций ПЦ;
- Обновлено Приложение №3;
- Сделаны незначительные правки в описании других сервисов.
2.13 29.03.2024
- Добавлены сервисы webapi/b2puser/VCardReissue и SDChangeState;
- Скорректированы ответы сервисов webapi/Reverse, webapi/b2puser/Reverse и
SDReverse.
2.14 23.04.2024
- Добавлен сервис SDPayInAlfaPay;
- Добавлен параметр unique_key в описание и примеры ответов сервисов
SDPayInDebit, SDPayInDebit2, SDComplete, SDPayIn, SDPayInSBP, SDPayInByUser,
S
2.14.1 28.05.2024
- Внесена корректировка обязательности параметра newpassphrase сервисов
gateweb/b2puser/CheckPhone и gateweb/b2puser/SetPhone;
- Удалено описание сервисов webapi/b2puser/CheckPhoneService и
webapi/b2puser/SetPhoneService;
- Добавлен параметр to_client_ref_stock в описание сервиса SDPayOut.
2.15 06.08.2024
- Добавлены сервисы webapi/GetSBPSubscription, webapi/PurchaseSBPByToken и
webapi/ChangeOrderStatus;
- Добавлен параметр mode и скорректированы варианты ответа в описании сервиса
b2puser/IdentificationStatus;
- Добавлен параметр currency в описание сервиса b2puser/Reverse;
- Удалён параметр inn из описания сервиса b2puser/Register.
2.16 18.04.2025
- Глобально удалена информация о Кубышках, контроль баланса которых ведется в
рамках указанного первого заказа через originator_id в связи с моральным
устареванием данного варианта учёта баланса;
- Добавлен параметр notify_url в описание сервиса webapi/Register;
- Изменена логика обработки параметра to_sd_ref в описании сервиса
SDRelocateFunds;
- Скорректированы ответы сервисов SDGetBalance и b2puser/PayOutSBP;
- Добавлены сервисы webapi/GetOperationConfirmation и webapi/b2puser/PayIn2;
- Добавлена расшифровка возможных значений кодов ответа
b2puser/IdentificationStatus;
- Добавлены рекомендации по переопросу статуса идентификации в описание
сервиса b2puser/IdentificationStatus;
- Удалено описание сервиса b2puser/SetCardCrLimit;
- Добавлены сценарии 158, 1581, 154, 155 в описание сервиса test/SBPTestCase;
- В Приложение №3 добавлен новый вариант колбэка по СБП.
2.17 03.06.2025
- Добавлен сервис SDPayOutIBAN;
- Добавлены параметры status (статус Виртуальной карты) и auth
_
state (результат
идентификации пользователя) в раздел Общее описание процесса;
- Оптимизировано описание возможных значений параметра state (статус
зарегистрированного в ПЦ пользователя) в разделе Общее описание процесса;
- Добавлены значения 6, 7, 8, 9 параметра active (полнота идентификации
пользователя) в раздел Общее описание процесса;
- Добавлены параметры esia, redirecturl в описание сервиса b2puser/Modify;
- Добавлен параметр card_state в описание сервиса b2puser/VCardBlock;
- В Приложение №1 добавлены Коды ответа для оплат по ранее осуществленной
СБП-привязке.
2.18 18.07.2025
- Скорректированы значения card_state в описании сервиса b2puser/VCardBlock;
- Добавлен параметр fee в описание сервиса SDPayOutSBPPrecheck;
- Добавлены параметры P015, P018, P021 и изменено описание параметра P020 в
сервисе SDPurchase;
- В Приложении №1 п.2 изменено оформление дополнительных тегов в ответах
сервисов и добавлены теги для реверсов по операциям СБП;
- В Приложение №1 п.4 добавлены новые и актуализированы некорректные коды
ошибок;
- В Приложение №3 добавлен колбэк об изменении остатка на счете в результате
выполнения банковских проводок;
- Внесены незначительные правки опечаток.
2.19 27.08.2025
- Добавлены сервисы webapi/p2pmarket/PayInSBPMe2MePull,
/webapi/beneficiaries/Register, /webapi/beneficiaries/Info, /webapi/beneficiaries/Modify;
- Добавлен параметр token в описание сервиса SDPayOutSBPPrecheck;
- Изменена длина параметра address в описании сервисов b2puser/Register и
b2puser/Modify;
- Добавлено примечание к описанию параметра sd
_
ref в описание сервиса
SDReverse;
- Добавлены возможные параметры ответа сервиса VCardReissue.
/Confidential
P 2 P M a r k e t С т р а н и ц а 5 | 1 7 2
/Confidential
2.20 08.09.2025 - Добавлены сервисы webapi/p2pmarket/ExtQRPrecheck,
/webapi/p2pmarket/ExtQRPayment.
2.20.1 30.09.2025
- Удалено описание сервиса webapi/PurchaseSBPByToken;
- Добавлены параметры get_
token и token в описание сервиса SDPayInAlfaPay;
- Добавлены дополнительные теги в Приложение №1 п.2.
2.20.2 27.11.2025
- Скорректирован максимальный остаток на счёте для статуса идентификации
пользователя active со значением 5 в разделе Общее описание процесса;
- Добавлен необязательный параметр cof
_
ind в сервисы webapi/b2puser/P2PIn,
webapi/b2puser/PayInDebit, webapi/b2puser/sd-services/SDPayIn, webapi/b2puser/sd-
services/SDPayInDebit, webapi/b2puser/sd-services/SDPayInDebit2 и webapi/CardEnroll;
- Добавлен вариант ответа, учитывающий фазу жизни кошелька, в сервис
webapi/b2puser/Info;
- Добавлены теги <token> и <subscription_state> в ответы сервисов
webapi/GetSBPSubscription и webapi/CheckToken, обновлены примеры ответов;
- В Приложение №1 п.5 добавлены коды ответов 20, 21, 22;
- Добавлен колбэк об изменении фазы жизни кошелька в Приложение №3;
- Внесены незначительные правки опечаток.
P 2 P M a r k e t С т р а н и ц а 6 | 1 7 2
/Confidential
Оглавление
ИЗМЕНЕНИЯ В ДОКУМЕНТЕ ................................................................................................................................ 2
Обзор терминов и сервисов ...................................................................................................................... 11
Термины и определения, используемые в данной Инструкции ................................................................... 11
Назначение сервисов ........................................................................................................................................ 12
Организация обмена данными ................................................................................................................. 15
Настройки для интеграции ........................................................................................................................ 15
Общее описание процесса ........................................................................................................................ 16
Общие сведения о проведении Операций ............................................................................................... 18
Использование заказа для проведения операций ......................................................................................... 18
Ограничение на срок оплаты заказа ................................................................................................................ 18
Статусы заказов .................................................................................................................................................. 18
Типы операций ................................................................................................................................................... 19
Статусы операций .............................................................................................................................................. 19
Отчеты для ТСП об операциях .......................................................................................................................... 20
Сервисы «Кубышка» ................................................................................................................................. 21
Сервисы webapi/b2puser/sd-services/SDPayInDebit и webapi/b2puser/sd-services/SDPayInDebit2 ............. 21
Сервис webapi/b2puser/sd-services/SDComplete ............................................................................................. 25
Сервис webapi/b2puser/sd-services/SDPayIn .................................................................................................... 27
Сервис webapi/b2puser/sd-services/SDPayInSBP ............................................................................................. 30
Сервис webapi/b2puser/sd-services/SDPayInSBPQRLink .................................................................................. 32
Сервис webapi/b2puser/sd-services/SDPayInSberPay ...................................................................................... 33
Сервис webapi/b2puser/sd-services/SDPayInAlfaPay ....................................................................................... 35
Сервис webapi/b2puser/sd-services/SDPayInByUser ........................................................................................ 37
Сервис webapi/b2puser/sd-services/SDPayInByLoan ........................................................................................ 39
Сервис webapi/b2puser/sd-services/SDPayInByAdvice ..................................................................................... 42
Сервис webapi/b2puser/sd-services/SDPayInSBPByToken ................................................................................ 44
Сервис webapi/b2puser/sd-services/SDPayInMobilePrecheck ......................................................................... 46
Сервис webapi/b2puser/sd-services/SDPayInMobile ........................................................................................ 47
Сервис webapi/b2puser/sd-services/SDPayOut ................................................................................................. 48
Сервис webapi/b2puser/sd-services/SDPayOutPage ......................................................................................... 51
Сервис webapi/b2puser/sd-services/SDPayOutSBPPrecheck ............................................................................ 52
Сервис webapi/b2puser/sd-services/SDPayOutSBP........................................................................................... 54
Сервис webapi/b2puser/sd-services/SDPayOutIBAN......................................................................................... 56
Сервис webapi/b2puser/sd-services/SDRelocateFunds ..................................................................................... 58
Сервис webapi/b2puser/sd-services/SDPurchase .............................................................................................. 60
Сервис webapi/b2puser/sd-services/SDReverse ................................................................................................ 63
P 2 P M a r k e t С т р а н и ц а 7 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDGetBalance .......................................................................................... 66
Сервис webapi/b2puser/sd-services/SDStatement ........................................................................................... 67
Сервис webapi/b2puser/sd-services/SDChangeState ........................................................................................ 68
Информационные сервисы работы с виртуальной картой ...................................................................... 70
*Вспомогательный сервис регистрации заказов webapi/Register ................................................................ 70
Сервис webapi/b2puser/Register ....................................................................................................................... 73
Сервис webapi/b2puser/Info .............................................................................................................................. 74
Сервис webapi/b2puser/Modify ........................................................................................................................ 76
Сервис webapi/b2puser/ModifyPage ................................................................................................................. 78
Сервис webapi/b2puser/SetPhone..................................................................................................................... 79
Сервис webapi/b2puser/GetBalance ................................................................................................................. 81
Сервис webapi/b2puser/Statement ................................................................................................................... 82
Сервис gateweb/b2puser/CheckPhone .............................................................................................................. 83
Сервис gateweb/b2puser/SetPhone .................................................................................................................. 85
Сервис webapi/b2puser/VCard .......................................................................................................................... 86
Сервис webapi/b2puser/VCardReissue .............................................................................................................. 87
Сервис webapi/b2puser/SetPhoneVCard ........................................................................................................... 89
Сервис webapi/b2puser/UpdateCardMetadata ................................................................................................. 91
Сервисы работы с финансовыми операциями по виртуальным картам .................................................. 92
Сервис webapi/b2puser/CardEnroll ................................................................................................................... 92
Сервисы webapi/b2puser/PayIn, webapi/b2puser/PayIn2 и webapi/b2puser/P2PIn ...................................... 93
Сервисы webapi/b2puser/PayInDebit и webapi/b2puser/PayInDebit2 ............................................................ 97
Сервис webapi/b2puser/Complete .................................................................................................................. 100
Сервис webapi/b2puser/Reverse ..................................................................................................................... 102
Сервис webapi/b2puser/Transfer..................................................................................................................... 104
Сервис webapi/b2puser/TransferDebit ............................................................................................................ 106
Сервисы webapi/b2puser/PayOut и webapi/b2puser/PayOut2...................................................................... 108
Сервисы webapi/UserAuthorize и webapi/AuthorizeByUser .......................................................................... 110
Сервис webapi/Complete ................................................................................................................................. 112
Сервисы webapi/UserPurchase и webapi/PurchaseByUser ............................................................................ 113
Сервис webapi/Reverse .................................................................................................................................... 114
Сервис webapi/b2puser/CreditUser ................................................................................................................. 116
Сервис webapi/p2pmarket/ExtQRPrecheck ..................................................................................................... 118
Сервис webapi/p2pmarket/ExtQRPayment ..................................................................................................... 120
Сервисы работы с ограничениями виртуальных карт ............................................................................ 122
Сервисы webapi/b2puser/SetAllowedParams и webapi/b2puser/SetRestrictedParams ............................... 122
Сервис CheckLimit ............................................................................................................................................ 123
Сервис webapi/b2puser/VCardBlock................................................................................................................ 125P 2 P M a r k e t С т р а н и ц а 8 | 1 7 2
/Confidential
Сервис webapi/b2puser/VCardUnblock ........................................................................................................... 126
Сервис webapi/b2puser/VCardUnblock2 ......................................................................................................... 128
Сервисы работы с процедурами идентификации .................................................................................. 129
Сервис webapi/b2puser/IdentificationStatus .................................................................................................. 129
Сервисы работы с xPay Wallet’ами .......................................................................................................... 132
Сервис webapi/b2puser/GetPayload ............................................................................................................... 132
Сервисы СБП ............................................................................................................................................ 133
Сервис webapi/b2puser/GetSBPBankList ......................................................................................................... 133
Сервис webapi/b2puser/GetDefaultSBPBank .................................................................................................. 134
Сервис webapi/p2pmarket/PayInSBPMe2MePull ............................................................................................ 135
Сервис webapi/b2puser/PayOutSBPPrecheck ................................................................................................. 136
Сервис webapi/b2puser/PayOutSBP ................................................................................................................ 138
Сервис webapi/GetSBPSubscription ................................................................................................................. 140
Сервис test/SBPTestCase .................................................................................................................................. 141
Вспомогательные сервисы ...................................................................................................................... 143
Сервис webapi/CardEnroll ................................................................................................................................ 143
Сервис webapi/СheckToken ............................................................................................................................. 145
Сервис webapi/Operation ................................................................................................................................ 146
Сервис webapi/ChangeOrderStatus ................................................................................................................. 147
Запрос webapi/GetOperationConfirmation ..................................................................................................... 148
Сервис /webapi/beneficiaries/Register ............................................................................................................ 149
Сервис /webapi/beneficiaries/Info ................................................................................................................... 151
Сервис /webapi/beneficiaries/Modify.............................................................................................................. 152
Приложение №1. Описание форматов xml-сообщений от ПЦ................................................................ 154
1. Формат xml-сообщения, присылаемого на операцию REGISTER ............................................................ 154
2. Формат xml-уведомления по результатам выполнения операции, присылаемого ПЦ на сервер ТСП
методом HTTP POST ......................................................................................................................................... 155
3. Формат xml-сообщения, присылаемого в ответ на запрос webapi/b2puser/Statement ........................ 157
4. Формат xml-сообщения об ошибке ............................................................................................................ 158
5. Описание возможных кодов ответов (Reason Code) ................................................................................ 163
Приложение №2. Формирование и проверка цифровой подписи. ....................................................... 166
Алгоритм формирования цифровой подписи ............................................................................................... 166
Пример формирования подписи.................................................................................................................... 167
Приложение №3. Примеры сallback ....................................................................................................... 168
Типовой сallback от ПЦ .................................................................................................................................... 168
Callback об операциях по виртуальным картам ............................................................................................ 169
Callback об изменении статуса идентификации юзера ................................................................................ 169
Callback об изменении фазы жизни кошелька .............................................................................................. 170
P 2 P M a r k e t С т р а н и ц а 9 | 1 7 2
/Confidential
Callback об операциях через СБП ................................................................................................................... 170
Callback об изменении статуса СБП-привязки ............................................................................................... 171
Callback об изменении остатка на счете в результате выполнения банковских проводок ...................... 172
P 2 P M a r k e t С т р а н и ц а 1 0 | 1 7 2
/Confidential
Обзор терминов и сервисов
Термины и определения, используемые в данной Инструкции
Процессинговый центр (далее ПЦ) – совокупность компьютерных программ и аппаратных средств
Оператора, а также телекоммуникаций и телекоммуникационных сетей, обеспечивающая обработку (прием,
передача, создание, хранение, изменение, удаление) данных, необходимых для осуществления Операций
Плательщиков.
Площадка – ТСП (торгово-сервисное предприятие — юридическое лицо, индивидуальный
предприниматель, кредитная организация и т.п.), предоставляющее продукт, позволяющий
взаимодействовать физическим лицам – держателям банковских карт в рамках реализации услуг ТСП.
ИС ТСП — информационная система ТСП; программно-аппаратный комплекс, обеспечивающий
взаимодействие ТСП и ПЦ со стороны ТСП, в том числе в рамках обмена данными, необходимыми для
осуществления Операций Плательщиков.
Пользователь Площадки (Исполнитель) – физическое лицо, зарегистрированное как клиент Площадки.
Виртуальная карта (далее ВК) – виртуальный счет пользователя Площадки, на / с которого пользователь
Площадки может переводить деньги с / на реальную карту.
Запрос — HTTP-запрос в ПЦ, используемый для передачи данных в формате application/x-www-form-
urlencoded с использованием архитектуры REST, для совершения взаимодействия ИС ТСП и ПЦ в рамках
данной инструкции.
Плательщик — физическое лицо, использующее ПЦ для осуществления Операций по сделкам (договорам,
заявкам), заключаемым между Плательщиком и ТСП.
Эмитент — кредитная организация или иное юридическое лицо, выпускающее Платёжные карты и
предоставляющее их Плательщикам на основании соответствующих договоров.
Заказ — набор данных, определяющий выбранные Плательщиком товары или услуги ТСП, для приобретения
которых Плательщик намерен заключить сделку с ТСП.
Операция — набор данных и последовательность связанных с этими данными сеансов обмена информацией
между ТСП, ПЦ, Эквайером и Эмитентом, отражающие требование ТСП, в рамках реализуемых им товаров
или услуг, по списанию и зачислению денежных средств со счета или на счет Платежной карты Плательщика.
Возврат/Отмена — Операция зачисления Плательщику списанных ранее средств, инициируемая ТСП, в
случае, когда средства были списаны ошибочно или неправомерно, либо Плательщик вернул товар или
отказался от услуги.
Платёжная форма — web-форма, являющаяся частью ПЦ, предназначенная для показа Плательщику с целью
организации приема и подтверждения от Плательщика информации, связанной с проведением Операции.
СБП — Система Быстрых Платежей от НСПК, позволяющая осуществлять перевод средств по
идентификатору получателя, даже если стороны перевода имеют счета в разных кредитных организациях.
СБП позволяет совершать мгновенные платежи в режиме 24/7, в том числе с использованием QR-кода.
P 2 P M a r k e t С т р а н и ц а 1 1 | 1 7 2
/Confidential
Назначение сервисов
Сервис Назначение
Сервисы «Кубышка»
webapi/b2puser/sd-services/SDPayInDebit Холдирование средств по счету карты Плательщика.
webapi/b2puser/sd-services/SDPayInDebit2 Действует аналогично SDPayInDebit, но возвращает
ответ в виде xml-сообщения.
webapi/b2puser/sd-services/SDComplete Списание ранее захолдированных средств и зачисление
их на счет Кубышки ТСП.
webapi/b2puser/sd-services/SDPayIn Списание средств с внешней карты и их зачисление на
баланс Кубышки в виде одной операции.
webapi/b2puser/sd-services/SDPayInSBP Пополнение Кубышки с помощью QR-кода СБП.
webapi/b2puser/sd-
services/SDPayInSBPQRLink
Создание на стороне ПЦ QR-кода для последующей
оплаты средствами СБП.
webapi/b2puser/sd-services/SDPayInSberPay Пополнение Кубышки с помощью SberPay.
webapi/b2puser/sd-services/SDPayInAlfaPay Пополнение Кубышки с помощью AlfaPay.
webapi/b2puser/sd-services/SDPayInByUser Пополнение Кубышки с виртуальной карты
пользователя.
webapi/b2puser/sd-services/SDPayInByLoan Пополнение Кубышки со счета юридического лица.
webapi/b2puser/sd-
services/SDPayInByAdvice
Отражение изменения баланса Кубышки, выполненного
через платежное поручение в банке.
webapi/b2puser/sd-
services/SDPayInSBPByToken
Пополнение Кубышки через безакцептное списание с
помощью СБП-токена.
webapi/b2puser/sd-
services/SDPayInMobilePrecheck
Инициация списания средств со счёта мобильного
оператора в целях последующего зачисления на баланс
Кубышки.
webapi/b2puser/sd-services/SDPayInMobile
Подтверждения списания средств со счёта мобильного
оператора и последующее зачисление их на баланс
Кубышки на базе пречека.
webapi/b2puser/sd-services/SDPayOut Выплата средств со счета Кубышки ТСП на внешнюю
карту.
webapi/b2puser/sd-services/SDPayOutPage Является аналогом webapi/b2puser/sd-
services/SDPayOut с показом платежных страниц ПЦ.
webapi/b2puser/sd-
services/SDPayOutSBPPrecheck
Проверка возможности совершения СБП-выплаты со
счета Кубышки по номеру телефона.
webapi/b2puser/sd-services/SDPayOutSBP Проведение СБП-выплаты со счета Кубышки на базе
ранее выполненного пречека.
webapi/b2puser/sd-services/SDPayOutIBAN Выплата средств со счета Кубышки ТСП на IBAN.
webapi/b2puser/sd-
services/SDRelocateFunds
Перемещение средств между счетами двух Кубышек в
рамках одного сектора.
webapi/b2puser/sd-services/SDPurchase
Перечисление средств со счета Кубышки в пользу
юридического лица, либо для выполнения перевода по
реквизитам счета.
webapi/b2puser/sd-services/SDReverse
Отмена или возврат средств по операциям
SDPayInDebit, SDComplete, SDPayIn, SDPayInSBP,
SDPayInSBPQRLink, SDPurchase.
webapi/b2puser/sd-services/SDGetBalance Получение актуального баланса Кубышки.
webapi/b2puser/sd-services/SDStatement Получение выписки по операциям Кубышки.
webapi/b2puser/sd-services/SDChangeState Блокировка/разблокировка Кубышки.
Информационные сервисы работы с виртуальной картой
webapi/b2puser/Register
Регистрация Исполнителя в ПЦ. Используйте, чтобы
зарегистрировать исполнителей пакетно и заранее,
добавляя к их данным ряд необязательных параметров
(опционально).
P 2 P M a r k e t С т р а н и ц а 1 2 | 1 7 2
/Confidential
webapi/b2puser/Info Получение информации о любом зарегистрированном в
ПЦ Исполнителе.
webapi/b2puser/Modify Изменения информации о зарегистрированном в ПЦ
Исполнителе.
webapi/b2puser/ModifyPage
Действует аналогично webapi/b2puser/Modify, но
перенаправляет Плательщика на Платёжные страницы
ПЦ.
webapi/b2puser/SetPhone
Привязка / перепривязка номера телефона к
Виртуальной карте Исполнителя. Производится на
нашей стороне в форме редиректа с использованием
секретного слова.
webapi/b2puser/GetBalance Получение от ПЦ информации об остатке средств на
счёте Виртуальной карты Исполнителя.
webapi/b2puser/Statement Получение выписки по операциям Виртуальной карты
конкретного Исполнителя.
gateweb/b2puser/CheckPhone Проверка валидности телефона и пароля Исполнителя.
gateweb/b2puser/SetPhone Привязка / перепривязка номера телефона к
Виртуальной карте Исполнителя.
webapi/b2puser/VCard
Показ полных карточных данных в ПЦ. Показ
происходит после проведения аутентификации с
использованием привязанного к пользователю номера
телефона.
webapi/b2puser/VCardReissue Перевыпуск Виртуальной карты пользователя.
webapi/b2puser/SetPhoneVCard
Одновременная привязка / перепривязка телефона и
показ полных карточных данных. Аналогично
webapi/b2puser/VCard, но с предварительным этапом
привязки телефона.
webapi/b2puser/UpdateCardMetadata Обновление дизайна Виртуальной карты в wallet.
Сервисы работы с финансовыми операциями по виртуальным картам
webapi/b2puser/CardEnroll
Привязка карты зарегистрированного Исполнителя к
его Виртуальной карте и получение токена
привязываемой карты.
webapi/b2puser/PayIn Пополнение Виртуальной карты Исполнителя с внешней
карты одной операцией (без холдирования).
webapi/b2puser/P2PIn
Является аналогом webapi/b2puser/PayIn, но отличается
порядком проведения операции в протоколе общения с
банком. Вместо двух транзакций (Purchase +
Merchandise return) отправляется одна (P2PTransfer).
webapi/b2puser/PayInDebit Холдирование средств на внешней карте Заказчика до
момента подтверждения операции.
webapi/b2puser/PayInDebit2 Действует аналогично webapi/b2puser/PayInDebit, но
возвращает ответ в виде xml-сообщения.
webapi/b2puser/Complete
Списание ранее захолдированных средств (PayInDebit)
с карты Заказчика и их перевод на Виртуальную карту
Исполнителя. Для завершения операции обязательно
указать идентификатор конечного Исполнителя.
webapi/b2puser/Reverse
Отмена сделанных ранее блокировок средств и
операций, созданных с помощью сервисов
b2puser/PayIn, b2puser/PayInDebit, b2puser/Complete в
ПЦ.
webapi/b2puser/Transfer Перевод средств с Виртуальной карты одного
Исполнителя на Виртуальную карту другого.
webapi/b2puser/TransferDebit Холдирование средств на Виртуальной карте
Исполнителя с целью последующего списания.
P 2 P M a r k e t С т р а н и ц а 1 3 | 1 7 2
/Confidential
webapi/b2puser/PayOut Вывод средств с Виртуальной карты Исполнителя на
внешнюю карту.
webapi/b2puser/PayOut2 Действует аналогично webapi/b2puser/PayOut, но
возвращает ответ в виде xml-сообщения.
webapi/UserAuthorize Холдирование средств на Виртуальной карте
Исполнителя за услуги Площадки (в адрес ЮЛ).
webapi/AuthorizeByUser Действует аналогично webapi/UserAuthorize, но
возвращает ответ в виде xml-сообщения.
webapi/Complete
Подтверждение соответствующей операции
webapi/UserAuthorize для списания средств за услуги
Площадки (в адрес ЮЛ).
webapi/UserPurchase Одностадийное списание (холдирование + списание)
средств за услуги Площадки (в адрес ЮЛ).
webapi/PurchaseByUser Действует аналогично webapi/UserPurchase, но
возвращает ответ в виде xml-сообщения.
webapi/Reverse
Отмена операций, созданных ранее с помощью
сервисов webapi/UserPurchase, webapi/UserAutorize,
webapi/Complete в ПЦ.
webapi/b2puser/CreditUser Пополнение Виртуальной карты Исполнителя со счета
Площадки в ПЦ.
webapi/p2pmarket/ExtQRPrecheck Получение информации по «внешнему» QR-коду
webapi/p2pmarket/ExtQRPayment Проведение платежа по «внешнему» QR-коду
Сервисы работы с ограничениями виртуальных карт
webapi/b2puser/SetAllowedParams
Установка разрешенных параметров оплат с карты
Исполнителя (МСС, ритейлеры, терминалы, страны и
валюты).
webapi/b2puser/SetRestrictedParams
Установка запрещенных параметров оплат с карты
Исполнителя (МСС, ритейлеры, терминалы, страны и
валюты).
CheckLimit Способ ответа на запрос ПЦ о возможности пополнения
Виртуальной карты клиента.
webapi/b2puser/VCardBlock Блокировка карты Исполнителя.
webapi/b2puser/VCardUnblock Разблокировка ранее заблокированной карты
Исполнителя.
webapi/b2puser/VCardUnblock2
Разблокировка ранее заблокированной карты
Исполнителя без проверки смс-кода.
Действует аналогично webapi/b2puser/VCardUnblock, но
возвращает ответ в виде xml-сообщения.
Сервисы работы с процедурами идентификации
webapi/b2puser/IdentificationStatus Идентификация физического лица по его реквизитам
паспорта и ФИО в ПЦ.
Сервисы работы с xPay Wallet’ами
webapi/b2puser/GetPayload Получение данных для wallet-приложения iOS.
Сервисы СБП
webapi/b2puser/GetSBPBankList Получение справочника банков, поддерживающих СБП.
webapi/b2puser/GetDefaultSBPBank Получение дефолтного банка Получателя перевода СБП.
webapi/p2pmarket/PayInSBPMe2MePull
Пополнение баланса виртуального кошелька
плательщика через СБП с его же счета, открытого в
стороннем банке.
webapi/b2puser/PayOutSBPPrecheck
Вывод средств с Виртуальной карты на счет через СБП
по номеру телефона (этап 1). Запрос данных от СБП для
подтверждения Отправителем личности Получателя.
webapi/b2puser/PayOutSBP Вывод средств с Виртуальной карты на счет через СБП
по номеру телефона (этап 2). Подтверждение перевода.
webapi/GetSBPSubscription Регистрация СБП-привязки без оплаты.
P 2 P M a r k e t С т р а н и ц а 1 4 | 1 7 2
/Confidential
webapi/b2puser/sd-services/SDPayInSBP Пополнение Кубышки с помощью QR-кода СБП.
webapi/b2puser/sd-
services/SDPayInSBPQRLink
Создание на стороне ПЦ QR-кода для последующей
оплаты средствами СБП.
Вспомогательные сервисы
webapi/CardEnroll Регистрация карты и получение токена.
webapi/CheckToken Проверка статуса ранее полученного токена.
webapi/Operation Получение информации по операции.
webapi/ChangeOrderStatus Смена статуса заказа.
Организация обмена данными
Взаимодействие ИС ТСП и ПЦ реализуется с использованием архитектуры REST.
1. 2. 3. 4. При отправке Запросов к ПЦ, ИС ТСП должна использовать 2048-битное SSL шифрование (протокол
HTTPS) и методы GET или POST.
В режиме промышленной эксплуатации рекомендуется по возможности все Запросы к ПЦ реализовать
только методом POST.
В зависимости от типа сделанного Запроса, в качестве ответа от ПЦ приходит:
• либо команда браузеру на перевод Плательщика на страницу, адрес которой предварительно был
получен от ИС ТСП;
• либо web-страница для показа Плательщику;
• либо информационное сообщение для обработки в ИС ТСП.
В ПЦ при обмене сообщениями по умолчанию используется кодировка UTF-8.
Настройки для интеграции
ПЦ поддерживает два режима взаимодействия с ИС ТСП: тестовый режим и режим промышленной
эксплуатации («боевой»). На физическом уровне для реализации тестового и боевого режимов
взаимодействия в ПЦ используются две ничем не связанные между собой подсистемы ПЦ — тестовая и
боевая системы. Поэтому, при подключении к каждой из указанных систем должны быть использованы свои,
соответствующие системе, реквизиты: адрес отправки Запросов, идентификаторы ТСП в системе ПЦ и
реквизиты доступа к Личному кабинету.
Для интеграции с сервером ПЦ ТСП используйте следующие значения.
Название Значение на тестовом стенде Значение на «боевом» стенде
URL для отправки Запросов https://test.paygine.com/ https://pay.paygine.com/
Уникальный идентификатор
учетной записи ТСП в ПЦ
Предоставляется после регистрации ТСП в ПЦ
(sector)
Пароль для формирования
цифровой подписи Предоставляется после регистрации ТСП в ПЦ
Номер тестовой карты Предоставляется после
регистрации ТСП в ПЦ Неприменимо
URL для входа в Личный
кабинет https://test.paygine.com/office/ https://pay.paygine.com/office/
Логин и пароль для входа в
Личный кабинет Предоставляется после регистрации ТСП в ПЦ
P 2 P M a r k e t С т р а н и ц а 1 5 | 1 7 2
/Confidential
Общее описание процесса
ПЦ ведет учет Площадок, выделяя на каждую Площадку отдельную учетную запись — сектор. В рамках
Площадки, ПЦ ведет учет пользователей Площадки, контролируя их уникальность по значениям: номер
пользователя (client_ref), номер паспорта (persondoc_number), номер телефона (phone).
Пользователю выпускается Виртуальная карта (далее ВК), одна карта на один client_ref.
status — статус Виртуальной карты пользователя. Возможные значения:
Значение Расшифровка
OPEN Открыта, доступна к работе
LOST Утеряна
STOLEN Украдена
NOT_ACTIVE Не активна
VIP Принадлежит VIP-клиенту
DOMESTIC Открыта для использования внутри страны
COMPROMISED Скомпрометирована (подделана, заподозрена в мошенничестве и т.п.)
CLOSED Закрыта, использование запрещено
REFERRAL Необходим дополнительный запрос к эмитенту
DECLARED Не издана
EXPIRED Истек срок действия
При блокировке / разблокировке ВК
0 Заблокирована
1 Разблокирована
Для каждого пользователя в ПЦ предусмотрены три параметра, определяющие работу с пользователями и
их переводами — state, auth
_
state и active (возвращаются в xml-ответе вида <b2p_user>).
state — статус зарегистрированного в ПЦ пользователя ВК. Возможные значения:
Значение Расшифровка Зачисление на ВК Списание с
ВК
0 (new) Новый клиент, может иметь привязанную
Виртуальную Карту (далее ВК).
разрешено запрещено
1 (active) Клиент имеет ВК и привязанный к ней телефон. разрешено
2 (inactive) По какой-либо причине, клиент считается
временно неактивным.
разрешено запрещено
3 (blocked) Клиент заблокирован в ПЦ. запрещено
4 (locked) Клиент заблокирован эмитентом. запрещено
auth
_
state — результат идентификации пользователя ВК (идентифицирован он или нет).
Возможные значения:
Возможные
Значение Расшифровка
значения
active
0 (anonymous)
Пользователь не идентифицирован. Ставится в двух случаях:
1. Идентификация не проводилась
2. Идентификация проводилась, но данные не подтверждены
0, 1, 3, 4, 6, 7,
8
2 (ui_documents) Данные пользователя подтверждены. Успешно проведена
упрощенная идентификация (УПРИД) по паспортным данным.
5
3 (full) Пользователь полностью идентифицирован. Успешно проведена
полная идентификация через ЕСИА.
9
P 2 P M a r k e t С т р а н и ц а 1 6 | 1 7 2
/Confidential
active — текущий статус идентификации пользователя и её влияние на лимиты по ВК.
Возможные значения:
Значение Расшифровка Максимальный
остаток на счете
Максимальный
объем списаний *
Идентификация не проводилась
0
Пользователь завел ВК, номер телефона еще не
привязан. Для управления пользователем ВК
привяжите номер телефона. ₽ 15,000 ₽ 40,000
1 Пользователь завел ВК и привязал номер
телефона. Можно запросить идентификацию.
Идентификация по паспортным данным (УПРИД)
3 Идентификация запрошена, ожидается ответ от
МВД или ФНС. Промежуточный статус. ₽ 15,000 ₽ 40,000
4 Идентификация проведена, получен отказ от
МВД или ФНС. Данные не подтверждены.
5 Идентификация проведена, данные
подтверждены через УПРИД. ₽ 100,000 ₽ 200,000
Идентификация по ЕСИА
6 Идентификация запрошена, ожидается ответ от
МВД. Промежуточный статус.
7 Идентификация проведена, получен явный
отказ от МВД. Данные не подтверждены.
₽ 15,000 ₽ 40,000
8 Отказ в идентификации по любым другим
причинам. За подробностями обращайтесь в ПЦ.
9 Полная успешная идентификация через ЕСИА. По согласованию По согласованию
* - с начала календарного месяца
Примечание: в случае active = 0 (anonymous) – телефон пользователя не привязан, при остальных
значениях параметра active телефон привязан.
Условия проведения операции зачисления средств на ВК пользователя:
• state не должен быть 3 (blocked) или 4 (locked);
• Остаток средств на ВК при сложении с суммой текущей операции не должен превышать
разрешенный для active максимальный остаток.
Условия проведения списания средств с ВК пользователя:
• state должен быть 1 (active);
• Остаток средств на ВК не должен превышать разрешенный для active максимальный остаток.
• Сумма операций с начала календарного месяца при сложении с суммой текущей операции не
должна превышать разрешенный для active максимальный объем списаний с ВК.
Например, при active=1 приходит xml следующего вида (рассмотренные параметры выделены жирным):
<b2p_user>
<reg_date>2021.02.10 10:38:18</reg_date>
<sector>888</sector>
<client_ref>gkgk</client_ref>
<state>1</state>
<auth_state>0</auth_state>
<active>1</active>
<phone>79081234567</phone>
<available_balance>0</available_balance>
<currency>643</currency>
<status>OPEN</status>
<signature>ZWVlNzJkOTNjMzRlZjgzMWJiYjYwNjIwOGViNDMxYmE=</signature>
</b2p_user>
P 2 P M a r k e t С т р а н и ц а 1 7 | 1 7 2
/Confidential
Общие сведения о проведении Операций
Использование заказа для проведения операций
1. 2. 3. Проведение Операции в ПЦ возможно только в рамках ранее зарегистрированного Заказа. Заказ
содержит описание предоставляемого товара или услуги и их основные параметры (сумма,
текстовое описание и т.д.). Операция содержит описание сути финансового взаимодействия с
Плательщиком в рамках предоставления товара или услуги, описанных в Заказе. Если в описании
некоторых Запросов указано, что предварительная регистрация Заказа при выполнении этого
Запроса не требуется — это означает, что ПЦ до проведения Операции сам автоматически
зарегистрирует Заказ на основании параметров Запроса.
Любая Операция может быть связана только с одним Заказом.
В рамках одного Заказа может быть зарегистрировано несколько Операций. При этом, в общем
случае, в рамках одного Заказа может быть проведена только одна успешная Операция одного типа.
Исключения:
• Операция типа REVERSE. ПЦ позволяет выполнять многократный частичный возврат по
Операциям оплаты товаров или услуг, и все такие Операции производятся для одного Заказа —
того, в котором зарегистрирована исходная Операция.
Ограничение на срок оплаты заказа
1. 2. 3. При регистрации Заказа можно указать время, в течение которого позволено оплатить Заказ —
время жизни Заказа.
По умолчанию, в ПЦ установлено время жизни Заказа 90 суток.
По истечении времени жизни, Заказ не может быть оплачен. В ответ на попытку оплатить такой
Заказ ПЦ вернет сообщение об ошибке.
Статусы заказов
Заказ, в зависимости от типа и результата выполнения в рамках него Операций, может иметь один из
следующих статусов.
Статус Описание
REGISTERED Заказ зарегистрирован в ПЦ и не содержит успешных Операций.
AUTHORIZED В рамках Заказа успешно проведена Операция типа AUTHORIZE (деньги для
проведения платежа заблокированы на счёте Карты Плательщика).
COMPLETED Заказ успешно оплачен. В рамках Заказа проведена успешная Операция одного
из типов: PURCHASE, COMPLETE, P2PTRANSFER, P2PCREDIT.
CANCELED Заказ отменен. В рамках Заказа проведена успешная Операция типа REVERSE.
Деньги по проведенной ранее в рамках Заказа оплате возвращены Плательщику.
BLOCKED
Заказ заблокирован внутренними правилами ПЦ.
ТСП необходимо получить подтверждение от Оператора ПЦ, либо дождаться
смены статуса Заказа на другой, прежде чем принимать решение об исполнении
обязательств перед Плательщиком.
EXPIRED Заказ с истекшим сроком действия. Время, установленное на оплату Заказа,
истекло.
P 2 P M a r k e t С т р а н и ц а 1 8 | 1 7 2
/Confidential
Типы операций
Типы Операций, поддерживаемые ПЦ, перечислены в таблице ниже.
Тип Описание
AUTHORIZE
Холдирование средств на счёте Платёжной карты Плательщика. Доступный
остаток средств на Платёжной карте Плательщика уменьшается, но
средства со счета не списываются до выполнения Операции COMPLETE.
COMPLETE
Операция подтверждения соответствующей Операции AUTHORIZE Заказа.
При успешном выполнении данной Операции производится списание
ранее захолдированных средств со счёта Платёжной карты Плательщика.
PURCHASE
Операция, при успешном выполнении которой сразу выполняется списание
средств со счёта Платёжной карты Плательщика. Данная Операция
аналогична последовательному выполнению пары Операций: AUTHORIZE и
COMPLETE.
REVERSE Возврат/Отмена. Позволяет вернуть средства, списанные или
захолдированные ранее в рамках Заказа.
P2PTRANSFER Операция перевода средств с Карты на Карту.
P2PCREDIT Операция зачисления денежных средств на Карту со счета ТСП.
PURCHASE_BY_QR
Операция прямого перевода средств со счёта плательщика на счёт
юридического лица или транзитный счёт организации. Проводится через
СБП.
CREDIT_BY_QR Операция прямого перевода средств со счёта ТСП на счёт физического
лица. Проводится через СБП.
PAYOUT_SBP Операция вывода денежных средств с виртуальной карты на счет
физического лица по номеру телефона. Проводится через СБП.
Статусы операций
В зависимости от этапа обработки в ПЦ, Операция может иметь один из следующих статусов.
Статус Описание
REGISTERED Операция зарегистрирована в ПЦ.
PENDING Операция направлена Эмитенту на одобрение.
CHECKOUT Операция ожидает изменений на стороне контрагента.
APPROVED Операция завершена. Получено одобрение Эмитента.
REJECTED Операция завершена. В проведении операции отказано.
TIMEOUT
Операция не завершена. ПЦ не получил ответ от эмитента. Требуется уточнение
статуса Операции. Рекомендуем настроить переопрос методом webapi/Operation
до получения конечного статуса.
ERROR Операция завершена. Получена ошибка при обработке Операции.
P 2 P M a r k e t С т р а н и ц а 1 9 | 1 7 2
/Confidential
Отчеты для ТСП об операциях
При правильно заполненных данных в Личном кабинете, ПЦ позволяет настроить следующие уведомления
в адрес ТСП:
• Отчет об операциях за период. По итогам дня или месяца ПЦ отправляет на email ТСП сообщение
со вложенным xls-документом. Этот документ содержит список Операций Плательщиков в ТСП за
период (ежедневно, ежемесячно). Если за отчетный период Операций нет, сообщение не
формируется;
• Email-уведомление о совершённой Операции. По завершении каждой Операции, ПЦ отправляет на
email ТСП сообщение с результатами проведения Операции Плательщика в ТСП. Если при
обработке Запроса на проведение Операции возникает ошибка, и Операция не регистрируется, то
уведомление не формируется;
• Уведомление на url о совершённой Операции. По завершении каждой Операции, ПЦ отправляет на
url ТСП xml-сообщение с результатами проведения Операции Плательщика в ТСП. При этом:
o ПЦ отправляет уведомление методом HTTP POST. Формат сообщения см. Приложение №1, п.2;
o После отправки уведомления, ПЦ ожидает от ИС ТСП ответ в виде сообщения “ok”
(text/plain). Если ответа нет, ПЦ делает ещё две попытки отправить уведомление с
интервалом в 5 минут;
o Уведомление содержит цифровую подпись, позволяющую проверить подлинность отправителя;
o Если при обработке Запроса на проведение Операции возникает ошибка, и Операция не
регистрируется, то уведомление не формируется.
P 2 P M a r k e t С т р а н и ц а 2 0 | 1 7 2
/Confidential
Сервисы «Кубышка»
Сервисы «Кубышка» — это сервисы, использующие для совершения расчётов дополнительный финансовый
«накопитель» — Кубышку, — позволяющую реализовать нетиповые подходы к организации сбора средств
плательщиков и последующему распределению этих средств при проведении выплат и переводов.
Сервисы «Кубышка» позволяют группировать потоки входящих и исходящих платежей, привязывая их к
отдельным Кубышкам, причем контроль баланса каждой Кубышки будет вестись автоматически
Процессинговым центром.
С помощью Сервисов «Кубышка» можно производить расчёты, собирая в Кубышку (одной или несколькими
операциями) средства с виртуальных и реальных карт Плательщиков и распределяя затем (так же, либо
одной, либо несколькими операциями) эти средства, выполняя пополнения различных реальных или
виртуальных карт Получателей, перечисляя средства в пользу юридических лиц или совершая переводы по
реквизитам счета.
Кубышка не привязана к заказу, идентификатор Кубышки задается ТСП.
Все операции, связываемые с балансом Кубышки (включая первое пополнение), должны содержать
идентификатор Кубышки в параметре sd_ref. Ограничений на количество операций пополнения или
расходования баланса Кубышки нет.
Сервисы webapi/b2puser/sd-services/SDPayInDebit и webapi/b2puser/sd-
services/SDPayInDebit2
Используйте запросы SDPayInDebit и SDPayInDebit2 для холдирования средств по счету карты Плательщика.
Запросы являются аналогами друг друга, выполняются с отображением Плательщику страниц ПЦ и
отличаются только форматом ответа:
• SDPayInDebit возвращает экранный чек, либо перенаправляет пользователя на url / failurl;
• SDPayInDebit2 возвращает xml-сообщение.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 1. Параметры запросов SDPayInDebit и SDPayInDebit2
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, payer_id, token, amount,
currency, sd_ref, unique_key, cof
_
ind, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей — копейки.
Если указан id, значение amount берётся из заказа.
1000
description Строка
(1000)
Описание перевода.
Если указан id, значение description берётся из
заказа.
iPhone 12
Mini
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD).
Если указан id, значение currency берётся из заказа.
643
Необязательные параметры
id Целое (19)
Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ, полученный по
результатам webapi/Register.
2231412
P 2 P M a r k e t С т р а н и ц а 2 1 | 1 7 2
sd_ref Строка (255) unique_key Строка (50)
tips Целое (12)
token Строка (255)
token2 Строка (255) payer_id Строка (255)
client_ref Строка (255) get_token Целое (1)
cvc Строка (3) fee Целое (12)
action Строка (3)
reference Строка (100) url Строка (500)
failurl Строка (500)
applePaymentData JSON-объект
в base64
P 2 P M a r k e t /Confidential
Уникальный идентификатор Кубышки. JMT1000
Ключ уникальности запроса. Генерируется на
стороне ТСП. При получении ключа ПЦ выполняет
проверку на наличие дубликата среди
обрабатываемых запросов и созданных операций.
Формат: допустимы цифры [0-9], латинские буквы
[a-zA-Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования
ключа уникальности осуществляется по
согласованию с Оператором.
Сумма чаевых в минимальных единицах валюты.
Не может превышать amount (основную сумму
операции).
Токен ранее зарегистрированной Платёжной карты,
заменяющий Карту Плательщика.
Позволяет Плательщику не вводить все реквизиты
Карты при повторном переводе, см. Работа с
токеном карты в основной инструкции по
интеграции.
Токен карты получателя чаевых.
Идентификатор пользователя Площадки, для
которого будет запомнена карта плательщика.
Если в запросе указан токен карты (параметр token),
значение параметра payer_id не используется.
Идентификатор пользователя получателя чаевых.
Запрос на предоставление токена использованной в
Операции Платёжной карты в составе уведомления
на url. Возможные значения: 0 (по умолчанию), 1.
0 — токен не возвращать;
1 — вернуть токен.
Проверочный код Карты Плательщика
CVV2/CVC2/ППК2.
Комиссия для удержания с Плательщика при
списании средств с его карты в минимальных
единицах валюты. Для рублей — копейки.
Если action=pay, то ПЦ осуществляет попытку
провести Операцию на основании параметров
Запроса, без отображения Платёжной формы
Плательщику. При нехватке данных для проведения
Операции — выводится форма для заполнения.
Номер перевода на стороне ТСП (в ИС ТСП). 12345ABC
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции.
Значение игнорируется для запроса SDPayInDebit2.
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
неуспешного окончания проведения Операции
(когда статус Операции отличен от APPROVED, или
Операция не сформирована из-за какой-либо
ошибки).
Значение игнорируется для запроса SDPayInDebit2.
Платежные данные Apple Pay в формате base64-
кодированной строки JSON. Значение параметра
paymentData, указанного в платежном токене Apple
(параметр paymentData внутри объекта класса
С т р а н и ц а 2 2 | 1 7 2
/Confidential
PKPaymentToken). Имеет более высокий приоритет
над полем applePaymentToken.
Параметр анализируется только вместе action=pay.
applePaymentToken Строка (255)
JSON-объект с платёжными данными Apple Pay.
Значение платежного токена, полученного от Apple
(объект класса PKPaymentToken).
Параметр анализируется только вместе action=pay.
googleCryptogram JSON-объект
в base64)
Платежные данные Google Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Google. Параметр
анализируется только вместе action=pay.
yandexCryptogram JSON-объект
в base64
Платежные данные Yandex Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Yandex. Параметр
анализируется только вместе action=pay.
samsung_ref_id Строка (255)
Платёжные данные Samsung Pay. Значение
уникального референса запроса на получение
криптограммы карты. Параметр анализируется
только вместе action=pay.
cof_ind Строка (4)
Значение, определяющее порядок применения
признаков использования сохраненных реквизитов
карты. Возможные значения:
CC (Credentials Captured) — с сохранением
реквизитов карты;
CNC (Credentials Not Captured) — без сохранения
реквизитов карты;
СIT (Consumer-Initiated Transaction) — операция по
сохраненным реквизитам, инициированная
плательщиком;
MITR (Merchant-Initiated Transaction Recurring) —
операция типа «подписка» по сохраненным
реквизитам, инициированная ТСП;
MITI (Merchant-Initiated Transaction Installment) —
операция типа «рассрочка» по сохраненным
реквизитам, инициированная ТСП.
CIT
Примечание: действует только для карт МИР.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInDebit
ИС ТСП перенаправляет Плательщика методом HTTP POST на Платёжную форму ПЦ с использованием
Запроса SDPayInDebit для ввода карточных данных:
POST /webapi/b2puser/sd-services/SDPayInDebit HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 107
Content-Type: application/x-www-form-urlencoded
signature=ODBhMjQxMjFhYzgwNGQ1MDQ1ZTFiYjllZTIwZGFhMjQ=&sector=3905&amount=100&curre
ncy=643&description=test
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля. В случае,
если запрос задублировался, и по данному unique_key уже была совершена операция, пользователь
перенаправляется на страницу показа экранного чека ПЦ с описанием ошибки, либо на страницу-
диспетчер, выполняющую редирект на url / failurl в зависимости от статуса операции-дубля с
передачей кода ошибки (в зависимости от выбранных настроек сектора);
P 2 P M a r k e t С т р а н и ц а 2 3 | 1 7 2
/Confidential
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если id Заказа задан, то статус этого Заказа должен быть REGISTERED.
В процессе обработки запроса:
• Пользователь перенаправляется на Платежную страницу ПЦ для ввода или подтверждения
карточных данных с возможным переходом на страницу ввода одноразового пароля 3DS для
подтверждения списания средств со своей карты;
• После проведения всех проверок и подтверждения корректности данных, ПЦ выполняет операцию
холдирования средств на карте Плательщика.
По окончании обработки запроса, при успешном завершении операции, ПЦ изменяет статус Заказа на
AUTHORIZED. Далее:
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• на адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной операции. Вид и состав уведомления см. в Приложении №3.
После обработки Запроса SDPayInDebit2, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>AUTHORIZE</type>
<state>COMPLETE</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 2 4 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDComplete
Используйте запрос SDComplete для списания ранее захолдированных средств и зачисления их на счет
Кубышки ТСП. Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления на
Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 2. Параметры запроса webapi/b2puser/sd-services/SDComplete
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ, полученный по
результатам запроса SDPayInDebit.
2231412
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
amount, currency, sd_ref, unique_key, password в указанном
порядке, см. Приложение №2.
Необязательные параметры
amount Целое (12)
Сумма операции в минимальных единицах валюты. Для
рублей — копейки.
Укажите amount если хотите изменить сумму списания,
заданную при холдировании средств.
1000
sd_ref Строка (255)
Уникальный идентификатор Кубышки. Если ранее в
запросе SDPayInDebit был передан другой sd_ref,
значение, заданное в текущем запросе, его заменит.
JMT1000
fee Целое (12)
Комиссия для удержания с Плательщика при списании
средств с его карты в минимальных единицах валюты. Для
рублей — копейки.
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840
для USD). 643
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-Z],
дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с
Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDComplete
ИС ТСП отправляет Запрос SDComplete в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDComplete HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 113
Content-Type: application/x-www-form-urlencoded
signature=NTM0YTc2ZDEzODI0MzJkZjAxZWNiZGI2OGNmZmJmMTc=&sector=3905&id=3503790&amoun
t=0&currency=643&sd_ref=SDRef7
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
P 2 P M a r k e t С т р а н и ц а 2 5 | 1 7 2
/Confidential
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Статус Заказа должен быть AUTHORIZED.
В процессе обработки запроса:
• ПЦ выполняет операцию списания средств с карты Плательщика и при ее успешном завершении
зачисляет средства на баланс Кубышки. Сумма списания равна сумме значений amount и fee;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств будет проводиться на баланс этой ранее зарегистрированной Кубышки. Иначе будет
создана и пополнена новая Кубышка.
По окончании обработки запроса, при успешном завершении операции, ПЦ изменяет статус Заказа на
COMPLETED.
После обработки Запроса webapi/b2puser/sd-services/SDComplete, ПЦ может прислать один из вариантов
ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>REVERSE</type>
<state>COMPLETE</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 2 6 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPayIn
Используйте запрос SDPayIn для выполнения списания средств с внешней карты и их зачисления на баланс
Кубышки в виде одной операции. Запрос выполняется с отображением Плательщику страниц ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 3. Параметры запроса webapi/b2puser/sd-services/SDPayIn
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они
использованы в запросе): sector, id, payer_id,
token, amount, currency, sd_ref, unique_key,
cof
_
ind, password в указанном порядке, см.
Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах
валюты. Для рублей — копейки.
Если указан id, значение amount берётся из
заказа.
1000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для
EUR; 840 для USD).
Если указан id, значение currency берётся из
заказа.
643
description Строка
(1000)
Описание перевода. Если указан id, значение
description берётся из заказа. iPhone 12 Mini
Необязательные параметры
id Целое (19)
Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ,
полученный по результатам запроса
webapi/Register.
2231412
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на
стороне ТСП. При получении ключа ПЦ
выполняет проверку на наличие дубликата
среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские
буквы [a-zA-Z], дефис и нижнее
подчеркивание [-_].
Предупреждение: возможность
использования ключа уникальности
осуществляется по согласованию с
Оператором.
tips Целое (12)
Сумма чаевых в минимальных единицах
валюты.
Не может превышать amount (основную
сумму операции).
token Строка (255)
Токен ранее зарегистрированной Платёжной
карты, заменяющий Карту Плательщика.
Позволяет Плательщику не вводить все
реквизиты Карты при повторном переводе,
см. Работа с токеном карты в основной
инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 2 7 | 1 7 2
token2 payer_id client_ref get_token cvc fee action reference url failurl applePaymentData applePaymentToken googleCryptogram P 2 P M a r k e t Строка (255) Строка (255)
Строка (255) Целое (1)
Строка (3) Целое (12)
Строка (3)
Строка (100) Строка (500)
Строка (500)
JSON-объект
в base64
Строка (255)
JSON-объект
в base64)
/Confidential
Токен карты получателя чаевых.
Идентификатор пользователя Площадки, для
которого будет запомнена карта
плательщика.
Если в запросе указан токен карты (параметр
token), значение параметра payer_id не
используется.
Идентификатор пользователя получателя
чаевых.
Запрос на предоставление токена
использованной в Операции Платёжной
карты в составе уведомления на url.
Возможные значения: 0 (по умолчанию), 1.
0 — токен не возвращать;
1 — вернуть токен.
Проверочный код Карты Плательщика
CVV2/CVC2/ППК2.
Комиссия для удержания с Плательщика при
списании средств с его карты в минимальных
единицах валюты. Для рублей — копейки.
Если action=pay, то ПЦ осуществляет попытку
провести Операцию на основании
параметров Запроса, без отображения
Платёжной формы Плательщику. При
нехватке данных для проведения Операции,
Плательщику будет выведена Платёжная
форма для заполнения недостающих данных.
Номер перевода на стороне ТСП (в ИС ТСП). 12345ABC
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции.
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в
случае неуспешного окончания проведения
Операции (когда статус Операции отличен от
APPROVED, или Операция не сформирована
из-за какой-либо ошибки).
Платежные данные Apple Pay в формате
base64-кодированной строки JSON. Значение
параметра paymentData, указанного в
платежном токене Apple (параметр
paymentData внутри объекта класса
PKPaymentToken). Имеет более высокий
приоритет над полем applePaymentToken.
Параметр анализируется только вместе
action=pay.
JSON-объект с платёжными данными Apple
Pay. Значение платежного токена,
полученного от Apple (объект класса
PKPaymentToken).
Параметр анализируется только вместе
action=pay.
Платежные данные Google Pay в формате
base64-кодированной строки JSON. Значение
поля cryptogram, полученного от Google.
С т р а н и ц а 2 8 | 1 7 2
/Confidential
Параметр анализируется только вместе
action=pay.
yandexCryptogram JSON-объект
в base64
Платежные данные Yandex Pay в формате
base64-кодированной строки JSON. Значение
поля cryptogram, полученного от Yandex.
Параметр анализируется только вместе
action=pay.
samsung_ref_id Строка (255)
Платёжные данные Samsung Pay. Значение
уникального референса запроса на
получение криптограммы карты. Параметр
анализируется только вместе action=pay.
cof_ind Строка (4)
Значение, определяющее порядок
применения признаков использования
сохраненных реквизитов карты. Возможные
значения:
CC (Credentials Captured)— с сохранением
реквизитов карты;
CNC (Credentials Not Captured) — без
сохранения реквизитов карты;
СIT (Consumer-Initiated Transaction) —
операция по сохраненным реквизитам,
инициированная плательщиком;
MITR (Merchant-Initiated Transaction
Recurring) — операция типа «подписка» по
сохраненным реквизитам, инициированная
ТСП;
MITI (Merchant-Initiated Transaction
Installment) — операция типа «рассрочка» по
сохраненным реквизитам, инициированная
ТСП.
CIT
Примечание: действует только для карт
МИР.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayIn
ИС ТСП перенаправляет Плательщика методом HTTP POST на Платёжную форму ПЦ с использованием
Запроса SDPayIn для ввода карточных данных:
POST /webapi/b2puser/sd-services/SDPayIn HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 107
Content-Type: application/x-www-form-urlencoded
signature=ODBhMjQxMjFhYzgwNGQ1MDQ1ZTFiYjllZTIwZGFhMjQ=&sector=3905&amount=100&curre
ncy=643&description=test
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля. В случае,
если запрос задублировался, и по данному unique_key уже была операция, пользователь
перенаправляется на страницу показа экранного чека ПЦ с описанием ошибки, либо на страницу-
диспетчер, выполняющую редирект на url / failurl в зависимости от статуса операции-дубля с
передачей кода ошибки (в зависимости от выбранных настроек сектора);
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Статус Заказа должен быть REGISTERED.
В процессе обработки запроса:
P 2 P M a r k e t С т р а н и ц а 2 9 | 1 7 2
/Confidential
• Пользователь перенаправляется на Платежную страницу ПЦ для ввода или подтверждения
карточных данных с возможным переходом на страницу ввода одноразового пароля 3DS для
подтверждения списания средств со своей карты;
• После проведения всех проверок и подтверждения корректности данных, ПЦ выполняет операцию
списания средств с карты Плательщика и, при ее успешном завершении, зачисляет средства на
баланс Кубышки;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств проводится на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и
пополнена новая Кубышка.
По окончании обработки запроса, при успешном завершении операции, ПЦ изменяет статус Заказа на
COMPLETED. Далее:
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной операции. Вид и состав уведомления см. в Приложении №3.
Сервис webapi/b2puser/sd-services/SDPayInSBP
Используйте запрос SDPayInSBP для пополнения Кубышки с помощью перевода через СБП. Запрос
выполняется с отображением Плательщику страниц ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 4. Параметры запроса webapi/b2puser/sd-services/SDPayInSBP
Описание Название Тип (длина) Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, amount, currency, sd_ref, unique_key,
password в указанном порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты. Для
рублей — копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840
для USD). Если указан id, значение currency берётся из
заказа.
643
description Строка (1000) Описание перевода. Если указан id, значение description
берётся из заказа.
iPhone 12
Mini
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ. 2231412
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-
Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с
Оператором.
P 2 P M a r k e t С т р а н и ц а 3 0 | 1 7 2
/Confidential
reference Строка (100) Номер перевода на стороне ТСП (в ИС ТСП). Если указан
id, значение reference берётся из заказа. 12345ABC
url Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по завершении
Операции. Если указан id, значение url берётся из заказа.
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
неуспешного окончания проведения Операции (когда
статус Операции отличен от APPROVED, или Операция не
сформирована из-за какой-либо ошибки). Если не указан,
считается равным значению url.
get_token Целое (1)
Запрос на предоставление СПБ-токена в составе
уведомления на url.
Возможные значения: 0 (по умолчанию), 1.
0 — токен не возвращать;
1 — вернуть СБП-токен.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInSBP
ИС ТСП перенаправляет Плательщика методом HTTP POST на Платёжную форму ПЦ с использованием
Запроса SDPayInSBP для ввода карточных данных:
POST /webapi/b2puser/sd-services/SDPayInSBP HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 107
Content-Type: application/x-www-form-urlencoded
signature=ODBhMjQxMjFhYzgwNGQ1MDQ1ZTFiYjllZTIwZGFhMjQ=&sector=3905&amount=100&curre
ncy=643&description=test
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля. В случае,
если запрос задублировался, и по данному unique_key уже была операция, пользователь
перенаправляется на страницу показа экранного чека ПЦ с описанием ошибки, либо на страницу-
диспетчер, выполняющую редирект на url / failurl в зависимости от статуса операции-дубля с
передачей кода ошибки (в зависимости от выбранных настроек сектора);
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
В процессе обработки запроса:
• Пользователь перенаправляется на Платежную страницу ПЦ с QR-кодом CБП для оплаты;
• При успешном завершении операции оплаты, ПЦ зачисляет средства на баланс Кубышки;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств проводится на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и
пополнена новая Кубышка.
По окончании обработки запроса, при успешном завершении операции, ПЦ изменяет статус Заказа на
COMPLETED. Далее:
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной операции. Вид и состав уведомления см. в Приложении №3.
P 2 P M a r k e t С т р а н и ц а 3 1 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPayInSBPQRLink
Используйте запрос SDPayInSBPQRLink для получения от ПЦ ссылки на выполнение перевода через СБП.
Сервис работает только с предварительно зарегистрированным Заказом (webapi/Register). Запрос
выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные
страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 5. Параметры запроса webapi/b2puser/sd-services/SDPayInSBPQRLink
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ. 2231412
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, sd_ref, password в указанном порядке,
см. Приложение №2.
Необязательные параметры
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
get_token Целое (1)
Запрос на предоставление СПБ-токена в составе уведомления
на url.
Возможные значения: 0 (по умолчанию), 1.
0 — токен не возвращать;
1 — вернуть СБП-токен.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInSBPQRLink
ИС ТСП отправляет Запрос SDPayInSBPQRLink в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInSBPQRLink HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 108
Content-Type: application/x-www-form-urlencoded
signature=MGM2ZjRkODc4YWFhNjA1ODE3ZmZmNDcwYzJiNmEyYTk=&sector=893&id=3110071&descri
ption=test&reference=test
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Статус Заказа должен быть REGISTERED, иначе возвращается ошибка «Неверный статус заказа»;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств по операции, выполненной с использованием предоставленной ссылки, будет проводится
на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и пополнена новая
Кубышка.
По окончании работы сервиса:
• При успехе регистрации QR-кода в НСПК. Приходит xml следующего вида:
P 2 P M a r k e t С т р а н и ц а 3 2 | 1 7 2
/Confidential
<SDPayInSBPQRLink>
<order_id>458851</order_id>
<qrcode_ref>1344</qrcode_ref>
<state>PENDING</state>
<code>RQ00000</code>
<message>Запрос обработан успешно</message>
<qroper_ref>1344</qroper_ref>
<qrcId>AD10005F3ED9GCLM94UBH9UKCVN5V07K</qrcId>
<payload>https://qr.nspk.ru/AD10005F3ED9GCLM94UBH9UKCVN5V07K?type=02&bank
=100000000030&sum=1000&cur=RUB&crc=A479</payload>
<qr_img> байтовое представление картинки с QR-кодом в виде строки base64
</qr_img>
</SDPayInSBPQRLink>
• При отказе от НСПК. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой
(в соответствии со справочником Агентской схемы СБП).
<SDPayInSBPQRLink>
<order_id>1001123</<id>
<qrcode_ref>10004</qr_ref> // номер записи в таблице ПЦ e_qr_code
<state>REJECTED</state>
<code>RQ03001</code>
<message>Wrong message format</message>
</SDPayInSBPQRLink>
• При ошибке. Приходит xml-сообщение с указанием кода ошибки и расшифровкой (см. Приложение
№1, п.4).
Сервис webapi/b2puser/sd-services/SDPayInSberPay
Используйте запрос SDPayInSberPay для пополнения Кубышки с помощью SberPay. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 6. Параметры запроса webapi/b2puser/sd-services/SDPayInSberPay
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
os_type Строка (7)
Тип операционной системы мобильного устройства
или персонального компьютера. Возможные
значения:
android — операционная система Android;
ios — операционная система iOS;
other — другая операционная система.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если присутствуют в запросе) параметры
sector, id, amount, currency, sd_ref, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Общая сумма всех последующих расходов по
сделке в минимальных единицах валюты. Для
рублей - копейки.
Если указан id, значение amount берётся из заказа.
1000
description Строка (1000)
Описание перевода.
Если указан id, значение description берётся из
заказа.
P 2 P M a r k e t С т р а н и ц а 3 3 | 1 7 2
/Confidential
Необязательные параметры
currency Целое (3) Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD). 643
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ. 2231412
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
fee Целое (12)
Комиссия для удержания с Плательщика при
списании средств с его карты в минимальных
единицах валюты. Для рублей — копейки.
reference Строка (100)
Номер перевода на стороне ТСП (в ИС ТСП).
Если в запросе указан параметр id, значение
параметра reference из запроса игнорируется.
12345ABC
url Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции. Если в запросе указан
параметр id, значение параметра url из запроса
игнорируется
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
неуспешного окончания проведения Операции
(когда статус Операции отличен от APPROVED, или
Операция не сформирована из-за какой-либо
ошибки). Если в запросе указан параметр id,
значение параметра url из запроса игнорируется.
Если failurl не указан, ПЦ считает его равным
значению url.
phone Строка (12) Телефон Плательщика. 79219999999
back_deep_link Строка (500)
Ссылка для возврата в мобильное приложение ТСП
(мерчанта) после оплаты. Если было указано при
регистрации заказа (webapi/Register), и в запросе
указан id — значение back_deep_link берется из
заказа.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInSberPay
ИС ТСП отправляет Запрос SDPayInSberPay в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInSberPay HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 147
Content-Type: application/x-www-form-urlencoded
signature=NThhMzQwYjhlYjAzZGY2OTYwZjYxNGRhNDVmYWI5MjU=&sector=1775&os_type=ios&amou
nt=50000&currency=643&description=test&reference=test&sd_ref=ref
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств по операции, выполненной с использованием предоставленной ссылки, будет проводится
на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и пополнена новая
Кубышка.
P 2 P M a r k e t С т р а н и ц а 3 4 | 1 7 2
/Confidential
По окончании работы сервиса:
• При успехе. Приходит xml следующего вида:
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sberpay>
<order_id>458208</order_id>
<order_state>REGISTERED</order_state>
<reference>test</reference>
<operation_id>424867</operation_id>
<date>2022-10-13T16:11:57.516+03:00</date>
<type>PURCHASE</type>
<state>REJECTED</state>
<amount>50000</amount>
<currency>643</currency>
</sberpay>
• При ошибке. Приходит xml-сообщение с указанием кода ошибки и расшифровкой (см. Приложение
№1, п.4).
Сервис webapi/b2puser/sd-services/SDPayInAlfaPay
Используйте запрос SDPayInAlfaPay для пополнения Кубышки с помощью AlfaPay. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 7. Параметры запроса webapi/b2puser/sd-services/SDPayInAlfaPay
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
os_type Строка (7)
Тип операционной системы мобильного устройства
или персонального компьютера. Возможные
значения:
android — операционная система Android;
ios — операционная система iOS;
other — другая операционная система.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если присутствуют в запросе) параметры
sector, id, amount, currency, sd_ref, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Общая сумма всех последующих расходов по
сделке в минимальных единицах валюты. Для
рублей - копейки.
Если указан id, значение amount берётся из заказа.
1000
description Строка (1000)
Описание перевода.
Если указан id, значение description берётся из
заказа.
Необязательные параметры
currency Целое (3) Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD). 643
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ. 2231412
sd_ref Строка (255) Уникальный идентификатор Кубышки (вариант
учета №2). JMT1000
P 2 P M a r k e t С т р а н и ц а 3 5 | 1 7 2
/Confidential
fee Целое (12)
Комиссия для удержания с Плательщика при
списании средств с его карты в минимальных
единицах валюты. Для рублей — копейки.
reference Строка (100)
Номер перевода на стороне ТСП (в ИС ТСП).
Если в запросе указан параметр id, значение
параметра reference из запроса игнорируется.
12345ABC
url Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции. Если в запросе указан
параметр id, значение параметра url из запроса
игнорируется
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
неуспешного окончания проведения Операции
(когда статус Операции отличен от APPROVED, или
Операция не сформирована из-за какой-либо
ошибки). Если в запросе указан параметр id,
значение параметра url из запроса игнорируется.
Если failurl не указан, ПЦ считает его равным
значению url.
phone Строка (12) Телефон Плательщика. 79219999999
back_deep_link Строка (500)
Ссылка для возврата в мобильное приложение ТСП
(мерчанта) после оплаты. Если было указано при
регистрации заказа (webapi/Register), и в запросе
указан id — значение back_deep_link берется из
заказа.
get_token Целое (1)
Запрос на выпуск токена для карты, которую
выберет клиент в приложении при оплате через
AlfaPay. Возможные значения: 0 (по умолчанию), 1.
0 — токен не возвращать;
1 — вернуть токен.
Предупреждение: выпуск и использование
токенов AlfaPay доступны по согласованию с
Оператором.
token Строка (255)
Токен ранее использованной платёжной карты,
заменяющий Карту Плательщика. Позволяет не
выбирать карту в приложении AlfaPay повторно, а
также пополнять Кубышку без участия
Плательщика.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInAlfaPay
ИС ТСП отправляет Запрос SDPayInAlfaPay в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInAlfaPay HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 147
Content-Type: application/x-www-form-urlencoded
signature=NThhMzQwYjhlYjAzZGY2OTYwZjYxNGRhNDVmYWI5MjU=&sector=1775&os_type=ios&amou
nt=50000&currency=643&description=test&reference=test&sd_ref=ref
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 3 6 | 1 7 2
/Confidential
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств по операции, выполненной с использованием предоставленной ссылки, будет проводится
на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и пополнена новая
Кубышка.
По окончании работы сервиса:
• При успехе. Приходит xml следующего вида:
<SDPayInAlfaPay>
<order_id>1009982</order_id>
<order_state>REGISTERED</order_state>
<reference>test</reference>
<operation_id>5587788</operation_id>
<date>2024.01.28 00:23:19</date>
<type>P2PTRANSFER</type>
<state>PENDING</state>
<amount>50000</amount>
<currency>643</currency>
<token>APa75cb395-57cf-44a5-b9cb-dc30a82eeb1b</token>
</SDPayInAlfaPay>
• При ошибке. Приходит xml-сообщение с указанием кода ошибки и расшифровкой (см. Приложение
№1, п.4).
Сервис webapi/b2puser/sd-services/SDPayInByUser
Используйте запрос SDPayInByUser для пополнения Кубышки с помощью Виртуальной карты пользователя.
Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на
Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 8. Параметры запроса webapi/b2puser/sd-services/SDPayInByUser
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя ТСП, с чьей Виртуальной
карты переводятся средства.
nikita
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если присутствуют в запросе) параметры
sector, id, amount, currency, client_ref, sd_ref,
unique_key, password в указанном порядке, см.
Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Общая сумма всех последующих расходов по сделке в
минимальных единицах валюты. Для рублей -
копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
Если указан id, значение currency берётся из заказа.
643
description Строка (1000) Описание перевода.
Если указан id, значение description берётся из заказа. iPhone 14
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам Запроса webapi/Register.
2231412
P 2 P M a r k e t С т р а н и ц а 3 7 | 1 7 2
/Confidential
sd_ref Строка (255) Уникальный идентификатор Кубышки (вариант учета
№2). JMT1000
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-
zA-Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования
ключа уникальности осуществляется по согласованию
с Оператором.
fee Целое (12)
Комиссия для удержания с Плательщика при списании
средств с его карты в минимальных единицах валюты.
Для рублей — копейки.
Если указан id, значение fee берётся из заказа.
0
reference Строка (100) Номер перевода на стороне ТСП (в ИС ТСП).
Если указан id, значение reference берётся из заказа. 12345ABC
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInByUser
ИС ТСП отправляет Запрос SDPayInByUser в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInByUser HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 105
Content-Type: application/x-www-form-urlencoded
signature=YTBjNjRjNmFmNTE5NDAyYWQ4OTdmZjFlMTFiZDIyZWY=&sector=893&id=5016061&client
_ref=nikita&sd_ref=zzz
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств по операции, выполненной с использованием предоставленной ссылки, будет проводится
на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и пополнена новая
Кубышка.
По окончании работы сервиса:
• Вариант 1. Запрос успешно обработан. Приходит xml следующего вида:
<?xml version="1.0" encoding="UTF-8" ?>
<operation>
<date>2023.07.28 12:37:51</date>
<ps>2</ps>
<iso>643</iso>
<signature>YjU2Zjk3MzU0ODA5NmM2MzhmYzIzN2Q3NzZkZGY2YTg=</signature>
<fee>0</fee>
<type>P2PTRANSFER</type>
<sd_ref>zzz</sd_ref>
<reference>fea9cb36-7f2f-477c-84d9-ed7b67f87ad4</reference>
<reason_code>1</reason_code>
<currency>643</currency>
<unique_key>test2</unique_key>
<id>1776440</id>
<state>APPROVED</state>
<pan>557071******4769</pan>
P 2 P M a r k e t С т р а н и ц а 3 8 | 1 7 2
/Confidential
<terminal_id>POS_1</terminal_id>
<approval_code>314002</approval_code>
<amount>10000</amount>
<client_ref>nikita</client_ref>
<bin_issuer>JOINT STOCK COMMERCIAL BANK “MOSCOW INDUSTRIAL
BANK”</bin_issuer>
<multiple></multiple>
<message>Successful financial transaction</message>
<rrn>35377588&amp;#29;35377591</rrn>
<sector_id>893</sector_id>
<bin_issuer2>JSCB MOSCOW INDUSTRIAL BANK</bin_issuer2>
<iso2>643</iso2>
<order_id>5016061</order_id>
<order_state>COMPLETED</order_state>
<expdate>10/2024</expdate>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>P2PTRANSFER</type>
<state>APPROVED</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/b2puser/sd-services/SDPayInByLoan
Используйте запрос SDPayInByLoan для пополнения Кубышки со счета юридического лица. Запрос
выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные
страницы ПЦ.
Предупреждение: данный сервис доступен только по согласованию с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 9. Параметры запроса webapi/b2puser/sd-services/SDPayInByLoan
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19)
Уникальный идентификатор учетной записи ТСП
(владельца счета, с которого будет пополнена
Кубышка) в ПЦ.
1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам Запроса webapi/Register.
2231412
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
P 2 P M a r k e t С т р а н и ц а 3 9 | 1 7 2
/Confidential
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если присутствуют в запросе) параметры
sector, id, sd_ref, unique_key, password в указанном
порядке, см. Приложение №2.
Необязательные параметры
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-
zA-Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования
ключа уникальности осуществляется по согласованию
с Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInByLoan
ИС ТСП отправляет Запрос SDPayInByLoan в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInByLoan HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 84
Content-Type: application/x-www-form-urlencoded
signature=MGFkMmZhNDdlNzMwMjI3NzU2OGVkMjRlOGE4NDgyODk=&sector=503&id=475497&sd_ref=
1
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств по операции, выполненной с использованием предоставленной ссылки, будет проводится
на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и пополнена новая
Кубышка.
По окончании работы сервиса:
• Вариант 1. Запрос успешно обработан. Приходит xml следующего вида:
<?xml version="1.0" encoding="UTF-8" ?>
<operation>
<order_id>475497</order_id>
<order_state>COMPLETED</order_state>
<reference>9e0dc499-6fbd-473a-887e-ea2ee5d175c9</reference>
<id>435744</id>
<date>2023.08.09 17:29:26</date>
<type>P2PTRANSFER</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>3000</amount>
<fee>0</fee>
<currency>643</currency>
<unique_key>test2</unique_key>
<approval_code>079284</approval_code>
<sd_ref>1</sd_ref>
<sector_id>503</sector_id>
<bin_issuer>JOINT STOCK COMMERCIAL BANK "MOSCOW INDUSTRIAL
BANK"</bin_issuer>
P 2 P M a r k e t С т р а н и ц а 4 0 | 1 7 2
/Confidential
<bin_issuer2>JSCB Moscow Industrial Bank</bin_issuer2>
<iso>643</iso>
<iso2>643</iso2>
<ps>2</ps>
<rrn>35491767</rrn>
<terminal_id>POS_1</terminal_id>
<ofd_state/>
<signature>YmExZThmYWIzYTMyNmVjNGYyZjEzMmFiNWEwOGRjYTE=</signature>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>P2PTRANSFER</type>
<state>COMPLETE</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 4 1 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPayInByAdvice
Используйте запрос SDPayInByAdvice для отражения изменения баланса Кубышки, выполненного через
платежное поручение в банке. Запрос выполняется в режиме обмена данными «сервер-сервер», без
перенаправления Плательщика на Платёжные страницы ПЦ.
Предупреждение: данный сервис доступен только по согласованию с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 10. Параметры запроса webapi/b2puser/sd-services/SDPayInByAdvice
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если присутствуют в запросе) параметры
sector, id, amount, fee, currency, sd_ref, unique_key,
password в указанном порядке, см. Приложение
№2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Общая сумма всех последующих расходов по
сделке в минимальных единицах валюты. Для
рублей - копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
Если указан id, значение currency берётся из
заказа.
643
description Строка (1000)
Описание перевода.
Если указан id, значение description берётся из
заказа.
Необязательные параметры
id Целое (19)
Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ, полученный по
результатам запроса webapi/Register.
2231412
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на
стороне ТСП. При получении ключа ПЦ выполняет
проверку на наличие дубликата среди
обрабатываемых запросов и созданных операций.
Формат: допустимы цифры [0-9], латинские буквы
[a-zA-Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования
ключа уникальности осуществляется по
согласованию с Оператором.
fee Целое (12)
Комиссия для удержания с Плательщика при
списании средств с его карты в минимальных
единицах валюты. Для рублей — копейки.
reference Строка (100)
Номер перевода на стороне ТСП (в ИС ТСП).
Если в запросе указан параметр id, значение
параметра reference из запроса игнорируется.
12345ABC
P 2 P M a r k e t С т р а н и ц а 4 2 | 1 7 2
/Confidential
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInByAdvice
ИС ТСП отправляет Запрос SDPayInByAdvice в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInByAdvice HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 88
Content-Type: application/x-www-form-urlencoded
signature=OGM0YTc5NDFlYzZiMTVhOTJhYjlhZDA2M2FmODU5ZTA=&sector=3013&id=4952681&sd_re
f=zzz
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств по операции, выполненной с использованием предоставленной ссылки, будет проводится
на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и пополнена новая
Кубышка.
По окончании работы сервиса:
• Вариант 1. Запрос успешно обработан. Приходит xml следующего вида:
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<operation>
<order_id>4952681</order_id>
<order_state>COMPLETED</order_state>
<reference>fe70d728-27a1-4f32-ae81-a29061a5c789</reference>
<id>1740143</id>
<date>2023.07.10 14:32:51</date>
<type>P2PTRANSFER</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>500</amount>
<fee>0</fee>
<currency>643</currency>
<unique_key>test2</unique_key>
<approval_code>906068</approval_code>
<signature>NzAyOTA4OWM3NjY4MzJiOWMyNjE1NTdlNTEwZDQ0YWM=</signature>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>P2PTRANSFER</type>
<state>COMPLETE</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
P 2 P M a r k e t С т р а н и ц а 4 3 | 1 7 2
/Confidential
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/b2puser/sd-services/SDPayInSBPByToken
Используйте запрос SDPayInSBPByToken для пополнения Кубышки через безакцептное списание денежных
средств с использованием ранее выпущенного СБП-токена. Запрос выполняется в режиме обмена данными
«сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Предупреждение: данный сервис доступен только по согласованию с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 11. Параметры запроса webapi/b2puser/sd-services/SDPayInSBPByToken
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ. 2231412
token Строка (39) СБП-токен, полученный ТСП во время осуществления
привязки через SDPayInSBP или SDPayInSBPQRLink.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, token, sd_ref, unique_key, password
в указанном порядке, см. Приложение №2.
Необязательные параметры
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-
Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с
Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInSBPByToken
ИС ТСП отправляет Запрос SDPayInSBPByToken в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInSBPByToken HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 138
Content-Type: application/x-www-form-urlencoded
signature=NmY2ODZmZDRjZjQzNDhjMjJmYTE0NzllYjNiMGZlYTE=&sector=1869&id=487446&token=
SBP1d422-60d0-4b18-b468-60897cafd31f&sd_ref=test_ref123
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Принадлежность к сектору и валидность переданного в запросе СБП-токена. Если есть ошибки —
ПЦ возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 4 4 | 1 7 2
/Confidential
• Если в запросе указан sd_ref, который ранее уже был зарегистрирован для сектора, зачисление
средств по операции, выполненной с использованием предоставленной ссылки, будет проводится
на баланс этой ранее зарегистрированной Кубышки. Иначе будет создана и пополнена новая
Кубышка.
По окончании работы сервиса:
• Вариант 1. Запрос успешно обработан. Приходит xml следующего вида:
<?xml version="1.0" encoding="UTF-8" ?>
<operation>
<order_id>487459</order_id>
<order_state>COMPLETED</order_state>
<reference>af207cae-a38b-4526-aa71-6bc07e6c3fbf</reference>
<id>460857</id>
<date>2023.10.23 11:07:49</date>
<type>PURCHASE_BY_QR</type>
<state>APPROVED</state>
<amount>10000</amount>
<fee>0</fee>
<currency>643</currency>
<unique_key>test2</unique_key>
<sd_ref>test4212</sd_ref>
<sector_id>1</sector_id>
<ps>11</ps>
<ofd_link>https://test.paygine.com/ofd/getReceipt/sector=1&operationId=46
0857&signature=ZTJlYjVlNjYxNjQzMTc3MTJkNTdkODBhNDVhMTU2NWI=</ofd_link>
<payload>https://qr.nspk.ru/BD10006LC02P46CD853PK9DG493SHI73?type=02&bank
=1crt88888881&sum=10000&cur=RUB&crc=B3A8</payload>
<qrcId>BD10006LC02P46CD853PK9DG493SHI73</qrcId>
<sbpTranId>asdghwerydfhsjkdhfuwoijkk</sbpTranId>
<payerId>*********0000</payerId>
<signature>MTlhN2JhMDFmOWJlYjUwMGQyZGM4Yzc5NjA1OGRmZjY=</signature>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>PURCHASE_BY_QR</type>
<state>COMPLETE</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 4 5 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPayInMobilePrecheck
Используйте запрос SDPayInMobilePrecheck для инициации списания средств со счёта мобильного
оператора в целях последующего зачисления на баланс Кубышки. Запрос SDPayInMobilePrecheck
выполняется в режиме обмена данными «сервер-сервер», без перенаправления на Платёжные страницы
ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 12. Параметры запроса webapi/b2puser/sd-services/SDPayInMobilePrecheck
Описание Название Тип (длина) Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
phone Строка (20) Номер телефона Плательщика.
79191013
456
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
id, sd_ref, phone, amount, fee, currency, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты. Для
рублей — копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
Если указан id, значение currency берётся из заказа.
643
description Строка (1000) Описание перевода.
Если указан id, значение description берётся из заказа.
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
reference Строка (100)
Номер перевода на стороне Площадки. Если не указан,
значение формируется автоматически на стороне ПЦ.
Если указан id, значение reference берётся из заказа.
12345ABC
fee Целое (12)
Эквайринговая комиссия за перевод в минимальных
единицах валюты. Для рублей – копейки.
Если указан id, значение fee берётся из заказа.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInMobilePrecheck
ИС ТСП отправляет Запрос SDPayInMobilePrecheck в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInMobilePrecheck HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 161
Content-Type: application/x-www-form-urlencoded
signature=MjYyMWJlM2RkNmExNjVkZjlhZjI5NjEzOGJlZjE5Zjc=&sector=893&phone=79112820910
&amount=10000&currency=643&description=test&fee=500&reference=12345&sd_ref=zzz
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 4 6 | 1 7 2
/Confidential
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса.
По окончании работы сервиса:
• При успехе. Приходит xml следующего вида:
<SDPayInMobilePrecheck>
<precheck_id>730211959044920001</precheck_id>
<order_id>471556</order_id>
<phone>79110123456</phone>
<sd_ref>15300</sd_ref>
<amount>12300</amount>
<fee>45</fee>
<signature>ZDg2M2NmMWNjNTRlYzI0MzNjZWJiZWY2NWNlNDg4MGE=</signature>
</SDPayInMobilePrecheck>
• При ошибке. Приходит xml-сообщение с указанием кода ошибки и расшифровкой (см. Приложение
№1, п.4).
Сервис webapi/b2puser/sd-services/SDPayInMobile
Используйте запрос SDPayInMobile для подтверждения списания средств со счёта мобильного оператора и
последующего зачисления их на баланс Кубышки на базе пречека. Запрос SDPayInMobile выполняется в
режиме обмена данными «сервер-сервер», без перенаправления на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 13. Параметры запроса webapi/b2puser/sd-services/SDPayInMobile
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19)
Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register
или SDPayInMobilePrecheck.
2231412
precheck_id Строка (100)
Уникальный идентификатор инициации списания
средств с использованием мобильной коммерции,
полученный по результатам запроса
SDPayInMobilePrecheck.
73021195904
4920001
smscode Строка (20) Код из смс-сообщения. 123456
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, sd_ref, smscode, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayInMobile
ИС ТСП отправляет Запрос SDPayInMobile в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayInMobile HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 130
Content-Type: application/x-www-form-urlencoded
signature=MjU2ZmRkMzQ5NTBiMzZlMzg5MzcyODNjODRmNGZmMjQ=&sector=893&id=470448&smscode
=1234&precheck_id=740846519803352001&sd_ref=zzz
P 2 P M a r k e t С т р а н и ц а 4 7 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса;
• Наличие выполненного ранее пречека.
По окончании работы сервиса:
• При успехе. Приходит xml следующего вида:
<operation>
<order_id>470656</order_id>
<order_state>COMPLETED</order_state>
<reference>8c01c99a-9218-4fd1-9648-8368b47520bc</reference>
<id>440280</id>
<date>2023.06.26 18:28:05</date>
<type>PHONE_PAYMENT</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>1000</amount>
<currency>643</currency>
<sd_ref>zzz</sd_ref>
<sector_id>893</sector_id>
<phone>79112342323</phone>
<ps>14</ps>
<signature>OWVmNzk0MjlhNDU4NDMwMWJlZjdlNzc4NmQzODJlNDQ=</signature>
</operation>
• При ошибке. Приходит xml-сообщение с указанием кода ошибки и расшифровкой (см. Приложение
№1, п.4).
Сервис webapi/b2puser/sd-services/SDPayOut
Используйте запрос SDPayOut для выплаты средств со счета Кубышки ТСП на внешнюю карту. Запрос
SDPayOut выполняется в режиме обмена данными «сервер-сервер», без перенаправления на Платёжные
страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 14. Параметры запроса webapi/b2puser/sd-services/SDPayOut
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, token, client_ref,
to_client_ref_stock, pan, amount, currency, sd_ref,
unique_key, password в указанном порядке, см.
Приложение №2.
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей — копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3) Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD). 643
P 2 P M a r k e t С т р а н и ц а 4 8 | 1 7 2
/Confidential
Если указан id, значение currency берётся из заказа.
description Строка
(1000)
Описание перевода. Если указан id, значение
description берётся из заказа.
iPhone 12
Mini
Необязательные параметры
id Целое (19) Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ. 2231412
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-
zA-Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования
ключа уникальности осуществляется по согласованию
с Оператором.
reference Строка (100) Номер Заказа на стороне ТСП (в ИС ТСП). 12345ABC
fee Целое (12)
Комиссия для удержания с ТСП при списании средств
с его технического счета в минимальных единицах
валюты. Для рублей —копейки.
client_ref Строка (255) Идентификатор пользователя ТСП, которому
переводятся средства.
to_client_ref_stock JSON-объект
в base64
Мульти-зачисления (нескольким разным мерчантам) в
формате base64-кодированной строки JSON.
Включает в себя общую сумму мульти-зачисления и
список пар client_ref и amount, где требуется
перевести мерчанту сумму, определенную
параметром amount.
см. ниже
token Строка (255) Токен карты получателя средств. Обязателен, если не
указан pan.
pan Строка (20) Номер карты получателя средств. Обязателен, если не
указан token.
ПРИМЕР — JSON-объект для отражения мульти-зачисления
Примерный вид строки JSON (параметр to_client_ref_stock) до кодирования:
{"amount_shared":12000,"shares":[{"client_ref":"Raphael","amount":3500},{"client_re
f":"Donatello","amount":1500},{"client_ref":"Michelangelo","amount":7000}]}
После base64-кодирования:
to_client_ref_stock=eyJhbW91bnRfc2hhcmVkIjoxMjAwMCwic2hhcmVzIjpbeyJjbGllbnRfcmVmIjo
iUmFwaGFlbCIsImFtb3VudCI6MzUwMH0seyJjbGllbnRfcmVmIjoiRG9uYXRlbGxvIiwiYW1vdW50IjoxNT
AwfSx7ImNsaWVudF9yZWYiOiJNaWNoZWxhbmdlbG8iLCJhbW91bnQiOjcwMDB9XX0=
При получении в запросе параметра to_client_ref_stock:
• Если в запросе также передан параметр client_ref, то приоритет отдается параметру
to_client_ref_stock, происходит мульти-выплата;
• Сумма всех amount в JSON должна совпадать со значением amount_shared.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayOut
ИС ТСП отправляет Запрос SDPayOut в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayOut HTTP/1.1
Host: test.paygine.com
P 2 P M a r k e t С т р а н и ц а 4 9 | 1 7 2
/Confidential
Accept: */*
Content-Length: 149
Content-Type: application/x-www-form-urlencoded
signature=NTAwOWFkNDUxYzQ1NjgyNTljNDNjZmM3M2FmYzg1OGQ=&sector=3905&sd_ref=3503823&p
an=5570725111394269&amount=200&currency=643&description=qwe
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• sd_ref должен быть ранее зарегистрирован для данного сектора;
• Сумма параметров amount + fee, указанных в запросе, не должна превышать сумму текущего
баланса Кубышки, идентификатор которой указан в параметре sd_ref.
По окончании работы сервиса:
• В случае успешной операции заказ переводится в статус COMPLETED;
• Доступный баланс Кубышки sd_ref уменьшается на сумму amount + fee.
После обработки Запроса webapi/b2puser/sd-services/SDPayOut, ПЦ может прислать один из вариантов
ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>P2PTRANSFER</type>
<state>COMPLETE</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 5 0 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPayOutPage
Используйте запрос SDPayOutPage для выплаты средств со счета Кубышки ТСП на внешнюю карту. Запрос
аналогичен SDPayOut, но выполняется с перенаправлением Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 15. Параметры запроса webapi/b2puser/sd-services/SDPayOutPage
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
token, client_ref, amount, currency, sd_ref, unique_key,
password в указанном порядке, см. Приложение №2.
id Целое (19) Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ. 2231412
Уникальный идентификатор Кубышки.
sd_ref Строка (255)
Важно: Параметр должен быть передан при
JMT1000
регистрации заказа (webapi/Register).
Необязательные параметры
reference Строка (100) Номер Заказа на стороне ТСП (в ИС ТСП). 12345ABC
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-
Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с
Оператором.
fee Целое (12)
Комиссия для удержания с ТСП при списании средств с
его технического счета в минимальных единицах валюты.
Для рублей —копейки.
client_ref Строка (255) Идентификатор пользователя ТСП, которому переводятся
средства.
token Строка (255) Токен карты получателя средств.
pan Строка (20) Номер карты получателя средств.
action Строка (3)
Если action=pay, то ПЦ осуществляет попытку провести
Операцию на основании параметров Запроса, без
отображения Платёжной формы Плательщику. При
нехватке данных для проведения Операции — выводится
форма для заполнения.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayOutPage
ИС ТСП перенаправляет Плательщика методом HTTP POST на Платёжную форму ПЦ с использованием
Запроса SDPayOutPage для ввода карточных данных:
POST /webapi/b2puser/sd-services/SDPayOutPage HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 149
Content-Type: application/x-www-form-urlencoded
signature=NTAwOWFkNDUxYzQ1NjgyNTljNDNjZmM3M2FmYzg1OGQ=&sector=3905&sd_ref=3503823&p
an=5570725111394269&amount=200&currency=643&description=qwe
P 2 P M a r k e t С т р а н и ц а 5 1 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля. В случае,
если запрос задублировался, и по данному unique_key уже была операция, пользователь
перенаправляется на страницу показа экранного чека ПЦ с описанием ошибки, либо на страницу-
диспетчер, выполняющую редирект на url / failurl в зависимости от статуса операции-дубля с
передачей кода ошибки (в зависимости от выбранных настроек сектора);
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• sd_ref должен быть ранее зарегистрирован для данного сектора;
• В заказе (webapi/Register) должен быть также указан параметр sd_ref с таким же значением;
• Сумма параметров amount + fee, указанных в запросе, не должна превышать сумму текущего
баланса Кубышки, идентификатор которой указан в параметре sd_ref.
По окончании работы сервиса:
• В случае успешной операции заказ переводится в статус COMPLETED;
• Доступный баланс Кубышки sd_ref уменьшается на сумму amount + fee.
В ответе на запрос ПЦ отправляет xml-сообщение с параметрами зарегистрированной операции, либо с
уведомлением об ошибке (с указанием кода ошибки и расшифровкой этого кода). Формат обоих сообщений
см. в Приложении №3.
Сервис webapi/b2puser/sd-services/SDPayOutSBPPrecheck
Используйте запрос SDPayOutSBPPrecheck для проверки возможности совершения СБП-выплаты со счета
Кубышки по номеру телефона. Запрос SDPayOutSBPPrecheck выполняется в режиме обмена данными
«сервер-сервер», без перенаправления на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 16. Параметры запроса webapi/b2puser/sd-services/SDPayOutSBPPrecheck
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
sd_ref Строка (255)
Уникальный идентификатор Кубышки. Если был
объявлен, то ПЦ проверит, достаточно ли денежных
средств для вывода с Кубышки на данный момент. JMT1000
Важно: Параметр должен быть передан при
регистрации заказа (webapi/Register).
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
id, token, phone, bank
_
id, amount, fee, currency, password
в указанном порядке, см. Приложение №2.
Условно-обязательные параметры (указывать либо phone и bank
_
id, либо token)
phone Строка (20) Номер телефона Получателя. 79191013
456
bank_id Строка (12) Уникальный идентификатор банка Получателя.
token Строка (39)
СБП-токен, полученный ТСП во время осуществления
привязки. Чтобы осуществлять выплаты по такому СБП-
токену, необходимо предварительно разово провести
по нему операцию списания с последующей отменой.
Условно-обязательные параметры (заполнять все, если не указан id)
amount Целое (12) Сумма операции в минимальных единицах валюты. Для
рублей — копейки. 1000
P 2 P M a r k e t С т р а н и ц а 5 2 | 1 7 2
/Confidential
Если указан id, значение amount берётся из заказа.
currency Целое (3)
Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
Если указан id, значение currency берётся из заказа.
643
description Строка
(1000)
Описание перевода.
Если указан id, значение description берётся из заказа.
fee Целое (12)
Комиссия за осуществление выплаты в минимальных
единицах валюты. Для рублей — копейки.
Если указан id, значение fee берётся из заказа.
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
reference Строка (100)
Номер перевода на стороне Площадки. Если не указан,
значение формируется автоматически на стороне ПЦ.
Если в запросе указан параметр id, значение параметра
reference из запроса игнорируется.
12345ABC
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayOutSBPPrecheck
ИС ТСП отправляет Запрос SDPayOutSBPPrecheck в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayOutSBPPrecheck HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 174
Content-Type: application/x-www-form-urlencoded
signature=NThlZWFiMmRlNWRkZDFlNTQzNjA2OTI0ODRlMDkxMDg=&sector=893&phone=70115110123
&bank_id=1crt88888881&amount=10007&currency=643&description=test&fee=0&sd_ref=47155
4
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса;
• Наличие на балансе Кубышки денежных средств в размере суммы значений параметров amount и
fee, переданных в запросе или объявленных в Заказе с переданным id.
Если ошибок нет, ПЦ отправляет xml-сообщение следующего вида:
<SDPayOutSBPPrecheck>
<precheck_id>730211959044920001</precheck_id>
<order_id>471556</order_id>
<amount>10007</amount>
<recipientBankId>1crt88888881</recipientBankId>
<pam>Иван Иванович И</pam>
<sd_ref>471554</sd_ref>
<signature>Y2U1MzRmMmVmZGY0MmNjMGY0MjM4YzY4ODI3ODZhYzM=</signature>
</SDPayOutSBPPrecheck>
P 2 P M a r k e t С т р а н и ц а 5 3 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPayOutSBP
Используйте запрос SDPayOutSBP для проведения СБП-выплаты со счета Кубышки на базе ранее
выполненного пречека. Запрос SDPayOutSBP выполняется в режиме обмена данными «сервер-сервер», без
перенаправления на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 17. Параметры запроса webapi/b2puser/sd-services/SDPayOutSBP
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19)
Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register
или SDPayOutSBPPrecheck.
2231412
precheck_id Строка (100)
Уникальный идентификатор проверки возможности
создания B2C перевода, полученный по результатам
запроса SDPayOutSBPPrecheck.
73021195904
4920001
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, sd_ref, precheck_id, unique_key,
password в указанном порядке, см. Приложение №2.
sd_ref Строка (255)
Уникальный идентификатор Кубышки. Если был
объявлен, то ПЦ проверит, достаточно ли денежных
средств для вывода с Кубышки на данный момент. JMT1000
Важно: Параметр должен быть передан при
регистрации заказа (webapi/Register).
Необязательные параметры
Ключ уникальности запроса. Генерируется на
стороне ТСП. При получении ключа ПЦ выполняет
проверку на наличие дубликата среди
обрабатываемых запросов и созданных операций.
unique_key Строка (50)
Формат: допустимы цифры [0-9], латинские буквы [a-
zA-Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования
ключа уникальности осуществляется по
согласованию с Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayOutSBP
ИС ТСП отправляет Запрос SDPayOutSBP в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayOutSBP HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 117
Content-Type: application/x-www-form-urlencoded
signature=NmE0OGUxNTI0NDYxN2ZmMWY0YzU2NWI4YzA0NmQ5Njg=&sector=893&id=471975&sd_ref=
zzz&precheck_id=732031634194986001
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 5 4 | 1 7 2
/Confidential
• Наличие на балансе Кубышки денежных средств в размере суммы значений параметров amount и
fee, объявленных в Заказе с переданным id.
После обработки Запроса webapi/b2puser/sd-services/SDPayOutSBP, ПЦ может прислать один из вариантов
ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
<operation>
<order_id>471975</order_id>
<order_state>COMPLETED</order_state>
<reference>6f48e1cf-058a-422a-a223-7e9bcb3d5201</reference>
<id>430929</id>
<date>2023.03.13 17:08:07</date>
<type>CREDIT_BY_QR</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>1000703</amount>
<fee>5000</fee>
<currency>643</currency>
<unique_key>test2</unique_key>
<sector_id>893</sector_id>
<phone>70115110123</phone>
<ps>11</ps>
<multiple/>
<recipientBankId>1crt88888881</recipientBankId>
<externalId>B3072140714897010000147AD3F3F3FF</externalId>
<pam>Петр Петрович П</pam>
<signature>YTVlZjExMTM1ZjY3ZDg0NTViOTA4OTJhZWU1NmViOTQ=</signature>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>CREDIT_BY_QR</type>
<state>COMPLETE</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 5 5 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPayOutIBAN
Используйте запрос SDPayOutIBAN для проведения выплаты со счета Кубышки на IBAN (International bank
account number). Запрос SDPayOutIBAN выполняется в режиме обмена данными «сервер-сервер», без
перенаправления на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 18. Параметры запроса webapi/b2puser/sd-services/SDPayOutIBAN
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
sd_ref Строка (255)
Уникальный идентификатор Кубышки. Если был
объявлен, то ПЦ проверит, достаточно ли денежных
средств для вывода с Кубышки на данный момент. JMT1000
Важно: Параметр должен быть передан при
регистрации заказа (webapi/Register).
receiver_iban Строка (255) Уникальный идентификатор международного
банковского счёта получателя денежных средств.
receiver_name Строка (100) Имя получателя денежных средств.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, receiver_iban, receiver_name,
amount, currency, sd_ref, password в указанном
порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей — копейки. Если указан id, значение
amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217 (949 для TRY, турецкая
лира). Если указан id, значение currency берётся из
заказа.
643
description Строка
(1000)
Описание перевода. Если указан id, значение
description берётся из заказа.
iPhone 12
Mini
Необязательные параметры
reference Строка (100) Номер Заказа на стороне ТСП (в ИС ТСП). 12345ABC
id Целое (19) 2231412
Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ. ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPayOutIBAN
ИС ТСП отправляет Запрос SDPayOutIBAN в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPayOutIBAN HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 230
Content-Type: application/x-www-form-urlencoded
signature=NzI1ZjczYmVjYmVhNTlhNTI5YmY0N2YyNjJjMWY0M2ViMmZjYTY1NGJjMzdmZmNlMTdkNTM0M
jU4NDIxMDY3Zg==&sector=2401&amount=1&currency=949&description=iban&sd_ref=iban7&rec
eiver_iban=TR100013400002111417900001&receiver_name=ilia+smirnov
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 5 6 | 1 7 2
/Confidential
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса;
• Наличие на балансе Кубышки денежных средств в размере суммы значений параметров amount и
fee, объявленных в Заказе с переданным id;
• Что валюта Кубышки и запроса — TRY (Турецкая лира).
После обработки Запроса webapi/b2puser/sd-services/SDPayOutIBAN, ПЦ может прислать один из вариантов
ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
<operation>
<order_id>520568</order_id>
<order_state>COMPLETED</order_state>
<reference>49465745-4772-403e-8395-b7fc54b18c3f</reference>
<id>491131</id>
<date>2025.04.21 12:11:41</date>
<type>P2PCREDIT</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<receiver_iban>TR100013400002111417900001</receiver_iban>
<amount>1000</amount>
<fee>0</fee>
<currency>643</currency>
<sd_ref>iban7</sd_ref>
<sector_id>2401</sector_id>
<signature>YzZiN2YwNDI3NTk3OWIyZDhkZjNkYTliOWM4NDI4OWEzN2ZmZjI4MTNhN2I
zY2ZhZmY5NzMxZWU5ZjBmOTg4NQ==</signature>
</operation>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 5 7 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDRelocateFunds
Используйте запрос SDRelocateFunds для перевода средств с одной Кубышки ТСП на другую (перемещение
средств между Кубышками). При необходимости переместить средства обратно, проведите данный запрос
в обратную сторону, поменяв местами идентификаторы Кубышек получателя и отправителя. Запрос
SDRelocateFunds выполняется в режиме обмена данными «сервер-сервер», без перенаправления на
Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 19. Параметры запроса webapi/b2puser/sd-services/SDRelocateFunds
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор предварительно
зарегистрированного Заказа в ПЦ. 2231412
from_sd_ref Строка (255) Уникальный идентификатор Кубышки отправителя. JMT1001
to_sd_ref Строка (255)
Уникальный идентификатор Кубышки получателя.
Если не Кубышка не существует —она создастся с
указанным идентификатором.
JMT1002
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, from_sd_ref, to_sd_ref, unique_key,
password в указанном порядке, см. Приложение №2.
Необязательные параметры
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне
ТСП. При получении ключа ПЦ выполняет проверку на
наличие дубликата среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские буквы [a-
zA-Z], дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования
ключа уникальности осуществляется по согласованию
с Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDRelocateFunds
ИС ТСП отправляет Запрос SDRelocateFunds в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDRelocateFunds HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 106
Content-Type: application/x-www-form-urlencoded
signature=ZDI0M2Q3OGM0Zjg5YWY5ZDg2MjEzOTk5ZmU3OTgwM2M=&sector=893&id=466699&from_sd
_ref=test&to_sd_ref=zzz
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Зарегистрирована ли для данного сектора Кубышка с указанным to_sd_ref. Если Кубышки с таким
идентификатором не существует — она создаётся, и средства переводятся на неё;
• В запросе должен быть указан только один получатель и только один отправитель.
P 2 P M a r k e t С т р а н и ц а 5 8 | 1 7 2
/Confidential
После обработки Запроса webapi/b2puser/sd-services/SDRelocateFunds, ПЦ может прислать один из
вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции;
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
<date>2023.03.22 12:34:45</date>
<ps>2</ps>
<iso>840</iso>
<ofd_state></ofd_state>
<signature>ODMyYzEzMjc5ZTk2Nzk5MzA4YzM3MjllZDY2NmMwNDU=</signature>
<fee>0</fee>
<type>P2PTRANSFER</type>
<reference>65bb2ba6-3e62-4abb-9fbf-a6f2f7f5ad56</reference>
<reason_code>1</reason_code>
<currency>643</currency>
<unique_key>test2</unique_key>
<id>435165</id>
<state>APPROVED</state>
<terminal_id>POS_1</terminal_id>
<approval_code>612555</approval_code>
<from_sd_ref>test</from_sd_ref>
<amount>1000</amount>
<bin_issuer>JOINT STOCK COMMERCIAL BANK</bin_issuer>
<multiple></multiple>
<to_sd_ref>zzz</to_sd_ref>
<message>Successful financial transaction</message>
<rrn>34004173</rrn>
<sector_id>893</sector_id>
<bin_issuer2>JOINT STOCK COMMERCIAL BANK</bin_issuer2>
<iso2>840</iso2>
<ofd_link>https%3A%2F%2Ftest.paygine.com%2Fofd%2FgetReceipt%3Fsector%3D8
93%26operationId%3D435165%26signature%3DMjNiYmJiNThkMWQ3ODUyNWViMjA5Yjdk
MDNiNjg0Yjk%3D</ofd_link>
<order_id>466699</order_id>
<order_state>COMPLETED</order_state>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>P2PTRANSFER</type>
<state>APPROVED</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 5 9 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDPurchase
Используйте запрос SDPurchase для перечисления средств со счета Кубышки в пользу юридического лица,
либо для выполнения перевода по реквизитам счета. Запрос выполняется в режиме обмена данными
«сервер-сервер», без перенаправления на Платёжные страницы ПЦ.
В случае затруднений с заполнением полей для платежа по свободным реквизитам, ориентируйтесь на
правила заполнения платежного поручения. Названия параметров этого блока идентичны названиям
полей платежного поручения.
Предупреждение: перед выполнением запроса рекомендуется зарегистрировать в ПЦ Заказ с
описанием всех деталей предстоящего платежа. Сделайте это отдельным запросом webapi/Register (см.
общую Инструкцию по интеграции).
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 20. Параметры запроса webapi/b2puser/sd-services/SDPurchase
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
signature Строка (255)
Цифровая подпись. В формировании
подписи участвуют параметры (если они
использованы в запросе): sector, id, amount,
currency, sd_ref, unique_key, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах
валюты. Для рублей — копейки. Если указан
id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978
для EUR; 840 для USD). Если указан id,
значение currency берётся из заказа.
643
description Строка
(1000)
Описание перевода. Если указан id,
значение description берётся из заказа. iPhone 12 Mini
Необязательные параметры
reference Строка (100) Номер Заказа на стороне ТСП (в ИС ТСП). 12345ABC
id Целое (19)
Уникальный идентификатор
предварительно зарегистрированного
Заказа в ПЦ.
2231412
unique_key Строка (50)
Ключ уникальности запроса. Генерируется
на стороне ТСП. При получении ключа ПЦ
выполняет проверку на наличие дубликата
среди обрабатываемых запросов и
созданных операций.
Формат: допустимы цифры [0-9], латинские
буквы [a-zA-Z], дефис и нижнее
подчеркивание [-_].
Предупреждение: возможность
использования ключа уникальности
осуществляется по согласованию с
Оператором.
email Строка (100)
Адрес электронной почты Плательщика.
Если в запросе передан параметр id,
данное значение email игнорируется (при
наличии берется email из заказа).
mail@somesite.com
P 2 P M a r k e t С т р а н и ц а 6 0 | 1 7 2
phone country region bank_name first_name last_name patronymic fio acc_number contract receipt_type P008-1 P008-2 P014 P015 P016 P017 P018 P020 P021 P 2 P M a r k e t Строка (100) Строка (2) Строка (100)
Строка (100) Строка (100) Строка (100) Строка (100) Строка (255) Строка (50) Строка (100) Целое (2)
Строка (80) Строка (80) Целое (9) Целое (20)
Строка (160) Целое (20) Целое (2)
Целое (1)
Целое (1)
/Confidential
Телефон Плательщика. 79219999999
Двухсимвольный код страны Плательщика
в соответствии с ISO 3166-1. RU
Название региона (области, края)
Плательщика. Для США указывается
название штата.
Ленинградская обл.
Наименование банка Плательщика. Сбербанк
Имя Плательщика. Иван
Фамилия Плательщика. Петров
Отчество Плательщика. Иванович
Фамилия Имя Отчество получателя
денежных средств. Иванов Петр Сидорович
Номер счета получателя денежных средств. 40817810123456789012
Номер договора получателя денежных
средств.
1234567890
Номер шаблона уведомления,
отправляемого на email Плательщику. По
умолчанию используется первый
(стандартный) шаблон.
Предупреждение: применяется по
2
согласованию с Оператором, только если
бизнес-требования ТСП подразумевают
использование разных шаблонов
уведомлений.
Наименование Плательщика.
Адрес Плательщика.
БИК получателя (ровно 9 цифр).
Корр. счёт банка получателя. Номер
банковского счёта, входящего в состав
единого казначейского счёта (ровно 20
цифр).
Наименование Получателя.
Счет получателя (ровно 20 цифр).
Вид операции. Возможные значения:
01 — платежное поручение;
06 — инкассовое поручение;
02 — платежное требование.
Назначение платежа. Заполняется при
указании банка. Возможные значения:
1 — Заработная плата, премии, больничные
листы и дивиденды сотрудникам (возможно
удержание не более 50%);
2 — Периодические выплаты, алименты
(удержания отсутствуют);
3 — Компенсация вреда здоровью
(удержание только на оплату алиментов);
4 — Разовые выплаты: командировочные,
выплаты на погребение (удержание 0%);
5 — Разовый доход (удержания в пользу
алиментов, возмещения вреда здоровью
или потери кормильца).
Очередность платежа. Отражает порядок
перечисления платежей и зависит от их
характера. Возможные значения:
1 — Алименты и платежи по судебным
С т р а н и ц а 6 1 | 1 7 2
/Confidential
решениям о возмещении вреда жизни и
здоровью;
2 — Авторские права, заработная плата и
выходные пособия сотрудникам;
3 — Заработная плата, налоговые
обязательства и погашение
задолженностей по налогам и взносам в
фонды;
4 — Средства по остальным
исполнительным документам судебных
приставов;
5 — Средства прочим контрагентам в
соответствии с порядком очерёдности.
P022 Целое (25) УИН (20 или 25 цифр).
Если отсутствует —проставьте 0.
P024 Строка (210) Назначение платежа.
P060 Целое (12) ИНН Плательщика (10 или 12 цифр).
Если отсутствует —проставьте 0.
P061 Целое (12) ИНН Получателя (10 или 12 цифр).
Если отсутствует —проставьте 0.
P101 Целое (2) Статус Плательщика.
P102 Целое (9) КПП Плательщика (9 цифр).
Если отсутствует —проставьте 0.
P103 Целое (9) КПП Получателя (9 цифр).
Если отсутствует —проставьте 0.
P104 Целое (20) КБК Получателя.
P105 Целое (11) ОКТМО (8 или 11 цифр).
P106 Строка (10) Основание платежа.
P107 Строка (10) Налоговый период.
P108 Строка (16) Номер документа, который является
основанием платежа, либо 0.
01;5800111222
P109 Строка (10) Дата документа (формат yyyy.MM.dd).
Если отсутствует —проставьте 0.
P110 Строка (10) Тип документа.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDPurchase
ИС ТСП отправляет Запрос SDPurchase в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDPurchase HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 130
Content-Type: application/x-www-form-urlencoded
signature=M2NjOWM1M2JhYWNjMWE4YjQyZjViZjA2MGUxMWIxYzA=&sector=3905&sd_ref=3503823&a
mount=100&currency=643&description=wqeqw
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• sd_ref должен быть ранее зарегистрирован для данного сектора;
• Сумма параметров amount + fee, указанных в запросе, не должна превышать сумму текущего
баланса Кубышки, идентификатор которой указан в параметре sd_ref.
P 2 P M a r k e t С т р а н и ц а 6 2 | 1 7 2
/Confidential
По окончании работы сервиса:
• В случае успешной операции заказ переводится в статус COMPLETED;
• Доступный баланс Кубышки sd_ref уменьшается на сумму amount + fee.
После обработки Запроса webapi/b2puser/sd-services/SDPurchase, ПЦ может прислать один из
вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>PURCHASE</type>
<state>APPROVED</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/b2puser/sd-services/SDReverse
Используйте запрос SDReverse для выполнения отмены или возврата средств по операциям пополнения
Кубышки и покупки с её помощью. Запрос выполняется в режиме обмена данными «сервер-сервер», без
перенаправления Плательщика на Платёжные страницы ПЦ.
Важно: Идентификатор кубышки необходимо указывать только для отмены операций, созданных в
рамках sd_ref.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 21. Параметры запроса webapi/b2puser/sd-services/SDReverse
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ. 2231412
signature Строка (255) Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
P 2 P M a r k e t С т р а н и ц а 6 3 | 1 7 2
/Confidential
amount, currency, sd_ref, unique_key, password в указанном
порядке, см. Приложение №2.
Условно-обязательные параметры
sd_ref Строка (255)
Уникальный идентификатор Кубышки. Применяется только
для сделок, которые были выполнены с указанием этого
параметра. Примечание: для возвратов операций SDRelocateFunds
JMT1000
укажите уникальный идентификатор Кубышки получателя
средств из оригинальной (отменяемой) операции.
Необязательные параметры
amount Целое (12)
Общая сумма Возврата/Отмены в минимальных единицах
валюты. Для рублей — копейки. Если не указана —
считается, что запрос сделан на полную остаточную сумму
заказа.
Сумма не может быть больше суммы отменяемого Заказа.
8000
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD). Если не указан — берется из Заказа. 643
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне ТСП.
При получении ключа ПЦ выполняет проверку на наличие
дубликата среди обрабатываемых запросов и созданных
операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-Z],
дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с
Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDReverse
ИС ТСП отправляет Запрос SDReverse в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDReverse HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 116
signature=OTMxOGEwNGFkNTg0YTEyYzMxOGVhMDRkYTM5NTRkNTQ=&sector=893&id=480413&amount=
100&currency=643&unique_key=test2
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Статус Заказа должен быть AUTHORIZED или СOMPLETED.
Дальнейшие проверки и обработка запроса зависят от того, какая операция подлежит отмене/возврату:
• Если отмена/возврат выполняется для SDPayInDebit:
o Отмена возможна только на полную сумму заказа;
o При указании sd_ref сумма баланса Кубышки не изменяется;
• Если отмена/возврат выполняется для SDComplete, SDPayIn:
o Если в запросе указан sd_ref, такой же sd_ref должен быть задан у отменяемой операции;
o Сумма возврата не должна превышать сумму баланса Кубышки;
o При успешной операции баланс Кубышки уменьшится на величину amount;
P 2 P M a r k e t С т р а н и ц а 6 4 | 1 7 2
/Confidential
• Если отмена/возврат выполняется для SDPurchase:
o Если в запросе указан sd_ref, такой же sd_ref должен быть задан у отменяемой операции;
o При успешной операции баланс Кубышки увеличится на величину amount.
По окончании работы сервиса в случае успешной операции если сумма списания равна остаточной сумме
заказа, то статус заказа меняется на CANCELED.
После обработки Запроса webapi/b2puser/sd-services/SDReverse, ПЦ может прислать один из вариантов
ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
<order_id>480413</order_id>
<order_state>COMPLETED</order_state>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
<id>449800</id>
<date>2024.03.29 17:20:53</date>
<type>REVERSE</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<pan>480938******7309</pan>
<amount>100</amount>
<currency>643</currency>
<approval_code>454362</approval_code>
<unique_key>test2</unique_key>
<sector_id>893</sector_id>
<bin_issuer>JSCB MOSCOW INDUSTRIAL BANK</bin_issuer>
<expdate>02/2023</expdate>
<iso>643</iso>
<terminal_id>POS_1</terminal_id>
<signature>YTY1ZWI2NWY3NTcyMDFmYjMxZmE0NTI2MzM1NTdjYjU=</signature>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test2</unique_key>
<id>449800</id>
<type>REVERSE</type>
<state>APPROVED</state>
<order_id>480413</order_id>
<reference>721716fc-6837-4dbc-8308-37de445c30f0</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>OWY5YTY5YjljOTFhNTNkOGQyMDQ0YTY4ZGUxOTBhM2I=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 6 5 | 1 7 2
/Confidential
Сервис webapi/b2puser/sd-services/SDGetBalance
Используйте запрос SDGetBalance для получения актуального баланса Кубышки. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 22. Параметры запроса webapi/b2puser/sd-services/SDGetBalance
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, sd_ref, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDGetBalance
ИС ТСП отправляет Запрос SDGetBalance в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDGetBalance HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 88
Content-Type: application/x-www-form-urlencoded
signature=M2NjOWM1M2JhYWNjMWE4YjQyZjViZjA2MGUxMWIxYzA=&sector=3905&sd_ref=3503823
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие sd_ref в запросе и принадлежность к указанному сектору;
• Если заданный sd_ref не найден в системе, проверяется настройка сектора на разрешение создания
Кубышки через SDGetBalance:
o Если создание Кубышки через SDGetBalance разрешено, создается Кубышка с нулевым
балансом;
o Если запрещено, возвращается ошибка «Неверный параметр sd_ref».
Важно: Создание Кубышки через метод SDGetBalance доступно по согласованию с ПЦ.
P 2 P M a r k e t С т р а н и ц а 6 6 | 1 7 2
/Confidential
По окончании работы сервиса:
• При успехе. Приходит xml со значением баланса "в копейках", соответствующим идентификатору
Кубышки, заданному в запросе (sd_ref). Примерный вид указан ниже:
<sd_balance>
<sd_ref>zzz</sd_ref>
<balance>124209703</balance>
<currency>643</currency>
<sd_state>ACTIVE</sd_state>
<available_balance>124209703</available_balance>
</sd_balance>
Где:
<sd_ref> — уникальный идентификатор Кубышки;
<sd_state> — статус Кубышки;
<balance> — значение основного баланса "в копейках";
<available_balance> — значение доступного баланса "в копейках";
<currency> — валюта баланса Кубышки.
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей. Формат сообщения
приведен в Приложении №1.
Сервис webapi/b2puser/sd-services/SDStatement
Используйте запрос SDStatement для получения выписки по операциям Кубышки. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 23. Параметры запроса webapi/b2puser/sd-services/SDStatement
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
sd_ref Строка (255) Уникальный идентификатор Кубышки. JMT1000
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, sd_ref,
start, end, count, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
start Строка (20) Дата начала периода выписки в формате:
yyyy.MM.ddTHH:mm:ss
end Строка (20) Дата окончания периода выписки в формате:
yyyy.MM.ddTHH:mm:ss
count Целое (3) Количество операций для возврата в выписке (максимум
500). Значение по умолчанию — 100. 500
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDStatement
ИС ТСП отправляет Запрос SDStatement в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDStatement HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 129
Content-Type: application/x-www-form-urlencoded
signature=ODc5ODk0MTM4Y2ViOGFlZTcwOTg0ODJkYjhhMDRhZmM=&sector=893&sd_ref=zzz&start=
2020-09-11T12:00&end=2023-09-12T11:00&count=10
P 2 P M a r k e t С т р а н и ц а 6 7 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие sd_ref по указанному сектору.
В ответ на запрос:
• При успехе. Приходит xml следующего вида, с выпиской по операциям:
<?xml version="1.0" encoding="UTF-8"?>
<SDStatement>
<SDStatementRow>
<order_id>479936</order_id>
<order_state>COMPLETED</order_state>
<reference>409411ac-7eeb-48bc-8ca7-54854f61d35d</reference>
<id>447770</id>
<date>2023-08-11T23:14:47.879+03:00</date>
<type>P2PTRANSFER</type>
<sd_type>SDPayout</sd_type>
<sd_ref>zzz</sd_ref>
<pan2>557072******5300</pan2>
<amount>1000</amount>
<currency>643</currency>
<fee>100</fee>
<balance_before>69668732</balance_before>
<balance_after>69667632</balance_after>
<approval_code>059170</approval_code>
</SDStatementRow>
........
<SDStatement>
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
Сервис webapi/b2puser/sd-services/SDChangeState
Используйте запрос SDChangeState для блокировки/разблокировки Кубышки. В режиме блокировки
Кубышки, по ней запрещено проведение финансовых операций. Для заблокированной Кубышки доступны
запросы SDGetBalance и SDChangeState. Запрос выполняется в режиме обмена данными «сервер-сервер»,
без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 24. Параметры запроса webapi/b2puser/sd-services/SDChangeState
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
sd_state Строка (20)
Целевое значение статуса Кубышки.
Допустимые значения:
BLOCKED — блокировка Кубышки;
ACTIVE — перевод Кубышки в активный статус.
BLOCKED
sd_ref_list Строка (255) Список уникальных идентификаторов Кубышки через
запятую. Не более 10 штук.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, sd_state, sd_ref_list, password в
указанном порядке, см. Приложение №2.
P 2 P M a r k e t С т р а н и ц а 6 8 | 1 7 2
/Confidential
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/sd-services/SDChangeState
ИС ТСП отправляет Запрос SDChangeState в ПЦ методом HTTP POST. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /webapi/b2puser/sd-services/SDChangeState HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 139
Content-Type: application/x-www-form-urlencoded
signature=OTU2ZjAwMTI4MjE2NzE2OGM3NWNlODY3NTk1M2Y3YjU=&sector=2502&sd_state=BLOCKED
&sd_ref_list=autotest1711718177072,autotest1711718177073
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие всех sd_ref из списка по указанному сектору.
В ответ на запрос:
• При успехе. Приходит xml следующего вида:
<?xml version="1.0" encoding="UTF-8"?>
<SDChangeState>
<sd_states>
<sd_state>
<sd_ref>autotest1711718177072</sd_ref>
<state>BLOCKED</state>
<message>Successful execution</message>
</sd_state>
<sd_state>
<sd_ref>autotest1711718177073</sd_ref>
<state>BLOCKED</state>
<message>Successful execution</message>
</sd_state>
</sd_states>
</SDChangeState>
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
P 2 P M a r k e t С т р а н и ц а 6 9 | 1 7 2
/Confidential
Информационные сервисы работы с виртуальной картой
*Вспомогательный сервис регистрации заказов webapi/Register
Примечание: здесь приведено сокращенное описание сервиса. Полное описание — в основной
инструкции по интеграции.
Сервис webapi/Register регистрирует заказ в ПЦ. Идентификатор заказа ПЦ используется в следующих
методах:
• webapi/b2puser/PayIn,
• webapi/b2puser/PayInDebit, webapi/b2puser/PayInDebit2,
• webapi/b2puser/Complete,
• webapi/UserAuthorize,
• webapi/Complete,
• webapi/UserPurchase,
• webapi/b2puser/PayOut, webapi/b2puser/PayOut2,
• webapi/b2puser/sd-services/SDPayInDebit, webapi/b2puser/sd-services/SDPayInDebit2,
• webapi/b2puser/sd-services/SDPayIn,
• webapi/b2puser/sd-services/SDPayInSBP,
• webapi/b2puser/sd-services/SDPayInSBPQRLink,
• webapi/b2puser/sd-services/SDPayInSberPay,
• webapi/b2puser/sd-services/SDPayInAlfaPay,
• webapi/b2puser/sd-services/SDPayInByUser,
• webapi/b2puser/sd-services/SDPayInByLoan,
• webapi/b2puser/sd-services/SDPayInByAdvice,
• webapi/b2puser/sd-services/SDPayInSBPByToken,
• webapi/b2puser/sd-services/SDPayOut,
• webapi/b2puser/sd-services/SDPayOutPage,
• webapi/b2puser/sd-services/SDRelocateFunds,
• webapi/b2puser/sd-services/SDPurchase.
Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на
Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 25. Параметры запроса webapi/Register
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной
записи ТСП в ПЦ. 1
amount Целое (12) Сумма заказа в минимальных единицах
валюты. Для рублей - копейки. 1000
currency Целое (3) Код валюты по ISO4217 (643 для RUB;
978 для EUR; 840 для USD). 643
reference Строка (100) Номер заказа на стороне ТСП в его
Системе магазина. 12345ABC
description Строка (1000) Описание платежа. iPhone 13
signature Строка (255)
Цифровая подпись. В формировании
подписи участвуют параметры: sector,
amount, currency, password в указанном
порядке, см. Приложение №2.
Условно-обязательные параметры (обязательно для SDPayOutPage)
P 2 P M a r k e t С т р а н и ц а 7 0 | 1 7 2
sd_ref fee url failurl life_period fiscalData acc_number contract payer_id email back_deep_link mode P 2 P M a r k e t Строка (255) Целое (12)
Строка (500)
Строка (500)
Строка (500) Объект JSON
Строка (50) Строка (100) Строка (255) Строка (100)
Строка (500)
Целое (1)
/Confidential
Уникальный идентификатор Кубышки. JMT1000
Необязательные параметры
Эквайринговая комиссия в
минимальных единицах валюты. Для
рублей – копейки. Взимается с
Плательщика дополнительно к основной
сумме Заказа.
200
Адрес страницы на стороне ТСП, на
которую автоматически переводится
Плательщик по завершении Операции.
ПЦ также передает на url
идентификаторы Заказа и Операции в
виде GET-параметров. Типовой чек ПЦ
не показывается.
Заполните значение параметра
полностью, с указанием префикса (http://
или https://)
http://www.site.com/
Accept.jsp
Адрес страницы на стороне ТСП, на
которую автоматически переводится
Плательщик в случае неуспешного
окончания проведения Операции (когда
статус Операции отличен от APPROVED,
или Операция не сформирована из-за
какой-либо ошибки). ПЦ также передает
на failurl идентификаторы Заказа и
Операции и код ошибки (при наличии) в
виде GET-параметров.
Если failurl не указан, ПЦ считает его
равным значению url.
Заполните значение параметра
полностью, с указанием префикса (http://
или https://)
http://www.site.com/
Fail.jsp
Время в секундах, в течение которого по
заказу может быть совершена Операция. 1800
Фискальные данные.
Подробные инструкции по
использованию фискальных данных см. в
документации Фискализация.
Номер счета получателя денежных
средств.
40817810123456789012
Номер договора получателя денежных
средств.
1234567890
Идентификатор клиента на стороне ТСП. 234234
Адрес электронной почты Плательщика.
По умолчанию, ПЦ использует значение
email для отправки Плательщику
уведомлений о результатах проводимых
в рамках Заказа Операций.
mail@somesite.com
Ссылка для возврата в мобильное
приложение ТСП (мерчанта) после
оплаты.
Режим ответа на Запрос
webapi/Register. Возможные значения:
0, 1.
С т р а н и ц а 7 1 | 1 7 2
/Confidential
0 (значение по умолчанию) – полный
ответ (xml-сообщение, см. Приложение
№1, п.1);
1 – сокращенный ответ (только ID
зарегистрированного Заказа в формате
text/plain).
notify_url Строка (500) URL для получения уведомлений об
операциях по регистрируемому заказу.
http://www.site.com/
Notifications.jsp
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Register
ИС ТСП отправляет Запрос webapi/Register в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/Register HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 241
Content-Type: application/x-www-form-urlencoded
signature=YzY4MzU4MmI0NDI4MzJjYTMxN2NjM2Q5NDhjZTlmM2Q=&sector=1&amount=152000&curre
ncy=643&email=mail@somesite.com&reference=578997456-
987&description=%D1%82%D0%B5%D0%BB%D0%B5%D1%84%D0%BE%D0%BD%20 Nokia
3310&url=http://www.somesite.com/accept.jsp&failurl=http://www.somesite.com/fail.js
p
Полное описание метода, особенности обработки запроса и примеры запроса/ответа см. в Основной
инструкции по интеграции.
После обработки Запроса webapi/Register, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан (параметр mode не равен 1). Приходит сообщение в формате
xml с параметрами зарегистрированного заказа (описание см. Приложение №1, п.1);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<order>
…
</order>
(описание формата см. Приложение №1, п.1)
• Вариант 2. Запрос успешно обработан (параметр mode равен 1). Приходит ID заказа в формате
text/plain;
HTTP/1.1 200 OK
Content-Type: text/html;charset=ISO-8859-1
235422
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 7 2 | 1 7 2
/Confidential
Сервис webapi/b2puser/Register
Сервис webapi/b2puser/Register регистрирует пользователя Площадки в ПЦ. Запрос выполняется в режиме
обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 26. Параметры запроса webapi/b2puser/Register
Описание Название Тип (длина) Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП
в ПЦ.
1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, first_name,
patronymic, last_name, birth_date, snils,
persondoc_number, persondoc_issdate,
persondoc_issby, address, email, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
client_ref Строка (255)
Идентификатор пользователя Площадки. Если не
у
казан, ПЦ генерирует его.
67812321
first_name Строка (30) Имя пользователя Площадки. Иван
patronymic Строка (30) Отчество пользователя Площадки. Петрович
last_name Строка (30) Фамилия пользователя Площадки. Иванов
birth_date Строка (10) Дата рождения пользователя Площадки.
Формат ГГГГ.ММ.ДД 2000.09.12
snils Строка (20) СНИЛС пользователя Площадки.
persondoc_number Строка (20) Номер идентификационного документа
пользователя Площадки.
persondoc_issdate Строка (10)
Дата выдачи идентификационного документа
пользователя Площадки.
Формат ГГГГ.ММ.ДД
persondoc_issby Строка (100) Место/орган, выдавший идентификационный
документ пользователя Площадки.
address Строка (2000) Адрес регистрации пользователя Площадки.
email Строка (100) Адрес электронной почты пользователя
Площадки.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/Register
ИС ТСП отправляет Запрос webapi/b2puser/Register в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/Register HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя Площадки с указанным client_ref. Если пользователь найден и имеет
Виртуальную карту, ПЦ возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 7 3 | 1 7 2
/Confidential
• Существование пользователя с другим client_ref, но таким же номером паспорта. Если такой
пользователь найден, ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, в процессе обработки запроса происходит следующее:
• Если client_ref в запросе не указан, ПЦ создает новую учетную запись с информацией о
пользователе, присваивает ей свой client_ref и открывает Виртуальную карту;
• Если client_ref указан в запросе, но в ПЦ нет информации о пользователе Площадки с таким
client_ref, создается новая учетная запись с информацией о пользователе. ПЦ присваивает ей
client_ref, указанный в запросе и открывает Виртуальную карту;
• Если в ПЦ есть привязанный к Площадке пользователь с таким же client_ref, как в запросе, но без
Виртуальной карты, то ПЦ переписывает все данные из запроса в учетную запись указанного
существующего пользователя и открывается ему Виртуальную карту;
• При сохранении данных first_name, patronymic, last_name, persondoc_issby, address, буква «ё»
заменяется на «е», значения сохраняются в верхнем регистре;
• При сохранении данных номера паспорта все пробелы удаляются;
• ПЦ создает и регистрирует за сектором пользователя Площадки. Пользователю Площадки
автоматически открывается ВК и привязывается к созданной записи.
После обработки Запроса webapi/b2puser/Register, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит xml с параметрами зарегистрированного
пользователя;
<b2p_user>
<reg_date>2022.11.21 15:09:08</reg_date>
<sector>3905</sector>
<client_ref>clientRefTest</client_ref>
<state>0</state>
<auth_state>0</auth_state>
<active>0</active>
<status>OPEN</status>
<signature>NDRjZDhkMzk1NGQ2YzY5YTU1MGM0NTQwMGM3ZGI3YjE=</signature>
</b2p_user>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/b2puser/Info
Используйте запрос webapi/b2puser/Info для получения информации о зарегистрированном в ПЦ
пользователе Площадки. Запрос выполняется в режиме обмена данными «сервер-сервер», без
перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 27. Параметры запроса webapi/b2puser/Info
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255) Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
P 2 P M a r k e t С т р а н и ц а 7 4 | 1 7 2
/Confidential
client_ref, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
get_cardinfo Целое (9)
Параметр со значением 1 возвращает в ответном
сообщении маскированный pan карты (6+4)
пользователя Площадки.
send_cardinfo Целое (9)
Параметр со значением 1 отправляет SMS на
привязанный номер телефона пользователя Площадки
со следующими данными: 6 недостающих цифр pan
карты, срок действия карты и CVV/CVC2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/Info
ИС ТСП отправляет Запрос webapi/b2puser/Info в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/Info HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
В ответ на запрос:
• При успехе. Приходит xml с параметрами зарегистрированного пользователя:
<b2p_user>
<reg_date>2022.11.21 15:09:08</reg_date>
<sector>3905</sector>
<client_ref>clientRefTest</client_ref>
<state>0</state>
<auth_state>0</auth_state>
<active>0</active>
<limit>0</limit>
<available_balance>0</available_balance>
<currency>643</currency>
<status>OPEN</status>
<signature>NWMxOTY2MjBlNWEyYTI3ZWJlMDdlMmM0YTRjYjMyZjQ=</signature>
</b2p_user>
Важно: Отображение фазы жизни кошелька доступно только по согласованию с Оператором.
Дополнительно возможно получение информации о фазе жизни кошелька в параметре wallet_state.
При наличии соответствующей настройки приходит xml с данным параметром:
<b2p_user>
<reg_date>2025.07.03 14:03:40</reg_date>
<sector>6513</sector>
<client_ref>e05c0e7e-b4b1-48b3-8269-6e8981b2192d</client_ref>
<bank_id>44</bank_id>
<state>3</state>
<auth_state>0</auth_state>
<active>1</active>
<phone>72004903762</phone>
<limit>0</limit>
<available_balance>40000</available_balance>
<currency>643</currency>
<status>BLOCKED</status>
<wallet_state>BLOCKED_BY_RNKO</wallet_state>
P 2 P M a r k e t С т р а н и ц а 7 5 | 1 7 2
/Confidential
<signature>OGZmNjhlOTBhZTIzM2FiZDc1OWQ4NzYzYzlmZDBhNDhmN2U5NzAwYjkzYTZkZWI
xNWY4M2QxZDljYzc5OTQyMw==</signature>
</b2p_user>
Где:
<wallet
_
state> — идентификатор фазы жизни кошелька. Возможные значения:
/ISSUED — Выпущен;
/ACTIVE — Активный;
/BLOCKED_BY_CLIENT — Заблокирован клиентом;
/BLOCKED
BY
CHANGE
_
_
_
PHONE — Заблокирован по смене номера телефона;
/BLOCKED_BY_APPLICATION — Заблокирован по заявлению;
/BLOCKED_BY_RNKO — Заблокирован РНКО;
/FINISHED — Завершен.
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
Помимо основной информации о пользователе Площадки, доступна настройка отображения лимитов, а
именно актуальной суммы по всем операций за месяц и максимального значения месячного лимита.
Важно: Отображение лимитов доступно по согласованию с ПЦ.
Если отображение лимитов включено, в ответе также приходит следующая информация:
<limit>
<limit_id>1044</limit_id>
<current>6215</current>
<max>200000</max>
</limit>
Где:
<current> — накопительное число всех операций в календарном месяце;
<max> — максимальная сумма всех операций в календарном месяце.
Сервис webapi/b2puser/Modify
Используйте запрос webapi/b2puser/Modify для изменения информации о зарегистрированном в ПЦ
пользователе Площадки. Запрос выполняется в режиме обмена данными «сервер-сервер», без
перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 28. Параметры запросов webapi/b2puser/Modify
Описание Название Тип (длина) Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП
в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если они использованы в запросе)
параметры sector, client_ref, first_name,
patronymic, last_name, birth_date, inn, snils,
persondoc_number, persondoc_issdate,
persondoc_issby, address, email, esia, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
first_name Строка (30) Имя пользователя Площадки. Иван
patronymic Строка (30) Отчество пользователя Площадки. Петрович
P 2 P M a r k e t С т р а н и ц а 7 6 | 1 7 2
/Confidential
last_name Строка (30) Фамилия пользователя Площадки Иванов
birth_date Строка (10) Дата рождения пользователя Площадки.
Формат ГГГГ.ММ.ДД 2000.09.12
inn Строка (20) ИНН пользователя Площадки.
snils Строка (20) СНИЛС пользователя Площадки.
persondoc_number Строка (20) Номер идентификационного документа
пользователя Площадки.
persondoc_issdate Строка (10)
Дата выдачи идентификационного документа
пользователя Площадки.
Формат ГГГГ.ММ.ДД
persondoc_issby Строка (100) Место/орган, выдавший идентификационный
документ пользователя Площадки.
address Строка (2000) Адрес регистрации пользователя Площадки.
email Строка (100) Адрес электронной почты пользователя
Площадки.
esia Строка (5)
Признак того, что данные физического лица
будут получены через сервис ЕСИА. Возможные
значения: true, false (по умолчанию).
true — идентификация через ЕСИА (ГосУслуги)
false — идентификация через УПРИД.
Если параметр не передан, это считается как
false.
true
redirecturl Строка (500)
URL на который будет отправлено физическое
лицо по результату прохождения процесса
аутентификации в ЕСИА с учётом согласия/отказа
предоставления персональных данных.
Учитывается только при передаче esia = true.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/Modify
ИС ТСП отправляет Запрос webapi/b2puser/Modify в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/b2puser/Modify HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 147
Content-Type: application/x-www-form-urlencoded
signature=NzAzOWZjZjJlMjE3NzdjNWY5Yjc3N2I5MDFiYmY5OGE=&sector=3905&client_ref=clien
tRefTest&esia=true
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя Площадки с указанным client_ref. Если пользователь не найден, ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя с другим client_ref, но таким же номером паспорта. Если такой
пользователь найден, ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ обновляет данные пользователя значениями, заданными в запросе.
P 2 P M a r k e t С т р а н и ц а 7 7 | 1 7 2
/Confidential
В ответ на запрос:
• При успехе. Приходит xml с параметрами зарегистрированного пользователя:
<b2p_user>
<reg_date>2022.11.21 15:09:08</reg_date>
<sector>3905</sector>
<client_ref>clientRefTest</client_ref>
<state>0</state>
<auth_state>0</auth_state>
<active>0</active>
<available_balance>0</available_balance>
<currency>643</currency>
<status>OPEN</status>
<esia_link>https://esia-
portal1.test.gosuslugi.ru/aas/oauth2/v2/ac?client_id=PKIT01&response_type=
code&redirect_uri=https%3A%2F%2Fdp-adapter-feature-free-dp-
adapter.test.paymentkit.ru%2Fdp-adapter%2Fv1%2Fcallback&state=aeb88846-
a41f-4e4d-8fae-
ad2118f2006e&access_type=offline&scope=fullname+gender+birthdate+snils+inn
+id_doc+birthplace+addresses+mobile+email+ils_doc+paternity_cert_doc+chang
e_fullname_cert_doc+divorce_cert_doc+marriage_cert_doc&client_secret=z5xGd
l9Ni5Pv6C2jUSv2ar-
ku5YwNfZLays18cuYMxL8JNP10NQHCOXPOdLwM0cLylTbyDgTt_nCgCfKbohCeg%3D%3D&time
stamp=2024.10.24+16%3A37%3A02+%2B0300&client_certificate_hash=2C4981866BE5
BD539E83C7167C87DEEB8BB01DD520E6DE32702A33979A89839F</esia_link>
<signature>YjE3M2JkMDllMmY3MzA2ZjliZWU0YWU5OTVjNzI5MGQ=</signature>
</b2p_user>
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
Сервис webapi/b2puser/ModifyPage
Используйте запрос webapi/b2puser/ModifyPage для изменения информации о зарегистрированном в ПЦ
пользователе Площадки. Запрос выполняется с перенаправлением Плательщика на Платёжные страницы
ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 29. Параметры запроса webapi/b2puser/ModifyPage
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если они использованы в запросе)
параметры sector, client_ref, url, failurl, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
url Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции. ПЦ также передает на url
идентификаторы Заказа и Операции в виде GET-
параметров. Типовой чек ПЦ не показывается.
Заполните значение параметра полностью, с
указанием префикса (http:// или https://)
http://www.site.com/
Accept.jsp
failurl Строка (500) Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
http://www.site.com/
Fail.jsp
P 2 P M a r k e t С т р а н и ц а 7 8 | 1 7 2
/Confidential
неуспешного окончания проведения Операции
(когда статус Операции отличен от APPROVED, или
Операция не сформирована из-за какой-либо
ошибки). ПЦ также передает на failurl
идентификаторы Заказа и Операции и код ошибки
(при наличии) в виде GET-параметров.
Если failurl не указан, ПЦ считает его равным
значению url.
Заполните значение параметра полностью, с
указанием префикса (http:// или https://)
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/ModifyPage
ИС ТСП перенаправляет Плательщика методом HTTP POST на Платёжную форму ПЦ с использованием
Запроса webapi/b2puser/ModifyPage для ввода карточных данных:
POST /webapi/b2puser/ModifyPage HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя Площадки с указанным client_ref. Если пользователь не найден, ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя с другим client_ref, но таким же номером паспорта. Если такой
пользователь найден, ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, пользователь перенаправляется на форму ПЦ для ввода новых данных пользователя.
После заполнения и отправки формы:
• Если параметры url / failurl переданы в запросе, пользователь переводится на адрес, заданный в
url / failurl в зависимости от результата;
• Если параметры url / failurl в запросе отсутствуют, пользователь переводится на страницу ПЦ с
сообщением об успехе или ошибке изменения персональных данных пользователя.
Сервис webapi/b2puser/SetPhone
Используйте запрос webapi/b2puser/SetPhone для привязки или перепривязки номера телефона к ВК
пользователя Площадки.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 30. Параметры запроса webapi/b2puser/SetPhone
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки, к которому будет
привязан телефон.
67812
P 2 P M a r k e t С т р а н и ц а 7 9 | 1 7 2
/Confidential
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, password в указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/SetPhone
ИС ТСП перенаправляет Плательщика методом HTTP POST страницы для установки или смены привязанного
к ВК номера телефона с использованием Запроса webapi/b2puser/SetPhone:
POST /webapi/b2puser/SetPhone HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя Площадки с указанным client_ref. Если пользователь не найден, ПЦ
возвращает ошибку выполнения запроса;
• Наличие ВК у указанного пользователя Площадки. Если карта отсутствует, ПЦ возвращает ошибку
выполнения запроса;
• Что пользователь не заблокирован в ПЦ и имеет статус new или active. Если пользователь Площадки
имеет некорректный статус, ПЦ возвращает ошибку выполнения запроса;
• Наличие зарегистрированного в ПЦ секретного слова у пользователя с ранее привязанным
телефоном. Если секретного слова нет, ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ возвращает страницы для установки или смены привязанного к ВК номера телефона:
• Для первичной привязки выводится окно с полями ввода номера телефона и секретного слова. Если
данные заполнены корректно, ПЦ отправит смс-сообщение с кодом подтверждения на введенный
номер телефона.
• Для смены номера телефона запрашивается секретное слово для авторизации пользователя. Если
значение введено правильно, выводится страница, аналогичная первичной привязке телефона.
Если сделанные изменения успешно подтверждены через смс-код, к ВК привязывается номер телефона, а
за пользователем закрепляется секретное слово.
Результат работы сервиса:
1. На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет следующее:
a. При успехе. Сообщение вида:
<b2p_user>
<reg_date>
<sector>
<client_ref>
<state>
<auth_state>
<first_name>
<patronymic>
<last_name>
<birth_date>
<inn>
<snils>
<persondoc_number>
<persondoc_issdate>
P 2 P M a r k e t С т р а н и ц а 8 0 | 1 7 2
/Confidential
<persondoc_issby>
<address>
<phone>
<email>
<available_balance>
<signature>
</b2p_user>
2. b. При неудаче. Сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим,
ID сектора указан неверно), либо если отсутствует одно из обязательных полей.
В браузер пользователя выводится страница ПЦ с результатом завершения операции привязки
телефона.
Сервис webapi/b2puser/GetBalance
Используйте запрос webapi/b2puser/GetBalance для получения от ПЦ информации об остатке средств на
счете ВК пользователя Площадки. Запрос выполняется в режиме обмена данными «сервер-сервер», без
перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 31. Параметры запроса webapi/b2puser/GetBalance
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки, к которому будет
привязана карта.
67812321
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, password в указанном порядке, см. Приложение
№2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/GetBalance
ИС ТСП отправляет Запрос webapi/b2puser/GetBalance в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/GetBalance HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
В ответ на запрос:
• При успехе. Приходит xml с параметрами зарегистрированного пользователя:
<b2p_user_balance>
<client_ref>clientRefTest</client_ref>
<available_balance>0</available_balance>
<currency>643</currency>
<credit_limit>0</credit_limit>
<status>OPEN</status>
<active>0</active>
<signature>YTZjOTQzYTBhMWU2ZGVhY2VkMzA3NTYxMWVkZGFiMjY=</signature>
</b2p_user_balance>
P 2 P M a r k e t С т р а н и ц а 8 1 | 1 7 2
Поле <active> /Confidential
отображает текущее состояние идентификации пользователя для доступности
вывода денег на внешнюю карту. Поле может содержать одно из следующих значений:
o 0 (anonymous). Идентификация не проводилась, либо данные не подтверждены, телефон
не привязан.
o 1 (anonymous). Идентификация не проводилась, либо данные не подтверждены, телефон
привязан.
o 2 (ui_card). Идентификация проводилась по карте, карта привязана, телефон привязан.
o 3 (anonymous/ui_card). Идентификация запрошена, нет информации о результате проверки,
телефон привязан.
o 4 (anonymous/ui_card). Идентификация проведена, данные не подтверждены, телефон
привязан.
o 5 (ui_documents). Идентификация проведена, данные подтверждены, телефон привязан.
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
Сервис webapi/b2puser/Statement
Используйте запрос webapi/b2puser/Statement для получения выписки по операциям ВК конкретного
пользователя. Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления
Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 32. Параметры запроса webapi/b2puser/Statement
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, start, end, count,
password в указанном порядке, см. Приложение №2.
Необязательные параметры
start Строка (20) Дата начала периода выписки в формате:
yyyy.MM.ddTHH:mm:ss
end Строка (20) Дата окончания периода выписки в формате:
yyyy.MM.ddTHH:mm:ss
count Целое (3) Количество операций для возврата в выписке.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/Statement
ИС ТСП отправляет Запрос webapi/b2puser/Statement в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/Statement HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
P 2 P M a r k e t С т р а н и ц а 8 2 | 1 7 2
/Confidential
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса.
Если ошибок нет, в процессе обработки запроса в ПЦ:
• Производится запрос данных об операциях пользователя Площадки.
В ответ на запрос:
• При успехе. Приходит xml следующего вида, с выпиской по операциям (см. Приложение №1, п.3):
<?xml version="1.0" encoding="UTF-8"?>
<Statement>
…
</Statement>
(описание формата см. Приложение №1, п.3)
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
Сервис gateweb/b2puser/CheckPhone
Используйте запрос gateweb/b2puser/CheckPhone для проверки валидности телефона и пароля
пользователя Площадки.
Предупреждение: сервис предоставляется ТСП после согласования с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 33. gateweb/b2puser/CheckPhone
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки, к которому
будет привязан телефон. 67812321
phone Строка (20) Телефон пользователя Площадки, к которому будет
привязан client_ref.
79191013456
passphrase Строка (20)
Новый пароль для пользователя в состоянии NEW,
либо текущий пароль пользователя в состоянии
ACTIVE, от 8 символов.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, phone, passphrase,
newpassphrase, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
resendSms true/false Признак необходимости отправки смс с новым
кодом.
mode Целое (1) Возможные значения: 0, 1.
P 2 P M a r k e t С т р а н и ц а 8 3 | 1 7 2
/Confidential
0 — выполняется отправка смс при проверке
валидности телефона и пароля;
1 — отправка смс при проверке валидности
телефона и пароля не выполняется.
newpassphrase Строка (20) Новый пароль для пользователя в состоянии
ACTIVE, от 8 символов.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса gateweb/b2puser/CheckPhone
ИС ТСП отправляет POST Запрос gateweb/b2puser/CheckPhone в ПЦ. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /gateweb/b2puser/CheckPhone HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 132
Content-Type: application/x-www-form-urlencoded
signature=MzU2NTkxZWU5ZDAyODgxNjEzMTg3YTAxMTljNDExYjQ=&sector=893&client_ref=test7
95&phone=79112820910&passphrase=adminadmin3&mode=1
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса;
• Существуют ли у данного сектора пользователи с таким же номером телефона. Если существуют, но
это не текущий пользователь — запрос завершается ошибкой;
• Введенное passphrase на равенство текущему значению.
Если в запросе передан параметр mode=1, и у сектора есть соответствующее разрешение, то отправка смс-
кода не выполняется, и сервис прекращает свою работу.
Если параметр mode=0 или не передан, то выполняется проверка на необходимость переотправки смс
(параметр resendSms):
• resendSms = true. ПЦ проверяет последнюю попытку привязки телефона для пользователя с
указанным client_ref. Если такой нет — запрос завершается ошибкой. Если есть, ПЦ находит
последний отправленный смс-код:
o Если данный код не найден, ПЦ выдаёт ошибку;
o Если количество отправок смс по последней попытке привязки телефона превышает 3, ПЦ
выдаёт ошибку;
o Иначе, ПЦ создает запись с указанием последнего отправленного смс-кода.
• resendSms = false или не указан. ПЦ проверяет все попытки привязки телефона для пользователя с
указанным client_ref:
o Если попыток больше трёх, ПЦ выдаёт ошибку;
o Иначе, ПЦ создает запись о новой попытке привязке телефона и на введенный номер
отправляется смс-код.
P 2 P M a r k e t С т р а н и ц а 8 4 | 1 7 2
/Confidential
Сервис gateweb/b2puser/SetPhone
Используйте запрос gateweb/b2puser/SetPhone для привязки или перепривязки номера телефона к ВК
пользователя Площадки. Использование сервиса подразумевает создание и проверку секретного слова
клиента.
Предупреждение: сервис предоставляется ТСП после согласования с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 34. Параметры запроса gateweb/b2puser/SetPhone
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки, к которому
будет привязан телефон. 67812321
phone Строка (20) Телефон пользователя Площадки, к которому будет
привязан client_ref.
79191013456
passphrase Строка (20)
Новый пароль для пользователя в состоянии NEW,
либо текущий пароль пользователя в состоянии
ACTIVE, от 8 символов.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, phone, passphrase,
newpassphrase, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
smscode Строка (20) Код из смс-сообщения.
mode Целое (1)
Возможные значения: 0, 1.
0 — с проверкой смс-кода;
1 — без проверки смс-кода.
newpassphrase Строка (20) Новый пароль для пользователя в состоянии
ACTIVE, от 8 символов.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса gateweb/b2puser/SetPhone
ИС ТСП отправляет POST Запрос gateweb/b2puser/SetPhone в ПЦ. Запрос выполняется в режиме «сервер-
сервер», редирект не используется.
POST /gateweb/b2puser/SetPhone HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 137
Content-Type: application/x-www-form-urlencoded
signature=OGNlM2UzNTIwM2U4MzBkNTQwYTE2ZTEyMDJlNzg0YmY=&sector=3013&client_ref=test
User&phone=71231234567&smscode=6746&passphrase=testtest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса.
Если в запросе передан параметр mode=1, то проверка смс-кода не выполняется.
Если параметр mode=0 или не передан, то выполняется проверка смс-кода:
P 2 P M a r k e t С т р а н и ц а 8 5 | 1 7 2
/Confidential
• ПЦ проверяет последнюю попытку привязки телефона для пользователя с указанным client_ref. Если
такой нет, либо в рамках этой попытки нет отправки смс-кода — запрос завершается ошибкой;
• Если введенный смс-код не совпадает с смс-кодом из последней отправленной смс, то выполняется
увеличение количества попыток ввода смс:
o Количество попыток = 3. ПЦ выдаёт ошибку "Превышено количество попыток ввода СМС-
кода. Попробуйте выполнить привязку телефона заново.";
o Количество попыток > 3. ПЦ переводит пользователя в состояние INACTIVE и выдаёт
ошибку "Превышено количество попыток выполнения операции". После этого необходим
ручной перевод пользователя в состояние NEW / Active и ручной сброс попыток привязки
телефона;
o Количество попыток < 3. ПЦ выдаёт ошибку "Был введен неправильный код СМС".
После успешной привязки/перепривязки телефона, ПЦ присылает callback следующего вида:
<?xml version="1.0" encoding="UTF-8"?>
<user_identification_status_change>
<sector_id>3013</sector_id>
<client_ref>999</client_ref>
<user_active_flag>1</user_active_flag>
<signature>ZDZiYjI3OTkxOGQxYWMxMGNjMjc2ZGE2NGExY2JlM2M=</signature>
</user_identification_status_change>
Сервис webapi/b2puser/VCard
Используйте запрос webapi/b2puser/VCard для показа полных карточных данных в ПЦ. Запрос выполняется
с отображением страниц ПЦ пользователю Площадки.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 35. Параметры запроса webapi/b2puser/VCard
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, url, failurl, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
url Строка (500)
Адрес страницы на стороне ТСП, на которую автоматически
переводится пользователь Площадки. Типовой чек ПЦ не
показывается. ПЦ также передает на url идентификатор
пользователя Площадки в виде GET-параметра.
Заполните значение параметра полностью, с указанием
префикса (http:// или https://).
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую автоматически
переводится Плательщик в случае неуспешного окончания
работы сервиса (т.е. в случае, когда показ карточных данных
невозможен, в том числе по причине какой-либо ошибки). ПЦ
также передает на failurl идентификатор пользователя
Площадки и код ошибки (при наличии) в виде GET-
параметров. Если failurl не указан, ПЦ считает его равным
значению url.
Заполните значение параметра полностью, с указанием
префикса (http:// или https://).
P 2 P M a r k e t С т р а н и ц а 8 6 | 1 7 2
/Confidential
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/VCard
ИС ТСП перенаправляет Плательщика методом HTTP POST на страницу ПЦ с использованием Запроса
webapi/b2puser/VCard для показа карточных данных:
POST /webapi/b2puser/VCard HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса;
• Наличие ВК у указанного пользователя Площадки. Если карта отсутствует, ПЦ возвращает ошибку
выполнения запроса;
• Что пользователь не заблокирован в ПЦ (т.е. имеет статус new или active). Если пользователь
Площадки имеет некорректный статус, ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ возвращает страницу с изображением карты и замаскированным номером (6+4), а
также окно для ввода одноразового пароля. При успешной проверке пароля, изображение на карте
изменяется: появляется полный номер карты, срок действия и CVV/CVC-код.
Сервис webapi/b2puser/VCardReissue
Используйте запрос webapi/b2puser/VCardReissue для перевыпуска ВК пользователя с одновременной
попыткой установить для новой карты все атрибуты старой карты. Запрос выполняется в режиме обмена
данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 36. Параметры запроса webapi/b2puser/VCardReissue
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки, чья карта
перевыпускается.
67812321
nonce Целое (16)
Уникальный номер Запроса. Каждый очередной Запрос
должен иметь значение параметра nonce не меньшее, чем
было указано в предыдущем Запросе.
20191101
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, nonce, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/VCardReissue
ИС ТСП отправляет Запрос webapi/b2puser/VCardReissue в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/VCardReissue HTTP/1.1
Host: test.paygine.com
Accept: */*
P 2 P M a r k e t С т р а н и ц а 8 7 | 1 7 2
/Confidential
Content-Length: 122
Content-Type: application/x-www-form-urlencoded
signature=NDhkMGY0MjhjMzc5ZTNmNzc1OTA4OTFiNTQxZTBkNzQ=&sector=2502&client_ref=f67bf
12a-a007-45f9-8912-8028cdb83910&nonce=2
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса.
В ответ на запрос:
• При успехе. Приходит xml следующего вида, со статусом перевыпуска ВК:
<?xml version="1.0" encoding="UTF-8"?>
<VCardReissue>
<issue_status>OK</issue_status>
<settings_status>OK</settings_status>
<phone_status>FAIL</phone_status>
<phone_status_reason>Can't set phone to new card</phone_status_reason>
</VCardReissue>
Таблица 37. Возможные параметры ответа внутри <VCardReissue>
Название Описание Значения
<issue_status> Статус перевыпуска карты: перевыпущена
или нет
OK, FAIL
<issue_status_reason> Пояснение к присвоенному статусу. Есть в
ответе только при <issue_status> = FAIL Строка
<settings_status> Статус переноса настроек карты. Есть в
ответе только при <issue_status> = OK OK, FAIL
<settings_status_reason>
Пояснение к присвоенному статусу. Есть в
ответе только при <settings_status> =
FAIL
Строка
<phone_status> Статус перепривязки телефона. Есть в ответе
только при <issue_status> = OK OK, FAIL
<phone_status_reason> Пояснение к присвоенному статусу. Есть в
ответе только при <phone_status> = FAIL Строка
<identify_status>
<issue_status> Статус проведения идентификации для
новой карты. Есть в ответе только при
= OK
OK, PENDING,
SENT,
INN_NOT_FOUND
<identify_status_reason> Пояснение к присвоенному статусу. Есть в
ответе только при identify_status = FAIL Строка
<balance_status>
<issue_status> Статус проведения идентификации для
новой карты. Есть в ответе только при
= OK
OK, FAIL
<balance_status_reason> Пояснение к присвоенному статусу. Есть в
ответе только при <balance_status> = FAIL Строка
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
P 2 P M a r k e t С т р а н и ц а 8 8 | 1 7 2
/Confidential
Сервис webapi/b2puser/SetPhoneVCard
Используйте запрос webapi/b2puser/SetPhoneVCard для привязки или перепривязки номера телефона к ВК
пользователя Площадки и последующего показа полных данных карты. Использование сервиса
подразумевает создание и проверку секретного слова клиента.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 38. Параметры запроса webapi/b2puser/SetPhoneVCard
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки, к которому
будет привязан телефон. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, phone, passphrase, password
в указанном порядке, см. Приложение №2.
Необязательные параметры
phone Строка (20) Телефон пользователя Площадки, к которому будет
привязан client_ref.
79191013456
passphrase Строка (20)
Новый пароль для пользователя в состоянии NEW,
либо текущий пароль пользователя в состоянии
ACTIVE, от 8 символов.
repassphrase Строка (20) Значение, дублирующее пароль.
url Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится пользователь Площадки
по завершении работы сервиса (нажатие кнопки
Закрыть). ПЦ также передает на url идентификатор
пользователя Площадки в виде GET-параметра.
Значение параметра необходимо заполнять
полностью, с указанием префикса (http:// или https://).
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится пользователь Площадки в
случае неуспешного окончания работы сервиса (т.е. в
случае, когда показ карточных данных невозможен, в
том числе по причине какой-либо ошибки). ПЦ также
передает на failurl идентификатор пользователя
Площадки и код ошибки в виде GET-параметров. Если
failurl не указан, ПЦ считает его равным значению url.
Значение параметра необходимо заполнять
полностью, с указанием префикса (http:// или https://).
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/SetPhoneVCard
ИС ТСП перенаправляет Плательщика методом HTTP POST на страницу ПЦ с использованием Запроса
webapi/b2puser/SetPhoneVCard для показа карточных данных:
POST /webapi/b2puser/SetPhoneVCard HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 8 9 | 1 7 2
/Confidential
• Существование пользователя Площадки с указанным client_ref. Если пользователь не найден, ПЦ
возвращает ошибку выполнения запроса;
• Наличие ВК у указанного пользователя Площадки. Если карта отсутствует, ПЦ возвращает ошибку
выполнения запроса;
• Что пользователь не заблокирован в ПЦ (т.е. имеет статус new или active). Если пользователь
Площадки имеет некорректный статус, ПЦ возвращает ошибку выполнения запроса;
• Наличие зарегистрированного в ПЦ секретного слова у пользователя с ранее привязанным
телефоном. Если секретного слова нет, ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ возвращает страницы для установки или смены привязанного к ВК номера телефона:
• Для первичной привязки выводится окно с полями ввода номера телефона и секретного слова. Если
данные заполнены корректно, ПЦ отправит смс-сообщение с кодом подтверждения на введенный
номер телефона.
• Для смены номера телефона запрашивается секретное слово для авторизации пользователя. Если
значение введено правильно, выводится страница, аналогичная первичной привязке телефона.
Если сделанные изменения успешно подтверждены через смс-код, к ВК привязывается номер телефона, а
за пользователем закрепляется секретное слово.
Результат работы сервиса:
1. На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет следующее:
a. При успехе. Сообщение вида:
<b2p_user>
<reg_date>
<sector>
<client_ref>
<state>
<auth_state>
<first_name>
<patronymic>
<last_name>
<birth_date>
<inn>
<snils>
<persondoc_number>
<persondoc_issdate>
<persondoc_issby>
<address>
<phone>
<email>
<available_balance>
<signature>
</b2p_user>
2. b. При неудаче. Сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим,
ID сектора указан неверно), либо если отсутствует одно из обязательных полей.
В браузер пользователя выводится страница ПЦ с полными данными карты и записью об успешном
завершении операции привязки телефона. После нажатия кнопки Закрыть, если параметр url
заполнен, пользователь автоматически перенаправляется на значение url, указанное в запросе, с
присоединением к адресу идентификатора Пользователя площадки в виде GET-параметра.
P 2 P M a r k e t С т р а н и ц а 9 0 | 1 7 2
/Confidential
Сервис webapi/b2puser/UpdateCardMetadata
Используйте запрос webapi/b2puser/UpdateCardMetadata для обновления дизайна ВК в wallet. Запрос
выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные
страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 39. Параметры запроса webapi/b2puser/UpdateCardMetadata
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Уникальный идентификатор пользователя Площадки.
foreground_color Строка (255) Цвет переднего плана. Формат rgb(132,231,234)
background_color Строка (255) Цвет заднего плана. Формат rgb(132,231,234)
label_color Строка (255) Цвет элементов карты. Формат rgb(132,231,234)
card_backgound Строка (255) Идентификатор дизайна карты в Visa Card Metadata
Manager.
card_icon Строка (255) Идентификатор дизайна лейбла карты в Visa Card
Metadata Manager.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют: sector, client_ref, foreground_color,
background_color, label_color, card_backgound,
card_icon, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/UpdateCardMetadata
ИС ТСП отправляет Запрос webapi/b2puser/UpdateCardMetadata в ПЦ методом HTTP POST. Запрос
выполняется в режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/UpdateCardMetadata HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 246
Content-Type: application/x-www-form-urlencoded
signature=MzZjMzViZGI0Yzg4ZjM2ZjhiMmQ0ZjJiYjY1OTA2YWQ=&sector=3905&client_ref=23dbf
142-c6f9-4929-9481-
91bfcdccc07a&foreground_color=rgb(0,0,0)&background_color=rgb(205,193,197)&label_co
lor=rgb(139,26,26)&card_background=rgb(139,26,26)&card_icon=1
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса.
В ответ на запрос:
• При успехе. Приходит xml с параметрами обновления дизайна карты:
<UpdateCardMetadata>
<client_ref>23dbf142-c6f9-4929-9481-91bfcdccc07a</client_ref>
<success>true</success>
<cardart_refid>rgb(139,26,26),1</cardart_refid>
</UpdateCardMetadata>
• При неудаче. Приходит сообщение в формате xml с указанием кода ошибки и расшифровкой.
Например, если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID
сектора указан неверно), либо если отсутствует одно из обязательных полей.
P 2 P M a r k e t С т р а н и ц а 9 1 | 1 7 2
/Confidential
Сервисы работы с финансовыми операциями по виртуальным картам
Сервис webapi/b2puser/CardEnroll
Используйте запрос webapi/b2puser/CardEnroll для привязки карты зарегистрированного пользователя
Площадки к его ВК и получения токена привязываемой карты. Запрос выполняется с отображением
пользователю Площадки страниц ПЦ.
Важно: данный метод используется ТОЛЬКО для привязки карты к Виртуальной карте. Для простой
регистрации карты и получения токена используйте сервис webapi/CardEnroll.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 40. Параметры запроса webapi/b2puser/CardEnroll
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, password в указанном порядке, см. Приложение
№2.
Необязательные параметры
url Строка (500)
Адрес страницы на стороне ТСП, на которую автоматически
переводится Плательщик по завершении Операции. ПЦ
также передает на url идентификаторы Заказа и Операции в
виде GET-параметров. Типовой чек ПЦ не показывается.
Заполните значение параметра полностью, с указанием
префикса (http:// или https://)
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую автоматически
переводится Плательщик в случае неуспешного окончания
проведения Операции (когда статус Операции отличен от
APPROVED, или Операция не сформирована из-за какой-
либо ошибки). ПЦ также передает на failurl идентификаторы
Заказа и Операции и код ошибки (при наличии) в виде GET-
параметров.
Если failurl не указан, ПЦ считает его равным значению url.
Заполните значение параметра полностью, с указанием
префикса (http:// или https://)
mode Целое (1)
0
Возможные значения: 0, 1.
0 — для привязки Вашей карты, будет временно
заблокирована сумма ₽ 1.
1 — для проверки Вашей карты, будет временно
заблокирована небольшая случайная сумма.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/CardEnroll
ИС ТСП перенаправляет Плательщика методом HTTP POST на страницы ПЦ с использованием Запроса
webapi/ b2puser/CardEnroll:
POST /webapi/b2puser/CardEnroll HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&client_ref=clien
tRefTest
P 2 P M a r k e t С т р а н и ц а 9 2 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с таким
client_ref, то ПЦ создает новую учетную запись с незаполненной информацией о пользователе и
присваивает ей client_ref. Открытие ВК не выполняется;
• Если client_ref не указан в запросе — это не считается ошибкой, но ПЦ не создает учетную запись
нового пользователя.
Если ошибок нет, ПЦ возвращает страницы для ввода карточных данных пользователя.
После ввода корректных данных, по карте совершается Операция списания на сумму ₽ 1. Возможны
следующие итоги обработки:
• Если параметры url / failurl не заполнены, ПЦ показывает чек с результатами операции;
• Если параметры url / failurl заполнены, ПЦ перенаправляет пользователя на адрес url / failurl,
указанный в запросе, присоединяя к адресу информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной Операции. Если операция завершена успешно, в этом уведомлении, в
числе прочих параметров, будет содержаться token карты. Вид и состав уведомления аналогичен
виду и составу уведомления о проведенной операции, указанному в основной инструкции по
интеграции;
• Если Операция завершена успешно, token карты в ПЦ привязывается к пользователю Площадки, а
сама операция — отменяется.
Важно: после привязки карты рекомендуется сделать возврат с помощью webapi/Reverse. В таком
случае, захолдированная сумма вернется пользователю быстрее.
Сервисы webapi/b2puser/PayIn, webapi/b2puser/PayIn2 и webapi/b2puser/P2PIn
Используйте запросы webapi/b2puser/PayIn и webapi/b2puser/PayIn2 для получения средств на счет
пользователя Площадки с внешней карты в ПЦ. Запросы являются аналогами друг друга, выполняются с
отображением Плательщику страниц ПЦ и отличаются только форматом ответа:
• PayIn возвращает экранный чек, либо перенаправляет пользователя на url / failurl;
• PayIn2 возвращает xml-сообщение.
Запрос webapi/b2puser/P2PIn является аналогом webapi/b2puser/PayIn, но отличается порядком
проведения операции в протоколе общения с банком. Вместо двух транзакций (Purchase + Merchandise
return) отправляется одна (P2PTransfer).
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 41. Параметры запроса webapi/b2puser/PayIn
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
to_client_ref Строка (255) Идентификатор пользователя Площадки, которому
переводятся средства.
67812321
signature Строка (255)
P 2 P M a r k e t Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, payer_id, to_client_ref, amount,
С т р а н и ц а 9 3 | 1 7 2
amount currency description id payer_id reference fee_value action get_token token applePaymentData P 2 P M a r k e t /Confidential
currency, token, cof
_
ind, password в указанном
порядке, см. Приложение №2.
Условно-обязательные параметры
Целое (12)
Сумма операции в минимальных единицах
валюты. Для рублей - копейки.
Обязателен, если не указан параметр id.
1000
Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD). Обязателен, если не указан
параметр id.
643
Строка (1000) Описание перевода.
Обязателен, если не указан параметр id.
Необязательные параметры
Целое (19)
Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса
webapi/Register.
2231412
Строка (255)
Идентификатор пользователя Площадки, для
которого будет запомнена карта плательщика.
Если в запросе указан токен карты (параметр
token), значение параметра payer_id не
используется.
Строка (100) Номер перевода на стороне Площадки. Если не
указан, значение формируется автоматически.
12345ABC
Целое (12)
Комиссия за осуществление перевода в
минимальных единицах валюты. Для рублей —
копейки. Данная комиссия взимается с
Плательщика дополнительно к основной сумме
перевода.
Если в запросе указан Заказ (параметр id),
значение параметра берется из Заказа.
Строка (3)
Если action=pay, то ПЦ осуществляет попытку
провести Операцию на основании параметров
Запроса, без отображения Платёжной формы
Плательщику. При нехватке данных для
проведения Операции, Плательщику выводится
Платёжная форма для заполнения недостающих
данных.
pay
Целое (1)
Запрос на предоставление токена использованной
в Операции Платёжной карты в составе
уведомления на url. Возможные значения: 0 (по
умолчанию), 1.
0 — токен не возвращать;
1 — вернуть токен.
0
Строка (255)
Токен ранее зарегистрированной Платёжной
карты, заменяющий Карту Плательщика.
Позволяет Плательщику не вводить все реквизиты
Карты при повторном переводе, см. Работа с
токеном карты в основной инструкции по
интеграции.
JSON-объект
в base64
Платежные данные Apple Pay в формате base64-
кодированной строки JSON. Значение параметра
paymentData, указанного в платежном токене
Apple (параметр paymentData внутри объекта
класса PKPaymentToken). Имеет более высокий
приоритет над полем applePaymentToken.
Параметр анализируется только вместе action=pay.
С т р а н и ц а 9 4 | 1 7 2
/Confidential
applePaymentToken Строка (255)
JSON-объект с платёжными данными Apple Pay.
Значение платежного токена, полученного от
Apple (объект класса PKPaymentToken).
Параметр анализируется только вместе action=pay.
googleCryptogram JSON-объект
в base64)
Платежные данные Google Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Google. Параметр
анализируется только вместе action=pay.
yandexCryptogram JSON-объект
в base64
Платежные данные Yandex Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Yandex. Параметр
анализируется только вместе action=pay.
samsung_ref_id Строка (255)
Платёжные данные Samsung Pay. Значение
уникального референса запроса на получение
криптограммы карты. Параметр анализируется
только вместе action=pay.
url Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции. ПЦ также передает на url
идентификаторы Заказа и Операции в виде GET-
параметров. Типовой чек ПЦ не показывается.
Если в запросе указан Заказ (параметр id),
значение параметра будет взято из Заказа.
Заполните значение параметра полностью, с
указанием префикса (http:// или https://).
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
неуспешного окончания проведения Операции
(когда статус Операции отличен от APPROVED, или
Операция не сформирована из-за какой-либо
ошибки). ПЦ также передает на failurl
идентификаторы Заказа и Операции и код ошибки
(при наличии) в виде GET-параметров.
Если failurl не указан, ПЦ считает его равным
значению url. Если в запросе указан Заказ
(параметр id), значение параметра берется из
Заказа.
Заполните значение параметра полностью, с
указанием префикса (http:// или https://).
Только для PayIn2 (необязательные параметры)
pares Строка (5000)
Значение <PaRes>, полученное от Банка-эмитента
по итогам проведения аутентификации на
странице ввода одноразового пароля.
md Строка (64)
Значение <MD>, полученное от Банка-эмитента по
итогам проведения аутентификации на странице
ввода одноразового пароля.
Только для P2PIn (необязательные параметры)
cof_ind Строка (4)
Значение, определяющее порядок применения
признаков использования сохраненных
реквизитов карты. Возможные значения:
CC (Credentials Captured)— с сохранением
реквизитов карты;
CNC (Credentials Not Captured) — без сохранения
реквизитов карты;
CIT
P 2 P M a r k e t С т р а н и ц а 9 5 | 1 7 2
/Confidential
СIT (Consumer-Initiated Transaction) — операция по
сохраненным реквизитам, инициированная
плательщиком;
MITR (Merchant-Initiated Transaction Recurring) —
операция типа «подписка» по сохраненным
реквизитам, инициированная ТСП;
MITI (Merchant-Initiated Transaction Installment) —
операция типа «рассрочка» по сохраненным
реквизитам, инициированная ТСП.
Примечание: действует только для карт МИР.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/PayIn
ИС ТСП перенаправляет Плательщика методом HTTP POST на страницы ПЦ с использованием Запроса
webapi/b2puser/PayIn:
POST /webapi/b2puser/PayIn HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 94
Content-Type: application/x-www-form-urlencoded
signature=ZDNiOTU4ZDg0ZTc4NDQzNjVmN2UyNDRjZmQyZjFhMDk=&sector=3905&to_client_ref=cl
ientRefTest
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если to_client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с
таким идентификатором пользователя, то ПЦ создает новую учетную запись с информацией о
пользователе, присваивает ей идентификатор пользователя и открывает ВК;
• Если в ПЦ есть привязанный к Площадке пользователь с таким же идентификатором пользователя,
как в параметре to_client_ref запроса, но без ВК, то ПЦ открывает этому пользователю ВК;
• Если в запросе пришли token и payer_id, то используется token;
• В зависимости от полноты идентификации пользователя ВК Площадки, следующие параметры
проведения операции должны соответствовать ограничениям, установленным законодательством
РФ (см. таблицу в Общем описании процесса):
o сумма текущей операции;
o совокупная сумма операций с начала календарного месяца;
o остаток на счете ВК.
Если параметры не соответствуют — ПЦ возвращает ошибку выполнения запроса.
В процессе обработки запроса, пользователь перенаправляется на Платежную страницу ПЦ для ввода или
подтверждения карточных данных. После ввода корректных данных выполняется операция перевода
средств с карты плательщика (с возможным переходом на 3DS для подтверждения списания средств с
внешней карты) на ВК пользователя Площадки. Далее:
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной операции. Вид и состав уведомления аналогичен виду и составу
уведомления о проведенной операции, указанному в основной инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 9 6 | 1 7 2
/Confidential
Сервисы webapi/b2puser/PayInDebit и webapi/b2puser/PayInDebit2
Используйте запросы webapi/b2puser/PayInDebit и webapi/b2puser/PayInDebit2 для холдирования средств
по внешней карте плательщика в ПЦ. Запросы являются аналогами друг друга, выполняются с отображением
Плательщику страниц ПЦ и отличаются только форматом ответа:
• PayInDebit возвращает экранный чек, либо перенаправляет пользователя на url / failurl;
• PayInDebit2 возвращает xml-сообщение.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 42. Параметры запросов webapi/b2puser/PayInDebit и webapi/b2puser/PayInDebit2
Пример
Название Тип (длина) Описание Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, payer_id, to_client_ref, amount,
currency, token, cof
_
ind, password в указанном
порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах
валюты. Для рублей - копейки. Если указан id,
значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD). Если указан id, значение currency
берётся из заказа.
643
description Строка (1000) Описание перевода. Если указан id, значение
description берётся из заказа.
Необязательные параметры
id Целое (19)
Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса
webapi/Register.
2231412
payer_id Строка (255)
Идентификатор пользователя Площадки, для
которого будет запомнена карта плательщика.
Если в запросе указан токен карты (параметр
token), значение параметра payer_id не
используется.
to_client_ref Строка (255) Идентификатор пользователя Площадки, которому
переводятся средства.
67812321
reference Строка (100) Номер перевода на стороне Площадки. Если не
указан, значение формируется автоматически. 12345ABC
fee Целое (12)
Комиссия за осуществление перевода в
минимальных единицах валюты. Для рублей —
копейки. Данная комиссия взимается с
Плательщика дополнительно к основной сумме
перевода.
Если в запросе указан Заказ (параметр id),
значение параметра берется из Заказа.
action Строка (3)
Если action=pay, то ПЦ осуществляет попытку
провести Операцию на основании параметров
Запроса, без отображения Платёжной формы
Плательщику. При нехватке данных для
проведения Операции, Плательщику выводится
Платёжная форма для заполнения недостающих
данных.
pay
P 2 P M a r k e t С т р а н и ц а 9 7 | 1 7 2
get_token token applePaymentData applePaymentToken googleCryptogram yandexCryptogram samsung_ref_id url failurl P 2 P M a r k e t Целое (1)
Строка (255)
JSON-объект
в base64
Строка (255)
JSON-объект
в base64)
JSON-объект
в base64
Строка (255)
Строка (500)
Строка (500)
/Confidential
Запрос на предоставление токена использованной
в Операции Платёжной карты в составе
уведомления на url. Возможные значения: 0 (по
умолчанию), 1.
0 — токен не возвращать;
1 — вернуть токен.
0
Токен ранее зарегистрированной Платёжной
карты, заменяющий Карту Плательщика.
Позволяет Плательщику не вводить все реквизиты
Карты при повторном переводе, см. Работа с
токеном карты в основной инструкции по
интеграции.
Платежные данные Apple Pay в формате base64-
кодированной строки JSON. Значение параметра
paymentData, указанного в платежном токене
Apple (параметр paymentData внутри объекта
класса PKPaymentToken). Имеет более высокий
приоритет над полем applePaymentToken.
Параметр анализируется только вместе action=pay.
JSON-объект с платёжными данными Apple Pay.
Значение платежного токена, полученного от
Apple (объект класса PKPaymentToken).
Параметр анализируется только вместе action=pay.
Платежные данные Google Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Google. Параметр
анализируется только вместе action=pay.
Платежные данные Yandex Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Yandex. Параметр
анализируется только вместе action=pay.
Платёжные данные Samsung Pay. Значение
уникального референса запроса на получение
криптограммы карты. Параметр анализируется
только вместе action=pay.
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции. ПЦ также передает на url
идентификаторы Заказа и Операции в виде GET-
параметров. Типовой чек ПЦ не показывается.
Если в запросе указан Заказ (параметр id),
значение параметра будет взято из Заказа.
Заполните значение параметра полностью, с
указанием префикса (http:// или https://)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
неуспешного окончания проведения Операции
(когда статус Операции отличен от APPROVED, или
Операция не сформирована из-за какой-либо
ошибки). ПЦ также передает на failurl
идентификаторы Заказа и Операции и код ошибки
(при наличии) в виде GET-параметров.
Если failurl не указан, ПЦ считает его равным
значению url. Если в запросе указан Заказ
(параметр id), значение параметра берется из
Заказа.
С т р а н и ц а 9 8 | 1 7 2
/Confidential
Заполните значение параметра полностью, с
указанием префикса (http:// или https://)
Только для PayInDebit (необязательные параметры)
cof_ind Строка (4)
Значение, определяющее порядок применения
признаков использования сохраненных
реквизитов карты. Возможные значения:
CC (Credentials Captured)— с сохранением
реквизитов карты;
CNC (Credentials Not Captured) — без сохранения
реквизитов карты;
СIT (Consumer-Initiated Transaction) — операция
по сохраненным реквизитам, инициированная
плательщиком;
MITR (Merchant-Initiated Transaction Recurring) —
операция типа «подписка» по сохраненным
реквизитам, инициированная ТСП;
MITI (Merchant-Initiated Transaction Installment) —
операция типа «рассрочка» по сохраненным
реквизитам, инициированная ТСП.
CIT
Примечание: действует только для карт МИР.
Только для PayInDebit2 (необязательные параметры)
pares Строка (5000)
Значение <PaRes>, полученное от Банка-эмитента
по итогам проведения аутентификации на
странице ввода одноразового пароля.
md Строка (64)
Значение <MD>, полученное от Банка-эмитента по
итогам проведения аутентификации на странице
ввода одноразового пароля.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/PayInDebit2
ИС ТСП отправляет Запрос webapi/b2puser/PayInDebit2 режиме «сервер-сервер», редирект не используется.
в ПЦ методом HTTP POST. Запрос выполняется в
POST /webapi/b2puser/PayInDebit2 HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 150
Content-Type: application/x-www-form-urlencoded
signature=OGRlZjZjMDEzZDM2NmY5NzUwYmJiZTg1MWM2MDJjMjM=&sector=893&from_client_ref=t
est795&to_client_ref=leoind&amount=100&currency=643&description=asd
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если to_client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с
таким идентификатором пользователя, то ПЦ не создает новую учетную запись, но и ошибкой такая
ситуация не считается;
• Если в ПЦ есть привязанный к Площадке пользователь с таким же идентификатором пользователя,
как в параметре to_client_ref запроса, но без ВК, то ПЦ открывает этому пользователю ВК;
• Если в запросе пришли token и payer_id, то используется token;
• В зависимости от полноты идентификации пользователя ВК Площадки, следующие параметры
проведения операции должны соответствовать ограничениям, установленным законодательством
РФ (см. таблицу в Общем описании процесса):
o сумма текущей операции;
P 2 P M a r k e t С т р а н и ц а 9 9 | 1 7 2
/Confidential
o совокупная сумма операций с начала календарного месяца;
o остаток на счете ВК.
Если параметры не соответствуют — ПЦ возвращает ошибку выполнения запроса.
В процессе обработки запроса, пользователь перенаправляется на Платежную страницу ПЦ для ввода или
подтверждения карточных данных. После ввода корректных данных выполняется операция перевода
средств с карты плательщика (с возможным переходом на 3DS для подтверждения списания средств с
внешней карты) на ВК пользователя Площадки. Далее:
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной операции. Вид и состав уведомления аналогичен виду и составу
уведомления о проведенной операции, указанному в основной инструкции по интеграции.
После обработки Запроса webapi/b2puser/PayInDebit2, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/b2puser/Complete
Используйте запрос webapi/b2puser/Complete для списания ранее захолдированных средств и перевода их
на ВК пользователя Площадки в ПЦ. Запрос выполняется в режиме обмена данными «сервер-сервер», без
перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 43. Параметры запроса webapi/b2puser/Complete
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
amount Целое (9) Сумма для фактического списания в минимальных
единицах валюты. Для рублей - копейки
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD) 643
client_ref Строка (255) Идентификатор пользователя Площадки, на ВК
которого будут переведены средства. 67812321
P 2 P M a r k e t С т р а н и ц а 1 0 0 | 1 7 2
/Confidential
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, amount, currency, client_ref,
password в указанном порядке, см. Приложение №2.
Необязательные параметры
fee Целое (12)
Комиссия за осуществление перевода в
минимальных единицах валюты. Для рублей –
копейки. Данная комиссия взимается с Плательщика
дополнительно к основной сумме перевода.
Если значение в запросе не указано, оно будет взято
из Заказа.
to_client_ref_stock JSON-объект
в base64
Мульти-зачисления (нескольким разным мерчантам)
в формате base64-кодированной строки JSON.
Включает в себя общую сумму мульти-зачисления и
список пар client_ref и amount, где требуется
перевести мерчанту сумму, определенную
параметром amount.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/Complete
ИС ТСП отправляет Запрос webapi/b2puser/Complete режиме «сервер-сервер», редирект не используется.
в ПЦ методом HTTP POST. Запрос выполняется в
POST /webapi/b2puser/Complete HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 119
Content-Type: application/x-www-form-urlencoded
signature=ZTIzODdhZDUyNzExYmExNjA1YzRiNDUzODA2ZjQ3Zjc=&sector=893&id=3504413&amount
=100&currency=643&client_ref=test795
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с таким
client_ref, то ПЦ создает новую учетную запись с незаполненной информацией о пользователе,
присваивает ей client_ref и открывает ВК;
• Если в ПЦ есть привязанный к Площадке пользователь с таким же client_ref, как в параметре
to_client_ref запроса, но без ВК, то ПЦ открывает этому пользователю ВК;
• В зависимости от полноты идентификации пользователя ВК Площадки, следующие параметры
проведения операции должны соответствовать ограничениям, установленным законодательством
РФ (см. таблицу в Общем описании процесса):
o сумма текущей операции;
o совокупная сумма операций с начала календарного месяца;
o остаток на счете ВК.
Если параметры не соответствуют — ПЦ возвращает ошибку выполнения запроса.
После обработки Запроса webapi/b2puser/Complete, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
P 2 P M a r k e t С т р а н и ц а 1 0 1 | 1 7 2
/Confidential
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/b2puser/Reverse
Используйте запрос webapi/b2puser/Reverse для отмены сделанных ранее блокировок средств и операций,
созданных с помощью сервисов b2puser/PayIn, b2puser/PayInDebit, b2puser/Complete в ПЦ. Запрос
выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные
страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 44. Параметры запроса webapi/b2puser/Reverse
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в
Процессинговом центре, для которого нужно сделать отмену. 2231412
amount Целое (9) Сумма для отмены в минимальных единицах валюты. Для
рублей – копейки.
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD) 643
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
amount, currency, unique_key, password в указанном порядке,
см. Приложение №2.
Необязательные параметры
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне ТСП.
При получении ключа ПЦ выполняет проверку на наличие
дубликата среди обрабатываемых запросов и созданных
операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-Z],
дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с
Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/Reverse
ИС ТСП отправляет Запрос webapi/b2puser/Reverse в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/Reverse HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 116
Content-Type: application/x-www-form-urlencoded
signature=YWVhOGY1NTkwMzNmN2QwYmY2YmVlM2UyNDJmZDIyMzA=&sector=893&id=480409&amount=
100&currency=643&unique_key=test1
P 2 P M a r k e t С т р а н и ц а 1 0 2 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса.
После обработки Запроса webapi/b2puser/Reverse, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
<order_id>480409</order_id>
<order_state>COMPLETED</order_state>
<reference>77d89bd5-3e2d-41b1-a1b6-040109d2496d</reference>
<id>449796</id>
<date>2024.03.29 17:17:50</date>
<type>REVERSE</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<pan>480938******7309</pan>
<pan2>557071******2794</pan2>
<amount>100</amount>
<currency>643</currency>
<approval_code>275901</approval_code>
<unique_key>test1</unique_key>
<sector_id>893</sector_id>
<bin_issuer>JSCB MOSCOW INDUSTRIAL BANK</bin_issuer>
<expdate>02/2023</expdate>
<iso>643</iso>
<terminal_id>POS_1</terminal_id>
<signature>M2QzNzE5OWFjNWU3NmY5YjEwYTU0MWVjZDBiMjE5YzY=</signature>
</operation>
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test1</unique_key>
<id>449796</id>
<type>REVERSE</type>
<state>APPROVED</state>
<order_id>480409</order_id>
<reference>77d89bd5-3e2d-41b1-a1b6-040109d2496d</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>YTA0NDFhYTFkYTNlMGNkMjAyODRjN2Q4M2YxNjhkYTc=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 1 0 3 | 1 7 2
/Confidential
Сервис webapi/b2puser/Transfer
Используйте запрос webapi/b2puser/Transfer для выплаты средств с ВК одного пользователя Площадки на
ВК другого. Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления
Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 45. Параметры запроса webapi/b2puser/Transfer
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
from_client_ref Строка (255) Идентификатор пользователя Площадки, который
переводит средства.
67812321
to_client_ref Строка (255) Идентификатор пользователя Площадки, которому
переводятся средства.
67812320
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, from_client_ref, to_client_ref,
amount, currency, password в указанном порядке, см.
Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей - копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
Если указан id, значение currency берётся из заказа.
643
description Строка (1000) Описание перевода.
Если указан id, значение description берётся из заказа.
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
reference Строка (100) Номер перевода на стороне Площадки. Если не указан,
значение формируется автоматически. 12345ABC
fee Целое (12)
Комиссия за осуществление перевода в минимальных
единицах валюты. Для рублей — копейки. Данная
комиссия взимается с Плательщика дополнительно к
основной сумме перевода.
Если в запросе указан Заказ (параметр id), значение
параметра берется из Заказа.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/Transfer
ИС ТСП отправляет Запрос webapi/b2puser/Transfer в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/Transfer HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 215
Content-Type: application/x-www-form-urlencoded
signature=YWE4NjFkMTNiM2IzY2ViNmZiOTgxNTM3MjcxNzhmZTI=&sector=893&amount=100&curren
cy=643&fee=0&from_client_ref=3a2dc480-659d-4b97-a5ac-
bc35b2bcbc6e&to_client_ref=544286e5-866d-428a-aede-94f3b39ffccf&description=asd
P 2 P M a r k e t С т р а н и ц а 1 0 4 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если from_client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с
таким client_ref, то ПЦ возвращает ошибку выполнения запроса;
• Если to_client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с
таким client_ref, то ПЦ создает новую учетную запись с информацией о пользователе, присваивает
ей client_ref, указанный в параметре to_client_ref запроса, и открывает ВК;
• Если в ПЦ есть привязанный к Площадке пользователь с таким же client_ref, как в параметре
to_client_ref запроса, но без ВК, то ПЦ открывает этому пользователю ВК;
• В зависимости от полноты идентификации пользователя ВК Площадки, следующие параметры
проведения операции должны соответствовать ограничениям, установленным законодательством
РФ (см. таблицу в Общем описании процесса):
o сумма текущей операции;
o совокупная сумма операций с начала календарного месяца;
o остаток на счете ВК.
Если параметры не соответствуют — ПЦ возвращает ошибку выполнения запроса.
После обработки Запроса webapi/b2puser/Transfer, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 1 0 5 | 1 7 2
/Confidential
Сервис webapi/b2puser/TransferDebit
Используйте запрос webapi/b2puser/TransferDebit для холдирования средств на ВК пользователя Площадки
с целью последующего списания в ПЦ. Запрос выполняется в режиме обмена данными «сервер-сервер»,
без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 46. Параметры запроса webapi/b2puser/TransferDebit
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
from_client_ref Строка (255) Идентификатор пользователя Площадки, который
переводит средства.
67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, from_client_ref, to_client_ref,
amount, currency, password в указанном порядке, см.
Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей - копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
Если указан id, значение currency берётся из заказа.
643
description Строка (1000) Описание перевода.
Если указан id, значение description берётся из заказа.
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
to_client_ref Строка (255) Идентификатор пользователя Площадки, которому
переводятся средства.
67812320
reference Строка (100) Номер перевода на стороне Площадки. Если не указан,
значение формируется автоматически. 12345ABC
fee Целое (12)
Комиссия за осуществление перевода в минимальных
единицах валюты. Для рублей — копейки. Данная
комиссия взимается с Плательщика дополнительно к
основной сумме перевода.
Если в запросе указан Заказ (параметр id), значение
параметра берется из Заказа.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/TransferDebit
ИС ТСП отправляет Запрос webapi/b2puser/TransferDebit режиме «сервер-сервер», редирект не используется.
в ПЦ методом HTTP POST. Запрос выполняется в
POST /webapi/b2puser/TransferDebit HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 142
Content-Type: application/x-www-form-urlencoded
signature=OWIwOTdlM2EwZWZiY2M5OGQ2MjM2ZWE4ODViMGVjNGQ=&sector=893&from_client_ref=5
44286e5-866d-428a-aede-94f3b39ffccf&amount=100&currency=643
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 1 0 6 | 1 7 2
/Confidential
• Если from_client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с
таким client_ref, то ПЦ возвращает ошибку выполнения запроса;
• Если to_client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с
таким client_ref, то ПЦ создает новую учетную запись с информацией о пользователе, присваивает
ей client_ref, указанный в параметре to_client_ref запроса, и открывает ВК;
• Если в ПЦ есть привязанный к Площадке пользователь с таким же client_ref, как в параметре
to_client_ref запроса, но без ВК, то ПЦ открывает этому пользователю ВК;
• В зависимости от полноты идентификации пользователя ВК Площадки, следующие параметры
проведения операции должны соответствовать ограничениям, установленным законодательством
РФ (см. таблицу в Общем описании процесса):
o сумма текущей операции;
o совокупная сумма операций с начала календарного месяца;
o остаток на счете ВК.
Если параметры не соответствуют — ПЦ возвращает ошибку выполнения запроса.
После обработки Запроса webapi/b2puser/TransferDebit, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 1 0 7 | 1 7 2
/Confidential
Сервисы webapi/b2puser/PayOut и webapi/b2puser/PayOut2
Используйте запросы webapi/b2puser/PayOut и webapi/b2puser/PayOut2 для выплаты средств с Виртуальной
карты пользователя Площадки на внешнюю карту в ПЦ. Запросы являются аналогами друг друга,
выполняются с отображением Плательщику страниц ПЦ и отличаются только форматом выдачи результата
о завершении операции:
• webapi/b2puser/PayOut – возвращает экранный чек, либо перенаправляет на указанный Площадкой
адрес;
• webapi/b2puser/PayOut2 – возвращает xml-сообщение.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 47. Параметры запроса webapi/b2puser/PayOut
Описание Название Тип (длина) Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
from_client_ref Строка (255) Идентификатор пользователя Площадки, который
переводит средства.
67812320
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, from_client_ref, to_client_ref,
amount, currency, token2, password в указанном
порядке, см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей — копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3)
Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
Если указан id, значение currency берётся из заказа.
643
description Строка (1000) Описание перевода.
Если указан id, значение description берётся из заказа.
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
to_client_ref Строка (255) Идентификатор пользователя Площадки, которому
переводятся средства.
67812321
reference Строка (100) Номер перевода на стороне Площадки. Если не указан,
значение формируется автоматически. 12345ABC
fee_value Целое (12)
Комиссия за осуществление перевода в минимальных
единицах валюты. Для рублей — копейки. Данная
комиссия взимается с Плательщика дополнительно к
основной сумме перевода.
Если в запросе указан Заказ (параметр id), значение
параметра берется из Заказа.
action Строка (3)
Если action=pay, то ПЦ осуществляет попытку провести
Операцию на основании параметров Запроса, без
отображения Платёжной формы Плательщику. При
нехватке данных для проведения Операции,
Плательщику выводится Платёжная форма для
заполнения недостающих данных.
pay
get_token Целое (1)
Запрос на предоставление токена использованной в
Операции Платёжной карты в составе уведомления на
url. Возможные значения: 0 (по умолчанию), 1.
0 — токен не возвращать;
1 — вернуть токен.
0
P 2 P M a r k e t С т р а н и ц а 1 0 8 | 1 7 2
/Confidential
token2 Строка (255)
Токен ранее зарегистрированной Платёжной карты,
заменяющий Карту Плательщика.
Позволяет Плательщику не вводить все реквизиты
Карты при повторном переводе, см. Работа с токеном
карты в основной инструкции по интеграции.
url Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик по
завершении Операции. ПЦ также передает на url
идентификаторы Заказа и Операции в виде GET-
параметров. Типовой чек ПЦ не показывается.
Если в запросе указан Заказ (параметр id), значение
параметра будет взято из Заказа.
Заполните значение параметра полностью, с
указанием префикса (http:// или https://).
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую
автоматически переводится Плательщик в случае
неуспешного окончания проведения Операции (когда
статус Операции отличен от APPROVED, или Операция
не сформирована из-за какой-либо ошибки). ПЦ также
передает на failurl идентификаторы Заказа и Операции
и код ошибки (при наличии) в виде GET-параметров.
Если failurl не указан, ПЦ считает его равным значению
url. Если в запросе указан Заказ (параметр id), значение
параметра берется из Заказа.
Заполните значение параметра полностью, с
указанием префикса (http:// или https://).
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/PayOut2
ИС ТСП перенаправляет Плательщика методом HTTP POST на Платёжную форму ПЦ с использованием
Запроса webapi/b2puser/PayOut2 для ввода карточных данных:
POST /webapi/b2puser/PayOut2 HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 173
Content-Type: application/x-www-form-urlencoded
signature=NDZiYThiNDU2OGIzMjRkYzFjMDlmYjE2NDdlZDY1NWY=&sector=893&from_client_ref=l
eo&to_client_ref=f419da1e-48ed-46fb-8647-
cafc78a7f75e&amount=1000&currency=643&fee_value=0
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с таким
client_ref, то ПЦ возвращает ошибку выполнения запроса;
• Если в запросе пришли token и to_client_ref, то указанный токен должен быть среди токенов
пользователя с номером to_client_ref. Если такого токена нет — возвращается ошибка выполнения
запроса;
• В зависимости от полноты идентификации пользователя Виртуальной карты Площадки, следующие
параметры проведения операции должны соответствовать ограничениям, установленным
законодательством РФ (см. таблицу в Общем описании процесса):
o сумма текущей операции;
o совокупная сумма операций с начала календарного месяца;
o остаток на счете Виртуальной карты.
P 2 P M a r k e t С т р а н и ц а 1 0 9 | 1 7 2
/Confidential
Если параметры не соответствуют — ПЦ возвращает ошибку выполнения запроса.
В процессе обработки запроса, пользователь перенаправляется на Платежную страницу ПЦ для ввода или
подтверждения карточных данных. После ввода корректных данных выполняется дополнительная
аутентификация пользователя Площадки (3DS авторизация списания с кошелька) операция перевода
средств с кошелька пользователя Площадки на внешнюю карту. По ее окончании, происходит следующее:
Для webapi/b2puser/PayOut
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе, с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
Для webapi/b2puser/PayOut2
В ответ на запрос, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
Сервисы webapi/UserAuthorize и webapi/AuthorizeByUser
Используйте запрос webapi/UserAuthorize для холдирования средств на Виртуальной карте пользователя
Площадки с целью последующего списания в пользу оплаты услуг Площадки. Запрос выполняется без
показа страницы ввода карточных данных, но с переводом на страницу чека или url / failurl по итогам
операции.
Запрос webapi/AuthorizeByUser является аналогом webapi/UserAuthorize, но возвращает ответ в виде xml-
сообщения.
По итогу успешного завершения работы сервисов, доступный остаток на Виртуальной карте пользователя
Площадки уменьшается, но списание средств не производится до вызова операции Complete (сервис
webapi/Complete).
P 2 P M a r k e t С т р а н и ц а 1 1 0 | 1 7 2
/Confidential
Таблица 48. Параметры запроса webapi/UserAuthorize
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
client_ref, password в указанном порядке, см. Приложение
№2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/AuthorizeByUser
ИС ТСП отправляет Запрос webapi/AuthorizeByUser в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/AuthorizeByUser HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 124
Content-Type: application/x-www-form-urlencoded
signature=ZGMwNDJjN2M4MTk5NWQ2NDNjZTVlNTU3ZDU4OGVlMGI=&sector=893&id=3504676&client
_ref=3a2dc480-659d-4b97-a5ac-bc35b2bcbc6e
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса.
После обработки Запроса webapi/AuthorizeByUser, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
По окончании работы сервиса webapi/UserAuthorize:
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе, с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной операции. Вид и состав уведомления аналогичен виду и составу
уведомления о проведенной операции, указанному в основной инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 1 1 1 | 1 7 2
/Confidential
Сервис webapi/Complete
Примечание: здесь приведено сокращенное описание сервиса. Полное описание — в основной
инструкции по интеграции.
Используйте запрос webapi/Complete для списания с Виртуальной карты пользователя Площадки средств,
ранее захолдированных запросом webapi/UserAuthorize. Запрос выполняется в режиме обмена данными
«сервер-сервер», без показа Платёжных страниц ПЦ.
Сумма запроса может отличаться как в меньшую, так и в большую сторону от суммы, указанной при
регистрации Заказа. Это позволяет Площадке произвести списание средств в объеме фактически оказанных
услуг (доставленных товаров и т.д.).
Ниже перечислены параметры, которые могут быть использованы в Запросе. Описание назначения
параметров приводится исходя из общей практики их применения.
Таблица 49. Параметры запроса webapi/Сomplete
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ, полученный
по результатам запроса webapi/Register.
2231412
amount Целое (12)
Сумма фактического списания в минимальных единицах
валюты. Для рублей — копейки.
Значение может отличаться от суммы, изначально указанной в
Заказе, как в меньшую, так и большую сторону
15000
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD). 643
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, amount, currency, password в указанном
порядке, см. Приложение №2.
Необязательные параметры
fee Целое (12)
Комиссия за осуществление перевода в минимальных
единицах валюты. Для рублей — копейки. Данная комиссия
взимается с Плательщика дополнительно к основной сумме
перевода.
Если в запросе указан Заказ (параметр id), значение параметра
будет взято из Заказа.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Complete
ИС ТСП отправляет Запрос webapi/Complete в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/Complete HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 97
Content-Type: application/x-www-form-urlencoded
signature=ZTNjZDgyOWIzNTM2MTg5YTlhYTMyNmIzMWMyOWUxZjE=&sector=1&id=234694&amount=60
0&currency=643
После обработки Запроса webapi/Complete, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
P 2 P M a r k e t С т р а н и ц а 1 1 2 | 1 7 2
/Confidential
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервисы webapi/UserPurchase и webapi/PurchaseByUser
Используйте запрос webapi/UserPurchase для списания средств с Виртуальной карты пользователя
Площадки в оплату услуг Площадки. Запрос выполняется без показа страницы ввода карточных данных, но
с переводом на страницу чека или url / failurl по итогам операции.
Запрос webapi/PurchaseByUser является аналогом webapi/UserPurchase, но возвращает ответ в виде xml-
сообщения.
По итогу успешного завершения работы сервиса, доступный остаток на Виртуальной карте пользователя
Площадки уменьшается.
Таблица 50. Параметры запроса webapi/UserPurchase
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
client_ref Строка (255) Идентификатор пользователя Площадки, с Виртуальной карты
которого переводятся средства.
67812321
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
client_ref, password в указанном порядке, см. Приложение
№2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/PurchaseByUser
ИС ТСП отправляет Запрос webapi/PurchaseByUser в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/PurchaseByUser HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 124
Content-Type: application/x-www-form-urlencoded
signature=ZGMwNDJjN2M4MTk5NWQ2NDNjZTVlNTU3ZDU4OGVlMGI=&sector=893&id=3504676&client
_ref=3a2dc480-659d-4b97-a5ac-bc35b2bcbc6e
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса.
После обработки Запроса webapi/PurchaseByUser, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
P 2 P M a r k e t С т р а н и ц а 1 1 3 | 1 7 2
/Confidential
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
По окончании работы сервиса webapi/UserPurchase:
• Если параметры url / failurl не заполнены, производится показ чека ПЦ;
• Если параметры url / failurl заполнены, пользователь перенаправляется на адрес url / failurl,
указанный в запросе, с присоединением к нему информации об Операции в виде GET-параметров
(стандартный редирект, описанный в инструкции по интеграции);
• На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c
параметрами совершенной операции. Вид и состав уведомления аналогичен виду и составу
уведомления о проведенной операции, указанному в основной инструкции по интеграции.
Сервис webapi/Reverse
Используйте запрос webapi/Reverse для отмены операций, созданных ранее в ПЦ с помощью сервисов
webapi/UserPurchase, webapi/UserAutorize, webapi/Complete и прочих. Запрос выполняется в режиме
обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 51. Параметры запроса webapi/Reverse
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
amount Целое (12)
Сумма Возврата/Отмены в минимальных единицах валюты.
Для рублей — копейки.
Сумма не может быть больше суммы отменяемого Заказа.
8000
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD). 643
signature Строка
(255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
amount, currency, unique_key, password в указанном порядке,
см. Приложение №2.
Необязательные параметры
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне ТСП.
При получении ключа ПЦ выполняет проверку на наличие
дубликата среди обрабатываемых запросов и созданных
операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-Z],
дефис и нижнее подчеркивание [-_].
Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с Оператором.
P 2 P M a r k e t С т р а н и ц а 1 1 4 | 1 7 2
/Confidential
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Reverse
ИС ТСП отправляет Запрос webapi/Reverse в ПЦ методом HTTP POST. Запрос выполняется в режиме обмена
данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
POST /webapi/Reverse HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 115
Content-Type: application/x-www-form-urlencoded
signature=ZTc1NTExZjhmY2QwZWZjNTZkZTNlYjYyYmY4NjViYjA=&sector=893&id=480407&amount
=100&currency=643&unique_key=test
При получении запроса ПЦ проверяет:
• Если в запросе передан параметр unique_key, то ПЦ проверяет запрос на наличие дубля;
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Что сумма, указанная в запросе и сложенная с суммой ранее проведенных реверсов, не превышает
сумму оригинальной (отменяемой) операции. Если сумма выходит за указанные рамки — ПЦ
возвращает ошибку выполнения запроса;
• Если в ПЦ отсутствует информация о пользователе Площадки с указанным в запросе client_ref, ПЦ
возвращает ошибку выполнения запроса.
После обработки Запроса webapi/Reverse, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
<order_id>480407</order_id>
<order_state>COMPLETED</order_state>
<reference>bdeeac71-c187-461c-a280-51c7e55b1956</reference>
<id>449794</id>
<date>2024.03.29 17:15:36</date>
<type>REVERSE</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<pan>480938******7309</pan>
<amount>100</amount>
<currency>643</currency>
<approval_code>000889</approval_code>
<unique_key>test</unique_key>
<sector_id>893</sector_id>
<bin_issuer>JSCB MOSCOW INDUSTRIAL BANK</bin_issuer>
<expdate>02/2023</expdate>
<iso>643</iso>
<terminal_id>POS_1</terminal_id>
<signature>YTY1ZWI2NWY3NTcyMDFmYjMxZmE0NTI2MzM1NTdjYjU=</signature>
</operation>
P 2 P M a r k e t С т р а н и ц а 1 1 5 | 1 7 2
/Confidential
• Вариант 2. Ключ уникальности запроса неуникален. Приходит сообщение об ошибке в формате xml
с параметрами операции-дубля для данного ключа (при наличии).
<?xml version="1.0" encoding="UTF-8"?>
<error>
<duplicated_operation>
<unique_key>test</unique_key>
<id>449794</id>
<type>REVERSE</type>
<state>APPROVED</state>
<order_id>480407</order_id>
<reference>bdeeac71-c187-461c-a280-51c7e55b1956</reference>
</duplicated_operation>
<code>299</code>
<description>unique_key is not unique</description>
<signature>NWM1Mjk0YzY5NDdlOTVhMTU4N2E2NTIzNjhkY2I3ODk=</signature>
</error>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
Сервис webapi/b2puser/CreditUser
Используйте запрос webapi/b2puser/CreditUser для пополнения Виртуальной карты со счета Площадки в ПЦ.
Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на
Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 52. Параметры запроса webapi/b2puser/CreditUser
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки, которому
переводятся средства.
67812321
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
amount, currency, client_ref, password в указанном порядке,
см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты. Для
рублей — копейки.
Если указан id, значение amount берётся из заказа.
1000
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD). Если указан id, значение currency берётся из заказа. 643
reference Строка (100)
Номер перевода на стороне Площадки.
Если не указан, значение формируется автоматически.
Если указан id, значение reference берётся из заказа.
12345ABC
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
P 2 P M a r k e t С т р а н и ц а 1 1 6 | 1 7 2
/Confidential
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/CreditUser
ИС ТСП отправляет Запрос webapi/b2puser/CreditUser режиме «сервер-сервер», редирект не используется.
в ПЦ методом HTTP POST. Запрос выполняется в
POST /webapi/b2puser/CreditUser HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 154
Content-Type: application/x-www-form-urlencoded
signature=NWQwNGE1NzU2ZWU0MDc2ZWNjMWIwY2RlYjZkNWNlMGY=&sector=893&reference=sdfsfd&
amount=100&currency=643&client_ref=3a2dc480-659d-4b97-a5ac-bc35b2bcbc6e
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Если client_ref указан в запросе, но в ПЦ отсутствует информация о пользователе Площадки с таким
client_ref, ПЦ создает новую учетную запись с незаполненной информацией о пользователе,
присваивает ей client_ref, указанный в запросе, и открывает Виртуальную карту;
• Если в ПЦ есть привязанный к Площадке пользователь с таким же client_ref, как в запросе, но без
Виртуальной карты, ПЦ открывает этому пользователю Виртуальную карту.
Если ошибок нет, ПЦ рассчитывает комиссию для данной операции (комиссия списывается со счета
Площадки) и, после выполнения операции перевода средств, возвращает один из следующих вариантов
ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 1 1 7 | 1 7 2
/Confidential
Сервис webapi/p2pmarket/ExtQRPrecheck
Используйте сервис webapi/p2pmarket/ExtQRPrecheck для получения платежной информации из
«внешнего» QR-кода. Запрос выполняется в режиме обмена данными «сервер-сервер» (без
перенаправления Плательщика на Платёжные страницы ПЦ).
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 53. Параметры запроса webapi/p2pmarket/ExtQRPrecheck
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
payload Строка (512) Информация, закодированная во «внешнем» QR-коде.
client_ref Строка (255) Идентификатор пользователя Площадки, по ВК
которого производится оплата.
67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, payload, client_ref, password в
указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/p2pmarket/ExtQRPrecheck
ИС ТСП отправляет Запрос webapi/p2pmarket/ExtQRPrecheck в ПЦ методом HTTP POST. Запрос выполняется
в режиме «сервер-сервер», редирект не используется.
POST /webapi/p2pmarket/ExtQRPrecheck HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 229
Content-Type: application/x-www-form-urlencoded
sector=2744&payload=https%3A%2F%2Fqr.nspk.ru%2FAS100032GHU3R48T8NUB21289U4GHSU0%3Ft
ype%3D01%26bank%3D1crt88888881%26sum%3D1000501%26cur%3DRUB%26crc%3D3B5F&client_ref=
5902d02b-6014-46ae-8bb1-
bf44d3bbf20e&signature=YWFjZjIyOTgzMTgxNmI1YjZhNGQ0NDdkZTA5NGE3OGI=
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса.
После обработки Запроса webapi/p2pmarket/ExtQRPayment, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированного заказа (описание см. Приложение №1, п.2);
<order>
<id>567731</id>
<state>REGISTERED</state>
<inprogress>0</inprogress>
<date>2025.09.04 13:37:40</date>
<amount>1600500</amount>
<currency>643</currency>
<reference>4afa2b86-09a5-41c5-8118-2c38f6097e4f</reference>
<description>Тестовый QR Dynamic для теста №502</description>
<url/>
<parameters number="18">
<parameter>
<name>client_ref</name>
<value>5902d02b-6014-46ae-8bb1-bf44d3bbf20e</value>
</parameter>
<parameter>
<name>precheck_id</name>
P 2 P M a r k e t С т р а н и ц а 1 1 8 | 1 7 2
/Confidential
<value>7f5e7640-7c26-4606-b2e4-7f7e896e1e24</value>
</parameter>
<parameter>
<name>qr_class</name>
<value>SBP</value>
</parameter>
<parameter>
<name>qr_type</name>
<value>DYNAMIC</value>
</parameter>
<parameter>
<name>qr_scenario</name>
<value>C2B</value>
</parameter>
<parameter>
<name>qr_external_id</name>
<value>AD10005TV2O61QCJ8FRA5D16T341TNHK</value>
</parameter>
<parameter>
<name>precheck_ext_id</name>
<value>250904382592662415</value>
</parameter>
<parameter>
<name>merchant_agent_id</name>
<value>1crt88888881</value>
</parameter>
<parameter>
<name>merchant_legal_name</name>
<value>ООО Ромашка</value>
</parameter>
<parameter>
<name>merchant_name</name>
<value>Цветы у дома</value>
</parameter>
<parameter>
<name>merchant_address</name>
<value>УЛИЦА ТАТАРСКАЯ Б. ДОМ 11</value>
</parameter>
<parameter>
<name>mcc</name>
<value>5992</value>
</parameter>
<parameter>
<name>lid</name>
<value/>
</parameter>
<parameter>
<name>mid</name>
<value>MA0000000005</value>
</parameter>
<parameter>
<name>orgn</name>
<value>5093240345798</value>
</parameter>
<parameter>
<name>inn</name>
<value>6514008333</value>
</parameter>
<parameter>
<name>paypage_open_count</name>
<value>0</value>
</parameter>
<parameter>
<name>payments_executed</name>
<value>0</value>
</parameter>
</parameters>
<signature>ZTE1MGZhM2JmOGIxNDA3Mzc3NDY5OTc1ODNiZDA0MjQ=</signature>
</order>
P 2 P M a r k e t С т р а н и ц а 1 1 9 | 1 7 2
/Confidential
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/p2pmarket/ExtQRPayment
Используйте сервис webapi/p2pmarket/ExtQRPayment для проведения платежа по «внешнему» QR-коду на
основании пречека. Запрос выполняется в режиме обмена данными «сервер-сервер» (без перенаправления
Плательщика на Платёжные страницы ПЦ).
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 54. Параметры запроса webapi/p2pmarket/ExtQRPayment
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор заказа, по которому
проводится операция. Содержится в ответе сервиса
webapi/p2pmarket/ExtQRPrecheck.
567731
precheck_id Целое (12)
Значение параметра precheck_id, полученное в
результате предшествующего вызова сервиса
webapi/p2pmarket/ExtQRPrecheck.
client_ref Строка (255) Идентификатор пользователя Площадки, по ВК
которого производится оплата.
67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, precheck_id, client_ref, password в
указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/p2pmarket/ExtQRPayment
ИС ТСП отправляет Запрос webapi/p2pmarket/ExtQRPayment в ПЦ методом HTTP POST. Запрос выполняется
в режиме «сервер-сервер», редирект не используется.
POST /webapi/p2pmarket/ExtQRPayment HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 173
Content-Type: application/x-www-form-urlencoded
sector=2744&id=567731&precheck_id=7f5e7640-7c26-4606-b2e4-
7f7e896e1e24&client_ref=5902d02b-6014-46ae-8bb1-
bf44d3bbf20e&signature=NzUxYzRhYTU5NjM4NzM1NTNkMjhlN2MyOGVlMDRjOTE=
P 2 P M a r k e t С т р а н и ц а 1 2 0 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование активной записи precheck_id для данного заказа. Если запись не найдена, ПЦ
возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ создаёт инициирует проведение оплаты.
После обработки Запроса webapi/p2pmarket/ExtQRPayment, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Если статус платежа присвоен до истечения синхронного
взаимодействия, то приходит сообщение в формате xml с параметрами зарегистрированной
операции (описание см. Приложение №1, п.2). Если статус платежа присвоен позже, то xml-
сообщение приходит как типовой операционный callback (содержание одинаковое).
<operation>
<order_id>567731</order_id>
<order_state>COMPLETED</order_state>
<reference>4afa2b86-09a5-41c5-8118-2c38f6097e4f</reference>
<id>536404</id>
<date>2025.09.04 13:39:07</date>
<type>PURCHASE_BY_QR_EXT</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>1600500</amount>
<currency>643</currency>
<approval_code>049297</approval_code>
<sector_id>2744</sector_id>
<signature>MjA1ZjU2ODgwZGEwMGRjNjM3ZjU5NzBmMDdkMWVlZjY=</signature>
</operation>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 1 2 1 | 1 7 2
/Confidential
Сервисы работы с ограничениями виртуальных карт
Сервисы webapi/b2puser/SetAllowedParams и webapi/b2puser/SetRestrictedParams
Для ограничения или разрешения использования виртуальной карты в ПЦ используйте следующие запросы:
• webapi/b2puser/SetAllowedParams — устанавливает списки разрешенных значений для некоторого
набора параметров операции. Попытка провести операцию будет отклонена, если значение любого
из параметров запроса, для которого задан разрешающий список, в нём не содержится;
• webapi/b2puser/SetRestrictedParams — устанавливает списков запрещенных значений для некоторого
набора параметров операции. Попытка провести операцию будет отклонена, если значение одного
из параметров, для которого задан запрещающий список, в нём содержится.
Важно: Приоритет у списков запрещенных значений всегда выше.
Запросы выполняются в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на
Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 55. Параметры запросов webapi/b2puser/SetAllowedParams,
webapi/b2puser/SetRestrictedParams
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, terminal_list, merchant_list,
mcc_list, trancode_list, country_list, currency_list,
password в указанном порядке, см. Приложение №2.
Необязательные параметры
terminal_list Строка (2000) Список терминалов торговых точек через запятую. E00110037
merchant_list Строка (2000) Список ID мерчантов торговых точек через запятую.
mcc_list Строка (1000) Список MCC (merchant category code) через запятую.
trancode_list Строка (1000)
Список типов операций в ПЦ через запятую.
Возможные значения:
110 — purchase (оплата)
111 — pre-purchase (ходирование/заморозка)
112 — pre-purchase complete (подтверждение
заморозки)
114 — merchandise return (возврат товара)
116 — card verification (проверка карты)
125 — purchase cancelation (отмена)
130 — quasi-cash (р2р-отправка)
132 — POS P2P Debit (р2р-отправка)
133 — POS P2P Credit (пополнение)
110, 111,
112, 125
country_list Строка (1000) Список стран, в которых возможно использовать карту,
через запятую.
currency_list Строка (1000) Список валют авторизации, доступных для карты, через
запятую.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/SetRestrictedParams
ИС ТСП отправляет Запрос webapi/b2puser/SetRestrictedParams в ПЦ методом HTTP POST. Запрос
выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные
страницы ПЦ.
P 2 P M a r k e t С т р а н и ц а 1 2 2 | 1 7 2
/Confidential
POST /webapi/b2puser/SetRestrictedParams HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 91
Content-Type: application/x-www-form-urlencoded
signature=MzQ1MjE1NzMxNDQzZTI2MDMxODRhMmIwODhmNzZhMmE=&sector=893&client_ref=3a2dc4
80-659d-4b97-a5ac-
bc35b2bcbc6e&terminal_list=1&merchant_list=2&mcc_list=3&country_list=643&currency_l
ist=643
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя Площадки с указанным client_ref. Если пользователь не найден, ПЦ
возвращает ошибку выполнения запроса.
После обработки Запроса webapi/b2puser/SetRestrictedParams, ПЦ может прислать один из вариантов
ответа:
• Вариант 1. Запрос успешно обработан;
<response>
<code>1</code>
<description>Successful financial transaction</description>
</response>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис CheckLimit
Используйте сервис CheckLimit чтобы ответить на запрос ПЦ о возможности пополнения виртуальной карты
клиента. Запрос выполняется в режиме обмена данными «сервер-сервер».
Метод запроса: POST
Формат тела запроса: JSON
Формат тела ответа: JSON
Пароль для генерации подписи (password) в тестовом контуре: test
Пароль для генерации подписи (password) в бою: XXXX
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 56. Параметры запроса CheckLimit
Название Тип (длина) Описание Пример
Обязательные параметры
client_ref Строка Референт клиента. 67812321
mcc Строка MCC-код.
amount Целое (12) Сумма операции в минимальных единицах валюты. Для
рублей — копейки. 10000
terminal Строка Информация о терминале. POS_1
retailer Строка Информация о ретейлере.
ext_uid Строка Внешний референс операции (TWOID).
signature Строка (255)
Цифровая подпись. Генерируется по аналогии с подписью
B2P из следующих данных в указанном порядке:
client_ref, mcc, amount, terminal, retailer, ext_uid,
password (константное значение).
P 2 P M a r k e t С т р а н и ц а 1 2 3 | 1 7 2
/Confidential
См. Приложение №2.
Если проверка прошла успешно, то сервис отвечает со статусом 200 OK. Тело ответа:
{
transaction_allowed: true/false // Статус проверки
}
В случае, если сервис проверки лимита по какой-то причине вернул ошибку, возвращается следующее тело
запроса:
{
errors: [
{ message: 'error 1 message' },
{ message: 'error 2 message' },
…
] // Информация по каждой ошибке
}
При этом, в зависимости от разных ошибок ответ может иметь разный статус:
• Код ошибки 400. Тело запроса не прошло валидацию;
• Код ошибки 404. Карта с таким референсом не найдена;
• Во всех остальных случаях возвращается статус 500.
P 2 P M a r k e t С т р а н и ц а 1 2 4 | 1 7 2
/Confidential
Сервис webapi/b2puser/VCardBlock
Используйте сервис webapi/b2puser/VCardBlock для блокировки ранее выданной карты пользователю
Площадки. Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления
Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 57. Параметры запроса webapi/b2puser/VCardBlock
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, card_state, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
card_state Строка (20)
Целевое значение статуса карты.
Возможные значения: restricted, closed.
restricted — Карта заблокирована, счет открыт. Карту
можно разблокировать в любой момент с помощью
запросов VCardUnblock и VCardUnblock2.
closed — Карта заблокирована, счет закрывается через 30
дней. Разблокировка невозможна.
restricted
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/VCardBlock
ИС ТСП отправляет Запрос webapi/b2puser/VCardBlock в ПЦ методом HTTP POST. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
POST /webapi/b2puser/VCardBlock HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 113
Content-Type: application/x-www-form-urlencoded
signature=YjQ4YzU0ZGZjNGYyNmI2ZGI0MDgxODkyZDMxMmM4MmU=&sector=893&client_ref=3a2dc4
80-659d-4b97-a5ac-bc35b2bcbc6e
<b2p_user>
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя Площадки с указанным client_ref. Если пользователь не найден, ПЦ
возвращает ошибку выполнения запроса.
После обработки Запроса webapi/b2puser/VCardBlock, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан;
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 1 2 5 | 1 7 2
<sector>893</sector>
<client_ref>3a2dc480-659d-4b97-a5ac-bc35b2bcbc6e</client_ref>
<pan>557071******5127</pan>
<status>0</status>
<signature>NGI5NTUyYTFjYzJhNzZjZjI4NzFlOWRlNzM4YTQyYTk=</signature>
</b2p_user>
/Confidential
Сервис webapi/b2puser/VCardUnblock
Для разблокировки ранее заблокированной карты пользователя Площадки используется сервис
webapi/b2puser/VCardUnblock. Запрос выполняется с отображением страниц ПЦ пользователю Площадки.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 58. Параметры запроса webapi/b2puser/VCardUnblock
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
nonce Целое (16)
Уникальный номер Запроса. Каждый очередной Запрос
должен иметь значение параметра nonce не меньшее, чем
было указано в предыдущем Запросе.
20191101
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, nonce, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
url Строка (500)
Адрес страницы на стороне ТСП, на которую автоматически
переводится пользователь Площадки по завершении работы
сервиса (нажатие кнопки Закрыть). ПЦ также передает на url
идентификатор пользователя Площадки в виде GET-
параметра.
Значение параметра необходимо заполнять полностью, с
указанием префикса (http:// или https://)
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую автоматически
переводится пользователь Площадки в случае неуспешного
окончания работы сервиса (т.е. в случае, когда показ
карточных данных невозможен, в том числе по причине
какой-либо ошибки). ПЦ также передает на failurl
идентификатор пользователя Площадки и код ошибки в виде
GET-параметров. Если failurl не указан, ПЦ считает его равным
значению url.
Значение параметра необходимо заполнять полностью, с
указанием префикса (http:// или https://)
action Строка (2)
smscode Строка (20) Возможные варианты: параметр не передаётся (по
умолчанию) и do.
Если action=do, то в этом случае дополнительно передается
смс-код в поле smscode.
Смс-код для разблокировки карты пользователя.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/VCardUnblock
ИС ТСП перенаправляет Плательщика методом HTTP POST на страницы ПЦ с использованием Запроса
webapi/b2puser/VCardUnblock:
POST /webapi/b2puser/VCardUnblock HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 121
Content-Type: application/x-www-form-urlencoded
signature=NTU5OGQ4MGM3YjdlZGE0MjEwZGJlYTI3YTM5ZmZlYmI=&sector=893&client_ref=3a2dc4
80-659d-4b97-a5ac-bc35b2bcbc6e&nonce=6
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
P 2 P M a r k e t С т р а н и ц а 1 2 6 | 1 7 2
/Confidential
• Существование пользователя Площадки с указанным client_ref и его статус. Если пользователь не
найден или его статус отличается от 3 (blocked), ПЦ возвращает ошибку выполнения запроса;
• Наличие Виртуальной карты у указанного пользователя Площадки. Если карта отсутствует, ПЦ
возвращает ошибку выполнения запроса;
• Наличие у пользователя ранее привязанного телефона. Если к пользователю не привязан телефон,
ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет и параметр action не был передан в запросе, ПЦ отправляет на привязанный к карте
телефон смс-сообщение с кодом и возвращает в браузер страницу для проверки пользователя путем
запроса отправленного кода. Получив смс с кодом на свой телефон, пользователь вводит код на странице.
ПЦ получает введенный пользователем код, и по результатам проверки:
1. На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет следующее:
При успехе (смс-код введен верно, карта успешно разблокирована). Сообщение вида:
<b2p_user>
<sector>1</sector>
<client_ref>4361</client_ref>
<pan>557071******2106</pan>
<status>1</status>
<signature>ZDg2M2NmMWNjNTRlYzI0MzNjZWJiZWY2NWNlNDg4MGE=</signature>
</b2p_user>
Где <status> имеет следующие значения: 0 — block, 1 — unblock.
2. В браузер пользователя выводится страница ПЦ с результатом операции (сообщение об ошибке,
либо об успешной разблокировке). Либо, если параметр url / failurl заполнен, пользователь
автоматически перенаправляется на значение url / failurl, указанное в запросе, с присоединением
к адресу идентификатора Пользователя площадки в виде GET-параметра.
Если в запросе был передан параметр action=do, ПЦ проверяет смс-код, переданный в параметре smscode.
В зависимости от результата проверки, существует три варианта дальнейшего развития событий:
• Снова открывается страница для ввода данных;
• ПЦ выдает ошибку (исчерпание лимита);
• Происходит процесс по разблокировке карты, и пользователь получает ответ в формате xml/json.
P 2 P M a r k e t С т р а н и ц а 1 2 7 | 1 7 2
/Confidential
Сервис webapi/b2puser/VCardUnblock2
Для разблокировки ранее выданной карты пользователю Площадки без проверки смс-кода, используется
сервис webapi/b2puser/VCardUnblock2. Запрос выполняется в режиме обмена данными «сервер-сервер»
(без перенаправления Плательщика на Платёжные страницы ПЦ).
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 59. Параметры запроса webapi/b2puser/VCardUnblock2
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
nonce Целое (16)
Уникальный номер Запроса. Каждый очередной
Запрос должен иметь значение параметра nonce
не меньшее, чем было указано в предыдущем
Запросе.
2019110111112311
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, nonce, password в
указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/VCardUnblock2
ИС ТСП отправляет Запрос webapi/b2puser/VCardUnblock2 в ПЦ методом HTTP POST. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
POST /webapi/b2puser/VCardUnblock2 HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 121
Content-Type: application/x-www-form-urlencoded
signature=NTU5OGQ4MGM3YjdlZGE0MjEwZGJlYTI3YTM5ZmZlYmI=&sector=893&client_ref=3a2dc4
80-659d-4b97-a5ac-bc35b2bcbc6e&nonce=6
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование пользователя Площадки с указанным client_ref и его статус. Если пользователь не
найден или его статус отличается от 3 (blocked), ПЦ возвращает ошибку выполнения запроса;
• Наличие Виртуальной карты у указанного пользователя Площадки. Если карта отсутствует, ПЦ
возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ разблокирует карту и отправляет xml-сообщение следующего вида:
<b2p_user>
<sector>893</sector>
<client_ref>3a2dc480-659d-4b97-a5ac-bc35b2bcbc6e</client_ref>
<pan>557071******5127</pan>
<status>1</status>
<signature>YTY1ZmY2ODdjNjFjODZhNGU5MzE5MGQ1M2UzOGQyZTI=</signature>
</b2p_user>
Где <status> имеет следующие значения: 0 — block, 1 — unblock.
P 2 P M a r k e t С т р а н и ц а 1 2 8 | 1 7 2
/Confidential
Сервисы работы с процедурами идентификации
Сервис webapi/b2puser/IdentificationStatus
Используйте запрос webapi/b2puser/IdentificationStatus для проведения идентификации физического лица
по его реквизитам паспорта и ФИО в ПЦ. Запрос выполняется в режиме обмена данными «сервер-сервер»,
без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 60. Параметры запроса webapi/b2puser/IdentificationStatus
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
first_name Строка (30) Имя физического лица. Иван
patronymic Строка (30) Отчество физического лица. Петрович
last_name Строка (30) Фамилия физического лица. Иванов
birth_date Строка (10) Дата рождения физического лица, которое нужно
идентифицировать. Формат ГГГГ.ММ.ДД 2000.09.12
persondoc_number Строка (20) Серия и номер паспорта физического лица.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, first_name, patronymic, last_name,
birth_date, persondoc_number, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
mode Целое (1)
Возможные значения: 0, 1.
0 (по умолчанию) — проверка всех документов.
1 — только проверка паспорта. 1
Предупреждение: разрешение на
использование параметра mode
предоставляется по согласованию с Оператором.
Рекомендуемый тайминг переотправки запросов
Во избежание перегрузки информационной системы, для получения конечного статуса по упрощённой
идентификации, рекомендуется использовать прогрессивную шкалу тайминга переотправки запросов.
Схема переопроса статуса идентификации (тайминг указан в минутах):
0 → 1 → 1 → 1 → 1 → 5 → 5 → 10 → 15 → 30 → 60 → 60 → 60 →
...
Где: 0 — первый запрос на идентификацию клиента, а 1, 5, 10, 15, 30, 60 — количество минут, спустя
которое, при неполучении конечного статуса <identification_state> (APPROVED или INN_NOT_FOUND),
рекомендуется отправить повторный запрос на уточнение статуса идентификации.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/IdentificationStatus
ИС ТСП отправляет Запрос webapi/b2puser/IdentificationStatus в ПЦ методом HTTP POST. Запрос
выполняется в режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/IdentificationStatus HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 167
Content-Type: application/x-www-form-urlencoded
signature=MWMwYjEyZWJmZWFkZTY1YzNlNGE3ZTA4ZjZjMTBjODk=&sector=1&first_name=Сидоров&
patronymic=Иван&last_name=Петрович&birth_date=2000.12.12&persondoc_number=445577788
8
P 2 P M a r k e t С т р а н и ц а 1 2 9 | 1 7 2
/Confidential
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса.
В ответ на запрос, при успехе приходит один из следующих вариантов ответа:
• Вариант 1. Проверка только ИНН. Приходит xml с описанием текущего статуса идентификации
физического лица:
<identification_data>
<identification_state>СТАТУС</identification_state>
<inn>ИНН</inn>
<signature>подпись ответа</signature>
</identification_data>
Поле <identification_state> отображает текущий статус идентификации физического лица.
Поле может содержать одно из следующих значений:
o UNKNOWN. Фасадная заглушка для статуса, который мы не умеем обрабатывать;
o PENDING. В очереди на проверку (данные на внешний сервис не отправлялись);
o APPROVED. ИНН есть;
o SENT. ИНН пока нет, ждем ответа от внешней системы (он же, если не удалось проверить
по таймауту);
o FORMAT_ERROR. Ошибка формата данных на проверку;
o INN_NOT_FOUND. ИНН не найден;
• Вариант 2. Проверка паспорта и ИНН. Приходит xml с описанием текущего статуса идентификации
физического лица:
<identification_data>
<persondoc_result>300 - Document validated</persondoc_result>
<signature>ZjViZmJjMTQ1ZTI3MDQ4NzEwZDNkYjg3NWRiM2MyYTEzMTYzMjAxNTgyYzR
hNDA5MzJkNWIwYzkzMTcxYmY5MA==</signature>
<identification_state>APPROVED</identification_state>
<inn>263450780409</inn>
<message>Inn successfully found</message>
<identification_level>40 - Паспорт валидный, ИНН
найден</identification_level>
<request_id>1061</request_id>
</identification_data>
• Вариант 3. Проверка только паспорта. Приходит xml с описанием текущего статуса идентификации
физического лица:
<identification_data>
<persondoc_result>300 - Document validated</persondoc_result>
<signature>MmM4MTM4YTA5MTUzMmExZTA3MGQyNWYzNTFlN2ZlZWFjNTA1NmFjM2VhYjR
iNWNmMDExNWQ5N2MzMGYxYTU1Mw==</signature>
<identification_state>INN_NOT_FOUND</identification_state>
<message>Inn not found. Check personal data</message>
<request_id>1068</request_id>
</identification_data>
Предупреждение: Варианты 2 и 3 доступны только по согласованию с Оператором.
При неудаче приходит сообщение в формате xml с указанием кода ошибки и расшифровкой. Например,
если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID сектора указан неверно),
либо если отсутствует одно из обязательных полей.
P 2 P M a r k e t С т р а н и ц а 1 3 0 | 1 7 2
/Confidential
При успешном запросе, но невозможности произвести идентификацию, в ответе придет параметр
persondoc_fail_reason, возможные значения см. в таблице ниже.
Таблица 61. Расшифровка возможных значений кодов ответа IdentificationStatus
Название Описание
Возможные значения <persondoc_result>
1 - No data Нет данных
300 - Document validated Документ валидирован
301 - Document validation failed Неуспешная валидация документа
302 - Document not found Документ не найден
Возможные значения <identification_level>
0 - паспорт недействителен, ИНН не проверяли
10 - паспорт не валидировался, ИНН не найден
20 - паспорт действителен, ИНН не найден
30 - паспорт не валидировался, ИНН найден
40 - паспорт валидный, ИНН найден
Возможные значения <persondoc_fail_reason>
601 - Expired Истёк срок действия
602 - Replaced with new Заменен на новый
603 - Issued incorrectly Выдан с нарушением
604 - Lost or stolen Числится в розыске
604 - Lost or stolen Изъят, уничтожен
606 - Owner is dead В связи со смертью владельца
607 - Technically defective Технический брак
P 2 P M a r k e t С т р а н и ц а 1 3 1 | 1 7 2
/Confidential
Сервисы работы с xPay Wallet’ами
Сервис webapi/b2puser/GetPayload
Используйте запрос webapi/b2puser/GetPayload для получения данных, которые потом можно использовать
для регистрации Виртуальной карты пользователя в wallet-приложении мобильных операционных систем.
Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на
Платёжные страницы ПЦ.
Важно: в настоящий момент поддерживается запрос для получения данных для wallet-приложения
операционной системы iOS и Android.
Процесс использования на стороне Площадки полученных данных в настоящей инструкции не
рассматривается.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 62. Параметры запроса webapi/b2puser/GetPayload
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) 67812321
nonce Целое (12)
Уникальный номер Запроса. Каждый очередной Запрос
должен иметь значение параметра nonce не меньшее,
чем было указано в предыдущем Запросе.
4
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
client_ref, nonce, password в указанном порядке, см.
Приложение №2.
Идентификатор пользователя Площадки, Виртуальную
карту которого требуется привязать к wallet-приложению.
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование активированного пользователя Площадки с указанным client_ref и привязанной
Виртуальной картой. Если пользователь не найден, ПЦ возвращает ошибку выполнения запроса.
В ответ на запрос отправляется:
• При успехе. Приходит xml-сообщение с параметром <encrypted_data>, в котором будет
содержаться нужная для загрузки в wallet-приложение информация;
• При неудаче. Приходит xml-сообщение с указанием кода ошибки и расшифровкой. Например, если
обнаружена ошибка значения какого-либо параметра запроса (допустим, ID сектора указан
неверно), либо если отсутствует одно из обязательных полей.
P 2 P M a r k e t С т р а н и ц а 1 3 2 | 1 7 2
/Confidential
Сервисы СБП
Сервис webapi/b2puser/GetSBPBankList
Для получения системного справочника банков, поддерживающих СБП, используйте сервис
webapi/b2puser/GetSBPBankList. Запрос выполняется в режиме обмена данными «сервер-сервер» (без
перенаправления Плательщика на Платёжные страницы ПЦ).
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 63. Параметры запроса webapi/b2puser/GetSBPBankList
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
nonce Целое (16)
Уникальный номер Запроса. Каждый очередной Запрос
должен иметь значение параметра nonce не меньшее, чем
было указано в предыдущем Запросе.
201912311
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
nonce, password в указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/GetSBPBankList
ИС ТСП отправляет Запрос webapi/b2puser/GetSBPBankList в ПЦ методом HTTP POST. Запрос выполняется
в режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/GetSBPBankList HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 76
Content-Type: application/x-www-form-urlencoded
signature=ZmYwZWU5ZmIzNGFiNTM1NzZkNTAwYzVmOWU4YjQxYzQ=&sector=893&nonce=5133
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ отправляет xml-сообщение следующего вида:
<GetSBPBankList>
<nonce>1</nonce>
<dataList>
<row>
<id>100000000001</id>
<title>Газпромбанк</title>
<latinTitle>Gazprombank</latinTitle>
</row>
<row>
<id>100000000002</id>
<title>РНКО Платежный центр</title>
<latinTitle>RNKO Payment Center</latinTitle>
</row>
<row>
<id>100000000003</id>
<title>СКБ-банк</title>
<latinTitle>SKB-bank</latinTitle>
</row>
<row>
<id>100000000004</id>
<title>Тинькофф Банк</title>
P 2 P M a r k e t С т р а н и ц а 1 3 3 | 1 7 2
/Confidential
<latinTitle>Tinkoff Bank</latinTitle>
</row>
</dataList>
<signature>ZDg2M2NmMWNjNTRlYzI0MzNjZWJiZWY2NWNlNDg4MGE=</signature>
</GetSBPBankList>
Сервис webapi/b2puser/GetDefaultSBPBank
Используйте сервис webapi/b2puser/GetDefaultSBPBank для получения дефолтного банка Получателя
перевода СБП. Запрос выполняется в режиме обмена данными «сервер-сервер» (без перенаправления
Плательщика на Платёжные страницы ПЦ).
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 64. Параметры запроса webapi/b2puser/GetDefaultSBPBank
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
phone Строка (20) Номер мобильного телефона Получателя. 79191013456
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, client_ref, phone, password в
указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/GetDefaultSBPBank
ИС ТСП отправляет Запрос webapi/b2puser/GetDefaultSBPBank в ПЦ методом HTTP POST. Запрос
выполняется в режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/GetDefaultSBPBank HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 109
Content-Type: application/x-www-form-urlencoded
signature=MDNiOTllY2FlOGM3MTlkODM1MDczMmU2ZTMzZWVlYmE=&sector=3905&client_ref=clien
tRefTest&phone=79191013456
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса;
Если ошибок нет, ПЦ отправляет xml-сообщение следующего вида:
<GetDefaultSBPBank>
<bankId>100000000001</bankId>
<title>Газпромбанк</title>
<latinTitle>Gazprombank</latinTitle>
<signature>ZDg2M2NmMWNjNTRlYzI0MzNjZWJiZWY2NWNlNDg4MGE=</signature>
</GetDefaultSBPBank>
P 2 P M a r k e t С т р а н и ц а 1 3 4 | 1 7 2
/Confidential
Сервис webapi/p2pmarket/PayInSBPMe2MePull
Используйте Запрос. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на
Платёжные страницы не используется.
Предупреждение: сервис предоставляется ТСП после согласования с Оператором.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 65. Параметры Запроса webapi/p2pmarket/PayInSBPMe2MePull
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
to_client_ref Строка (255) Идентификатор пользователя Площадки, которому
переводятся средства.
1234
bank_id Строка (12)
Уникальный идентификатор стороннего банка, со
счёта которого пополняется баланс виртуального
кошелька через СБП.
signature Строка (100)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, amount, currency,
to
client
ref, bank
_
_
_
id, password в указанном порядке,
см. Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей — копейки.
Если указан id, значение amount берётся из заказа.
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD). Если указан id, значение currency
берётся из заказа.
description Строка
(1000)
Описание перевода. Если в запросе указан параметр
id, значение параметра description из запроса
игнорируется.
Обязателен, если не указан параметр id.
description
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
reference Строка (100)
Номер Заказа на стороне ИС ТСП. Если не указан,
значение формируется автоматически на стороне ПЦ.
Если в запросе указан параметр id, значение
параметра reference из запроса игнорируется.
12345ABC
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/p2pmarket/PayInSBPMe2MePull
ИС ТСП отправляет Запрос webapi/p2pmarket/PayInSBPMe2MePull в ПЦ методом HTTP POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST webapi/p2pmarket/PayInSBPMe2MePull HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 167
Content-Type: application/x-www-form-urlencoded
P 2 P M a r k e t С т р а н и ц а 1 3 5 | 1 7 2
/Confidential
sector=7940&to_client_ref=me2me1&bank_id=1crt88888881&amount=1030&currency=643&de
scription=test&reference=123456&signature=ZGY1NmFhZjdjZjk1ZmRiNDY5OTA1MDMyNGEwYTA
wZjg=
После обработки Запроса webapi/p2pmarket/PayInSBPMe2MePull, ПЦ может прислать один из вариантов
ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<operation>
<order_id>11237449</order_id>
<order_state>REGISTERED</order_state>
<reference>123456</reference>
<id>3808790</id>
<date>2025.08.26 11:07:48</date>
<type>ME2METRANSFER</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>1000</amount>
<fee>0</fee>
<currency>643</currency>
<sector_id>7940</sector_id>
<client_ref>me2me1</client_ref>
<signature>NjUzMmIxZmNhNDAzMGMyZDQ2YzYwM2I2NzNmZmU3MjA=</signature>
</operation>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис webapi/b2puser/PayOutSBPPrecheck
Используйте сервис webapi/b2puser/PayOutSBPPrecheck чтобы запросить данные от СБП для
подтверждения Отправителем личности Получателя. Данный метод реализует первый этап операции
вывода с виртуальной карты на счет через СБП по номеру телефона.
Для выполнения данной операции пользователь Площадки должен быть идентифицирован по документам
и иметь привязанный телефон (параметр active=5).
Запрос выполняется в режиме обмена данными «сервер-сервер» (без перенаправления Плательщика на
Платёжные страницы ПЦ).
Предупреждение: сервис предоставляется ТСП после согласования с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 66. Параметры запроса webapi/b2puser/PayOutSBPPrecheck
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
client_ref Строка (255) Идентификатор пользователя Площадки. 67812321
phone Строка (20) Номер телефона Получателя. 79191013456
bank_id Строка (12) Уникальный идентификатор банка Получателя.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, id, client_ref, phone, bank_id, amount,
fee, currency, password в указанном порядке, см.
Приложение №2.
P 2 P M a r k e t С т р а н и ц а 1 3 6 | 1 7 2
/Confidential
Условно-обязательные параметры
amount Целое (12)
Сумма операции в минимальных единицах валюты.
Для рублей — копейки. Если в запросе указан
параметр id, значение параметра amount из запроса
игнорируется.
Обязателен, если не указан параметр id.
1000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD). Если в запросе указан параметр id,
значение параметра currency из запроса игнорируется.
Обязателен, если не указан параметр id.
643
description Строка
(1000)
Описание перевода. Если в запросе указан параметр
id, значение параметра description из запроса
игнорируется.
Обязателен, если не указан параметр id.
Необязательные параметры
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ,
полученный по результатам запроса webapi/Register.
2231412
reference Строка (100)
Номер перевода на стороне Площадки. Если не указан,
значение формируется автоматически на стороне ПЦ.
Если в запросе указан параметр id, значение
параметра reference из запроса игнорируется.
12345ABC
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/PayOutSBPPrecheck
ИС ТСП отправляет Запрос webapi/b2puser/PayOutSBPPrecheck в ПЦ методом HTTP POST. Запрос
выполняется в режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/PayOutSBPPrecheck HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 162
Content-Type: application/x-www-form-urlencoded
signature=ODExM2Q0ZGEzYjJjODg4NDViY2Q0NGIxZmYzMmJlY2U=&sector=502&bank_id=1crt88888
881&phone=70005310033&id=457829&client_ref=4ea714b4-116e-4396-b3bc-92d6d8c6ffb5
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса;
• Существование действующего пользователя Площадки с указанным client_ref и состояние
идентификации пользователя. Если пользователь не найден, неактивен или имеет некорректный
статус идентификации (параметр active не равен 5), ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ отправляет xml-сообщение следующего вида:
<PayOutSBPPrecheck>
<order_id>123456</order_id>
<precheck_id>123456</precheck_id>
<pam>Петр Петрович Пупкин</pam>
<signature>ZDg2M2NmMWNjNTRlYzI0MzNjZWJiZWY2NWNlNDg4MGE=</signature>
</PayOutSBPPrecheck>
P 2 P M a r k e t С т р а н и ц а 1 3 7 | 1 7 2
/Confidential
Сервис webapi/b2puser/PayOutSBP
Используйте сервис webapi/b2puser/PayOutSBP для подтверждения перевода. Данный метод реализует
второй этап операции вывода с виртуальной карты на счет через СБП по номеру телефона.
Для пользования сервисом пользователь Площадки должен быть идентифицирован по документам и иметь
привязанный телефон (параметр active=5).
Запрос выполняется в режиме обмена данными «сервер-сервер» (без перенаправления Плательщика на
Платёжные страницы ПЦ).
Предупреждение: сервис предоставляется ТСП после согласования с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 67. Параметры запроса webapi/b2puser/PayOutSBP
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор заказа, по которому
проводится операция. Содержится в ответе сервиса
webapi/b2puser/PayOutSBPPrecheck.
2231412
precheck_id Целое (12)
Значение параметра precheck_id, полученное в
результате предшествующего вызова сервиса
webapi/b2puser/PayOutSBPPrecheck.
123456
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector,
id, precheck_id, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/PayOutSBP
ИС ТСП отправляет Запрос webapi/b2puser/PayOutSBP в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/PayOutSBP HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 96
Content-Type: application/x-www-form-urlencoded
signature=N2VlZjc2NjVmN2QzNjg5YzcwM2ZlYWI5YzNkZWU1YmY=&sector=502&id=457829&prechec
k_id=32771499
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Существование активной записи precheck_id для данного заказа. Если запись не найдена, ПЦ
возвращает ошибку выполнения запроса;
• Состояние идентификации и действительность пользователя Площадки. Если пользователь не
активен, либо имеет некорректный статус идентификации (параметр active не равен 5), ПЦ
возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ создаёт операцию.
P 2 P M a r k e t С т р а н и ц а 1 3 8 | 1 7 2
/Confidential
После обработки Запроса webapi/b2puser/PayOutSBP, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
<order_id>490694</order_id>
<order_state>COMPLETED</order_state>
<reference>618649ab-617b-43f3-b052-09f29bef633e</reference>
<id>463128</id>
<date>2024.09.23 10:55:54</date>
<type>PAYOUT_SBP</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<pan>220441******2868</pan>
<amount>2000</amount>
<currency>643</currency>
<approval_code>344230</approval_code>
<sector_id>2494</sector_id>
<phone>70000000000</phone>
<expdate>09/2029</expdate>
<ps>11</ps>
<ofd_state/>
<pan_sha256>a5ace24bb2ce883643d60e0c09bdfce5c312e1ece0c843651a81707cb1b54
877</pan_sha256>
<edsAccount>40914810310010000047</edsAccount>
<trxId>B4267075541575010000120011340901</trxId>
<signature>MjA1ZjU2ODgwZGEwMGRjNjM3ZjU5NzBmMDdkMWVlZjY=</signature>
</operation>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
На адрес url-уведомлений, указанный в ЛК Площадки, ПЦ отправляет xml-сообщение c параметрами
совершенной операции. Вид и состав уведомления аналогичен виду и составу уведомления о проведенной
операции, указанному в основной инструкции по интеграции.
P 2 P M a r k e t С т р а н и ц а 1 3 9 | 1 7 2
/Confidential
Сервис webapi/GetSBPSubscription
Используйте Запрос webapi/GetSBPSubscription для регистрации функциональный СБП-ссылки для
привязки счёта плательщика к счёту ТСП без совершения оплаты. Запрос выполняется в режиме обмена
данными «сервер-сервер», редирект на Платёжные страницы не используется.
Для осуществления привязки, Плательщик переходит по ссылке из поля payload ответа
webapi/GetSBPSubscription и даёт согласие на привязку своего счета к счету ТСП. Статус привязки придет в
колбэке об изменении статуса СБП-привязки.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 68. Параметры Запроса webapi/GetSBPSubscription
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
description Строка (140)
Назначение привязки счета. Данная информация будет
отображаться на экране Плательщика при оформлении
привязки счета в приложении Банка Плательщика.
Рекомендуется предоставлять максимально
подробную информацию о привязке счета, включая,
если применимо, регулярность платежей, сумму
регулярных платежей и пр.
Предупреждение: запрещается передавать в
description переносы строки и специальные символы.
Привязка
счета для
оплат в
пользу АО
Кофеек,
регулярность
раз в месяц,
сумма 100
рублей
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, description, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
Ссылка для автоматического возврата Плательщика из
приложения Банка в приложение или на сайт ТСП.
url Строка (500)
Предупреждение: допускаются только символы в
кодировке ASCII. Формат должен соответствовать
спецификации RFC-3986.
life_period Целое (6)
Срок жизни ссылки в минутах. Если параметр не
определён, то время жизни ссылки составит 4320
минут (3 дня).
60
get_qr_img Целое (1)
Получение изображения QR-кода. Возможные
значения: 0, 1.
0 (по умолчанию) — не генерировать QR код;
1 — сгенерировать QR код (в ответе придет base64 -
значение сгенерированной картинки QR кода,
содержащего в себе адрес короткой ссылки).
1
P 2 P M a r k e t С т р а н и ц а 1 4 0 | 1 7 2
/Confidential
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/GetSBPSubscription
ИС ТСП отправляет Запрос webapi/GetSBPSubscription в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/GetSBPSubscription HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 244
Content-Type: application/x-www-form-urlencoded
signature=OTA5NTJkNGMzMzAyYzczZTNkNWE1YWQwZDA4NzZlNDc=&sector=1869&description=Пр
ивязка счета для оплат в пользу АО Кофеек, регулярность раз в месяц, сумма 100
рублей&url=https://helpline.paygine.com/issues/355783&life_period=2500&get_qr_img
=0
После обработки Запроса webapi/GetSBPSubscription, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с СБП-ссылкой;
<?xml version="1.0" encoding="UTF-8"?>
<GetSBPSubscription>
<id>9652</id>
<date>2024.03.21 16:43:05</date>
<state>CREATED</state>
<message>Запрос обработан успешно</message>
<description>Привязка счета для оплат в пользу АО Кофеек, регулярность
раз в месяц, сумма 100 рублей</description>
<qrcId>BB1S002MRVDB143A8MTR97H5TNHHAOVT</qrcId>
<payload>https://sub.nspk.ru/BB1S002MRVDB143A8MTR97H5TNHHAOVT?type=03&ba
nk=100000000123&crc=4640</payload>
<subscription_state>NOT_SET</subscription_state>
<token>SBPcbd67-dd2d-4a42-adc8-67436c7b0654</token>
<member_id>1crt88888881</member_id>
</GetSBPSubscription>
Предупреждение: получение СБП-токена в синхронном ответе доступно только по
согласованию с Оператором.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис test/SBPTestCase
Используйте Запрос test/SBPTestCase для проведения операций и тестовых кейсов по qrc_id. Запрос
выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
Предупреждение: данный сервис доступен только для запуска на тестовом стенде.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
P 2 P M a r k e t С т р а н и ц а 1 4 1 | 1 7 2
/Confidential
Таблица 69. Параметры Запроса test/SBPTestCase
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
case_id Строка (3)
Номер тест-кейса для запуска. Возможные варианты:
150 – Успешная оплата по QR-коду;
151 – Неуспешная оплата по QR-коду;
158 – Успешная оплата по QR-коду c осуществлением
привязки;
1581 – Успешная оплата по QR-коду с отказом в проведении
привязки;
154 – Успешное оформление привязки счёта;
155 – Неуспешное оформление привязки счёта;
301 – Успешный платеж QR Static (при amount= 1000301);
221 – Уведомление об успешном статусе Операции СБП (QR
Dynamic);
222 – Уведомление о неуспешном статусе Операции СБП
(QR Dynamic);
223 – Уведомление об успешном статусе Операции СБП при
задержке статуса операции (QR Static);
232 – Успешная оплата по Кассовой ссылке СБП;
233 – Неуспешная оплата по Кассовой ссылке СБП.
150
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, case_id, qrc_id, order_id, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры (один из них должен быть в запросе)
qrc_id Строка (32) Идентификатор зарегистрированной Функциональной
ссылки СБП.
order_id Целое (19) Номер заказа, который использовался для регистрации QR-
Dynamic.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса test/SBPTestCase
ИС ТСП отправляет Запрос test/SBPTestCase в ПЦ методом HTTP GET или POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /test/SBPTestCase HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 117
Content-Type: application/x-www-form-urlencoded
signature=MzJkMGZmYmM4NjUxYmIyMTg1MjZmMTkyM2ZmMTFjOWU=&sector=893&case_id=150&qrc
_id=AS1R000KOMEPGAIE9519CB1Q4PGN6ULN
После обработки Запроса test/SBPTestCase, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<?xml version="1.0" encoding="UTF-8"?>
<SBPTestCase>
<qrc_id>AS1R000KOMEPGAIE9519CB1Q4PGN6ULN</qrc_id>
<message>[00150: не запущен] Тестовый сценарий запущен</message>
</SBPTestCase>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 1 4 2 | 1 7 2
/Confidential
Вспомогательные сервисы
Сервис webapi/CardEnroll
Используйте Запрос webapi/CardEnroll для регистрации карты и получения токена. Запрос выполняется с
отображением страниц ПЦ пользователю Площадки.
Таблица 70. Параметры запроса webapi/CardEnroll
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если участвуют в запросе): sector, id, cof_ind,
password в указанном порядке, см. Приложение №2.
Необязательные параметры
cof_ind Строка (4)
Значение, определяющее порядок применения признаков
использования сохраненных реквизитов карты. Возможные
значения:
CC (Credentials Captured)— с сохранением реквизитов карты;
CNC (Credentials Not Captured) — без сохранения реквизитов
карты;
СIT (Consumer-Initiated Transaction) — операция по
сохраненным реквизитам, инициированная плательщиком;
MITR (Merchant-Initiated Transaction Recurring) — операция
типа «подписка» по сохраненным реквизитам, инициированная
ТСП;
MITI (Merchant-Initiated Transaction Installment) — операция
типа «рассрочка» по сохраненным реквизитам,
инициированная ТСП.
CIT
Примечание: действует только для карт МИР.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/CardEnroll
ИС ТСП отправляет Запрос webapi/CardEnroll в ПЦ методом HTTP GET или POST. ПЦ перенаправляет
Плательщика на Платёжную форму для ввода карточных данных.
POST /webapi/CardEnroll HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NjI4ZTk3MzIwOTQ3MTgyYWEwOWQ0NzE3OWM0YTk2Y2M=&sector=1&id=12345
При этом, Плательщику отображается платёжная форма с указанием суммы, установленной ТСП при
регистрации Заказа для данной операции. Это сделано для того, чтобы ТСП мог сам задать случайную
небольшую сумму и потом запросить её у Плательщика для подтверждения того, что карта принадлежит
Плательщику, а не стороннему лицу.
Примечание: мы рекомендуем генерировать случайную сумму в пределах 10 единиц валюты.
По результатам выполнения запроса webapi/CardEnroll формируется операция AUTHORIZE.
После успешной регистрации карты, мы рекомендуем откатить эту операцию с помощью Запроса
webapi/Reverse, чтобы у Плательщика не блокировалась данная сумма на длительный срок.
После выполнения операции, ПЦ перенаправит Плательщика обратно на страницу, указанную ранее при
регистрации Заказа, методом HTTP GET.
P 2 P M a r k e t С т р а н и ц а 1 4 3 | 1 7 2
/Confidential
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ; например,
на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное ИС
ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
Если в процессе обработки произошла какая-либо ошибка, то ПЦ не регистрирует операцию и
перенаправляет Плательщика на url из Заказа следующим запросом:
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&error=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное ИС
ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
Есть два способа узнать результат выполнения Операции и получить токен карты:
1. 2. ТСП самостоятельно запрашивает статус соответствующей Операции с помощью webapi/Operation.
Альтернатива: ТСП использует автоматические xml-уведомления от ПЦ. Они содержат цифровую
подпись, позволяющую проверить подлинность отправителя. Если операция была успешна (статус
APPROVED), то в уведомлении будет указан токен карты.
P 2 P M a r k e t С т р а н и ц а 1 4 4 | 1 7 2
/Confidential
Сервис webapi/СheckToken
Используйте запрос webapi/CheckToken для проверки статуса ранее полученного токена. Запрос
выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные
страницы ПЦ.
Предупреждение: данный сервис доступен только по согласованию с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 71. Параметры запроса webapi/CheckToken
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
token Строка (39) Ранее полученный токен.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, token, password в указанном порядке,
см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/CheckToken
ИС ТСП отправляет Запрос webapi/CheckToken в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/CheckToken HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 111
Content-Type: application/x-www-form-urlencoded
signature=MjgwZWIxODJlNzhhMGNkYTA0NTlmODI4YmVhMTAyNDc=&sector=1869&token=SBPcbd67-
dd2d-4a42-adc8-67436c7b0654
При получении запроса ПЦ проверяет правильность расчета подписи и корректность параметров запроса.
Если есть ошибки — ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ отправляет xml-сообщение следующего вида:
<CheckToken>
<token>SBPcbd67-dd2d-4a42-adc8-67436c7b0654</token>
<type>SBP</type>
<state>ACTIVE</state>
<info>
<member_id>1crt88888881</member_id>
<subscription_state>ACCEPTED</subscription_state>
<qrcId>BB1S00218JREAQ4G83Q8J29MK3M25S5P</qrcId>
<create_date>2025.11.19 14:30:15.139</create_date>
<update_date>2025.11.19 14:31:18.839</update_date>
</info>
</CheckToken>
P 2 P M a r k e t С т р а н и ц а 1 4 5 | 1 7 2
/Confidential
Сервис webapi/Operation
Используйте запрос webapi/Operation для получения информации по операции. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Таблица 72. Параметры запроса webapi/Operation
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
operation Целое (19) Уникальный идентификатор Операции в ПЦ, полученный в
ответ на соответствующий Запрос. 2686
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, operation, password в указанном порядке,
см. Приложение №2.
Необязательные параметры
get_token Целое (1)
Запрос на предоставление токена использованной в Операции
Платёжной карты в составе уведомления на url.
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
В дальнейшем, токен может использоваться для инициирования
операций по карте без ввода ее реквизитов.
1
Предупреждение: возможность получения и использования
токена Карты осуществляется по согласованию с Оператором.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/Operation
ИС ТСП отправляет Запрос webapi/Operation в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/Operation HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 90
Content-Type: application/x-www-form-urlencoded
signature=ZGQ5MzVlYWJlMmZjYjcwNzEwZDc5OGRmZjMyNzc4MjY=&sector=1&id=408206&operation
=366658
Запрос может быть направлен в ПЦ методом HTTP GET или POST.
В ответ на данный Запрос ПЦ присылает сообщение в формате xml (см. Приложение №1, п.2).
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора) или отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и
расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.
Важно: только после получения ответа на такой Запрос или получения оповещения от ПЦ (по
email или методом HTTP POST) ТСП может принимать решение об успешности той или иной
Операции.
P 2 P M a r k e t С т р а н и ц а 1 4 6 | 1 7 2
/Confidential
Сервис webapi/ChangeOrderStatus
Предупреждение: разрешение на использование Запроса предоставляется по согласованию с
Оператором.
Используйте запрос webapi/ChangeOrderStatus для изменения статуса Заказа. Запрос выполняется в
режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
На данный момент возможно движение статусов между значениями REGISTERED и EXPIRED.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 73. Параметры запроса webapi/ChangeOrderStatus
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ, полученный
по результатам Запроса webapi/Register.
12345
order_state Строка (20)
Новое значение статуса Заказа.
Возможные варианты:
REGISTERED — Заказ зарегистрирован в ПЦ и не
содержит успешных Операций;
EXPIRED — Заказ с истекшим сроком действия.
EXPIRED
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, order_state, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
Если параметр mode=1, то при закрытии Заказа
вводится запрет на его оплату через QR-код СБП.
mode Строка (20)
Важно: действует только при закрытии Заказа
1
(параметр order_state=EXPIRED) и наличии в нём
действующего динамического qrcId.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/ChangeOrderStatus
ИС ТСП отправляет Запрос webapi/ChangeOrderStatus в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST webapi/ChangeOrderStatus HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 121
Content-Type: application/x-www-form-urlencoded
signature=ZDc5ZGE5ZjFmOGI1MTU0NWYyYTk3ZGVjNTQ0MDU1OWY=&sector=893&id=463896&order_s
tate=REGISTERED
В ответ на данный Запрос ПЦ присылает сообщение в формате xml (см. Приложение №1, п.1).
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора) или отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и
расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.
P 2 P M a r k e t С т р а н и ц а 1 4 7 | 1 7 2
/Confidential
Запрос webapi/GetOperationConfirmation
Используйте Запрос webapi/GetOperationConfirmation для получения справки в формате pdf с
подтверждением операции. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на
Платёжные страницы не используется.
Предупреждение: разрешение на использование Запроса предоставляется по согласованию с
Оператором. Для получения справок предоставьте Оператору электронный адрес.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 74. Параметры запроса webapi/GetOperationConfirmation
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ.
operation Целое (19) Уникальный идентификатор Операции в ПЦ.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, operation, email, password в указанном
порядке, см. Приложение №2.
Необязательные параметры
date Строка (10) Дата для указания в тексте справки. Формат: ДД.ММ.ГГГГ
По умолчанию, в справке указывается текущая дата. 23.09.2022
email Строка (100) Адрес электронной почты отправителя, на который ему
придёт письмо с PDF-справкой о результате операции.
mail@some
site.com
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/GetOperationConfirmation
ИС ТСП отправляет Запрос webapi/GetOperationConfirmation в ПЦ методом HTTP GET или POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST webapi/GetOperationConfirmation HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 110
Content-Type: application/x-www-form-urlencoded
signature=Njc4ZjQyYmQ1YWQwMjBlNmJlYjkxZDhlZDhhNTNjNTA=&sector=893&id=3338889&operat
ion=1316160&date=03.10.2022
При обработке Запроса ПЦ проверяет, что:
• Операция принадлежит Заказу, указанному в запросе;
• И Операция, и Заказ принадлежат сектору, указанному в запросе.
После обработки Запроса webapi/GetOperationConfirmation, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Справка отправлена на электронный адрес ТСП. Приходит
сообщение в формате xml следующего вида:
<?xml version="1.0" encoding="UTF-8"?>
<GetOperationConfirmation>
<result>OK</result>
</GetOperationConfirmation>
P 2 P M a r k e t С т р а н и ц а 1 4 8 | 1 7 2
/Confidential
Справка имеет следующий вид:
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Сервис /webapi/beneficiaries/Register
Используйте Запрос /webapi/beneficiaries/Register для регистрации выгодоприобретателя номинального
счета в ПЦ. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные
страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
Таблица 75. Параметры Запроса /webapi/beneficiaries/Register
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
inn Строка (12) ИНН выгодоприобретателя, может начинаться
с 0.
67812321
type Целое (1)
Тип выгодоприобретателя. Возможные
значения:
0 — Юридические лица;
1 — Индивидуальные Предприниматели
резиденты РФ;
2 — Индивидуальные Предприниматели
нерезиденты РФ;
3 — Физические Лица резиденты РФ;
4 — Физические Лица нерезиденты РФ.
3
site Строка (255) URL-адрес сайта выгодоприобретателя.
phone Строка (11) Номер телефона выгодоприобретатель в
формате 7XXXXXXXXXX 79773641999
email Строка (255) Электронная почта выгодоприобретателя.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если они использованы в запросе)
параметры sector, inn, type, site, phone, email,
company_
name, first
name, last
name,
_
_
patronymic, birth
_
date, persondoc_
snumber,
persondoc_
number, persondoc_
issdate,
persondoc_
isscode, address, password в
указанном порядке, см. Приложение №2.
P 2 P M a r k e t С т р а н и ц а 1 4 9 | 1 7 2
/Confidential
Условно-обязательные параметры (обязательны для type = 0)
company_name Строка (255) Наименование юридического лица, может
содержать кавычки.
Условно-обязательные параметры (обязательны для type = 1, 2, 3 или 4)
first_name Строка (50) Имя выгодоприобретателя. Иван
patronymic Строка (50) Отчество выгодоприобретателя. Петрович
last_name Строка (50) Фамилия выгодоприобретателя. Иванов
birth_date Строка (10) Дата рождения выгодоприобретателя.
Формат ГГГГ.ММ.ДД 2000.09.12
persondoc_snumber Строка (4) Серия документа, удостоверяющего личность.
persondoc_number Строка (7) Номер документа, удостоверяющего личность,
без серии.
persondoc_issdate Строка (10) Дата выдачи документа, удостоверяющего
личность. Формат ГГГГ.ММ.ДД
persondoc_isscode Строка (10) Код подразделения выдачи документа,
удостоверяющего личность.
address Строка (2000) Адрес регистрации выгодоприобретателя.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса /webapi/beneficiaries/Register
ИС ТСП отправляет Запрос /webapi/beneficiaries/Register в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/beneficiaries/Register HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 175
Content-Type: application/x-www-form-urlencoded
sector=2819&inn=6605927602&type=0&site=https://pillows.ru/&phone=79000000000&emai
l=user@pillows.net&company_name=Pillows&signature=MmU1NzI4YWNlZGU0OTljMGEwOTgzZWI
wNTRjMjkzYWI=
После обработки Запроса /webapi/beneficiaries/Register, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<beneficiary>
<inn>6605927602</inn>
<state>NEW</state>
</beneficiary>
Где возможные значения статуса <state>:
NEW — новый;
ACTIVE — активный, успешно прошел проверку;
CHECK — на проверке;
ERROR — ошибка проверки;
INVALID — не прошел проверку;
DELETЕD — удален.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 1 5 0 | 1 7 2
/Confidential
Сервис /webapi/beneficiaries/Info
Используйте Запрос /webapi/beneficiaries/Info для получения данных выгодоприобретателя номинального
счета. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы
не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
Таблица 76. Параметры Запроса /webapi/beneficiaries/Info
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
inn Строка (12) ИНН выгодоприобретателя, может начинаться с 0. 67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, inn, password в
указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса /webapi/beneficiaries/Info
ИС ТСП отправляет Запрос /webapi/beneficiaries/Info в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/beneficiaries/Info HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 79
Content-Type: application/x-www-form-urlencoded
signature=ZjExZTg5YThlYjNlMTNhZGQ5ZmFhYzQxYWNjYTQ2MWU=&sector=1869&inn=67812321
После обработки Запроса /webapi/beneficiaries/Info, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<beneficiary>
<inn>6605927602</inn>
<state>CHECK</state>
</beneficiary>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 1 5 1 | 1 7 2
/Confidential
Сервис /webapi/beneficiaries/Modify
Используйте Запрос /webapi/beneficiaries/Modify как для изменения реквизитов выгодоприобретателя, так
и для смены его статуса на "удален". Запрос выполняется в режиме обмена данными «сервер-сервер»,
редирект на Платёжные страницы не используется.
Примечание: изменение реквизитов возможно только для выгодоприобретателей в статусе
INVALID. Удаление выгодоприобретателей возможно только в статусе ACTIVE.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
Таблица 77. Параметры Запроса /webapi/beneficiaries/Modify
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
inn Строка (12) ИНН выгодоприобретателя, может начинаться
с 0.
67812321
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют (если они использованы в запросе)
параметры sector, inn, state, site, phone, email,
first
name, last
_
_
name, patronymic, birth
date,
_
persondoc_
snumber, persondoc_
number,
persondoc_
issdate, persondoc_
isscode, address,
password в указанном порядке, см.
Приложение №2.
Условно-обязательные параметры
(в запросе обязательно должен быть либо state, либо хотя бы один любой другой параметр)
state Строка (12) Статус выгодоприобретателя. Возможные
значения: DELETED — удалён.
site Строка (255) URL-адрес сайта выгодоприобретателя.
phone Строка (11) Номер телефона выгодоприобретатель в
формате 7XXXXXXXXXX 79773641999
email Строка (255) Электронная почта выгодоприобретателя.
first_name Строка (50) Имя выгодоприобретателя. Иван
patronymic Строка (50) Отчество выгодоприобретателя. Петрович
last_name Строка (50) Фамилия выгодоприобретателя. Иванов
birth_date Строка (10) Дата рождения выгодоприобретателя.
Формат ГГГГ.ММ.ДД 2000.09.12
persondoc_snumber Строка (4) Серия документа, удостоверяющего личность.
persondoc_number Строка (7) Номер документа, удостоверяющего личность,
без серии.
persondoc_issdate Строка (10) Дата выдачи документа, удостоверяющего
личность. Формат ГГГГ.ММ.ДД
persondoc_isscode Строка (10) Код подразделения выдачи документа,
удостоверяющего личность.
Address Строка (2000) Адрес регистрации выгодоприобретателя.
P 2 P M a r k e t С т р а н и ц а 1 5 2 | 1 7 2
/Confidential
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса /webapi/beneficiaries/Modify
ИС ТСП отправляет Запрос /webapi/beneficiaries/Modify в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/beneficiaries/Modify HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 93
Content-Type: application/x-www-form-urlencoded
signature=ZjExZTg5YThlYjNlMTNhZGQ5ZmFhYzQxYWNjYTQ2MWU=&sector=2819&inn=67812321&s
tate=DELETED
После обработки Запроса /webapi/beneficiaries/Modify, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<beneficiary>
<inn>67812321</inn>
<state>DELETED</state>
</beneficiary>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
P 2 P M a r k e t С т р а н и ц а 1 5 3 | 1 7 2
/Confidential
Приложение №1. Описание форматов xml-сообщений от ПЦ.
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать приложенный файл payments.xsd c
описанием структуры всех сообщений.
1. Формат xml-сообщения, присылаемого на операцию REGISTER
<?xml version="1.0" encoding="UTF-8"?>
<order>
<id>457</id>
<state>REGISTERED</state>
<inprogress>0</inprogress>
<date>2013.03.01 15:52:02</date>
<amount>111</amount>
<currency>643</currency>
<email>mail@somesite.com</email>
<phone>79219999999</phone>
<reference>12345ABC</reference>
<description>notebook</description>
<url>http://www.somesite.com/Accept.jsp</url>
<parameters number="1">
<parameter>
<name>mode</name>
<value>1</value>
</parameter>
</parameters>
<signature>NzA4MjllNTczMTZlMGZjN2RlNGNlMmQ2Njc5ZDJhMjU=</signature>
</order>
Где:
<id> — номер Заказа в ПЦ;
<state> — статус Заказа в ПЦ;
<inprogress> — признак нахождения Заказа в процессе оплаты (0 — в рамках Заказа
нет активных Операций; 1 — в рамках Заказа есть активная Операция);
<date> — дата и время регистрации Заказа в ПЦ;
<parameters number="1"> — тег, содержащий описание значений всех дополнительных
параметров, переданных в Запросе webapi/Register. Атрибут number задает количество
вложенных параметров;
<signature> — цифровая подпись сообщения. В подписи участвуют значения всех тегов
в порядке их следования и пароль для расчета цифровой подписи, предоставляемый ТСП
после его регистрации в ПЦ.
Если Заказ находится в процессе оплаты (inprogress=1), то новые Операции в рамках данного Заказа не
регистрируются во избежание дублированных оплат.
Важно: ТСП должен всегда проверять цифровую подпись для проверки целостности полученных
данных и идентификации отправителя сообщений, см. Приложение №2.
Остальные поля дублируют то, что было в Запросе на регистрацию Заказа. Если какие-то необязательные
поля в Запросе отсутствовали, то в ответном xml будут отсутствовать соответствующие теги.
П р и л о ж е н и е № 1 С т р а н и ц а 1 5 4 | 1 7 2
/Confidential
2. Формат xml-уведомления по результатам выполнения операции, присылаемого ПЦ на
сервер ТСП методом HTTP POST
Примечание: приведенное ниже xml-уведомление может приходить как синхронно — в ответных
сообщениях на Запросы AUTHORIZE, COMPLETE, REVERSE, OPERATION, так и асинхронно – в колбэках.
<?xml version="1.0" encoding="UTF-8"?>
<operation>
<order_id>3504676</order_id>
<order_state>AUTHORIZED</order_state>
<reference>791ce5f6-cab6-4b15-b62c-3264d37af2e3</reference>
<id>1343770</id>
<date>2022.11.21 16:39:21</date>
<type>AUTHORIZE</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>100</amount>
<currency>643</currency>
<approval_code>122004</approval_code>
<sector_id>893</sector_id>
<bin_issuer>JOINT STOCK COMMERCIAL BANK "MOSCOW INDUSTRIAL BANK"</bin_issuer>
<expdate>10/2024</expdate>
<iso>643</iso>
<ps>2</ps>
<rrn>33147812</rrn>
<terminal_id>POS_1</terminal_id>
<ofd_state/>
<client_ref>3a2dc480-659d-4b97-a5ac-bc35b2bcbc6e</client_ref>
<signature>Y2Y0ZjllMGI3NDc0YjhjYTU2Yzk1ZTg1NGMxMmI1MDQ=</signature>
</operation>
Где:
<order_id> — идентификатор Заказа, в рамках которого была операция;
<order_state> — статус Заказа после выполнения Операции;
<reference> — номер Заказа на стороне ТСП в его Системе магазина;
<id> — идентификатор операции в ПЦ;
<date> — дата и время совершения операции в ПЦ;
<type> — тип операции, отправленной в ПЦ;
<state> — результат выполнения операции в ПЦ;
<reason_code> — код ответа на операцию ПЦ, см. п.6 ниже;
<message> — краткое описание кода ответа на операцию ПЦ;
<amount> — сумма операции;
<currency> — валюта операции;
<approval_code> — код авторизации, полученный в Банке на данную операцию;
<sector_id> — идентификатор сектора в ПЦ, в рамках которого была операция;
<bin_issuer> идентификационный номер банка-Эмитента;
<expdate> — срок действия банковской карты Плательщика;
<iso> — код валюты по ISO4217;
<ps> — платежная система;
<rrn> — RRN банковской транзакции;
<terminal_id> — идентификатор банковского терминала;
<ofd_state> — статус обработки платежа онлайн-кассой;
<client_ref> — идентификатор пользователя Площадки;
<signature> — цифровая подпись сообщения. В подписи участвуют значения всех тегов
в порядке их следования и пароль для расчёта цифровой подписи, предоставляемый ТСП
после его регистрации в ПЦ.
Важно: ТСП должен всегда проверять цифровую подпись для проверки целостности полученных
данных и идентификации отправителя сообщений, см. Приложение №2.
Некоторых теги, такие как: <sector_id>, <bin_issuer>, <expdate>, <iso>, <ps>, <rrn>,
<terminal_id>, <ofd_status>, <client_ref>, операции.
П р и л о ж е н и е № 1 могут отсутствовать в зависимости от типа и статуса
С т р а н и ц а 1 5 5 | 1 7 2
/Confidential
Дополнительные теги, которые могут быть добавлены в ответ вида <operation> (по согласованию с
Оператором):
Запрос / операция Тег Описание
Запросы
<to_client_ref> b2puser/PayInDebit2,
Идентификатор пользователя Площадки,
которому переводятся средства.
b2puser/PayOut2 и
<from_client_ref> b2puser/Transfer
Идентификатор пользователя Площадки,
который переводит средства.
Запросы b2puser/PayOut2,
b2puser/Transfer,
<fee>
b2puser/TransferDebit и
Комиссия за осуществления перевода в
минимальных единицах валюты. Для рублей —
копейки.
b2puser/CreditUser
Запросы SDReverse,
SDComplete,
b2puser/PayOut2,
<pan> Маскированный номер карты отправителя
средств.
b2puser/Transfer,
b2puser/TransferDebit
Запросы
b2puser/Complete,
<pan2> b2puser/PayOut2 и
Маскированный номер карты получателя
средств.
b2puser/Transfer
Запрос webapi/Operation <token> Токен карты (если в запросе передан
get_token=1).
Запросы
<payerId> Идентификатор плательщика от НСПК.
webapi/Operation,
<sbp_phone> webapi/Reverse и
Телефон, к которому привязан счет СБП куда
вернутся средства.
SDReverse при оплате
<sbp_bank_id> Уникальный идентификатор банка.
через СБП
<sbp_bank_name> Наименование банка, куда вернутся средства.
П р и л о ж е н и е № 1 С т р а н и ц а 1 5 6 | 1 7 2
/Confidential
3. Формат xml-сообщения, присылаемого в ответ на запрос webapi/b2puser/Statement
<?xml version="1.0" encoding="UTF-8"?>
<Statement>
<StatementRow>
<tran_id>5905905555</tran_id>
<date>2021-10-04T07:20:53</date>
<type>112</type>
<transaction_type>200</transaction_type>
<terminal>E003399</terminal>
<terminal_location>UL UNIVERSITETSKAYA NABER</terminal_location>
<term_retailer_name>050136</term_retailer_name>
<term_sic>8040</term_sic>
<term_sic_name>Scooters and Bikes</term_sic_name>
<term_country_name>Russia</term_country_name>
<term_city>CHELYABINSK</term_city>
<term_owner>example.com</term_owner>
<invoice_num>432008283</invoice_num>
<avail_balance_before>0</avail_balance_before>
<avail_balance>0</avail_balance>
<fee>0</fee>
<amount>78100</amount>
<currency>643</currency>
<approval_code>728016</approval_code>
</StatementRow>
</Statement>
Где:
<tran_id> — идентификатор транзакции на хосте авторизатора;
<date> — дата транзакции;
<type> — код транзакции. Возможные значения:
110 — purchase (оплата);
111 — pre-purchase (холдирование/заморозка средств);
112 — pre-purchase complete (завершение оплаты);
114 — merchandise return (возврат товара);
116 — card verification (проверка карты);
125 — purchase cancellation (отмена);
130 — quasi-cash (покупка квази-наличных: чеков, фишек и пр.);
132 — POS P2P Debit (дебетовая часть перевода с карты на карту);
133 — POS P2P Credit (кредитовая часть перевода с карты на карту).
<transaction_type> — тип транзакции. Возможные значения:
100 — AuthRequest (авторизационная транзакция);
120 — AuthAdvice (авторизационное извещение);
200 — Request (финансовая транзакция);
220 — Advice (финансовое извещение);
420 — Reversal (отмена транзакции AuthRequest/AuthAdvice/Request/Advice).
<terminal> — идентификатор терминала, через который проведена транзакция;
<terminal_location> — адрес регистрации терминала;
<term_retailer_name> — имя ритейлера, владельца терминала;
<term_sic> — MCC ритейлера (код категории мерчанта);
<term_sic_name> — значение МСС;
<term_country_name> — страна нахождения терминала;
<term_city> — город нахождения терминала;
<term_owner> — банк-Эмитент терминала;
<invoice_num> — номер счета;
<avail_balance_before> — доступный баланс до проведения транзакции;
<avail_balance> — текущий баланс;
<fee> — комиссия операции;
<amount> — сумма транзакции в копейках;
<currency> — валюта транзакции;
<approval_code> — код авторизации.
П р и л о ж е н и е № 1 С т р а н и ц а 1 5 7 | 1 7 2
/Confidential
4. Формат xml-сообщения об ошибке
<?xml version="1.0" encoding="UTF-8"?>
<error>
<description>Sector not found </description>
<code>105</code>
</error>
Где:
<description> — текстовое сообщение об ошибке;
<code> — код ошибки.
Возможные варианты ошибок приведены в таблице ниже.
Таблица 78. Возможные варианты ошибок
Сообщение на русском Сообщение на английском Код
Неправильный ID операции Incorrect Operation ID 100
Неправильный ID заказа Incorrect Order ID 101
Неправильный ID сектора Incorrect Sector ID 102
Операция не найдена Operation not found 103
Заказ не найден Order not found 104
Сектор не найден Sector not found 105
Операция не принадлежит Заказу Operation does not belong to specified
Order 106
Операция не принадлежит сектору Operation does not belong to specified
Sector 107
Заказ не принадлежит Сектору Order does not belong to specified Sector 108
Неверная цифровая подпись Invalid signature 109
Отсутствует параметр ‘reference’ Missing reference 110
Отсутствует параметр 'amount' Missing amount 111
Отсутствует параметр 'currency' Missing currency 112
Валюта отличается от валюты Сектора Currency does not match Sector's currency 113
Отсутствует электронная почта Missing email 114
Неверная электронная почта Invalid email 115
Отсутствует телефон Missing phone 116
Неверный формат телефона Invalid phone 117
Заказ не зарегистрирован в базе данных ПЦ Order not registered in DB 118
ТСП не активирован в ПЦ Sector is not active 121
Длина параметра ‘description’ превышает
заданное ограничение Description is too long 122
Длина параметра 'email' превышает заданное
ограничение Email is too long 123
Длина параметра 'phone' превышает заданное
ограничение Phone is too long 124
Длина параметра 'URL' превышает заданное
ограничение URL is too long 125
Заказ уже находится в процессе оплаты Order is in progress 126
Плательщик отказался от совершения операции Canceled by Customer 127
Неправильная сумма операции Invalid amount 128
Валюта отличается от валюты Заказа Currency does not match Order's currency 129
Внутренняя ошибка Internal error 130
Заказ не авторизован Order not authorized 131
Оригинальная операция не найдена Original operation not found 132
Неправильный статус Заказа для указанной
Операции
Incorrect Order state for specified
Operation 133
П р и л о ж е н и е № 1 С т р а н и ц а 1 5 8 | 1 7 2
Сумма Операции превышает сумму
оригинальной Операции
Сумма Возврата не равна сумме оригинальной
Операции
Неправильный код валюты Длина параметра 'reference' превышает
заданное ограничение Неверное значение параметра 'mode' Неверное значение параметра Отсутствует параметр 'cvc/cvv2' Неверное значение параметра 'name' Неверное значение параметра 'pan' Неверное значение параметра 'month' Неверное значение параметра 'year' ТСП не поддерживает операцию Authorize Крипто модуль неактивен ТСП не поддерживает регулярные платежи ТСП не поддерживает работу в режиме Gate ТСП не поддерживает работу с токеном карты ТСП не поддерживает операцию P2P ТСП не поддерживает операцию Reverse Токен 3DS не существует. ТСП не поддерживает операцию PayForm Некорректный IP сервера Неверно задан период Неверно введена капча Неверно рассчитана комиссия Карта не соответствует выбранной платёжной
системе Неверный идентификатор кэша Токен не был создан ТСП не поддерживает операцию Card reg Запрет операции по ссылке для данного сектора Отключены cookies, для продолжения включите
cookies или воспользуйтесь другим браузером
Не получается найти реквизиты для зачисления Карта отправителя совпадает с картой
получателя ТСП не поддерживает операцию P2P credit Торговец не поддерживает операцию Оригинальная операция не валидна Превышено время, отведенное на проведение
операции Достигнут лимит попыток совершения операции Ошибка token2 Количество вендор-полей не равно одному Платеж не найден Невозможно привязать номер телефона к
пользователю B2P Неправильный пароль Телефон не уникален для сектора Пользователь не найден Превышено количество попыток выполнения
операции П р и л о ж е н и е № 1 /Confidential
Operation amount exceeds the original
transaction amount 134
Reverse amount exceeds the original
transaction amount 135
Invalid currency 136
Reference is too long 137
Invalid mode 138
Invalid parameter 139
Missing cvc/cvv2 140
Invalid name 141
Invalid pan 142
Invalid month 143
Invalid year 144
Sector does not support Authorize 145
Crypto module not active 146
Sector does not support Recurring 147
Sector does not support Gate 148
Sector does not support card token 149
Sector does not support P2P 150
Sector does not support Reverse 151
3DS token does not exist 152
Sector does not support PayForm 153
Incorrect remote IP 154
Invalid period 155
Wrong captcha 156
Invalid fee 157
Invalid payment system 158
Invalid cache ID 159
The token has not been created 160
Sector does not support Card reg 161
Refuse direct link for sector 162
Disable cookies, to continue to enable
cookies, or use a different browser 163
Cannot find details for enrollment 164
The sender's card equals the receiver's card 165
Sector does not support P2P credit 166
Sector does not support operation 167
Original operation is not valid 168
Time for completing operation has expired 169
Attempts limit for executing transaction
has been reached 170
Invalid token2 171
Number of vendor fields is not equal to one 172
Bill not found 173
Cannot bind phone number to B2P user 174
Incorrect password 175
Phone not unique for sector 176
User not found 177
Operation retry limit is exceeded 178
С т р а н и ц а 1 5 9 | 1 7 2
Был введен неправильный код СМС Не найдено ни одной отправленной СМС с
кодом
Превышено количество попыток ввода СМС-
кода. Попробуйте выполнить привязку телефона
заново
Достигнут лимит переотправки СМС Достигнут лимит регистрации телефона Ошибка протокола Fimi Пользователь B2P не активен Карта сектора не привязана Операция запрещена для сектора Карта для вывода средств не привязана Карта для вывода средств не совпадает с
привязанной картой Не удается зарегистрировать карту Неверная длина элемента в параметре
fiscal_positions
Общая сумма элементов fiscal_positions не
совпадает с суммой заказа
Некорректный формат параметра в элементе
fiscal_positions
Ошибка идентификации пользователя Ошибка ограничения уникальности 3DS 2.0 Ошибка аутентификации Некорректное состояние пользователя B2P Превышен лимит ввода пароля Достигнут лимит ввода СМС-кода Запрещено для текущего статуса рекуррента Запрещено для текущей периодичности
рекуррента Данные кредитной карты, привязанной к
сектору, не найдены PAN не привязан к сектору Данные кредитной карты сектора не найдены Неправильный pan или token Банк не найден Банк не активирован в Процессинговом центре Неправильный ID Банка Банк не поддерживает операции через gate Некорректный ID персоны Банк не поддерживает операцию Нет ключа для расшифровки У пользователя B2P не существует кошелька Не задан MerchantID для мобильных платежей Дублированные фискальные позиции Некорректный формат фискальных данных Не переданы фискальные данные для операции
с частичной суммой
Неизвестный БИК Некорректный номер расчетного счета Некорректные данные мультиплатежей Заказ не регулярный Параметр count вне допустимого диапазона П р и л о ж е н и е № 1 /Confidential
Incorrect SMS code was entered 179
Incorrect SMS code was entered 180
SMS-code enter attempts is exceeded.
Please, try to bind phone again 181
SMS reattempt limit reached 182
Phone registration limit reached 183
Fimi protocol error 184
B2P user not active 185
Sector card is not binded 186
Operation is forbidden for sector 187
Receive card is not linked 188
Receive card doesn't match the linked card 189
Cannot register card 190
Invalid length of element in fiscal_positions
parameter
191
Total amount of fiscal_positions elements
doesn't match order amount 192
Invalid parameter format of fiscal_positions
element 193
User identification error 194
Unique constraint error 195
3DS 2.0 Authentication failed 196
Incorrect B2P user state 197
Password input overflow reached 198
SMS code input limit reached 199
Forbidden recurring state 200
Forbidden recurring frequency 201
Sector credit card not found 202
Sector credit pan not binded 203
Sector credit card data not found 204
Invalid pan or token 205
Bank not found 206
Bank not active 207
Incorrect bank ID 208
Bank do not support gate 209
Invalid person ID 210
Bank doesn't not support operation 211
No key for decryption 212
B2P User Has No Wallet 213
No MerchantID for mobile payment 214
Duplicated fiscal positions 215
Invalid fiscal data format 216
No fiscal data provided for the operation
with partial amount 217
Unknown bank identification code 218
Incorrect checking account number 219
Incorrect multipayment data 225
Order is not recurring 226
Parameter count out of range 227
С т р а н и ц а 1 6 0 | 1 7 2
Потеряна операция SafeDepositDebit Потерянная транзакция Потерян результат гейта Не выбран гейт Token или clientRef не указаны Некорректный тип ответа Предотвращение излишних возвратов. В заказе
есть reverse со статусом timeout
Неправильный clientRefStock Ошибка валидации Потеряна операция SDPayInDebit Пользователь B2P заблокирован Превышено количество запросов в минуту / час Операция оспаривается плательщиком Некорректная настройка сектора для
запрашиваемого действия
Не удалось зарегистрировать отправителя в СБП Не удалось получить данные получателя из СБП Ошибка сочетания параметров запроса Недостаточно средств на балансе sdRef Невозможно поменять статус. Срок действия
заказа истёк Предотвращение излишних операций Команда не поддерживается Неизвестная команда Мерчант аккаунт не зарегистрирован Некорректный мерчант аккаунт Мерчант аккаунт не верифицирован Сектор не поддерживает telegram платежи Пользователь не является владельцем бота Уже существует аккаунт с незавершенной
верификацией Мерчант аккаунт уже зарегистрирован Невозможно разобрать сообщение Несовпадение версий ФФД sd_ref не найден Неверный код валюты гейта Отсутствует сумма в валюте гейта Отсутствует комиссия в валюте гейта Отсутствуют курсы валют Отсутствуют источники курсов валют Валюты сектора не найдены precheck_id не найден Системная настройка не определена Неподдерживаемая операция канала Карточный продукт для страны не найден Ассоциация не определена Ассоциация не разрешена Не удалось получить информацию о карте Неизвестная валюта П р и л о ж е н и е № 1 /Confidential
Missing operation SafeDepositDebit 228
Missing transaction 229
Missing gate result 230
No gate selected 231
Missing token or clientRef 232
Incorrect response type 233
Excessive refunding prevention. There is
timeouted reverse in the order 234
Incorrect clientRefStock 235
Validation error 236
SDPayInDebit operation lost 237
B2P user is blocked 238
Exceeded requests count per minute / hour 239
The operation is disputed by the payer 240
Sector setting is not set properly for the
action requested 241
Couldn't enroll sender to SBP 242
Couldn't get information about receiver
from SBP 243
Invalid combination of request parameters 244
Not enough money on sdRef balance 245
Unable to change status. Order has expired 246
Excessive operations prevention
247,
248,
249
Unsupported command 250
Unknown command 251
Merchant account is not registered 252
Incorrect merchant account 253
Merchant account is not verified 254
Sector does not support telegram payments 255
Current user is not bot owner 256
Merchant already has unverified account 257
Merchant account has already been
registered 258
Invalid answer parse 259
FFD version mismatch 260
sd_ref not found 261
Invalid gate currency code 262
Missing amount in gate currency 263
Missing fee in gate currency 264
Missing currency rates 265
Missing currency rates sources 266
Sector currencies not found 267
precheck_id not found 268
System setting undefined 269
Channel unsupported operation 270
Country product not found 271
Association undefined 272
Association not allowed 273
Failed get card info 274
Unknown currency 275
С т р а н и ц а 1 6 1 | 1 7 2
Курс покупки не найден Курс продажи не найден ФИО не определены Возврат запрещен для операций Невозможно использовать эту карту Хост отклонил запрос по причине неверных
параметров Запрос неавторизован Запрашиваемый ресурс не найден Ошибка выполнения операции на стороне
банка-эквайра Банк-эквайер недоступен Неверное значение параметра 'address' Сервис недоступен для подписчика Достигнут лимит гейта Precheck_id не найден Неверное значение параметра vendor_service Недостаточно параметров для vendor_service Buyid уже используется Достигнут лимит сектора Недостаточный баланс bankacct Ошибка взаимодействия с внешними сервисами Возврат запрещен для АФТ операций Terminal set не установлен Некорректная пара: токен и оригинатор Неверный токен Ошибка 3DS2 Challenge Внешняя система ответила ошибкой Ошибка 3DS2 аутентификации Ошибка взаимодействия с внешней системой sd_ref / originator_id заблокирован Ошибка проверки хоста Сбп Legal_id не совпадают Некорректная короткая ссылка Срок действия короткой ссылки истёк client_ref заблокирован Отсутствует разрешение Qr capabilities Некорректные настройки миграции Неправильный sd_ref stock Превышен дневной лимит использования.
Попробуйте позже
Платежная система недоступна Ошибка авторизации. Пожалуйста, повторите
попытку позже Фискальные данные содержат нулевое
количество Достигнут лимит по SDPayIn Достигнут лимит по SDPayOut Достигнут лимит по SDBalance Не выбран процессор Не выбран продукт Внутренняя ошибка канала Внутренняя ошибка заказа П р и л о ж е н и е № 1 /Confidential
Buy rate not found 276
Sell rate not found 277
FIO undefined 278
Reverse forbidden for operations 279
Can not use this card 280
Bank Acquiring Invalid Parameters 281
Bank acquiring request forbidden 282
Bank acquiring resource not found 283
Bank acquiring internal error 284
Bank acquiring not available 285
Invalid address 286
Service Unavailable For Subscriber 287
Gate limit reached 288
Precheck_id not found 289
Incorrect vendor_service parameter value 290
Not enough parameters for vendor_service 291
Buyid is already in use 292
Sector limit reached 293
Invalid bankacct balance 294
Error while interacting with external
service 295
Reverse forbidden for AFT operations 296
TerminalSetNotFound 297
incorrect token and originator pair 298
invalid token 299
3DS2 Challenge error 300
External system responded with error 301
3DS2 authentication error 302
Error communicating with external system 303
sd_ref / originator_id is blocked / locked 304
Host validation error 305
Sbp Legal_id mismatch 306
Invalid short URL 307
Short URL expired 308
client_ref is blocked 309
Sbp Qr capabilities no permission 310
Invalid migration settings 311
Incorrect sd_ref stock 312
SBP Subscription usage day-limit exceeded.
Please try again later 313
Processing payment system unavailable 314
Authorization error. Please, try again later 315
Fiscal data contains zero quantity 316
SDPayIn limit reached 317
SDPayOut limit reached 318
SDBalance limit reached 319
No processor selected 320
No product selected 321
Internal channel error 322
Internal order error 323
С т р а н и ц а 1 6 2 | 1 7 2
/Confidential
Неуспешная проверка Precheck is not OK 324
Ошибка: precheck_id не соответствует id заказа Error: precheck_id not match order id 325
Отсутствует обязательный параметр Missing required parameter 326
QRC не найден QRC not found 327
Доступ запрещен Access denied 328
Недостаточно средств Insufficient funds 329
Достигнут лимит перевыпуска карты Client cards reissue limit reached 330
Достигнут лимит гейта Gate limit reached 331
Сектор назначения некорректно настроен to_sector is not properly configured 332
Данные счета не найдены Account data not found 333
Другой запрос с этим unique key уже находится
в обработке
Another request with unique key is in
progress
334
Некорректные данные сохраненного токена Invalid saved token data 335
Таймаут соединения: сервер не ответил в
отведенное время
Connection timed out: server did not
respond in time 336
Невалидный номер карты получателя денежных
средств The recipient PAN is not valid 337
Валюта sd_ref/originator_id отличается от валюты
операции sd_ref/originator_id currency mismatch 338
Ошибка по протоколу партнера Partner protocol error 339
Отказ от банка получателя Rejected by receiver's bank 340
Сумма реверса больше суммы Available reverse Reverse amount is greater than Available
reverse
341
Некорректные настройки кассы Invalid online cashier settings 342
Бенефициар уже существует The beneficiary already exists 343
Бенефициар не найден The beneficiary not found 344
Некорректный статус Бенефициара Incorrect Beneficiary status 345
Отказ от НСПК Rejected by OPKC 346
5. Описание возможных кодов ответов (Reason Code)
Каждой операции в ПЦ присваивается соответствующий код ответа.
Таблица 79. Описание возможных кодов ответов
Код Описание на русском Описание на английском Рекомендуемый текст сообщений
для плательщика
1 Удачное выполнение
операции
Successful financial
transaction Ваш платёж проведён успешно.
2 Неверный срок действия
Банковской карты Card expired
Платёж отклонён. Возможные
причины: недостаточно средств на
счёте, были указаны неверные
реквизиты карты, по Вашей карте
запрещены расчёты через Интернет.
Пожалуйста, попробуйте выполнить
платёж повторно или обратитесь в
Банк, выпустивший Вашу карту.
3
Неверный статус
Банковской карты на
стороне Эмитента
Invalid card status
4 Операция отклонена
Эмитентом
Transaction declined by
Issuer
Платёж отклонён. Пожалуйста,
обратитесь в Банк, выпустивший
Вашу карту.
5 Операция недопустима
для Эмитента
Invalid transaction.
Declined by Issuer.
П р и л о ж е н и е № 1 С т р а н и ц а 1 6 3 | 1 7 2
6 Недостаточно средств на
счёте Банковской карты 7
Превышен установленный
для ТСП лимит на сумму
операций (дневной,
недельный, месячный) или
сумма операции выходит
за пределы установленных
границ
8
Операция отклонена по
причине срабатывания
системы предотвращения
мошенничества
9
Заказ уже находится в
процессе оплаты.
Операция, возможно,
задублировалась
10 Системная ошибка 11 Ошибка 3DS
аутентификации 12
Указано неверное
значение секретного кода
карты
13
Операция отклонена по
причине недоступности
Эмитента и/или Банка-
эквайрера.
15
BIN платёжной карты
присутствует в черных
списках
16
BIN 2 платёжной карты
присутствует в черных
списках
17 Заказ просрочен 18 Неверно задан параметр
'month'/'reference' 19 Операция оспаривается
плательщиком
20 Транзакция не может быть
выполнена
21
Операция отклонена по
временному ограничению
эмитента
П р и л о ж е н и е № 1 /Confidential
Insufficient funds
Платёж отклонён. Возможные
причины: недостаточно средств на
счёте, были указаны неверные
реквизиты карты, по Вашей карте
запрещены расчёты через Интернет.
Пожалуйста, попробуйте выполнить
платёж повторно или обратитесь в
Банк, выпустивший Вашу карту.
Merchant usage limit
checkup failure
Antifraud checkup failure
Платёж отклонён. Пожалуйста,
обратитесь в Интернет-магазин.
Duplicated transaction
System error
3DS authentication failure
Wrong CVV2/CVC
Платёж отклонён. Возможные
причины: недостаточно средств на
счёте, были указаны неверные
реквизиты карты, по Вашей карте
запрещены расчёты через Интернет.
Пожалуйста, попробуйте выполнить
платёж повторно или обратитесь в
Банк, выпустивший Вашу карту.
Timeout
Платёж отклонён. Пожалуйста,
попробуйте выполнить платёж
позднее или обратитесь в Интернет-
магазин.
Black list bin checkup
failure Платёж отклонён. Пожалуйста,
обратитесь в Интернет-магазин.
Black list bin 2 checkup
failure
Order expired Время на оплату заказа истекло.
Missing month/reference
The transaction is
disputed by the payer.
(Chargeback)
Операция оспаривается
плательщиком.
Transaction can not be
performed Невозможно выполнить операцию.
pan is temporarily
blocked
Операция отклонена по временному
ограничению эмитента. Попробуйте
позже.
С т р а н и ц а 1 6 4 | 1 7 2
/Confidential
22 Операция отклонена по
требованию эмитента Pan Blocked
Операция отклонена по требованию
эмитента. Для совершения
рекуррентного платежа необходимо
повторно привязать карту клиента.
0
Операция отклонена по
другим причинам.
Требуется уточнение у ПЦ.
Internal reason code
Платёж отклонён. Пожалуйста,
попробуйте выполнить платёж
позднее или обратитесь в Интернет-
магазин.
Коды ответа для оплат по ранее осуществленной СБП-привязке
6
Недостаточно средств на
счёте плательщика
(RQ05060)
Insufficient funds in the
payer's account
(RQ05060)
Недостаточно денежных средств для
проведения операции
8 Подозрение в
мошенничестве (RQ05063)
Suspected fraud
(RQ05063) Подозрение в мошенничестве
34
Выполнение операций в
данной категории ТСП
запрещено (RQ05064)
Performing operations in
this category of TSP is
prohibited (RQ05064)
Выполнение операций в данной
категории ТСП запрещено
35 Счет заблокирован
(RQ05065)
Payer's bank account is
blocked (RQ05065) Счет заблокирован
36 Счет закрыт (RQ05066) Payer's bank account is
closed (RQ05066) Счет закрыт
37
Превышен лимит по сумме
операций по СБП
(RQ05061)
The limit on the amount
of SBP transactions has
been exceeded (RQ05061)
Превышен лимит по сумме операций
по СБП
38
Превышен лимит по
количеству операций по
СБП (RQ05062)
The limit on the number
of SBP operations has
been exceeded (RQ05062)
Превышен лимит по количеству
операций по СБП
39
Выполнение операции
запрещено по требованию
законодательства
(RQ05067)
The operation is prohibited
by law (RQ05067)
Выполнение операции запрещено по
требованию законодательства
40
Отказ Банка Плательщика
в выполнении платежа
(RQ05032)
The bank of the payer has
refused to process the
payment (RQ05032)
Отказ Банка Плательщика в
выполнении платежа
41
Истекло время ожидания
решения Банка
Плательщика (RQ05035)
Timeout for the Payer's
Bank's decision has
expired (RQ05035)
Истекло время ожидания решения
Банка Плательщика
42
Распоряжение от Банка
Плательщика не было
получено в ожидаемое
время (RQ05052)
The payment request
from the Payer's financial
institution was not
received as anticipated
(RQ05052)
Распоряжение от Банка Плательщика
не было получено в ожидаемое
время
П р и л о ж е н и е № 1 С т р а н и ц а 1 6 5 | 1 7 2
/Confidential
Приложение №2. Формирование и проверка цифровой подписи.
CryptoJS.SHA256(str).toString() Алгоритм формирования цифровой подписи
1. Формируется строка из значений заданных параметров для каждого вида Запросов/ответов и в конце
добавляется пароль ТСП для цифровой подписи.
2. Полученная строка преобразуется в хэш алгоритмом SHA256. Например, с использованием функции
библиотеки crypto-js.min.js. При вычислении SHA256 для
3. jquery.base64.js.
правильного кодирования русских символов, необходимо использовать только кодировку UTF-8.
Полученное значение хеша кодируется алгоритмом Base64 (кодируется не его битовое представление, а
его шестнадцатеричное строковое представление в нижнем регистре) в итоговую цифровую подпись
библиотеки
signature. Например, с использованием функции Base64.encode(sha256) Пароль для расчёта цифровой подписи предоставляется Организацией после регистрации ТСП в ПЦ.
Важно: при расчете цифровой подписи сообщений от ПЦ учитывайте, что набор полей таких
сообщений не фиксирован и может изменяться путём добавления и исключения ПЦ тегов из
ответа/колбэка.
П р и л о ж е н и е № 2 С т р а н и ц а 1 6 6 | 1 7 2
/Confidential
Пример формирования подписи
REGISTER
Запрос:
sector = 1
amount = 100
currency = 643
email = info@mail.ru
phone = 8911111111111
reference = 1s23d333d333
description = Оплата товара ноутбук ASUS X55A
Вычисление строки:
str = sector + amount + currency + password
Получаем для примера:
str = 1100643test
sha256 = f665bf26a3d24e00b5646c829ea07cef67ed7a2af5eb1fbc258720c651136fee
signature =
ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZQ
==
Ответная xml:
<?xml version="1.0" encoding="UTF-8"?>
<order>
<id>561</id>
<state>REGISTERED</state>
<inprogress>0</inprogress>
<date>2014.07.10 15:07:45</date>
<amount>100</amount>
<currency>643</currency>
<email>info@mail.ru</email>
<phone>8911111111111</phone>
<reference>1s23d333d333</reference>
<description>Оплата товара ноутбук ASUS X55A</description>
<url/>
<signature>ZTBiMjk0NzBiMTcxYjUxMmQ2MzVjNTE5M2FiODNkZTk3N2FiZTFkMmQwNmY5YmEwZDdjY
mYxODJmODMxMjdlYg==</signature>
</order>
Вычисление строки(str) происходит суммированием последовательно содержимого всех тегов
+ password
Получаем для примера:
str = 561REGISTERED02014.07.10
15:07:45100643info@mail.ru89111111111111s23d333d333Оплата товара ноутбук ASUS X55Atest
sha256 = e0b29470b171b512d635c5193ab83de977abe1d2d06f9ba0d7cbf182f83127eb
signature =
ZTBiMjk0NzBiMTcxYjUxMmQ2MzVjNTE5M2FiODNkZTk3N2FiZTFkMmQwNmY5YmEwZDdjYmYxODJmODMxMjdlYg
==
П р и л о ж е н и е № 2 С т р а н и ц а 1 6 7 | 1 7 2
/Confidential
Приложение №3. Примеры сallback
Примечание: для колбэков любого формата цифровая подпись signature формируется из значений
всех тегов в порядке их следования и пароля для расчёта цифровой подписи, предоставляемого ТСП после
его регистрации в ПЦ.
Типовой сallback от ПЦ
При успешной обработке запросов, ПЦ отправляет xml-сообщения следующего вида:
<operation>
<order_id>449420</order_id>
<order_state>REGISTERED</order_state>
<reference>fd9910c2-d105-48fc-9443-9214ddd73946</reference>
<id>413017</id>
<date>2021.09.22 16:19:16</date>
<type>P2PTRANSFER</type>
<state>REJECTED</state>
<reason_code>2</reason_code>
<message>Card expired</message>
<name>P2P Transfer</name>
<pan>411111******1111</pan>
<pan2>557071******4487</pan2>
<amount>10000</amount>
<fee>3000</fee>
<currency>643</currency>
<sector_id>3013</sector_id>
<expdate>04/2025</expdate>
<ps>1</ps>
<rrn>27990043</rrn>
<terminal_id>POS_1</terminal_id>
<ofd_state/>
<to_client_ref>sdfjkhks</to_client_ref>
<signature>YjFlNmUxY2U0YTJiYmQ3YmEzYWE5ZTI2MjIyZDc5NDA=</signature>
</operation>
Где:
<order_id> — идентификатор Заказа, в рамках которого была операция в ПЦ;
<order_state> — статус Заказа после выполнения Операции. Возможные статусы:
/COMPLETED — Заказ успешно оплачен;
/CANCELED — Заказ отменен;
/BLOCKED — Заказ заблокирован внутренними правилами ПЦ;
/REGISTERED — Заказ зарегистрирован;
<reference> — номер Заказа на стороне ТСП;
<id> — идентификатор Операции в ПЦ;
<date> — дата и время регистрации Заказа в ПЦ;
<type> — тип операции в ПЦ;
<state> — результат выполнения Операции в ПЦ:
/APPROVED — успех;
/REJECTED — отклонено;
<reason_code> — код ответа на Операцию ПЦ (1 — успех, любой другой код — ошибка);
<message> — текст сообщения, описывающий <reason_code>;
<name> — имя на карте плательщика;
<pan> — зашифрованный номер карты плательщика;
<pan2> — зашифрованный номер карты получателя средств;
<amount> — сумма операции;
<fee> — комиссия;
<currency> — код валюты;
<sector_id> — идентификатор сектора в ПЦ;
<expdate> — срок действия карты;
<ps> — платежная система;
<rrn> — RRN банковской транзакции;
<terminal_id> — идентификатор терминала;
П р и л о ж е н и е № 3 С т р а н и ц а 1 6 8 | 1 7 2
/Confidential
<to_client_ref> — идентификатор пользователя Площадки, на Виртуальную карту
которого переводятся средства.
<signature> — цифровая подпись ответа на запрос.
Callback об операциях по виртуальным картам
При проведении любой операции по виртуальной карте во внешней сети, т.е. в устройствах, не связанных
с устройствами банка, приходит xml-сообщение следующего вида:
<card_operation>
<sector>3013</sector>
<maskedPan>557071******6657</maskedPan>
<client_ref>nomer5</client_ref>
<personID>10000002302</personID>
<mcc>4814</mcc>
<termID>POS_1</termID>
<termLocation>C.Cetkin str.,20</termLocation>
<retailerID>R0010007</retailerID>
<retailerName>LR*Paygine_MInB</retailerName>
<amount>22200</amount>
<aqfee>0</aqfee>
<currency>643</currency>
<country>643</country>
<trancode>110</trancode>
<TWOID>3733898</TWOID>
<dateTime>2019.06.13 16:59:16</dateTime>
<availableBalance>0</availableBalance>
<credLimit>1447800</credLimit>
<signature>Y2FiYmNiYzAzNzMxMic3YjQ1ZDI5NjllYjMwMzIyNDQ=</signature>
</card_operation>
Callback об изменении статуса идентификации юзера
Важно: получение данного типа колбэка доступно только по согласованию с Оператором.
При изменении уровня идентификации пользователя приходит xml-сообщение следующего вида:
<b2p_user>
<reg_date>2022.11.25 17:56:28</reg_date>
<sector>893</sector>
<client_ref>d212c42b-3163-42b9-a449-62fb7c5c09fd</client_ref>
<state>0</state>
<auth_state>2</auth_state>
<active>0</active>
<first_name>Илья</first_name>
<patronymic>Федорович</patronymic>
<last_name>Борисов</last_name>
<birth_date>1990.12.06</birth_date>
<inn>781140000243</inn>
<persondoc_number>4700892298</persondoc_number>
<available_balance>0</available_balance>
<currency>643</currency>
<status>OPEN</status>
<signature>Y2EwZTdiYTU1NmExYzk2MjgxMDFmYjcyOWU4NWM4NjA=</signature>
</b2p_user>
П р и л о ж е н и е № 3 С т р а н и ц а 1 6 9 | 1 7 2
/Confidential
Callback об изменении фазы жизни кошелька
Важно: получение данного типа колбэка доступно только по согласованию с Оператором.
При изменении фазы жизни кошелька приходит xml-сообщение следующего вида:
<vcard_status_notification>
<sector_id>4751</sector_id>
<client_ref>5072a979-41bb-4725-bfc1-4e1870b3a4c6</client_ref>
<vcard_status>BLOCKED</vcard_status>
<wallet_state>BLOCKED_BY_RNKO</wallet_state>
<signature>YzQzYjkyMTZkMzhmZTFhY2NiZjBkOWI3ODU3MTQyODgxZDQxYjMxM2FlMzZiOWIyYz
lhNzc2ODJhNWY2Y2ZiMA==</signature>
</vcard_status_notification>
Где:
<wallet
_
state> — идентификатор фазы жизни кошелька. Возможные значения:
/ISSUED — Выпущен;
/ACTIVE — Активный;
/BLOCKED_BY_CLIENT — Заблокирован клиентом;
/BLOCKED
BY
CHANGE
_
_
_
PHONE — Заблокирован по смене номера телефона;
/BLOCKED_BY_APPLICATION — Заблокирован по заявлению;
/BLOCKED_BY_RNKO — Заблокирован РНКО;
/BLOCKED_FOR_TERRORISM — Заблокирован за терроризм;
/FINISHED — Завершен.
Callback об операциях через СБП
При проведении любой операции через Систему Быстрых Платежей (СБП), приходит xml-сообщение
следующего вида:
<operation>
<order_id>461894488</order_id>
<order_state>COMPLETED</order_state>
<reference>test b2p</reference>
<id>685675100</id>
<date>2022.06.16 14:47:49</date>
<type>PURCHASE_BY_QR</type>
<state>APPROVED</state>
<email>roman@paygine.com</email>
<amount>1000</amount>
<fee>0</fee>
<currency>643</currency>
<qrcId>AD10004O2VQJVS7K8N6O65TOH9RTLNPI</qrcId>
<sbpTranId>B2167114748464070000176517BE1DD5</sbpTranId>
<token>SBP434eed38-9e24-45b9-ba49-0d0f0d5eda3a</token>
<signature>NzIxN2NlNzM5OTM5OWE0MjBkYmE1NmUyYjVhYTc3YWE=</signature>
</operation>
Важно: параметр <token> появится в колбэке только после согласования с Оператором схемы работы
по привязке СБП и отображения токенов в колбэке.
Также, по согласованию с Оператором, доступна отправка второго колбэка с дополнительной
информацией по СБП-операции:
П р и л о ж е н и е № 3 С т р а н и ц а 1 7 0 | 1 7 2
/Confidential
• Вариант 1. Расширенный, с ФИО и номером телефона получателя:
<SBPOperationDetails>
<order_id>506122</order_id>
<operation_id>482668</operation_id>
<operation_state>APPROVED</operation_state>
<reference>9820911a-b795-4c7f-9dae-4b653443b7de</reference>
<phone>79112223344</phone>
<recipientFIO>Неиванов Неиван Н.</recipientFIO>
<sbp_bank_id>100000000111</sbp_bank_id>
<sector_id>1869</sector_id>
<signature>ZjAwOTJkZmU0YmFjNDdkMzI0MjQ2ZTg3NzAwYWRiNTE=</signature>
</SBPOperationDetails>
• Вариант 2. Сокращенный, без данных о получателе, но с результатами проверки этих данных:
<SBPOperationDetails>
<order_id>506123</order_id>
<operation_id>482669</operation_id>
<operation_state>APPROVED</operation_state>
<reference>8104e8ee-b13d-4cb1-908e-a1748707acb7</reference>
<sbp_bank_id>100000000111</sbp_bank_id>
<sector_id>1869</sector_id>
<signature>N2YwNWRmYzczYjAxYWM0MmE4OTQwNmY4NDU1ZjU4ZWI=</signature>
<verified_phone>true</verified_phone>
<verified_FIO>true</verified_FIO>
</SBPOperationDetails>
Callback об изменении статуса СБП-привязки
Важно: получение данного типа колбэка доступно только по согласованию с Оператором.
Примечание: время в колбэке приходит по Москве — UTC+3.
При изменении статуса СБП-привязки приходит xml-сообщение следующего вида:
<SBPSubscriptionState>
<date>2022.10.20 21:00:39.450</date>
<order_id>590335525</order_id>
<qrcId>AD1R0031255MJTQN9T98G926KHHF3N7F</qrcId>
<subscription_state>NOT_SET/ACCEPTED/REJECTED/CANCELED</subscription_state>
<token>SBP434eed38-9e24-45b9-ba49-0d0f0d5eda3a</token>
<member_id>100000000004</member_id>
<signature>YjI4YTliNzJjMGIwYjlkNDhjMGJkODRkMWU5YWFjYWI=</signature>
</SBPSubscriptionState>
П р и л о ж е н и е № 3 С т р а н и ц а 1 7 1 | 1 7 2
/Confidential
Callback об изменении остатка на счете в результате выполнения банковских проводок
По факту изменения остатка на счете после выполнения банковских проводок приходит xml-
сообщение следующего вида:
<BankOperation>
<bank_id>21</bank_id>
<account>30232810500005000941</account>
<P008>ИВАНОВ ИВАН ИВАНОВИЧ г КРАСНОЯРСК УЛ КИРОВА 18 44</P008>
<P024>ОПЛАТА УСЛУГ ХИМЧИСТКИ</P024>
… // все P-поля с их значениями
<P060>0</P060>
<signature>Y2FiYmNiYzAzNzMxMic3YjQ1ZDI5NjllYjMwMzIyNDQ=</signature>
</BankOperation>
П р и л о ж е н и е № 3 С т р а н и ц а 1 7 2 | 1 7 2