# ADR 0002: Интерфейс PaymentGateway

**Статус:** Принято  
**Дата:** 2025-01-25  
**Контекст:** Интеграция с платёжными провайдерами

## Решение

Выделить абстракцию `PaymentGateway` (порт) с методами `createPayment`, `getStatus`, `handleWebhook`.

## Контекст

- Сейчас используется заглушка (StubPaymentGateway) для демо.
- В будущем — подключение реального провайдера (ЮKassa, Paygine, Best2Pay и т.д.).
- Логика приёма чаевых не должна зависеть от конкретного провайдера.

## Варианты

1. **Прямые вызовы API провайдера** — жёсткая связь, сложно менять.
2. **Абстракция PaymentGateway** — use case зависит от интерфейса, реализация в infrastructure.
3. **Event-driven (платёж как событие)** — избыточно для MVP.

## Выбор

Вариант 2: интерфейс в `lib/payment/gateway.ts`, реализация в `lib/payment/stub-gateway.ts`. При подключении провайдера — новый адаптер без изменения API routes.

## Последствия

- Соблюдение Open/Closed принципа для платёжного модуля.
- Тесты: mock PaymentGateway в use case.
- Webhook: проверка подписи в адаптере, fail closed в production без секрета.
