# ADR 0001: JWT вместо серверных сессий

**Статус:** Принято  
**Дата:** 2025-01-24  
**Контекст:** Аутентификация пользователей

## Решение

Использовать JWT (access + refresh) вместо серверных сессий для аутентификации API.

## Контекст

- Нужна stateless-авторизация для масштабирования.
- Refresh token хранится в БД (Session) для возможности инвалидации.
- Access token — короткий срок жизни (15 мин), без хранения на сервере.

## Варианты

1. **Только JWT** — полностью stateless, но невозможна мгновенная инвалидация.
2. **JWT + refresh в БД** — компромисс: короткий access stateless, refresh проверяется при обновлении.
3. **Серверные сессии** — stateful, требует sticky sessions или Redis.

## Выбор

Вариант 2: JWT access + refresh в httpOnly cookie и в БД. При refresh проверяем Session в БД, при необходимости инвалидируем.

## Последствия

- При горизонтальном масштабировании sticky sessions не нужны.
- Инвалидация — через удаление Session в БД при logout.
- Refresh при 401 — прозрачно для клиента (interceptor).
