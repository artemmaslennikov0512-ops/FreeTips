Оглавление
ВВЕДЕНИЕ ................................................................................................................................................................9
ТЕРМИНЫ И ОПРЕДЕЛЕНИЯ, ИСПОЛЬЗУЕМЫЕ В ДАННОЙ ИНСТРУКЦИИ ...............................................................................................9
ОРГАНИЗАЦИЯ ОБМЕНА ДАННЫМИ ....................................................................................................................10
НАСТРОЙКИ ДЛЯ ИНТЕГРАЦИИ ............................................................................................................................11
ОБЩИЕ СВЕДЕНИЯ О ПРОВЕДЕНИИ ОПЕРАЦИЙ ..................................................................................................12
ИСПОЛЬЗОВАНИЕ ЗАКАЗА ДЛЯ ПРОВЕДЕНИЯ ОПЕРАЦИЙ .................................................................................................................12
ОГРАНИЧЕНИЕ НА СРОК ОПЛАТЫ ЗАКАЗА ......................................................................................................................................12
СТАТУСЫ ЗАКАЗОВ.....................................................................................................................................................................13
ТИПЫ ОПЕРАЦИЙ......................................................................................................................................................................13
СТАТУСЫ ОПЕРАЦИЙ..................................................................................................................................................................14
ДВУХСТАДИЙНЫЕ ОПЕРАЦИИ......................................................................................................................................................14
ОПОВЕЩЕНИЕ ПЛАТЕЛЬЩИКА ОБ ОПЕРАЦИЯХ ...............................................................................................................................15
ОТЧЕТЫ ДЛЯ ТСП ОБ ОПЕРАЦИЯХ ...............................................................................................................................................15
ИСПОЛЬЗОВАНИЕ ТОКЕНОВ ........................................................................................................................................................16
РАБОТА С РЕКУРРЕНТНЫМИ ПЛАТЕЖАМИ (RECURRING PAYMENTS, АВТОПЛАТЕЖИ).............................................................................16
ОСНОВНЫЕ ПРИНЦИПЫ РАБОТЫ С ФИСКАЛЬНЫМИ ДАННЫМИ ........................................................................................................18
ЗАПРОСЫ К ПЦ.......................................................................................................................................................19
ЗАПРОС WEBAPI/REGISTER — РЕГИСТРАЦИЯ ЗАКАЗА ...............................................................................................................19
ЗАПРОС WEBAPI/PURCHASE — ОПЛАТА ПО КАРТЕ ....................................................................................................................26
ЗАПРОС WEBAPI/AUTHORIZE — ХОЛДИРОВАНИЕ СРЕДСТВ НА КАРТЕ .....................................................................................29
ЗАПРОС WEBAPI/AUTHORIZEINC — УВЕЛИЧЕНИЕ СУММЫ ЗАХОЛДИРОВАННЫХ СРЕДСТВ ....................................................32
ЗАПРОС WEBAPI/COMPLETE — ЗАВЕРШЕНИЕ ОПЛАТЫ ПО КАРТЕ............................................................................................34
ЗАПРОС GATEWEB/PAYMENT — ОПЛАТА / ХОЛДИРОВАНИЕ ПО КАРТЕ ...................................................................................36
ЗАПРОС WEBAPI/REVERSE — ОТМЕНА ОПЕРАЦИИ ОПЛАТЫ....................................................................................................39
ЗАПРОС GATEWEB/VERIFY — ПРОВЕРКА ПОДПИСКИ КАРТЫ НА 3DS......................................................................................41
ЗАПРОС GATEWEB/CHECKVERIFYSTATUS — ПРОВЕРКА СТАТУСА АУТЕНТИФИКАЦИИ................................................................47
ЗАПРОС WEBAPI/ALFAPAY — ОПЛАТА ЧЕРЕЗ ALFAPAY ...............................................................................................................48
ЗАПРОС WEBAPI/PURCHASEBYSECTORCARD — ОПЛАТА С ТЕХНИЧЕСКОЙ КАРТЫ СЕКТОРА .......................................................49
ЗАПРОС WEBAPI/PAYMENTFEE — РАСЧЕТ КОМИССИИ ЗА ОПЛАТУ...........................................................................................52
ЗАПРОС WEBAPI/OPERATION — ПОЛУЧЕНИЕ ИНФОРМАЦИИ ПО ОПЕРАЦИИ.........................................................................55
ЗАПРОС WEBAPI/ORDER — ПОЛУЧЕНИЕ ИНФОРМАЦИИ ПО ЗАКАЗУ......................................................................................56
ЗАПРОС WEBAPI/CHANGEORDERSTATUS — СМЕНА СТАТУСА ЗАКАЗА.........................................................................................57
ЗАПРОС WEBAPI/ORDERLIST — ВЫВОД СПИСКА ЗАКАЗОВ ПО КРИТЕРИЯМ ............................................................................58
ЗАПРОС WEBAPI/GETSHORTLINK — ГЕНЕРАЦИЯ КОРОТКИХ ССЫЛОК.......................................................................................59
ЗАПРОС WEBAPI/GETOPERATIONCONFIRMATION — ГЕНЕРАЦИЯ PDF-СПРАВКИ ПО ОПЕРАЦИИ .................................................61
ЗАПРОС WEBAPI/PING — ОТСЛЕЖИВАНИЕ ДОСТУПНОСТИ ....................................................................................................62
РАБОТА С РЕКУРРЕНТНЫМИ ПЛАТЕЖАМИ (RECURRING PAYMENTS)..................................................................63
ЗАПРОС WEBAPI/RECURRING — ПОВТОРНОЕ (АВТОМАТИЧЕСКОЕ) СПИСАНИЕ ПО КАРТЕ .....................................................63
ЗАПРОС WEBAPI/CANCEL – ОТМЕНА РЕГУЛЯРНОГО ЗАКАЗА....................................................................................................65
ЗАПРОС WEBAPI/CHANGEREC — ИЗМЕНЕНИЕ ПАРАМЕТРОВ РЕГУЛЯРНОГО ЗАКАЗА .............................................................66
ЗАПРОС WEBAPI/CHANGERECCARD — СМЕНА КАРТЫ РЕКУРРЕНТНОГО ПЛАТЕЖА ..................................................................67
ЗАПРОС WEBAPI/SETREC — ПЕРЕВОД СУЩЕСТВУЮЩЕГО ЗАКАЗА В РЕГУЛЯРНЫЙ................................................................70
ЗАПРОС WEBAPI/REVERSEKEEPREC – ВОЗВРАТ РЕГУЛЯРНОГО ПЛАТЕЖА ..................................................................................71
РАБОТА С ТОКЕНОМ КАРТЫ..................................................................................................................................73
ЗАПРОС WEBAPI/CARDENROLL — РЕГИСТРАЦИЯ КАРТЫ И ПОЛУЧЕНИЕ ТОКЕНА ....................................................................73
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 7 | 140
ЗАПРОСЫ WEBAPI/PURCHASEBYTOKEN И WEBAPI/AUTHORIZEBYTOKEN — ОПЛАТА И ХОЛДИРОВАНИЕ ПО ТОКЕНУ КАРТЫ..........75
ЗАПРОС WEBAPI/RECURRINGBYTOKEN — ИНИЦИИРОВАНИЕ РЕГУЛЯРНОГО ПЛАТЕЖА ПО ТОКЕНУ КАРТЫ............................77
ЗАПРОС WEBAPI/СHECKTOKEN — ПРОВЕРКА СТАТУСА ТОКЕНА................................................................................................78
ОПЕРАЦИИ ПЕРЕВОДА С КАРТЫ НА КАРТУ (P2PTRANSFER).................................................................................79
ЗАПРОС WEBAPI/P2PTRANSFER — ВЫПОЛНЕНИЕ ПЕРЕВОДА С КАРТЫ НА КАРТУ ...................................................................79
ЗАПРОС GATEWEB/P2PTRANSFER — ВЫПОЛНЕНИЕ ПЕРЕВОДА С КАРТЫ НА КАРТУ ................................................................82
ЗАПРОС WEBAPI/P2PFEE — РАСЧЕТ КОМИССИИ ЗА ПЕРЕВОД................................................................................................86
ЗАПРОС WEBAPI/P2PDEBIT — ДЕБЕТОВАЯ ЧАСТЬ ПЕРЕВОДА С КАРТЫ НА КАРТУ..................................................................87
ЗАПРОС WEBAPI/P2PCOMPLETE — КРЕДИТОВАЯ ЧАСТЬ ПЕРЕВОДА С КАРТЫ НА КАРТУ.........................................................90
ЗАПРОС GATEWEB/P2PCREDIT — ЗАЧИСЛЕНИЕ СРЕДСТВ НА КАРТУ СО СЧЕТА ТСП ................................................................91
ЗАПРОС WEBAPI/P2PCREDITBALANCE — БАЛАНС СЧЕТА СЕКТОРА ............................................................................................92
ЗАПРОС GATEWEB/CARDINFO — ПОЛУЧЕНИЕ ИНФОРМАЦИИ ПО КАРТЕ.................................................................................94
РАБОТА С ПРОЦЕДУРАМИ ИДЕНТИФИКАЦИИ.....................................................................................................97
ЗАПРОС WEBAPI/B2PUSER/IDENTIFICATIONSTATUS — ИДЕНТИФИКАЦИЯ ФИЗЛИЦА....................................................................97
РАБОТА СО СКОРИНГОВЫМ БАЛЛОМ................................................................................................................100
ЗАПРОС WEBAPI/GETSCORING — ПОЛУЧЕНИЕ СКОРИНГ-БАЛЛА КЛИЕНТА .......................................................................... 100
РАБОТА С СМС .....................................................................................................................................................102
ЗАПРОС GATEWEB/SMSSEND — ОТПРАВКА СМС .................................................................................................................... 102
ЗАПРОС GATEWEB/SMSSTATUS — ПРОВЕРКА СОСТОЯНИЯ ОТПРАВЛЕННЫХ СМС ............................................................... 104
РАБОТА С QR-КОДОМ СБП ..................................................................................................................................106
ЗАПРОС WEBAPI/PURCHASESBP — ОПЛАТА QR-КОДОМ СБП ................................................................................................... 107
ЗАПРОС WEBAPI/PURCHASESBPQRLINK — ПОЛУЧЕНИЕ ССЫЛКИ НА QR-КОД СБП.................................................................. 109
ЗАПРОС WEBAPI/REGISTERSBPQRCASH — РЕГИСТРАЦИЯ КАССОВОЙ ССЫЛКИ СБП .............................................................. 110
ЗАПРОС WEBAPI/ACTIVATESBPQRCASH — АКТИВАЦИЯ КАССОВОЙ ССЫЛКИ СБП ................................................................. 111
ЗАПРОС WEBAPI/DEACTIVATESBPQRCASH — ДЕАКТИВАЦИЯ КАССОВОЙ ССЫЛКИ СБП ......................................................... 113
ЗАПРОС WEBAPI/GETSBPSUBSCRIPTION — РЕГИСТРАЦИЯ СБП-ПРИВЯЗКИ БЕЗ ОПЛАТЫ....................................................... 114
ЗАПРОС WEBAPI/PURCHASESBPBYTOKEN — БЕЗАКЦЕПТНАЯ ОПЛАТА ПО СБП-ПРИВЯЗКЕ .................................................... 115
ЗАПРОС TEST/SBPTESTCASE — ПРОВЕДЕНИЕ ТЕСТ-КЕЙСОВ СБП.......................................................................................... 116
ЗАПРОС WEBAPI/B2PUSER/GETSBPBANKLIST — СПРАВОЧНИК БАНКОВ С СБП ........................................................................ 117
ЗАПРОС WEBAPI/SBP/SBPCREDITPRECHECK — ПРОВЕРКА ВОЗМОЖНОСТИ ВЫПЛАТЫ ЧЕРЕЗ СБП ........................................ 119
ЗАПРОС WEBAPI/SBP/SBPCREDIT — B2C ВЫПЛАТЫ ЧЕРЕЗ СБП.............................................................................................. 120
ЗАПРОС WEBAPI/SBP/SBPCREDITBALANCE — БАЛАНС СЧЕТА ТСП ДЛЯ СБП-ВЫПЛАТ............................................................. 121
ТЕСТОВЫЕ СЦЕНАРИИ ДЛЯ СЕРВИСОВ СБП-ВЫПЛАТ.........................................................................................122
ПРИЛОЖЕНИЕ №1. ОПИСАНИЕ ФОРМАТОВ XML-СООБЩЕНИЙ ОТ ПЦ.............................................................124
1. ФОРМАТ XML-СООБЩЕНИЯ, ПРИСЫЛАЕМОГО НА ОПЕРАЦИЮ REGISTER ................................................................................... 124
2. ФОРМАТ XML-УВЕДОМЛЕНИЯ ПО РЕЗУЛЬТАТАМ ВЫПОЛНЕНИЯ ОПЕРАЦИИ, ПРИСЫЛАЕМОГО ПЦ НА СЕРВЕР ТСП МЕТОДОМ HTTP POST
........................................................................................................................................................................................... 125
3. ФОРМАТ XML-СООБЩЕНИЯ, ПРИСЫЛАЕМОГО В ОТВЕТ НА ЗАПРОС ORDER ................................................................................ 127
4. ФОРМАТ XML-СООБЩЕНИЯ ОБ ОШИБКЕ ................................................................................................................................ 128
5. ОПИСАНИЕ ВОЗМОЖНЫХ КОДОВ ОТВЕТОВ (REASON CODE) ...................................................................................................... 133
ПРИЛОЖЕНИЕ №2. ФОРМИРОВАНИЕ И ПРОВЕРКА ЦИФРОВОЙ ПОДПИСИ.....................................................136
АЛГОРИТМ ФОРМИРОВАНИЯ ЦИФРОВОЙ ПОДПИСИ.................................................................................................................... 136
ПРИМЕРЫ ФОРМИРОВАНИЯ ПОДПИСИ...................................................................................................................................... 136
ПРИЛОЖЕНИЕ №3. ПРИМЕРЫ СALLBACK ...........................................................................................................139
CALLBACK ОБ ОПЕРАЦИЯХ ЧЕРЕЗ СБП........................................................................................................................................ 139
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 8 | 140
CALLBACK ОБ ИЗМЕНЕНИИ СТАТУСА СБП-ПРИВЯЗКИ.................................................................................................................... 140
CALLBACK ОБ ИЗМЕНЕНИИ ОСТАТКА НА СЧЕТЕ В РЕЗУЛЬТАТЕ ВЫПОЛНЕНИЯ БАНКОВСКИХ ПРОВОДОК .................................................. 140

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 9 | 140
Введение
Инструкция по интеграции с Процессинговым центром компании Pay Engine предназначена для
технических специалистов, осуществляющих интеграцию информационной системы ТСП с Процессинговым
центром для добавления возможности приёма платежей с помощью банковских карт и прочих платёжных
инструментов в пользу ТСП.
Инструкция определяет протокол взаимодействия между Процессинговым центром и информационной
системой ТСП, а также обязательные процедуры, необходимые в процессе проведения Операций через
интернет в пользу ТСП.
Термины и определения, используемые в данной Инструкции
Оператор — общество с ограниченной ответственность «Пэй Энджин».
Процессинговый центр (далее ПЦ) — совокупность компьютерных программ и аппаратных средств
Оператора, а также телекоммуникаций и телекоммуникационных сетей, обеспечивающая обработку (прием,
передачу, создание, хранение, изменение, удаление) данных, необходимых для осуществления Операций
Плательщиков.
ТСП — торгово-сервисное предприятие (юридическое лицо, индивидуальный предприниматель, кредитная
организация и т.п.), реализующее товары или услуги через интернет или другими способами, и
использующее ПЦ для проведения Операций в рамках своей деятельности.
ИС ТСП — информационная система ТСП; программно-аппаратный комплекс, обеспечивающий
взаимодействие ТСП и ПЦ со стороны ТСП, в том числе в рамках обмена данными, необходимыми для
осуществления Операций Плательщиков.
Платёжные системы — международные платёжные системы «VISA International», «MasterCard Worldwide».
Плательщик — физическое лицо, использующее ПЦ для осуществления Операций по сделкам (договорам,
заявкам), заключаемым между Плательщиком и ТСП.
Эмитент — кредитная организация или иное юридическое лицо, выпускающее Платёжные карты и
предоставляющее их Плательщикам на основании соответствующих договоров.
Платёжная карта, Карта – выпущенная соответствующим Эмитентом банковская карта одной из Платёжных
систем, являющаяся расчётным средством для осуществления Операций и разрешённая к оплате
Платёжными системами в интернете.
Эквайер — кредитная организация, привлекаемая Оператором или ТСП для организации процесса
проведения Операций в пользу ТСП с использованием Платёжных карт.
Заказ — набор данных, определяющий выбранные Плательщиком товары или услуги ТСП, для приобретения
которых Плательщик намерен заключить сделку с ТСП.
Операция — набор данных и последовательность связанных с этими данными сеансов обмена информацией
между ТСП, ПЦ, Эквайером и Эмитентом, отражающие требование ТСП, в рамках реализуемых им товаров
или услуг, по списанию и зачислению денежных средств со счета или на счет Платежной карты Плательщика.
Рекуррентный платеж — платеж, повторяющийся с заданной Плательщиком периодичностью, и полностью
дублирующий параметры какой-то «эталонной операции». Эталонная операция проводится
непосредственно Плательщиком. После задания графика списаний, Рекуррентные платежи участия
Плательщика не требуют.
Возврат/Отмена — Операция зачисления Плательщику списанных ранее средств, инициируемая ТСП, в
случае, когда средства были списаны ошибочно или неправомерно, либо Плательщик вернул товар или
отказался от услуги.
Запрос — HTTP-запрос в ПЦ, используемый для передачи данных в формате application/x-www-formurlencoded с использованием архитектуры REST, для совершения взаимодействия ИС ТСП и ПЦ в рамках
данной инструкции.
СБП — Система Быстрых Платежей от НСПК, позволяющая осуществлять перевод средств по
идентификатору получателя, даже если стороны перевода имеют счета в разных кредитных организациях.
СБП позволяет совершать мгновенные платежи в режиме 24/7, в том числе с использованием QR-кода.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 10 | 140
Личный кабинет — специализированное web-приложение ПЦ, защищённое специальными средствами
защиты, реквизиты доступа к которому ТСП получает при регистрации в ПЦ. В Личном кабинете сотрудники
ТСП в рамках выделенных им прав могут просматривать информацию о состоянии Заказов и Операций,
зарегистрированных в ПЦ, а также давать разного рода поручения в ПЦ.
Организация обмена данными
Взаимодействие ИС ТСП и ПЦ реализуется с использованием архитектуры REST.
1. При отправке Запросов к ПЦ, ИС ТСП должна использовать 2048-битное SSL шифрование (протокол
HTTPS) и методы GET или POST.
2. В режиме промышленной эксплуатации рекомендуется по возможности все Запросы к ПЦ
реализовать только методом POST.
3. В зависимости от типа сделанного Запроса, в качестве ответа от ПЦ приходит:
• либо команда браузеру на перевод Плательщика на страницу, адрес которой предварительно
был получен от ИС ТСП;
• либо web-страница для показа Плательщику;
• либо информационное сообщение для обработки в ИС ТСП.
4. В ПЦ при обмене сообщениями по умолчанию используется кодировка UTF-8.
5. В ответах и колбэках от ПЦ любые тэги, содержащие массивы параметров, могут быть пустыми или
содержать произвольное количество элементов.
6. При предоставлении ПЦ ссылок для отправки колбэков, используйте ссылки через протокол HTTPS
со стандартным портом (порт 443). Если ИС ТСП требует вызова через нестандартный порт,
свяжитесь с Оператором для обсуждения вариантов настройки.
 Предупреждение: любые изменения ссылок с нестандартным портом требуют предварительного
согласования с Оператором и времени на перенастройку на стороне ПЦ.

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 11 | 140
Настройки для интеграции
ПЦ поддерживает два режима взаимодействия с ИС ТСП: тестовый режим и режим промышленной
эксплуатации («боевой»). На физическом уровне для реализации тестового и боевого режимов
взаимодействия в ПЦ используются две ничем не связанные между собой подсистемы ПЦ — тестовая и
боевая системы. Поэтому, при подключении к каждой из указанных систем должны быть использованы свои,
соответствующие системе, реквизиты: адрес отправки Запросов, идентификаторы ТСП в системе ПЦ и
реквизиты доступа к Личному кабинету.
Для интеграции с тестовым сервером ПЦ ТСП используйте следующие значения.
Название Значение на тестовом стенде Значение на «боевом» стенде
URL для отправки Запросов https://test.paygine.com/webapi/ https://pay.paygine.com/webapi/
Уникальный идентификатор
учетной записи ТСП в ПЦ
(sector)
Предоставляется после регистрации ТСП в ПЦ
Пароль для формирования
цифровой подписи Предоставляется после регистрации ТСП в ПЦ
Номер тестовой карты Предоставляется после
регистрации ТСП в ПЦ Неприменимо
URL для входа в Личный
кабинет https://test.paygine.com/office/ https://pay.paygine.com/office/
Логин и пароль для входа в
Личный кабинет Предоставляется после регистрации ТСП в ПЦ

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 12 | 140
Общие сведения о проведении Операций
Использование заказа для проведения операций
1. Проведение Операции в ПЦ возможно только в рамках ранее зарегистрированного Заказа. Заказ
содержит описание предоставляемого товара или услуги и их основные параметры (сумма,
текстовое описание и т.д.). Операция содержит описание сути финансового взаимодействия с
Плательщиком в рамках предоставления товара или услуги, описанных в Заказе. Если в описании
некоторых Запросов указано, что предварительная регистрация Заказа при выполнении этого
Запроса не требуется — это означает, что ПЦ до проведения Операции сам автоматически
зарегистрирует Заказ на основании параметров Запроса.
2. Любая Операция может быть связана только с одним Заказом.
3. В рамках одного Заказа может быть зарегистрировано несколько Операций. При этом, в общем
случае, в рамках одного Заказа может быть проведена только одна успешная Операция одного типа.
Исключения:
• Операция типа REVERSE. ПЦ позволяет выполнять многократный частичный возврат по
Операциям оплаты товаров или услуг, и все такие Операции производятся для одного Заказа —
того, в котором зарегистрирована исходная Операция;
• Операция типа RECURRING. Все Операции, выполняемые в режиме «автоплатеж»
(Рекуррентные платежи), производятся в рамках одного Заказа — того, для которого был
активирован данный Рекуррентный платеж;
• Операция типа AUTHORIZE_INC. В рамках одного Заказа может быть зарегистрировано
несколько Операций увеличения суммы захолдированных средств. Операцию AUTHORIZE_INC
можно выполнить только после успешной Операции AUTHORIZE и до проведения Операции
COMPLETE (или REVERSE) в рамках Заказа.
Ограничение на срок оплаты заказа
1. При регистрации Заказа можно указать время, в течение которого позволено оплатить Заказ —
время жизни Заказа.
2. По умолчанию, в ПЦ установлено время жизни Заказа 90 суток.
3. По истечении времени жизни, Заказ не может быть оплачен. В ответ на попытку оплатить такой
Заказ ПЦ вернет сообщение об ошибке.

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 13 | 140
Статусы заказов
Заказ, в зависимости от типа и результата выполнения в рамках него Операций, может иметь один из
следующих статусов.
Статус Описание
REGISTERED Заказ зарегистрирован в ПЦ и не содержит успешных Операций.
AUTHORIZED В рамках Заказа успешно проведена Операция типа AUTHORIZE (деньги для
проведения платежа заблокированы на счёте Карты Плательщика).
P2PAUTHORIZED В рамках Заказа успешно проведена операция типа P2PDEBIT (деньги для
проведения перевода с карты на карту списаны с Платёжной карты Плательщика).
COMPLETED Заказ успешно оплачен. В рамках Заказа проведена успешная Операция одного
из типов: PURCHASE, COMPLETE, P2PTRANSFER, P2PCOMPLETE, P2PCREDIT.
CANCELED Заказ отменен. В рамках Заказа проведена успешная Операция типа REVERSE.
Деньги по проведенной ранее в рамках Заказа оплате возвращены Плательщику.
BLOCKED
Заказ заблокирован внутренними правилами ПЦ.
ТСП необходимо получить подтверждение от Оператора ПЦ, либо дождаться
смены статуса Заказа на другой, прежде чем принимать решение об исполнении
обязательств перед Плательщиком.
EXPIRED Заказ с истекшим сроком действия. Время, установленное на оплату Заказа,
истекло.
Типы операций
Типы Операций, поддерживаемые ПЦ, перечислены в таблице ниже.
Тип Описание
AUTHORIZE,
AUTHORIZE_BY_TOKEN
Холдирование средств на счёте Платёжной карты Плательщика. Доступный
остаток средств на Платёжной карте Плательщика уменьшается, но
средства со счета не списываются до выполнения Операции COMPLETE.
COMPLETE
Операция подтверждения соответствующей Операции AUTHORIZE Заказа.
При успешном выполнении данной Операции производится списание
ранее захолдированных средств со счёта Платёжной карты Плательщика.
PURCHASE,
PURCHASE_BY_TOKEN
Операция, при успешном выполнении которой сразу выполняется списание
средств со счёта Платёжной карты Плательщика. Данная Операция
аналогична последовательному выполнению пары Операций: AUTHORIZE и
COMPLETE.
RECURRING,
RECURRING_BY_TOKEN
Операция, аналогичная PURCHASE (PURCHASE_BY_TOKEN). В отличие от
PURCHASE, проводится без участия Плательщика. Выполняется для
списания Рекуррентного платежа.
REVERSE Возврат/Отмена. Позволяет вернуть средства, списанные или
захолдированные ранее в рамках Заказа.
P2PTRANSFER Операция перевода средств с Карты на Карту.
P2PDEBIT Дебетовая часть перевода с Карты на Карту — списание денежных средств
с Карты отправителя.
P2PCOMPLETE Кредитовая часть перевода с Карты на Карту — зачисление денежных
средств на Карту получателя.
P2PCREDIT Операция зачисления денежных средств на Карту со счета ТСП.
PURCHASE_BY_QR
Операция прямого перевода средств со счёта плательщика на счёт
юридического лица или транзитный счёт организации. Проводится через
СБП.
RECURRING_BY_QR
Операция аналогичная PURCHASE_BY_QR. В отличие от PURCHASE_BY_QR
проводится без участия Плательщика. Выполняется для списания
рекуррентного платежа. Проводится через СБП.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 14 | 140
CREDIT_BY_QR Операция прямого перевода средств со счёта ТСП на счёт физического
лица. Проводится через СБП.
AUTHORIZE_INC Операция увеличения суммы захолдированных средств.
Статусы операций
В зависимости от этапа обработки в ПЦ, Операция может иметь один из следующих статусов.
Статус Описание
REGISTERED Операция зарегистрирована в ПЦ.
PENDING Операция направлена Эмитенту на одобрение.
APPROVED Операция завершена. Получено одобрение Эмитента.
REJECTED Операция завершена. В проведении операции отказано.
TIMEOUT
Операция не завершена. ПЦ не получил ответ от эмитента. Требуется уточнение
статуса Операции. Рекомендуем настроить переопрос методом webapi/Operation
до получения конечного статуса.
ERROR Операция завершена. Получена ошибка при обработке Операции.
Двухстадийные операции
ПЦ позволяет разбить процедуры оплаты товара по Карте и перевода средств с Карты на Карту на два этапа.
То есть, при наличии соответствующих бизнес-требований, Операцию, которую можно выполнить одним
Запросом, ТСП также может выполнить, разбив ее на два шага, каждый из которых представляет отдельную
Операцию.
Оплата товара
На первом этапе, для холдирования средств на счете Карты Плательщика, ТСП инициирует Операцию типа
AUTHORIZE. Затем, позднее, ТСП осуществляет второй этап — списание средств с указанного счета с
помощью Операции типа COMPLETE.
Такой подход можно использовать в тех случаях, когда бизнес-процесс ТСП предполагает получение
предварительных финансовых гарантий от Плательщика о том, что на счёте его Платёжной карты достаточно
средств на момент фактического выполнения Заказа. Такой способ используется при бронировании отелей,
покупке авиабилетов, прокате автомобилей и т.д.
Пример оплаты гостиницы:
1. На первой стадии (до заселения в номер) выполняется Операция AUTHORIZE. Средства на счёте
Карты Плательщика холдируются.
2. На второй стадии (через несколько дней, по выезду из номера) выполняется Операция COMPLETE
— списание средств с указанного счёта Карты.
Перевод с Карты на Карту
На первом этапе проводится Операция типа P2PDEBIT, с Платёжной карты отправителя списываются
средства. Затем, позднее, происходит второй этап: выполняется Операция типа P2PCOMPLETE, по
результатам которой деньги перечисляются на счет Карты получателя. При этом, отправитель контролирует
возможность получения средств с помощью секретного кода, который генерируется на первом этапе и
предоставляется отправителю. Код требуется для проведения второго этапа.
Такой подход можно использовать в тех случаях, когда бизнес-процесс ТСП предполагает, что отправитель
и получатель средств должны сами, отдельно друг от друга по месту и времени, заполнить реквизиты своих
 Примечание: стандартный (одностадийный) подход предполагает, что ТСП для оплаты товара
инициирует Операцию типа PURCHASE. В процессе её выполнения производится сразу и проверка
наличия денежных средств на счете Платёжной карты Плательщика, и их списание со счета.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 15 | 140
Платёжных карт. Например, в бизнес-логике ТСП предполагается, что отправителю известны только
контактные данные получателя средств — телефон или email, либо между Операцией списания средств с
Карты отправителя и отправкой их на Карту получателя требуется наличие задержки во времени.
Оповещение плательщика об операциях
При правильно заполненных параметрах Заказа или Операции, ПЦ позволяет отправлять Плательщику
следующие уведомления:
• Выставление счета на оплату. ТСП может направлять Плательщику email- или sms-уведомления о
зарегистрированном для Плательщика Заказе, требующем оплаты. В такие уведомления ПЦ
автоматически добавляет ссылки для вызова платежных страниц;
• Чек по совершённой Операции. По умолчанию, ПЦ отправляет Плательщику email с результатами
проведенной Операций на адрес, указанный при оформлении платежа;
• Предупреждение о грядущем списании. По умолчанию, в рамках зарегистрированного
автоплатежа, за три дня до совершения очередной Операции ПЦ отправляет email с напоминанием
о предстоящем списании;
• Уведомление о переводе на карту. Email-уведомления также могут быть отправлены получателю
денежных средств при проведении Операций P2PTRANSFER, P2PCOMPLETE, P2PCREDIT — о
получении или возможности получения средств.
Отчеты для ТСП об операциях
При правильно заполненных данных в Личном кабинете, ПЦ позволяет настроить следующие уведомления
в адрес ТСП:
• Отчет об операциях за период. По итогам дня или месяца ПЦ отправляет на email ТСП сообщение
со вложенным xls-документом. Этот документ содержит список Операций Плательщиков в ТСП за
период (ежедневно, ежемесячно). Если за отчетный период Операций нет, сообщение не
формируется;
• Email-уведомление о совершённой Операции. По завершении каждой Операции, ПЦ отправляет на
email ТСП сообщение с результатами проведения Операции Плательщика в ТСП. Если при
обработке Запроса на проведение Операции возникает ошибка, и Операция не регистрируется, то
уведомление не формируется;
• Уведомление на url о совершённой Операции. По завершении каждой Операции, ПЦ отправляет на
url ТСП xml-сообщение с результатами проведения Операции Плательщика в ТСП. При этом:
o ПЦ отправляет уведомление методом HTTP POST. Формат сообщения см. Приложение №1, п.2;
o После отправки уведомления, ПЦ ожидает от ИС ТСП ответ в виде сообщения “ok”
(text/plain) в течение 5 секунд, после чего обрывает соединение (поэтому рекомендуется
сначала ответить ПЦ, а потом выполнять бизнес логику на стороне ТСП). Если ответа нет, ПЦ
делает ещё две попытки отправить уведомление с интервалом в 5 минут;
o Уведомление содержит цифровую подпись, позволяющую проверить подлинность отправителя;
o Если при обработке Запроса на проведение Операции возникает ошибка, и Операция не
регистрируется, то уведомление не формируется.
 Примечание: стандартный (одностадийный) подход предполагает, что ТСП формирует Запрос на
проведение Операции типа P2PTRANSFER, при успешном проведении которой сразу производится
списание денежных средств со счета Платёжной карты отправителя средств и перевод их на Платёжную
карту получателя.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 16 | 140
Использование токенов
1. В ПЦ реализована возможность токенизации карточных данных. Токен Платёжной карты — это
цифробуквенная последовательность, заменяющая собой данные Карты Плательщика в рамках
взаимодействия ИС ТСП и ПЦ.
2. Функционал использования токенов для взаимодействия ИС ТСП и ПЦ предоставляется по
согласованию с Оператором.
3. Для получения токена Платёжной карты Плательщика, ТСП необходимо провести хотя бы одну
успешную Операцию со вводом полных карточных данных.
4. Механизм выдачи токена в общем случае можно описать следующим образом: если при проведении
Операция завершилась успехом (получен статус APPROVED), то ПЦ сохраняет на своей стороне
полученные в Запросе карточные данные и в ответе для ИС ТСП возвращает токен,
соответствующий сохраненным данным.
5. Если после проведения успешной Операции обнаружено, что в ПЦ уже зарегистрирована карта с
тем же номером, но другим сроком действия, токен такой карты перевыпускается.
6. При проведении Операций, указание токена заменяет ввод карточных данных, переданных
Плательщиком ранее в другой операции.
Работа с рекуррентными платежами (Recurring Payments, автоплатежи)
1. В общем случае, суть проведения Рекуррентных платежей состоит в создании с некой
периодичностью операций типов RECURRING и RECURRING_BY_QR, платежные реквизиты которых
полностью повторяют платежные реквизиты какой-то успешной «эталонной» Операции (PURCHASE,
AUTHORIZE с необязательной COMPLETE или PURCHASE_BY_QR). Операции RECURRING и
RECURRING_BY_QR выполняются без участия Плательщика, но с его согласия, предварительно
полученного ТСП.
2. Функционал использования Рекуррентных платежей при взаимодействии ИС ТСП и ПЦ
предоставляется по согласованию с Оператором.
3. ПЦ позволяет проводить Рекуррентные платежи для Операций по Картам и через СБП (см. п. 10).
4. Рекуррентные платежи в ПЦ можно провести только в рамках Заказа с заданным значением
параметра recurring_period. Если этот параметр задан, то ПЦ помечает Заказ как регулярный и
позволяет в рамках него провести несколько успешных операций PURCHASE. ТСП необходимо
запомнить ID Заказа, т.к. работа с регулярными платежами осуществляется только через этот ID.
Возможные значения параметра recurring_period приведены ниже. Остальные настройки
Рекуррентного платежа и их описание можно посмотреть в соответствующем разделе параметров
Запроса webapi/Register.
Значение Описание
0
Нет периодичности списания. Инициация Рекуррентных платежей на
стороне ИС ТСП.
1, 2, 3, …28 Списание по 1-ым, 2-ым, ..., 28-ым числам каждого месяца.
32 Списание в последний календарный день месяца.
-1, -2, -3, … -7
Списание еженедельно по понедельникам, вторникам, средам, четвергам,
пятницам, субботам, воскресеньям.
-10 Списание ежедневно.
5. Для получения возможности выполнять Рекуррентные платежи в рамках зарегистрированного
Заказа, его необходимо активировать. Для этого проведите успешную операцию типа PURCHASE,
AUTHORIZE (с последующей необязательной COMPLETE) или PURCHASE_BY_QR. Если первая
операция прошла неудачно (статус Операции не APPROVED), то Рекуррентный платёж не
активируется и списания выполняться не будут.
6. ПЦ позволяет проводить Рекуррентные платежи:
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 17 | 140
• с инициацией списаний на стороне ПЦ (recurring_period отличен от 0, списания происходят на
основании периодичности, указанной при регистрации Заказа, см. таблицу выше);
• с инициацией списаний на стороне ИС ТСП (recurring_period = 0, график списаний ведется на
стороне ТСП).
7. Если ТСП планирует инициировать Рекуррентные платежи на своей стороне, то номер Заказа,
регистрируемого для проведения Рекуррентных платежей, следует сохранить в ИС ТСП.
8. Если параметры Рекуррентных платежей не указаны в Запросе webapi/Register, то ПЦ выставляет
значения по умолчанию. При регистрации Заказа им будут присвоены следующие значения:
• error_period = 1, т.е. время до следующей попытки выполнить регулярный платёж. При провале
выполнения, следующая попытка будет осуществлена через 1 сутки;
• error_number:
o Если recurring_period отличен от 0, то error_number присваивается значение 3, т.е.
система пытается выполнить регулярную операцию 3 раза с интервалом error_period;
o Если recurring_period = 0, то error_number не устанавливается, т.е. количество
неуспешных попыток выполнения Операции списания Рекуррентного платежа не
ограничивается системой.
• remind_days_before = 0, т.е. система не отправляет напоминания на электронную почту
Плательщика о предстоящем списании;
• start_date — не устанавливается, т.е. система считает, что дата начала регулярного Заказа равна
дате первой операции;
• end_date — не устанавливается, т.е. система считает, что регулярный Заказ бессрочный.
9. Если после активации Заказа recurring_period не равен 0, то ПЦ включает Заказ в планировщик
формирования Рекуррентных платежей. Этот планировщик ежедневно анализирует настройки
каждого активного Заказа, чье значение recurring_period отлично от 0, на предмет необходимости
выполнить очередную попытку списания Рекуррентного платежа по этому Заказу. Если
планировщик выявляет, что платеж должен быть списан, то соответствующая Операция
формируется автоматически, без каких-либо дополнительных действий со стороны Плательщика и
ТСП. При этом:
• Сумма Рекуррентного платежа равна сумме Заказа (однако, сумму можно изменить Запросом
на изменение параметров Рекуррентного платежа);
• По аналогии с проведением обычных Операций типа PURCHASE, при проведении Операции
списания Рекуррентного платежа (тип RECURRING), ПЦ формирует уведомления для ТСП о
проведенной Операции в соответствии с настройками в Личном кабинете ТСП;
• Если при попытке списать Рекуррентный платеж от эмитента получен ответ «Карта просрочена»
или «Карта украдена», то такой Заказ деактивируется – все последующие попытки списания
Рекуррентного платежа по нему прекращаются вне зависимости от настроек Рекуррентного
платежа в Заказе.
10. Рекурренты через СБП. Для получения возможности выполнять Рекуррентные платежи через СБП (с
помощью QR-кода) помимо успешной «эталонной» операции PURCHASE_BY_QR требуется согласие
плательщика на привязку счёта списания к ТСП. Согласие на привязку может быть запрошено
приложением банка как на форме СБП до проведения операции, так и после успешного проведения
операции. Если согласие плательщика не получено, то Рекуррентный платёж не активируется и
списания выполняться не будут.

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 18 | 140
Основные принципы работы с фискальными данными
Для формирования кассовых чеков в ПЦ используется параметр fiscalData (base64-кодированный JSON) —
фискальные данные.
Фискальные данные передаются в следующих случаях:
• В запросе webapi/Register при создании заказа;
• Если при двухстадийной оплате сумма фактического списания отличается от захолдированной
ранее суммы, следует еще раз передать фискальные данные в запросе webapi/Complete с учетом
изменений;
• Для проведения частичного возврата (webapi/Reverse) передайте позиции, которые должны
остаться в чеке, по аналогии с тем, как отправляли данные при создании заказа.
 Примечание: на операцию холдирования средств (webapi/Authorize) чек не формируется.
Формат отправки фискальных данных с помощью параметра fiscalData описан в отдельной документации
Фискализация (предоставляется по запросу).
 Важно: если фискальные данные при частичном возврате (webapi/Reverse) или частичном завершении
оплаты (webapi/Complete) не были указаны, то чек не будет сформирован и добавить данные будет
невозможно.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 19 | 140
Запросы к ПЦ
Запрос webapi/Register — РЕГИСТРАЦИЯ ЗАКАЗА
Используйте Запрос webapi/Register для регистрации Заказа в ПЦ. Запрос выполняется в режиме обмена
данными «сервер-сервер», редирект на Платёжные страницы не используется.
В случае затруднений с заполнением полей для платежа по свободным реквизитам, ориентируйтесь на
правила заполнения платежного поручения. Названия параметров этого блока идентичны названиям полей
платежного поручения.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 1. Параметры запроса webapi/Register
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
amount Целое (12) Сумма заказа в минимальных единицах
валюты. Для рублей — копейки. 1000
currency Целое (3) Код валюты по ISO4217
(643 для RUB; 978 для EUR; 840 для USD).
643
description Строка (1000) Описание Заказа. iPhone 4S
signature Строка (255)
Цифровая подпись Запроса. В
формировании подписи участвуют
параметры: sector, amount, currency,
password в указанном порядке, см.
Приложение №2.
Обязательные параметры при условии перевода на иностранные карты (P2PTRANSFER)
address Строка (100)
Адрес Плательщика. Общий формат:
название улицы, номер дома, номер
квартиры/офиса.
Для P2PTransfer заполняйте латиницей.
ул. Широкая, д.
2, кв. 36
city Строка (100)
Название населённого пункта Плательщика
(города, посёлка и т.д.).
Для P2PTransfer заполняйте латиницей.
СанктПетербург
post_code Строка (100) Индекс Плательщика (ZIP code). 197022
Необязательные параметры
lang Строка (2)
Язык отображения Платёжных страниц.
Представлен двухсимвольным кодом.
Возможные варианты: RU, EN (другие
варианты возможны после согласования).
По умолчанию берется из настроек учетной
записи ТСП.
EN
reference Строка (100)
Номер Заказа на стороне ТСП (в ИС ТСП).
Если не указан, то создаётся
автоматически.
12345ABC
life_period Целое (9)
Время жизни Заказа в секундах — период,
в течение которого разрешена оплата
Заказа. Если не указан, то берется из
системных настроек ПЦ (по умолчанию — 3
месяца).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 20 | 140
fee Целое (12)
Эквайринговая комиссия в минимальных
единицах валюты. Для рублей — копейки.
Взимается с Плательщика дополнительно к
основной сумме Заказа. 200
 Предупреждение: порядок
использования данного параметра
необходимо согласовать с Оператором.
url Строка (500)
Адрес страницы на стороне ТСП, на
которую по завершении Операции
переводится Плательщик вместо показа
ему типового чека ПЦ. При переводе
Плательщика на адрес из url, ПЦ также
передает на этот адрес идентификаторы
Заказа и Операции в виде GET-параметров.
Значение параметра необходимо заполнять
полностью, с указанием префикса (http://
или https://).
http://www.so
mesite.com/acc
ept.jsp
failurl Строка (500)
Адрес страницы на стороне ТСП, на
которую переводится Плательщик в случае
неуспешного окончания проведения
Операции (когда статус Операции отличен
от APPROVED, или Операция не
сформирована по причине какой-либо
ошибки). При переводе Плательщика на
адрес из failurl, ПЦ также передает на него
идентификаторы Заказа и Операции и код
ошибки (при наличии) в виде GETпараметров.
Если параметр failurl не указан, ПЦ считает
его равным значению url.
Значение параметра необходимо заполнять
полностью, с указанием префикса (http://
или https://).
http://www.so
mesite.com/Fai
l.jsp
notify_url Строка (500) URL для уведомлений об операциях по
данному заказу (не более одного URL).
comment Строка (100) Комментарий к заказу. Используется при
проведении операции webapi/P2PDebit.
email Строка (100)
Адрес электронной почты Плательщика.
По умолчанию, ПЦ использует значение
email для отправки Плательщику
уведомлений о результатах проводимых в
рамках Заказа Операций.
mail@somesit
e.com
phone Строка (100)
Телефон Плательщика. ПЦ использует
значение phone для оповещения
Плательщика о результатах проводимых в
рамках Заказа Операций.
79219999999
email2 Строка (100)
Адрес электронной почты получателя
денежных средств. ПЦ использует значение
email2 для оповещения получателя средств
о совершенном в его пользу переводе,
либо для отправки уведомления о
возможности получить средства в рамках
выполнения отложенного перевода (см.
описание Запросов webapi/P2PDebit и
webapi/P2PComplete).
mail@somesit
e.com
phone2 Строка (100) Телефон получателя денежных средств. 79219999999
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 21 | 140
ПЦ использует значение phone2 для
оповещения получателя средств о
совершенном в его пользу переводе, либо
для отправки уведомления о возможности
получить средства в рамках выполнения
отложенного перевода (см. описание
Запросов webapi/P2PDebit и
webapi/P2PComplete).
country Строка (2) Двухсимвольный код страны Плательщика
в соответствии с ISO 3166-1.
RU
region Строка (100)
Название региона (области, края)
Плательщика. Для США указывается
название штата.
Ленинградская
обл.
bank_name Строка (100) Наименование банка Плательщика. Сбербанк
first_name Строка (100) Имя Плательщика. Иван
last_name Строка (100) Фамилия Плательщика. Петров
patronymic Строка (100) Отчество Плательщика. Иванович
fio Строка (255) Фамилия Имя Отчество получателя
денежных средств.
Иванов Петр
Сидорович
fiscalData JSON в base64
Фискальные данные. Подробные
инструкции по использованию фискальных
данных см. в документации Фискализация.
acc_number Строка (50) Номер счета получателя денежных средств. 408178101234
56789012
contract Строка (100) Номер договора получателя денежных
средств.
1234567890
ps Целое (2)
Платёжная система, используемая для
оплаты. Возможные значения параметра:
0 (по умолчанию) — не установлена;
1 — Visa;
2 — MasterCard;
8 — Maestro;
10 – MIR;
11 — СБП;
12 — Uzcard;
13 — JCB;
14 — оплата со счёта мобильного
телефона;
16 — HUMO;
17 — CHUP.
1
receipt_type Целое (2)
Номер шаблона уведомления,
отправляемого на email Плательщику. По
умолчанию используется первый
(стандартный) шаблон.
 Предупреждение: применяется по 2
согласованию с Оператором, только если
бизнес-требования ТСП подразумевают
использование разных шаблонов
уведомлений.
notify_customer Целое (1)
Признак, отвечающий за необходимость
отправки Плательщику email-уведомления
о зарегистрированном Заказе со ссылкой
на оплату. Возможные значения: 0, 1.
0 (значение по умолчанию) – уведомление
не отправляется;
1 – требуется отправить уведомление.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 22 | 140
month Целое (2)
Месяц срока действия Карты Плательщика.
Используется для упрощения ввода
параметров Карты в режиме оплаты через
IVR.
year Целое (4)
Год срока действия Карты Плательщика.
Используется для упрощения ввода
параметров Карты в режиме оплаты через
IVR.
mode Целое (1)
Режим ответа на Запрос webapi/Register.
Возможные значения: 0, 1.
0 (значение по умолчанию) – полный ответ
(xml-сообщение, см. Приложение №1);
1 – сокращенный ответ (только ID
зарегистрированного Заказа в формате
text/plain).
originator Целое (19)
ID Операции в ПЦ (webapi/Purchase,
webapi/Authorize), на основании которой
был получен токен карты. Наличие данного
параметра увеличивает конверсию
регулярных платежей и требуется при
возникновении претензий со стороны
Плательщиков.
32111
multipaymentData Строка (JSON)
Значение для передачи данных обо всех
дополнительных платежах в формате JSONобъекта с ключом payments.
Для каждого из платежей должны быть
указаны:
Обязательно:
• paymentNum - уникальное значение
партнёра для сплитования платежа;
• amount – сумма;
• fee - комиссия;
• currency - валюта;
• description – описание.
При наличии:
• reference – референс;
• fiscalPositions - фискальные позиции;
• fiscalData - данные для регистрации по
кассе (в base64url).
{"payments":[{"
paymentNum":
1,"amount":950
0,"fee":0,"curre
ncy":643,"descr
iption":"number
1"},{"paymentN
um":2,"amount"
:2500,"fee":0,"c
urrency":643,"d
escription":"nu
mber2"}]}
notify_sms true/false
Опция, отвечающая за необходимость
отправки sms-уведомления (счета) со
ссылкой на оплату. Возможные значения:
false (значение по умолчанию) — не
отправлять sms;
true — отправить sms.
false
 Предупреждение: использование опции
предоставляется по согласованию с
Оператором.
Необязательные параметры — настройки платежа по свободным реквизитам
P008-1 Строка (80) Наименование Плательщика.
P008-2 Строка (80) Адрес Плательщика.
P014 Целое (9) БИК получателя (ровно 9 цифр).
P015 Целое (20)
Корр. счёт банка получателя. Номер
банковского счёта, входящего в состав
единого казначейского счёта (ровно 20
цифр).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 23 | 140
P016 Строка (160) Наименование Получателя.
P017 Целое (20) Счет получателя (ровно 20 цифр).
P018 Целое (2)
Вид операции. Возможные значения:
01 — платежное поручение;
06 — инкассовое поручение;
02 — платежное требование.
P020 Целое (1)
Назначение платежа. Заполняется при
указании банка. Возможные значения:
1 — Заработная плата, премии, больничные
листы и дивиденды сотрудникам (возможно
удержание не более 50%);
2 — Периодические выплаты, алименты
(удержания отсутствуют);
3 — Компенсация вреда здоровью
(удержание только на оплату алиментов);
4 — Разовые выплаты: командировочные,
выплаты на погребение (удержание 0%);
5 — Разовый доход (удержания в пользу
алиментов, возмещения вреда здоровью
или потери кормильца).
P021 Целое (1)
Очередность платежа. Отражает порядок
перечисления платежей и зависит от их
характера. Возможные значения:
1 — Алименты и платежи по судебным
решениям о возмещении вреда жизни и
здоровью;
2 — Авторские права, заработная плата и
выходные пособия сотрудникам;
3 — Заработная плата, налоговые
обязательства и погашение
задолженностей по налогам и взносам в
фонды;
4 — Средства по остальным
исполнительным документам судебных
приставов;
5 — Средства прочим контрагентам в
соответствии с порядком очерёдности.
P022 Целое (25)
УИН (20 или 25 цифр).
Если отсутствует —проставьте 0.
P024 Строка (210) Назначение платежа.
P060 Целое (12)
ИНН Плательщика (10 или 12 цифр).
Если отсутствует —проставьте 0.
P061 Целое (12)
ИНН Получателя (10 или 12 цифр).
Если отсутствует —проставьте 0.
P101 Целое (2) Статус Плательщика.
P102 Целое (9) КПП Плательщика (9 цифр).
Если отсутствует —проставьте 0.
P103 Целое (9) КПП Получателя (9 цифр).
Если отсутствует —проставьте 0.
P104 Целое (20) КБК Получателя.
P105 Целое (11) ОКТМО (8 или 11 цифр).
P106 Строка (10) Основание платежа.
P107 Строка (10) Налоговый период.
P108 Строка (16) Номер документа, который является
основанием платежа, либо 0.
01;580011122
2
P109 Строка (10) Дата документа (формат yyyy.MM.dd).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 24 | 140
Если отсутствует —проставьте 0.
P110 Строка (10) Тип документа.
Необязательные параметры — настройки рекуррентных платежей
recurring_period Целое (3) Код периода для Рекуррентных платежей
(см. Работа с регулярными платежами). 12
error_period Целое (3)
Интервал времени в днях, через который
необходимо повторить попытку выполнить
Рекуррентный платёж при неуспешной
предыдущей. По умолчанию равен 1.
2
error_number Целое (3)
Допустимое количество неуспешных
попыток выполнения Операции списания
Рекуррентного платежа. После достижения
счетчиком неуспешных попыток значения
error_number, попытки списать этот платеж
прекращаются. По умолчанию равно 3
(если recurring_period отличен от 0).
4
 Примечание: если recurring_period = 0 и
error_number не был передан в запросе, то
количество неуспешных попыток
выполнения Операции списания
Рекуррентного платежа не ограничивается.
continuing_recurring true/false
Опция, действующая совместно с
error_number. По умолчанию равна false.
После достижения счетчиком неуспешных
попыток значения error_number:
• Если continuing_recurring = false,
текущий и все предстоящие
Рекуррентные платежи Заказа
перестают списываться;
• Если continuing_recurring = true,
текущий (неуспешный) Рекуррентный
платеж пропускается, счетчик
неуспешных попыток обнуляется, ПЦ
ожидает наступления следующего по
графику Рекуррентного платежа
Заказа.
false
remind_days_before Целое (2)
Количество дней до списания
Рекуррентного платежа, когда необходимо
отправить Плательщику уведомление на
электронную почту с напоминанием о
предстоящем списании. Принимает
значения от 0 до 10.
По умолчанию равен 0 (не уведомлять).
3
start_date Строка (20)
Дата начала периода действия
Рекуррентного платежа в формате:
yyyy.MM.dd HH:mm:ss
Если значение не указано, оно будет
считаться равным 00:00:00 дня, следующего
за днем совершения первой успешной
Операции Заказа.
2015.07.01
00:00:00
end_date Строка (20)
Дата окончания периода действия
Рекуррентного платежа в формате:
yyyy.MM.dd HH:mm:ss
Если значение не указано, Рекуррентный
платеж будет считаться бессрочным.
2017.07.01
23:00:00
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 25 | 140
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Register
ИС ТСП отправляет Запрос webapi/Register в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/Register HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 241
Content-Type: application/x-www-form-urlencoded
signature=YzY4MzU4MmI0NDI4MzJjYTMxN2NjM2Q5NDhjZTlmM2Q=&sector=1&amount=152000&curr
ency=643&email=mail@somesite.com&reference=578997456-
987&description=%D1%82%D0%B5%D0%BB%D0%B5%D1%84%D0%BE%D0%BD%20 Nokia
3310&url=http://www.somesite.com/accept.jsp&failurl=http://www.somesite.com/fail.j
sp
После обработки Запроса webapi/Register, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан (параметр mode не равен 1). Приходит сообщение в формате
xml с параметрами зарегистрированного заказа (описание см. Приложение №1, п.1);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<order>
…
</order>
(описание формата см. Приложение №1, п.1)
• Вариант 2. Запрос успешно обработан (параметр mode равен 1). Приходит ID заказа в формате
text/plain;
HTTP/1.1 200 OK
Content-Type: text/html;charset=ISO-8859-1
235422
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 26 | 140
Запрос webapi/Purchase — ОПЛАТА ПО КАРТЕ
Используйте Запрос webapi/Purchase для проведения Операции PURCHASE. Запрос выполняется с
перенаправлением (редиректом) Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в Запросе. Сумма и комиссия Операции в
Запросе не задаются, они берутся из Заказа (параметры amount и fee Запроса webapi/Register).
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 2. Параметры запроса webapi/Purchase
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе) в указанном порядке: sector, id, payer_id,
pan_token_sha256, password. См. Приложение №2.
Необязательные параметры
cvc Строка (3)
Проверочный код Карты Плательщика
CVV2/CVC2/ППК2. Для Карт Maestro может
отсутствовать.
111
get_token Целое (1)
Запрос на предоставление токена (см. Работа с
токеном карты) использованной в Операции
Платёжной карты в составе уведомления на url.
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
1
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
token Строка (255)
Токен ранее зарегистрированной Платёжной карты
Плательщика. Позволяет Плательщику не вводить
все реквизиты Карты при повторной оплате, но при
этом поддерживает работу с 3DS (см. Работа с
токеном карты).
action Строка (3)
Если action=pay, то ПЦ попытается провести
Операцию на основании параметров Запроса, без
отображения Платёжной формы Плательщику. При
нехватке данных для проведения Операции,
Плательщику выводится Платёжная форма для
заполнения недостающих данных.
pay
payer_id Строка (100) Идентификатор клиента на стороне ТСП. 234234
pan_token Строка (20)
Значение для передачи номера карты, по которой
будет проводиться операция. Если передано,
пользователь не сможет указать другую карту.
pan_token_sha256 Строка (64)
Значение хеша, взятого по алгоритму sha256 от
значения pan_token. Используется для включения в
подпись запроса.
pan Строка (20) Номер карты Плательщика.
month Целое (2) Месяц срока действия Карты Плательщика. 8
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 27 | 140
year Целое (4) Год срока действия Карты Плательщика. 2025
save_card Целое (1)
Возможные значения: 0, 1.
0 — не сохранять карту;
1 — сохранить карту.
В случае, если save_card == 1, и в запросе передан
параметр payer_id, то при обработке транзакции в
ПЦ сохраняется связка sector, payer_id и карты. При
следующем вызове платежной страницы с такими
значениями sector и payer_id в поле номера карты
станет доступен для выбора номер карты из
сохраненной ранее связки (вместе с другими
картами, использовавшимися с такой парой sector и
payer_id).
applePaymentData JSON-объект
в base64
Платежные данные Apple Pay в формате base64-
кодированной строки JSON. Значение параметра
paymentData, указанного в платежном токене Apple
(параметр paymentData внутри объекта класса
PKPaymentToken). Имеет более высокий приоритет
над полем applePaymentToken.
Параметр анализируется только вместе action=pay.
applePaymentToken Строка (255)
JSON-объект с платёжными данными Apple Pay.
Значение платежного токена, полученного от Apple
(объект класса PKPaymentToken).
Параметр анализируется только вместе action=pay.
googleCryptogram JSON-объект
в base64)
Платежные данные Google Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Google. Параметр
анализируется только вместе action=pay.
yandexCryptogram JSON-объект
в base64
Платежные данные Yandex Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Yandex. Параметр
анализируется только вместе action=pay.
samsung_ref_id Строка (255)
Платёжные данные Samsung Pay. Значение
уникального референса запроса на получение
криптограммы карты. Параметр анализируется
только вместе action=pay.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Purchase
ИС ТСП перенаправляет Плательщика методом HTTP GET или POST на Платёжную форму ПЦ с
использованием Запроса webapi/Purchase для ввода карточных данных:
POST /webapi/Purchase HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NTVjMDVlYmFlM2E1YmY1NmIxNTA3MzA2ZjZiNTU5NTQ=&sector=1&id=70365
В процессе обработки данных, полученных от Плательщика, а также в соответствии с настройками учетной
записи ТСП в ПЦ, Плательщик может быть перенаправлен на страницу прохождения 3DS аутентификации.
По результатам выполнения в ПЦ Операции PURCHASE и в зависимости от значений параметров url и failurl,
указанных ранее при регистрации Заказа (Запрос webapi/Register), Плательщику будет показан один из
следующих вариантов итоговой страницы:
• Вариант 1. Если параметр Заказа url не заполнен, Плательщику выводится типовая форма экранного
чека ПЦ, либо сообщение об ошибке.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 28 | 140
HTTP/1.1 200 OK
(HTML c типовой формой экранного чека ПЦ)
• Вариант 2. Если параметры Заказа url / failurl заполнены, и Операция в ПЦ проведена без ошибок,
Плательщик методом HTTP GET перенаправляется на страницу, адрес которой был указан в Запросе
webapi/Register в значении параметра url (если операция одобрена), либо failurl (если получен
отказ).
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ;
например, на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code
=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 3. Если параметры Заказа url / failurl заполнены, и при проведении Операции в ПЦ
выявлены ошибки, то Плательщик методом HTTP GET перенаправляется на страницу, адрес которой
был указан в Запросе webapi/Register в значении параметра failurl (если параметр был задан), либо
url (если failurl не был задан).
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
 Важно: если в рамках бизнес-процесса ТСП требуется уточнить результат Операции (или
удостовериться в его точности) или получить информацию о состоянии Заказа, то ТСП может это сделать,
реализовав на своей стороне дополнительные Запросы webapi/Operation, webapi/Order к ПЦ для
получения детальной информации по нужной Операции или Заказу. Рекомендации использовать
дополнительные Запросы обусловлены требованиями повышения безопасности совершения платежей.
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&erro
r=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 29 | 140
Запрос webapi/Authorize — ХОЛДИРОВАНИЕ СРЕДСТВ НА КАРТЕ
Используйте Запрос webapi/Authorize для проведения Операции AUTHORIZE. Запрос выполняется с
перенаправлением (редиректом) Плательщика на Платёжные страницы ПЦ.
 Важно: выполнение Операции AUTHORIZE влечет за собой не списание средств со счета Плательщика,
а только их блокировку. На некоторый срок средства будут недоступны для распоряжений Плательщика.
Для последующего списания средств, ТСП необходимо инициировать Операцию COMPLETE (Запрос
webapi/Complete) для соответствующей Операции AUTHORIZE.
Максимальный срок блокировки средств по операции AUTHORIZE зависит от настроек Эмитента и правил
Платёжных систем и составляет от 4 до 30 дней. По истечении этого срока, средства на счете Плательщика
будут разблокированы. Однако, даже в этом случае Операция COMPLETE все равно может быть
выполнена.
Ниже перечислены параметры, которые могут быть использованы в Запросе. Сумма и комиссия Операции в
Запросе не задаются, они берутся из Заказа (параметры amount и fee Запроса webapi/Register).
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 3. Параметры запроса webapi/Authorize
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса webapi/Register 12345
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если участвуют в запросе):
sector, id, payer_id, pan_token_sha256, password в
указанном порядке. См. Приложение №2.
Необязательные параметры
cvc Строка (3)
Проверочный код Карты Плательщика
CVV2/CVC2/ППК2. Для Карт Maestro может
отсутствовать.
111
get_token Целое (1)
Запрос на предоставление токена (см. Работа с
токеном карты) использованной в Операции
Платёжной карты в составе уведомления на url.
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
1
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
token Строка (255)
Токен ранее зарегистрированной Платёжной карты
Плательщика. Позволяет Плательщику не вводить
все реквизиты Карты при повторной оплате, но при
этом поддерживает работу с 3DS (см. Работа с
токеном карты).
action Строка (3)
Если action=pay, то ПЦ попытается провести
Операцию на основании параметров Запроса, без
отображения Платёжной формы Плательщику. При
нехватке данных для проведения Операции,
Плательщику выводится Платёжная форма для
заполнения недостающих данных.
pay
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 30 | 140
payer_id Строка (100) Идентификатор клиента на стороне ТСП. 234234
pan_token Строка (20)
Значение для передачи номера карты, по которой
будет проводиться операция. Если передано,
пользователь не сможет указать другую карту.
pan_token_sha256 Строка (64)
Значение хеша, взятого по алгоритму sha256 от
значения pan_token. Используется для включения в
подпись запроса.
pan Строка (20) Номер карты Плательщика.
month Целое (2) Месяц срока действия Карты Плательщика. 8
year Целое (4) Год срока действия Карты Плательщика. 2025
save_card Целое (1)
Возможные значения: 0, 1.
0 — не сохранять карту;
1 — сохранить карту.
В случае, если save_card == 1, и в запросе передан
параметр payer_id, то при обработке транзакции в
ПЦ сохраняется связка sector, payer_id и карты. При
следующем вызове платежной страницы с такими
значениями sector и payer_id в поле номера карты
станет доступен для выбора номер карты из
сохраненной ранее связки (вместе с другими
картами, использовавшимися с такой парой sector и
payer_id).
applePaymentData JSON-объект
в base64
Платежные данные Apple Pay в формате base64-
кодированной строки JSON. Значение параметра
paymentData, указанного в платежном токене Apple
(параметр paymentData внутри объекта класса
PKPaymentToken). Имеет более высокий приоритет
над полем applePaymentToken.
Параметр анализируется только вместе action=pay.
applePaymentToken Строка (255)
JSON-объект с платёжными данными Apple Pay.
Значение платежного токена, полученного от Apple
(объект класса PKPaymentToken).
Параметр анализируется только вместе action=pay.
googleCryptogram JSON-объект
в base64)
Платежные данные Google Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Google. Параметр
анализируется только вместе action=pay.
yandexCryptogram JSON-объект
в base64
Платежные данные Yandex Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Yandex. Параметр
анализируется только вместе action=pay.
samsung_ref_id Строка (255)
Платёжные данные Samsung Pay. Значение
уникального референса запроса на получение
криптограммы карты. Параметр анализируется
только вместе action=pay.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Authorize
ИС ТСП перенаправляет Плательщика методом HTTP GET или POST на Платёжную форму ПЦ с
использованием Запроса webapi/Authorize для ввода карточных данных:
POST /webapi/Authorize HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NTVjMDVlYmFlM2E1YmY1NmIxNTA3MzA2ZjZiNTU5NTQ=&sector=1&id=70365
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 31 | 140
В процессе обработки данных, полученных от Плательщика, а также в соответствии с настройками учетной
записи ТСП в ПЦ, Плательщик может быть перенаправлен на страницу прохождения 3DS аутентификации.
По результатам выполнения в ПЦ Операции AUTHORIZE и в зависимости от значений параметров url и
failurl, указанных ранее при регистрации Заказа (Запрос webapi/Register), Плательщику будет показан один
из следующих вариантов итоговой страницы:
• Вариант 1. Если параметр Заказа url не заполнен, Плательщику выводится типовая форма экранного
чека ПЦ, либо сообщение об ошибке.
HTTP/1.1 200 OK
(HTML c типовой формой экранного чека ПЦ)
• Вариант 2. Если параметры Заказа url / failurl заполнены, и Операция в ПЦ проведена без ошибок,
Плательщик методом HTTP GET перенаправляется на страницу, адрес которой был указан в Запросе
webapi/Register в значении параметра url (если операция одобрена), либо failurl (если получен
отказ).
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ; например,
на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное ИС
ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки уведомления
— один раз в 5 минут, но не более трех раз, либо до получения от адресата сообщения “ok” в
формате text/plain.
• Вариант 3. Если параметры Заказа url / failurl заполнены, и при проведении Операции в ПЦ
выявлены ошибки, то Плательщик методом HTTP GET перенаправляется на страницу, адрес которой
был указан в Запросе webapi/Register в значении параметра failurl (если параметр был задан), либо
url (если failurl не был задан).
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&erro
r=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 32 | 140
 Важно: если в рамках бизнес-процесса ТСП требуется уточнить результат Операции (или
удостовериться в его точности) или получить информацию о состоянии Заказа, то ТСП может это сделать,
реализовав на своей стороне дополнительные Запросы webapi/Operation, webapi/Order к ПЦ для
получения детальной информации по нужной Операции или Заказу. Рекомендации использовать
дополнительные Запросы обусловлены требованиями повышения безопасности совершения платежей.
Запрос webapi/AuthorizeInc — УВЕЛИЧЕНИЕ СУММЫ ЗАХОЛДИРОВАННЫХ СРЕДСТВ
Используйте Запрос webapi/AuthorizeInc для проведения Операции AUTHORIZE_INC с целью увеличения
суммы средств, захолдированных ранее Запросом webapi/Authorize. Запрос выполняется в режиме обмена
данными «сервер-сервер», редирект на Платёжные страницы не используется.
Операцию AUTHORIZE_INC можно выполнить только после успешной Операции AUTHORIZE и до
проведения Операции COMPLETE (или REVERSE) в рамках Заказа.
В рамках одного Заказа может быть зарегистрировано несколько Операций AUTHORIZE_INC.
На логическом уровне в ПЦ каждая Операция AUTHORIZE_INC является заменой предыдущей Операции
AUTHORIZE (либо предыдущей AUTHORIZE_INC) с увеличением суммы Операции. Поэтому сумма Операции
AUTHORIZE_INC должна быть не меньше, чем сумма предыдущей успешной Операции AUTHORIZE (либо
AUTHORIZE_INC).
 Предупреждение: Разрешение на использование Запроса предоставляется по согласованию с
Оператором.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 4. Параметры запроса webapi/AuthorizeInc
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
amount Целое (12) Сумма новой Операции в минимальных единицах валюты. Для
рублей — копейки. 15000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD).
643
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, amount, currency, password в указанном
порядке, или sector, id, amount, fee, currency, password, если
параметр fee участвует в запросе. См. Приложение №2.
Необязательные параметры
fee Целое (12)
Эквайринговая комиссия в минимальных единицах валюты. Для
рублей — копейки. Холдируется на счету Плательщика
дополнительно к основной сумме Операции.
Если параметр не указан, значение комиссии будет равно
предыдущему значению, зарегистрированному в Заказе.
Порядок использования данного параметра необходимо
согласовать с Оператором.
111
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 33 | 140
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/AuthorizeInc
ИС ТСП отправляет Запрос webapi/AuthorizeInc в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/AuthorizeInc HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 97
Content-Type: application/x-www-form-urlencoded
signature=ZTNjZDgyOWIzNTM2MTg5YTlhYTMyNmIzMWMyOWUxZjE=&sector=1&id=234694&amount=60
0&currency=643
После обработки Запроса webapi/AuthorizeInc, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции;
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой;
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 34 | 140
Запрос webapi/Complete — ЗАВЕРШЕНИЕ ОПЛАТЫ ПО КАРТЕ
Используйте Запрос webapi/Complete для проведения Операции COMPLETE с целью списания ранее
захолдированных средств. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на
Платёжные страницы не используется.
Операцию COMPLETE можно выполнить только после Операций AUTHORIZE и AUTHORIZE_INC, даже после
истечения срока холдирования средств в банке-эмитенте.
Сумма Операции COMPLETE может отличаться от суммы соответствующей Операции:
• для AUTHORIZE как в меньшую, так и в большую сторону. Это позволяет ТСП произвести списание
средств в объеме фактически оказанных услуг (доставленных товаров и т.д.)
• для AUTHORIZE_INC только в меньшую сторону, т.к. увеличение суммы происходит непосредственно
с помощью AUTHORIZE_INC.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 5. Параметры запроса webapi/Complete
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
amount Целое (12)
Сумма новой Операции в минимальных единицах валюты. Для
рублей — копейки. Значение может отличаться от суммы
соответствующей Операции как в меньшую (AUTHORIZE,
AUTHORIZE_INC), так и большую (только AUTHORIZE) сторону.
15000
 Предупреждение: Возможность списания операцией
COMPLETE суммы большей ранее заблокированной операцией
AUTHORIZE предоставляется по согласованию с Оператором.
По умолчанию данная возможность отсутствует.
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD).
643
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, amount, currency, password в указанном
порядке, см. Приложение №2.
Необязательные параметры
fee Целое (12)
Эквайринговая комиссия в минимальных единицах валюты. Для
рублей — копейки. Данная комиссия взимается с Плательщика
дополнительно к основной сумме Заказа.
111
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Complete
ИС ТСП отправляет Запрос webapi/Complete в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/Complete HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 97
Content-Type: application/x-www-form-urlencoded
signature=ZTNjZDgyOWIzNTM2MTg5YTlhYTMyNmIzMWMyOWUxZjE=&sector=1&id=234694&amount=600&
currency=643
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 35 | 140
После обработки Запроса webapi/Complete, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID-сектора), либо отсутствует одно из обязательных полей. Придет сообщение в формате xml
с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 36 | 140
Запрос gateweb/Payment — ОПЛАТА / ХОЛДИРОВАНИЕ ПО КАРТЕ
Используйте Запрос gateweb/Payment для выполнения Операций PURCHASE/AUTHORIZE. Запрос
выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
 Предупреждение: Данный режим выполнения Операций PURCHASE / AUTHORIZE предоставляется ТСП
после согласования с Оператором, поскольку требует от ТСП соблюдения требований стандартов PCI DSS.
Параметр preauth в Запросе gateweb/Payment отвечает за выбор проводимой операции:
• Для проведения Операции PURCHASE передайте параметр preauth=N;
• Для проведения Операции AUTHORIZE передайте параметр preauth=Y.
По умолчанию, Операция проводится с валютой, суммой и комиссией, указанными, соответственно, в
параметрах currency, amount и fee Заказа. При указании данных параметров в Запросе gateweb/Payment,
Операция будет проводится со значениями, указанными в Запросе.
 Важно: выполнение Операции AUTHORIZE влечет за собой не списание средств со счета Плательщика,
а только их блокировку. На некоторый срок средства будут недоступны для распоряжений Плательщика.
Для последующего списания средств, ТСП необходимо инициировать Операцию COMPLETE (Запрос
webapi/Complete) для соответствующей Операции AUTHORIZE.
Максимальный срок блокировки средств по операции AUTHORIZE зависит от настроек Эмитента и правил
Платёжных систем и составляет от 4 до 30 дней. По истечении этого срока, средства на счете Плательщика
будут разблокированы. Однако, даже в этом случае Операция COMPLETE все равно может быть
выполнена.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 6. Параметры запроса gateweb/Payment
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register.
12345
preauth Строка (1)
Параметр отвечает за тип выполняемой
Операции. Возможные значения: Y, N.
Y — выполняется операция AUTHORIZE,
N — выполняется операция PURCHASE.
Y
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, pan, token,
name, month, year, cvc, amount, currency,
preauth, transaction_id, unique_key, password в
указанном порядке. см. Приложение №2
Условно-обязательные параметры
(обязательно должен присутствовать либо token, либо googleCryptogram,
либо реквизиты карты — параметры pan, month и year)
pan Строка (20) Номер Карты Плательщика.
month Целое (2) Месяц срока действия Карты Плательщика. 8
year Целое (4) Год срока действия Карты Плательщика. 2015
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 37 | 140
token Строка (255)
Токен ранее зарегистрированной Платёжной
карты Плательщика. Позволяет Плательщику не
вводить все реквизиты Карты при повторной
оплате (см. Работа с токеном карты).
googleCryptogram JSON-объект
в base64
Платежные данные Google Pay в формате
base64-кодированной строки JSON. Значение
поля cryptogram, полученного от Google.
Обязательность зависит от настроек учетной записи ТСП в ПЦ
email Строка (100)
Адрес электронной почты Плательщика.
По умолчанию, ПЦ использует значение email
для отправки уведомлений Плательщику о
результатах проводимых в рамках Заказа
Операций.
mail@ex.com
phone Строка (100)
Телефон Плательщика.
Может быть использован ПЦ для оповещения
Плательщика о результатах Операций,
проводимых в рамках Заказа.
79219999999
bank_name Строка (100) Название Эмитента Карты Плательщика. Сбербанк
first_name Строка (100) Имя Плательщика. Иван
last_name Строка (100) Фамилия Плательщика. Петров
address Строка (100) Адрес Плательщика. Общий формат: название
улицы, номер дома, номер квартиры/офиса.
ул. Широкая, д.
2, кв. 36
city Строка (100) Название населённого пункта Плательщика
(города, посёлка и т.д.). Москва
region Строка (100) Название региона (области, края) Плательщика.
Для США укажите название штата.
Ленинградская
обл.
post_code Строка (100) Индекс Плательщика (ZIP code). 111111
country Строка (2) Двухсимвольный код страны Плательщика в
соответствии с ISO 3166-1.
RU
Необязательные параметры
cvc Строка (3)
Проверочный код Карты Плательщика
CVV2/CVC2/ППК2. Для Карт Maestro может
отсутствовать.
111
amount Целое (12) Сумма Операции в минимальных единицах
валюты. Для рублей — копейки. 1000
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978 для
EUR; 840 для USD).
643
fee Целое (12)
Эквайринговая комиссия в минимальных
единицах валюты. Для рублей — копейки.
Взимается с Плательщика дополнительно к
основной сумме Операции. 200
 Предупреждение: порядок использования
данного параметра необходимо согласовать с
Оператором.
get_token Целое (1)
Запрос на предоставление токена (см. Работа с
токеном карты) использованной в Операции
Платёжной карты в составе уведомления на url.
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать
токен;
1 — вернуть токен.
1
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
name Строка (100) Имя на Карте Плательщика. Mr Card Holder
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 38 | 140
md Строка (64)
Значение <MD>, полученное от Банка-эмитента
в результате Запроса 3DS авторизации
(см. ответ на запрос gateweb/Verify).
pares
Строка
(5000)
Значение <PaRes>, полученное от Банкаэмитента в результате Запроса 3DS
авторизации (см. ответ на запрос
gateweb/Verify).
transaction_id Строка (255)
Уникальный идентификатор цепочки 3DS2
запроса (значение <TransactionId> в ответе на
запрос gateweb/Verify).
cres Строка (255)
Значение параметра cres, полученного от
эмитента по итогам проведения
аутентификации на странице ввода
одноразового пароля.
gw_cardholder_ip Строка (255) IP-адрес Плательщика.
gw_resolution Строка (255) Разрешение экрана на устройстве плательщика.
Формат: число + “x” + число
2560x1080
gw_user_agent Строка (255) Значение user-agent браузера Плательщика в
base64-encode.
init_cond Целое (1)
Признак инициатора операции списания
денежных средств. Возможные значения:
1 (по умолчанию) — плательщик указал
карточные реквизиты, реквизиты будут
сохранены;
2 — плательщик запросил оплату по
сохраненным реквизитам;
7 — ТСП запросил оплату по сохраненным
реквизитам.
7
originator Целое (19) ID оригинальной Операции в ПЦ. 123456789
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на
стороне ТСП. При получении ключа ПЦ
выполняет проверку на наличие дубликата
среди обрабатываемых запросов и созданных
операций.
Формат: допустимы цифры [0-9], латинские
буквы [a-zA-Z], дефис и нижнее подчеркивание
[-_].
 Предупреждение: возможность
использования ключа уникальности
осуществляется по согласованию с Оператором.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса gateweb/Payment
ИС ТСП отправляет Запрос gateweb/Payment в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /gateweb/Payment HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 518
Content-Type: application/x-www-form-urlencoded
signature=MmMzM2JiN2VmNjg5NzY0MmJjMDAzM2M3YWY2NGEwNzA=&sector=1&id=234946&pan=43210
98765432109&name=CARDHOLDER
NAME&month=05&year=17&cvc=333&preauth=N&email=zzz@zzz.zz&md=
0165820609523841,12,0000000000002109,05/17,0165820609523841&pares=eJxVkEFuAjEMRa9iZ
d9JQqGlk7csoOxYlR4gyhgmUiaunIB6/A4itKrkjf3t923j5ntKcCUpkXOvbGcUUA48xHzu1edx/7RWG4fH
UYh2HxQuQg4PVIo/E8ShV8ZaY1/Ni3lbLZ8XS6scvouwOgxQNzO7BepHinSTtzyQW6HS
71hnZ7lslX4BNwJmCBiYWAEk2Ua4E4R776FAfwIbDc1oXKUEeC8kUhnmLwdbbrmsWDe3fZUfUXuqNJGH2u3
UVS62sK6naE/h3U/37wA74RbCk=
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 39 | 140
После обработки Запроса gateweb/Payment, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
Запрос webapi/Reverse — ОТМЕНА ОПЕРАЦИИ ОПЛАТЫ
Используйте Запрос webapi/Reverse для проведения Операции REVERSE. Запрос выполняется в режиме
обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
В зависимости от типа отменяемой Операции, времени выполнения Операции REVERSE, а также внутренних
правил работы Эмитента, средства могут быть возвращены Плательщику моментально (например, при
отмене операции AUTHORIZE), либо в течение нескольких дней.
При формировании Операции REVERSE применяются следующие правила:
• Отменяемая Операция — это последняя успешная Операция Заказа одного из следующих типов:
o AUTHORIZE (всех разновидностей)
o COMPLETE
o PURCHASE (всех разновидностей, включая RECURRING)
o P2PDEBIT
• Операции AUTHORIZE и P2PDEBIT можно отменить только на полную сумму Заказа;
• В рамках одного Заказа можно выполнять несколько успешных Операций REVERSE: каждая на
сумму, не превышающую сумму отменяемой Операции;
• Общая сумма успешных Операций REVERSE в одном Заказе не может превышать сумму отменяемой
Операции;
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 40 | 140
• Успешная Операция REVERSE, выполненная для Заказа с настроенным регулярным платежом, кроме
отмены последнего платежа приводит к отключению регулярного платежа. В дальнейшем,
регулярные операции по данному Заказу не генерируются.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 7. Параметры запроса webapi/Reverse
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
amount Целое (12)
Сумма Возврата или Отмены в минимальных единицах валюты.
Для рублей — копейки. 15000
 Предупреждение: Сумма не может быть больше суммы
отменяемого Заказа.
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD).
643
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, id,
amount, currency, unique_key, password в указанном порядке,
см. Приложение №2.
Необязательные параметры
unique_key Строка (50)
Ключ уникальности запроса. Генерируется на стороне ТСП.
При получении ключа ПЦ выполняет проверку на наличие
дубликата среди обрабатываемых запросов и созданных
операций.
Формат: допустимы цифры [0-9], латинские буквы [a-zA-Z],
дефис и нижнее подчеркивание [-_].
 Предупреждение: возможность использования ключа
уникальности осуществляется по согласованию с Оператором.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/Reverse
ИС ТСП отправляет Запрос webapi/Reverse в ПЦ методом HTTP POST. Запрос выполняется в режиме обмена
данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
POST /webapi/Reverse HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 98
Content-Type: application/x-www-form-urlencoded
signature=Y2Q2MGM0ZWNlOWQ4ZTY4ZTExN2JjM2U1MWQ3MjJkNGI=&sector=1&id=125823&amount=9
500&currency=643
После обработки Запроса webapi/Reverse, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 41 | 140
</operation>
(описание формата см. Приложение №1, п.2)
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xml-документ
(описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки уведомления — один раз в
5 минут, но не более трех раз, либо до получения от адресата сообщения “ok” в формате text/plain.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Придет сообщение в формате xml
с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
Запрос gateweb/Verify — ПРОВЕРКА ПОДПИСКИ КАРТЫ НА 3DS
Используйте этот сервис для подготовки данных о подтверждении личности Плательщика (процедура 3DSаутентификации) для запросов gateweb/Payment и gateweb/P2PTransfer. Сервис также поддерживает
проведение неплатежной аутентификации.
 Примечание: на момент проведения аутентификации по протоколу 3DS 2.0 требуется знать, через
какой терминал будет проводиться операция. Чтобы провести аутентификацию на одном секторе и
использовать ее результат в операции другого сектора, передайте параметр oper_sector в Запросе
gateweb/Verify. Этот параметр нужен для указания номера сектора, в котором будет проводиться
операция с использованием результата аутентификации.
Доступ к использованию параметра oper_sector предоставляется по согласованию с Оператором.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 8. Параметры запроса gateweb/Verify
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
amount Целое (12)
Сумма списания с карты Плательщика. Должна
равняться сумме Заказа, сложенной с суммой
эквайринговой комиссии (сумма значений полей
amount и fee Заказа).
8000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для
EUR; 840 для USD).
643
name Строка (20) Название магазина. Sample Ltd
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 42 | 140
url Строка (50) URL магазина, в полном формате.
http://www.
somesite.ru
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, pan, token,
month, year, pan2, token2, amount, currency,
cres_url, browser_data, oper_sector, password в
указанном порядке, см. Приложение №2.
Обязательные параметры для проведения 3DS2 аутентификации
cres_url Строка (255)
Адрес, на который acs отправит ответ с
сообщением cres после аутентификации
пользователя на странице эмитента.
Заполняется аналогично url.
browser_data Строка
(1000)
Характеристики браузера в формате base64-
кодированной строки JSON. Включают в себя
следующие параметры и их значения:
• accept_header — точное содержание acceptхедеров, полученных от браузера
пользователя;
• ip — IP-адрес браузера плательщика;
• color_depth — глубина цвета экрана
пользователя;
• java_enabled — значение свойства
javaEnabled браузера;
• javascript_enabled — значение свойства
javaScriptEnabled браузера;
• language — язык браузера;
• screen_height — высота экрана из свойств
браузера;
• screen_width — ширина экрана из свойств
браузера;
• time_zone — временная зона браузера в виде
смещения (в минутах) относительно времени
по Гринвичу;
• user_agent — значение user-agent браузера.
Условно-обязательные параметры
(обязательно должен присутствовать либо token, либо googleCryptogram,
либо реквизиты карты — параметры pan, month и year)
pan Строка (20) Номер карты Плательщика.
month Целое (2) Месяц срока действия карты. 05
year Целое (4) Год срока действия карты. 2023
token Строка (255)
Токен ранее зарегистрированной карты.
Позволяет Плательщику не вводить все реквизиты
карты при повторной оплате (см. Работа с
токеном карты).
googleCryptogram JSON-объект
в base64
Платежные данные Google Pay в формате base64-
кодированной строки JSON. Значение поля
cryptogram, полученного от Google. Параметр
анализируется только вместе action=pay.
Необязательные параметры
email Строка (100)
Адрес электронной почты отправителя, на
который высылается письмо с информацией о
результате операции.
mail@some
site.com
phone Строка (100)
Телефон отправителя, необходимый для
исполнения операции или для оповещения
отправителя о результате выполнения операции.
792199999
99
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 43 | 140
oper_sector Целое (19)
Номер сектора, для проведения операции на
котором будут использованы
аутентификационные данные, полученные по
протоколу 3DS2. Если совпадает с sector — не
указывайте.
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register.
12345
pan2 Строка (20) Номер Карты получателя средств.
token2 Строка (255)
Токен ранее зарегистрированной Платёжной
карты, заменяющий Карту получателя перевода.
Позволяет отправителю не вводить номер карты
получателя (см. Работа с токеном карты).
category Строка (2)
Категория запроса. Возможные значения: 01, 02.
01 (по умолчанию) — платежные аутентификации;
02 — неплатежные аутентификации.
fee Целое (12)
Эквайринговая комиссия в минимальных
единицах валюты. Для рублей — копейки.
Взимается с Плательщика дополнительно к
основной сумме Заказа.
200
ПРИМЕР 1 – Обмен с ПЦ в рамках выполнения Запроса gateweb/Verify для 3DS версии 1.0
ИС ТСП отправляет Запрос gateweb/Verify в ПЦ методом HTTP POST. Запрос выполняется в режиме «серверсервер», редирект на Платёжные страницы не используется.
POST /gateweb/Verify HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 157
Content-Type: application/x-www-form-urlencoded
signature=ZGFmZWI0NTYwNDk5YmY0ZWE5NTMyM2ZmY2I4NmZkNTc=&sector=1&pan=43210987654321
09&name=Masato&month=12&year=2020&amount=380&currency=643&phone=79773641393
После обработки Запроса gateweb/Verify, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с результатами
проверки подписки;
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<Verify>
 <CardEnrolled>Y</CardEnrolled>
 <ACSURL>https://acs2.sbrf.ru:443/acs/pa?id=355201087220853</ACSURL>
<PaReq>eJxVUV1zgjAQ/CuMzx1zAakfc2YGxWmZFqqWPvQxEzJKK6ABFP31TVBq+3a7uezt7WG
8VVL671LUSjIMZVnyjbTSZNqjAGPqgONScAcwsnsMl95aHhgepSrTIme0D30bSQf1byW2PK8Yc
nGYBREbgO3YQyQ3iJlUgc8WAFobKJIrxpxnkoVFLs/WkldbqZC0FIqizit1Zo8DB0kHsFY7lu3
7osiQmBrJffCyNlWp/zZpwoK5twn8xSn0v5vw4l2ieHGK4tXpzQ+mSEwHJrySzAbqmHUt6k5cO
gFtueWRZ2Yoo/AAYK0/1nqVK4N7M8jrngGQ/GVQx6lkLjrrHULZ7PWeukPn9lsjudueP5v0RKV
zKUWqkiiK57PD5670vsTr7PiyGjajp1C7vzUZxVSnQl0Yt5IGIDEy5HYuHU97VV39u/YP6C+mm
Q==</PaReq>
 <MD> 1009130351054082,1000,4276*********07,**/**,1009130351054082</MD>
</Verify>
Где:
<CardEnrolled> — параметр, указывающий поддерживает ли карта технологию 3DS:
если Y — требуется выполнение дальнейших действий;
если N — выполняется Запрос gateweb/Payment без соответствующих параметров.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 44 | 140
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
Далее, чтобы выполнить 3DS-аутентификацию на стороне Банка-эмитента, необходимо перенаправить
Плательщика с использованием HTTP POST Запроса в браузере Плательщика на ACSUrl Банка, полученного
в ответе на запрос gateweb/Verify. Для этого рекомендуется отдать в браузер страницу формой с примерно
таким кодом:
<form action='<%=ACSUrl%>' method='POST'>
<input type='hidden' name='PaReq' value='<%=PaReq%>'>
<input type='hidden' name='TermUrl' value='<%=TermUrl%>'>
<input type='hidden' name='MD' value='<%=MD%>'>
</form>
Где:
ACSUrl, PaReq, MD — значения, полученные по результатам Запроса gateweb/Verify;
TermUrl — url сервиса на стороне ТСП, принимающего ответ от Банка-эмитента после
авторизации.
К TermURL могут быть прибавлены параметры для идентификации транзакции после получения обратного
редиректа от Банка-эмитента.
Пример
https://someserver.com/api?id=12323 — id идентифицирует номер транзакции на стороне мерчанта.
В ответе Банка-эмитента, отправленном на TermURL, содержатся параметры MD и PaRes. Передайте их в
неизменном виде в запрос на проведение Операции — gateweb/Payment или gateweb/P2PTransfer. Если в
ответе от Банка отсутствует параметр MD, рекомендуется считать его равным тому, что был получен по
итогам запроса gateweb/Verify.
ПРИМЕР 2 – Обмен с ПЦ в рамках выполнения Запроса gateweb/Verify (задан 3DS2 requestor для МПС карты)
ИС ТСП отправляет Запрос gateweb/Verify в ПЦ методом HTTP POST. Запрос выполняется в режиме «серверсервер», редирект на Платёжные страницы не используется.
POST /gateweb/Verify HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 674
Content-Type: application/x-www-form-urlencoded
signature=OGM0ZjBiZTFlN2Q4ZmI3M2Y4YWU4MDI5ZDRhOGU5Mjg=&sector=1&name=Sample_Ltd&mon
th=05&year=2023&amount=8000&currency=643&cres_url=http://www.somesite.ru/autent&bro
wser_data=eyJhY2NlcHRfaGVhZGVyIjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsa
WNhdGlvbi94bWw7cT0wLjksKi8qO3E9MC44IiwiaXAiOiI5My4xODcuMTkxLjQzIiwiY29sb3JfZGVwdGgi
OiIxNiIsImphdmFfZW5hYmxlZCI6dHJ1ZSwiamF2YXNjcmlwdF9lbmFibGVkIjp0cnVlLCJsYW5ndWFnZSI
6IlJVIiwic2NyZWVuX2hlaWdodCI6IjEwMjQiLCJzY3JlZW5fd2lkdGgiOiIxMjAwIiwidGltZV96b25lIj
oiMTgwIiwidXNlcl9hZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7I
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 45 | 140
HJ2OjY2LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvNjYuMCJ9&oper_sector=13&url=http://www.s
omesite.ru
После обработки Запроса gateweb/Verify, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан, карта подписана на 3DS 2.0. Приходит сообщение в формате
xml с результатами проверки подписки;
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<Verify3DS2>
<ACSURL> https://acsurl.mirconnect.rus/creq </ACSURL>
<ThreeDSVersion>2.1.0</ThreeDSVersion>
<TransactionId>c23b0fe0-85c9-…-a8a47b4b60df</TransactionId>
<TransactionState>C</TransactionState>
<CreQ>eyJ0aHJlZURTU2V … 6IjIuMS4wIn0=</CreQ>
</Verify3DS2>
Где:
<ACSURL> — адрес банка для проведения аутентификации;
<ThreeDSVersion> — версия протокола 3DS2, по которому проводится
аутентификация;
<TransactionId> — идентификатор зарегистрированного на стороне ПЦ запроса на
аутентификацию;
<CreQ> — значение для указания в параметре creq в запросе на ACSURL, если
необходима проверка держателя на сайте эмитента;
<TransactionState> — код статуса, определяющий результат или состояние процесса
аутентификации, сценарий дальнейшего поведения ТСП.
Таблица 9. Возможные значения TransactionState
Значение Расшифровка Дальнейшие действия
Y
Держатель успешно аутентифицирован.
Проверка держателя с помощью
одноразового пароля на сайте эмитента
не требуется.
Переходить к проведению
операции с использованием
TransactionId.
A
Проведена попытка выполнить
аутентификацию.
Аутентификация не выполнена, но есть
доказательство сделанной попытки.
Переходить к проведению
операции с использованием
TransactionId.
C
Необходима проверка держателя на сайте
эмитента.
Продолжить аутентификацию:
перевести держателя на ACSURL с
использованием значения CreQ.
U
Аутентификация не проводилась по
техническим (или другим) причинам.
Транзакцию проводить не
рекомендуется.
N Аутентификация не пройдена. В транзакции отказать.
R
Отказ эмитента в аутентификации.
Прямой запрет проводить операцию.
В транзакции отказать.
• Вариант 2. Запрос успешно обработан, но карта не подписана на 3DS 2.0. Придет xml-сообщение с
результатами проверки подписки (формат аналогичен 3DS 1.0);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<Verify>
 <CardEnrolled>Y</CardEnrolled>
 <ACSURL>https://acs2.sbrf.ru:443/acs/pa?id=355201087220853</ACSURL>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 46 | 140
<PaReq>eJxVUV1zgjAQ/CuMzx1zAakfc2YGxWmZFqqWPvQxEzJKK6ABFP31TVBq+3a7uezt7WG
8VVL671LUSjIMZVnyjbTSZNqjAGPqgONScAcwsnsMl95aHhgepSrTIme0D30bSQf1byW2PK8Yc
nGYBREbgO3YQyQ3iJlUgc8WAFobKJIrxpxnkoVFLs/WkldbqZC0FIqizit1Zo8DB0kHsFY7lu3
7osiQmBrJffCyNlWp/zZpwoK5twn8xSn0v5vw4l2ieHGK4tXpzQ+mSEwHJrySzAbqmHUt6k5cO
gFtueWRZ2Yoo/AAYK0/1nqVK4N7M8jrngGQ/GVQx6lkLjrrHULZ7PWeukPn9lsjudueP5v0RKV
zKUWqkiiK57PD5670vsTr7PiyGjajp1C7vzUZxVSnQl0Yt5IGIDEy5HYuHU97VV39u/YP6C+mm
Q==</PaReq>
 <MD> 1009130351054082,1000,4276*********07,**/**,1009130351054082</MD>
</Verify>
Где:
<CardEnrolled> — параметр, указывающий поддерживает ли карта технологию 3DS:
если Y — требуется выполнение дальнейших действий;
если N — выполняется Запрос gateweb/Payment без соответствующих параметров.
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
Далее, если пришел ответ из Варианта 2, необходимо провести аутентификацию как указано в ПРИМЕРЕ 1.
Если пришел ответ из Варианта 1, необходимо выполнить POST Запрос в браузере Плательщика для
перевода Плательщика на адрес ACSUrl Банка. Для этого рекомендуется отдать в браузер страницу формой
с примерно таким кодом:
<form action='<%=ACSUrl%>' method='POST'>
<input type='hidden' name='creq' value='<%=creq%>'>
</form>
Где:
creq — значение параметра CreQ, полученное по результатам Запроса gateweb/Verify.
Ответ Банка-эмитента с результатами завершения аутентификации отправляется на адрес, указанный в
параметре cres_url, переданном в ПЦ в Запросе gateweb/Verify. Для отправки результатов аутентификации
держателя по 3DS 2.0 необходимо в запросе на проведение Операции gateweb/Payment или
gateweb/P2PTransfer передать параметр transaction_id. Укажите в нем значение параметра TransactionId из
ответа сервиса gateweb/Verify. Опционально в запрос можно включить значение параметра cres,
полученное от эмитента по результатам аутентификации на ACSURL. При получении данного параметра, ПЦ
сверяет его данные с теми, что ПЦ получил от эмитента по итогам проведения аутентификации.

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 47 | 140
Запрос gateweb/CheckVerifyStatus — ПРОВЕРКА СТАТУСА АУТЕНТИФИКАЦИИ
Используйте Запрос gateweb/CheckVerifyStatus для получения итогового результата аутентификации
держателя карты. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные
страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 10. Параметры запроса gateweb/CheckVerifyStatus
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
transaction_id Строка (255)
Уникальный идентификатор цепочки 3DS2 запроса
(значение <TransactionId> в ответе на запрос
gateweb/Verify).
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, transaction_id, cres, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
cres Строка (255)
Значение параметра cres, полученного от эмитента по
итогам проведения аутентификации на странице ввода
одноразового пароля.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса gateweb/CheckVerifyStatus
ИС ТСП отправляет Запрос gateweb/CheckVerifyStatus в ПЦ методом HTTP POST. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
POST /gateweb/CheckVerifyStatus HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 363
Content-Type: application/x-www-form-urlencoded
signature=NGMzYzRkOGM5MmU1YTE1ZjlhNzI1OGYyNzFjMDc5YTg=&sector=893&transaction_id=a
025d8c8-f92a-45ce-8de2-
cd4fcc3f280c&cres=eyJtZXNzYWdlVmVyc2lvbiI6IjIuMi4wIiwibWVzc2FnZVR5cGUiOiJDUmVzIiwi
dGhyZWVEU1NlcnZlclRyYW5zSUQiOiJhMDI1ZDhjOC1mOTJhLTQ1Y2UtOGRlMi1jZDRmY2MzZjI4MGMiLC
JhY3NUcmFuc0lEIjoiYTBkZmYwNWUtN2ZhNS00NTQ3LTk1MzUtMzJhZTViNGVlYTVjIiwidHJhbnNTdGF0
dXMiOiJZIn0'
После обработки Запроса gateweb/CheckVerifyStatus, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<CheckVerifyStatus>
 <TransactionId>a025d8c8-f92a-45ce-8de2-cd4fcc3f280c</TransactionId>
 <LastKnownStatus>С</LastKnownStatus>
 <StatusReason>Waiting for result message from issuer</StatusReason>
</CheckVerifyStatus>
Где:
<TransactionId> — transaction_id из запроса;
<LastKnownStatus> — последний известный результат аутентификации.
Возможные значения: Y, N, A, C, R, Error, No status.
Для расшифровки буквенного статуса см. таблицу 9.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 48 | 140
<StatusReason> — обоснование текущего статуса.
Не возвращается для статусов Y и A.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Придет сообщение в формате xml
с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
Запрос webapi/AlfaPay — ОПЛАТА ЧЕРЕЗ AlfaPay
Используйте запрос webapi/AlfaPay для оплаты с помощью AlfaPay. Запрос выполняется в режиме обмена
данными «сервер-сервер», без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 11. Параметры запроса webapi/AlfaPay
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор платежа (Заказа) в ПЦ. 2231412
preauth Строка (1)
Параметр отвечает за тип выполняемой Операции.
Возможные значения: Y, N.
Y — выполняется операция AUTHORIZE,
N — выполняется операция PURCHASE.
Y
os_type Строка (7)
Тип операционной системы мобильного устройства или
персонального компьютера. Возможные значения:
android — операционная система Android;
ios — операционная система iOS;
other — другая операционная система.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
(если присутствуют в запросе) параметры sector, id,
password в указанном порядке, см. Приложение №2.
Необязательные параметры
phone Строка (12) Телефон Плательщика. 79219999999
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/AlfaPay
ИС ТСП отправляет Запрос webapi/AlfaPay в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/AlfaPay HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 147
Content-Type: application/x-www-form-urlencoded
signature=NThhMzQwYjhlYjAzZGY2OTYwZjYxNGRhNDVmYWI5MjU=&sector=1775&id=1234567&prea
uth=Y&os_type=ios
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 49 | 140
При получении запроса ПЦ проверяет правильность расчета подписи и корректность параметров запроса.
Если есть ошибки — ПЦ возвращает ошибку выполнения запроса.
По окончании работы сервиса:
• При успехе. Приходит xml следующего вида:
<AlfaPay>
<order_id>1009982</order_id>
<order_state>REGISTERED</order_state>
<reference>test</reference>
<operation_id>5587788</operation_id>
<date>2024.01.28 00:23:19</date>
<type>AUTHORIZE</type>
<state>PENDING</state>
<amount>50000</amount>
<currency>643</currency>
<alfapay_url>https://alfa.rbsuat.com/payment/acsRedirect.do?orderId=03e3e
b4c-e799-7b1e-8937-f3f60233a4fb</alfapay_url>
</AlfaPay>
• При ошибке. Приходит xml-сообщение с указанием кода ошибки и расшифровкой (см. Приложение
№1, п.4).
Запрос webapi/PurchaseBySectorCard — ОПЛАТА С ТЕХНИЧЕСКОЙ КАРТЫ СЕКТОРА
Используйте Запрос webapi/PurchaseBySectorCard для проведения оплаты с технической карты сектора.
Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
В случае затруднений с заполнением полей для платежа по свободным реквизитам, ориентируйтесь на
правила заполнения платежного поручения. Названия параметров этого блока идентичны названиям полей
платежного поручения.
Отмена операции производится с помощью сервиса webapi/Reverse, как и для обычной оплаты по карте
(webapi/Purchase).
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 12. Параметры запроса webapi/PurchaseBySectorCard
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, amount, currency,
password в указанном порядке или sector, id,
password, если параметр id участвует в запросе, см.
Приложение №2.
Условно-обязательные параметры (если не указан id)
amount Целое (12)
Сумма Заказа в минимальных единицах валюты.
Для рублей — копейки.
Если указан id Заказа, данное значение
игнорируется.
15000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD).
Если указан id Заказа, данное значение
игнорируется.
643
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 50 | 140
description Строка (1000)
Описание Заказа.
Если указан id Заказа, данное значение
игнорируется.
iPhone12 mini
Необязательные параметры
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register.
12345
reference Строка (100) Номер Заказа на стороне ТСП (в ИС ТСП). Если не
указан, то создаётся автоматически. 12345ABC
email Строка (100)
Адрес электронной почты Плательщика.
По умолчанию, ПЦ использует значение email для
отправки Плательщику уведомлений о результатах
проводимых в рамках Заказа Операций.
mail@somesit
e.com
phone Строка (100)
Телефон Плательщика. ПЦ использует значение
phone для оповещения Плательщика о результатах
проводимых в рамках Заказа Операций.
79219999999
country Строка (2) Двухсимвольный код страны Плательщика в
соответствии с ISO 3166-1.
RU
region Строка (100) Название региона (области, края) Плательщика. Для
США указывается название штата.
Ленинградская
обл.
bank_name Строка (100) Наименование банка Плательщика. Сбербанк
first_name Строка (100) Имя Плательщика. Иван
last_name Строка (100) Фамилия Плательщика. Петров
patronymic Строка (100) Отчество Плательщика. Иванович
fio Строка (255) Фамилия Имя Отчество получателя денежных
средств.
Иванов Петр
Сидорович
acc_number Строка (50) Номер счета получателя денежных средств. 408178101234
56789012
contract Строка (100) Номер договора получателя денежных средств. 1234567890
receipt_type Целое (2)
Номер шаблона уведомления, отправляемого на
email Плательщику. По умолчанию используется
первый (стандартный) шаблон.
 Предупреждение: применяется по согласованию 2
с Оператором, только если бизнес-требования ТСП
подразумевают использование разных шаблонов
уведомлений.
Необязательные параметры — настройки платежа по свободным реквизитам
P008-1 Строка (80) Наименование Плательщика.
P008-2 Строка (80) Адрес Плательщика.
P014 Целое (9) БИК получателя (ровно 9 цифр).
P015 Целое (20)
Корр. счёт банка получателя. Номер банковского
счёта, входящего в состав единого казначейского
счёта (ровно 20 цифр).
P016 Строка (160) Наименование Получателя.
P017 Целое (20) Счет получателя (ровно 20 цифр).
P018 Целое (2)
Вид операции. Возможные значения:
01 — платежное поручение;
06 — инкассовое поручение;
02 — платежное требование.
P020 Целое (1)
Назначение платежа. Заполняется при указании
банка. Возможные значения:
1 — Заработная плата, премии, больничные листы и
дивиденды сотрудникам (возможно удержание не
более 50%);
2 — Периодические выплаты, алименты (удержания
отсутствуют);
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 51 | 140
3 — Компенсация вреда здоровью (удержание
только на оплату алиментов);
4 — Разовые выплаты: командировочные, выплаты
на погребение (удержание 0%);
5 — Разовый доход (удержания в пользу
алиментов, возмещения вреда здоровью или
потери кормильца).
P021 Целое (1)
Очередность платежа. Отражает порядок
перечисления платежей и зависит от их характера.
Возможные значения:
1 — Алименты и платежи по судебным решениям о
возмещении вреда жизни и здоровью;
2 — Авторские права, заработная плата и выходные
пособия сотрудникам;
3 — Заработная плата, налоговые обязательства и
погашение задолженностей по налогам и взносам в
фонды;
4 — Средства по остальным исполнительным
документам судебных приставов;
5 — Средства прочим контрагентам в соответствии
с порядком очерёдности.
P022 Целое (25)
УИН (20 или 25 цифр).
Если отсутствует —проставьте 0.
P024 Строка (210) Назначение платежа.
P060 Целое (12)
ИНН Плательщика (10 или 12 цифр).
Если отсутствует —проставьте 0.
P061 Целое (12)
ИНН Получателя (10 или 12 цифр).
Если отсутствует —проставьте 0.
P101 Целое (2) Статус Плательщика.
P102 Целое (9) КПП Плательщика (9 цифр).
Если отсутствует —проставьте 0.
P103 Целое (9) КПП Получателя (9 цифр).
Если отсутствует —проставьте 0.
P104 Целое (20) КБК Получателя.
P105 Целое (11) ОКТМО (8 или 11 цифр).
P106 Строка (10) Основание платежа.
P107 Строка (10) Налоговый период.
P108 Строка (16) Номер документа, который является основанием
платежа, либо 0.
01;5800111222
P109 Строка (10) Дата документа (формат yyyy.MM.dd).
Если отсутствует —проставьте 0.
P110 Строка (10) Тип документа.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/PurchaseBySectorCard
ИС ТСП отправляет Запрос webapi/PurchaseBySectorCard в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект не используется.
POST /webapi/PurchaseBySectorCard HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 107
Content-Type: application/x-www-form-urlencoded
signature=ZmJhMTZkMjg1ZjEwYzRhMTRkZDJkYjBmNTg4MmY5OWE=&sector=893&amount=1000&currenc
y=643&description=ddaa
После обработки Запроса webapi/PurchaseBySectorCard, ПЦ может прислать один из вариантов ответа:
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 52 | 140
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции;
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
 <order_id>453481</order_id>
 <order_state>COMPLETED</order_state>
 <reference>b8624f1b-3fbb-4674-914d-ef17c82ef18b</reference>
 <id>420534</id>
 <date>2022.02.24 12:59:14</date>
 <type>PURCHASE</type>
 <state>APPROVED</state>
 <reason_code>1</reason_code>
 <message>Successful financial transaction</message>
 <amount>1000</amount>
 <fee>0</fee>
 <currency>643</currency>
 <approval_code>226823</approval_code>
 <sector_id>893</sector_id>
 <bin_issuer>JSCB MOSCOW INDUSTRIAL BANK</bin_issuer>
 <iso>643</iso>
 <ps>1</ps>
 <rrn>28940648</rrn>
 <terminal_id>POS_1</terminal_id>
 <ofd_state />
 <multiple />
 <signature>NzU5NDlhYmNiN2IxYzgzNWUwYzk4MTNkNjJhZjA2MjY=</signature>
</operation>
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID-сектора), либо отсутствует одно из обязательных полей. Придет сообщение в формате xml
с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).

Запрос webapi/PaymentFee — РАСЧЕТ КОМИССИИ ЗА ОПЛАТУ
Используйте Запрос webapi/PaymentFee для вычисления комиссии к платёжным операциям. Запрос
выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 53 | 140
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 13. Параметры запроса webapi/PaymentFee
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
amount Целое (12) Сумма Заказа в минимальных единицах валюты. Для
рублей — копейки. 1000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD).
643
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, amount, ps, pan, token,
password в указанном порядке, см. Приложение №2.
Условно-обязательные параметры (необходимо передать один их них)
token Строка (255)
Токен ранее зарегистрированной карты. Позволяет
Плательщику не вводить все реквизиты Карты при
повторной оплате (см. Работа с токеном карты).
pan Строка (19) Номер Карты плательщика.
ps Целое (2)
Платёжная система, используемая для оплаты.
Возможные значения параметра:
0 (по умолчанию) — не установлена;
1 — Visa;
2 — MasterCard;
8 — Maestro;
10 – MIR;
11 — СБП;
12 — Uzcard;
13 — JCB;
14 — оплата со счёта мобильного телефона;
16 — HUMO;
17 — CHUP.
1
Необязательные параметры
mode Целое (1)
Режим ответа на Запрос.
Возможные значения: 0, 2.
0 (значение по умолчанию) — короткий ответ: сумма
комиссии в копейках или -1, если возникла ошибка
расчета комиссии;
2 — xml с результатом расчета комиссии или
причиной ошибки расчета.
2
ПРИМЕР – Обмен с ПЦ в рамках выполнения запроса webapi/PaymentFee
ИС ТСП отправляет запрос webapi/PaymentFee в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/PaymentFee HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 94
Content-Type: application/x-www-form-urlencoded
signature=Y2ZkODQ3MGRlNjU3YmM1MWQ4ZmQwNWJmYmVkOTk5MzI=&sector=1&amount=10000&curr
ency=643&ps=1
После обработки запроса webapi/PaymentFee, ПЦ может прислать один из вариантов ответа:
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 54 | 140
• Вариант 1. Запрос успешно обработан:
o Если mode=0, приходит сумма комиссии в копейках;
100
o Если mode=2, приходит xml с результатом расчета комиссии и дополнительными
параметрами;
• Вариант 2. Обнаружена ошибка:
o Если mode=0 и возникла ошибка при расчёте комиссии:
-1
o Если mode=2, то при какой-либо ошибке, например, неверно указан ID сектора или
некорректный номер карты или отсутствует обязательное поле, ПЦ возвращает xml с
указанием кода ошибки и расшифровкой. Описание формата и список всех ошибок см.
Приложение №1, п.4.

<?xml version="1.0" encoding="UTF-8"?>
<PaymentFee>
 <fee_value>100</fee_value>
</PaymentFee>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 55 | 140
Запрос webapi/Operation — ПОЛУЧЕНИЕ ИНФОРМАЦИИ ПО ОПЕРАЦИИ
Таблица 14. Параметры запроса webapi/Operation
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
operation Целое (19)
Уникальный идентификатор Операции в ПЦ, полученный в
ответ на соответствующий Запрос (webapi/Purchase,
webapi/Authorize, webapi/Complete, webapi/Reverse).
2686
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, operation, password в указанном порядке,
см. Приложение №2.
Необязательные параметры
get_token Целое (1)
Запрос на предоставление токена (см. Работа с токеном карты)
использованной в Операции Платёжной карты в составе
уведомления на url. Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
В дальнейшем, токен может использоваться для инициирования
операций по карте без ввода ее реквизитов.
1
 Предупреждение: возможность получения и использования
токена Карты осуществляется по согласованию с Оператором.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/Operation
ИС ТСП отправляет Запрос webapi/Operation в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/Operation HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 90
Content-Type: application/x-www-form-urlencoded
signature=ZGQ5MzVlYWJlMmZjYjcwNzEwZDc5OGRmZjMyNzc4MjY=&sector=1&id=408206&operation
=366658
Запрос может быть направлен в ПЦ методом HTTP GET или POST.
В ответ на данный Запрос ПЦ присылает сообщение в формате xml (см. Приложение №1, п.2).
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID сектора)
или отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и расшифровкой.
Описание формата и список всех ошибок см. Приложение №1, п.4.
Важно: только после получения ответа на запросы webapi/Operation или webapi/Order или
получения оповещения от ПЦ (по email или методом HTTP POST) ТСП может принимать решение об
успешности той или иной Операции.
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 56 | 140
Запрос webapi/Order — ПОЛУЧЕНИЕ ИНФОРМАЦИИ ПО ЗАКАЗУ
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 15. Параметры запроса webapi/Order
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, reference, password в указанном
порядке, см. Приложение №2.
Условно-обязательные параметры (хотя бы один из них должен быть в запросе)
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
reference Строка (100)
Номер заказа на стороне ТСП в его Системе магазина. Если
указан параметр reference, но не указан id, то система ищет
в ПЦ последний Заказ с указанным reference в рамках
соответствующего сектора и выдает xml с данными
найденного Заказа. Если одновременно указаны и id, и
reference, то поиск Заказа идет по значению параметра id.
12345ABC
Необязательные параметры
mode Целое (1)
Если параметр mode=1, то ПЦ возвращает сокращённую
информацию только по Заказу, без информации по каждой
операции Заказа.
1
get_token Целое (1)
Запрос на предоставление токена (см. Работа с токеном
карты) использованной в Операции Платёжной карты в
составе уведомления на url. Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
1
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/Order
ИС ТСП отправляет Запрос webapi/Order в ПЦ методом HTTP POST. Запрос выполняется в режиме «серверсервер», редирект на Платёжные страницы не используется.
POST /webapi/Order HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 92
Content-Type: application/x-www-form-urlencoded
signature=N2NjMjdlNDc3ODhlZjQ3NzBkYjhkZDY2NGE1NTdhM2E=&sector=1&id=408206&mode=1&ge
t_token=1
Запрос может быть направлен в ПЦ методом HTTP GET или POST.
В ответ на данный Запрос ПЦ присылает сообщение в формате xml (см. Приложение №1, п.3). Ответ
содержит всю информацию по соответствующему Заказу, включая все операции, которые были проведены
в рамках него, даже если они не были успешными.
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора), либо отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и
расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 57 | 140
Запрос webapi/ChangeOrderStatus — СМЕНА СТАТУСА ЗАКАЗА
Предупреждение: разрешение на использование Запроса предоставляется по согласованию с
Оператором.
Используйте запрос webapi/ChangeOrderStatus для изменения статуса Заказа. Запрос выполняется в режиме
обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
На данный момент возможно движение статусов между значениями REGISTERED и EXPIRED.
Ниже перечислены параметры, которые могут быть использованы в запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 16. Параметры запроса webapi/ChangeOrderStatus
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ, полученный
по результатам Запроса webapi/Register.
12345
order_state Строка (20)
Новое значение статуса Заказа.
Возможные варианты:
REGISTERED — Заказ зарегистрирован в ПЦ и не
содержит успешных Операций;
EXPIRED — Заказ с истекшим сроком действия.
EXPIRED
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, order_state, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
mode Строка (20)
Если параметр mode=1, то при закрытии Заказа
вводится запрет на его оплату через QR-код СБП.
 Важно: действует только при закрытии Заказа 1
(параметр order_state=EXPIRED) и наличии в нём
действующего динамического qrcId.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/ChangeOrderStatus
ИС ТСП отправляет Запрос webapi/ChangeOrderStatus в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST webapi/ChangeOrderStatus HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 121
Content-Type: application/x-www-form-urlencoded
signature=ZDc5ZGE5ZjFmOGI1MTU0NWYyYTk3ZGVjNTQ0MDU1OWY=&sector=893&id=463896&order_s
tate=REGISTERED
В ответ на данный Запрос ПЦ присылает сообщение в формате xml (см. Приложение №1, п.1).
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID сектора)
или отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и расшифровкой.
Описание формата и список всех ошибок см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 58 | 140
Запрос webapi/OrderList — ВЫВОД СПИСКА ЗАКАЗОВ ПО КРИТЕРИЯМ
Используйте запрос webapi/OrderList для получения от ПЦ информации о списке Заказов, соответствующих
определенным критериям. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на
Платёжные страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 17. Параметры запроса webapi/OrderList
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, client_ref_list,
acc_number_list, contract_list, reference_list,
order_state, recurring_only_mode, recurring_state,
from_date, to_date, password в указанном порядке,
см. Приложение №2.
Условно-обязательные параметры (хотя бы один из них должен быть в запросе)
client_ref_list Строка (1000) Список значений client_ref для отбора заказов.
Тип/длина client_ref — Строка (255).
acc_number_list Строка (1000) Список значений acc_number для отбора заказов.
Тип/длина acc_number — Строка (255).
contract_list Строка (1000) Список значений contract для отбора заказов.
Тип/длина contract — Целое (3).
reference_list Строка (1000) Список значений reference для отбора заказов.
Тип/длина reference — Строка (12).
Необязательные параметры
order_state Целое (1)
Код статуса заказа для отбора:
0 — REGISTERED,
1 — AUTHORIZED,
2 — COMPLETED,
3 — CANCELED,
4 — BLOCKED,
6 — EXPIRED,
7 — P2PAUTHORIZED.
2
recurring_only_mode Целое (1)
0 или 1 — значение, регулирующее наличие
нерекуррентных заказов в итоговой выборке.
0 (по умолчанию) — не использовать фильтр на
рекуррентные заказы,
1 — вернуть только рекуррентные заказы.
recurring_state Целое (1)
0 или 1 — признак активности рекуррента.
Если значение не задано — возвращаются все
заказы.
0 — только рекуррентные неактивные заказы,
1 — только рекуррентные активные заказы.
Если значение указано, то должны возвращаться
только рекуррентные заказы, вне зависимости от
значения recurring_only_mode.
0
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 59 | 140
from_date Строка (20)
Значение даты начала периода отбора заказов.
ДД.ММ.ГГГГ. По умолчанию — первое число
текущего месяца (включительно).
0
to_date Строка (20)
Значение даты окончания периода отбора заказов.
ДД.ММ.ГГГГ (включительно). По умолчанию —
конец текущего дня.
mode Целое (1)
Признак передачи расширенной информации по
каждому заказу.
Возможные значения: 0 (по умолчанию), 1.
Если параметр mode=1, ПЦ возвращает
расширенную информацию по каждому заказу: с
перечнем дополнительных параметров и списком
операций. При mode=1 максимальный период для
одного Запроса не может превышать 31 день.
0
При получении запроса ПЦ проверит правильность расчета подписи и корректность параметров запроса.
Если есть ошибки — возвращается ошибка выполнения запроса.
Если ошибок нет, то в процессе обработки Запроса в ПЦ запрашивает данные о заказах с переданными в
Запросе параметрами.
В ответ на запрос:
• При успехе. Приходит xml-сообщение со списком заказов. Каждый отдельный элемент списка будет
содержать описание заказа в формате, аналогичном ответу на запрос webapi/Order;
• При неудаче. Если обнаружена ошибка в значении какого-либо параметра Запроса (например,
неверно указан ID сектора), либо отсутствует одно из обязательных полей, приходит xml-сообщение
с указанием кода ошибки и расшифровкой.
Запрос webapi/GetShortLink — ГЕНЕРАЦИЯ КОРОТКИХ ССЫЛОК
Используйте Запрос webapi/GetShortLink для получения короткой ссылки на сервис ПЦ, равноценной
длинной ссылке с полным адресом и перечислением параметров. Запрос выполняется в режиме обмена
данными «сервер-сервер», редирект на Платёжные страницы не используется.
Короткую ссылку можно использовать в течение времени, заданного при ее создании. При вызове короткой
ссылки происходит обращение методом POST на сервис, указанный в параметре url Запроса
webapi/GetShortLink.
Предупреждение: разрешение на использование Запроса предоставляется по согласованию с
Оператором.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 18. Параметры запроса webapi/GetShortLink
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
url Строка
(500)
Полный адрес ссылки на сервис ПЦ с указанием всех нужных
параметров.
signature Строка
(255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, url, password в указанном порядке, см.
Приложение №2.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 60 | 140
Необязательные параметры
life_period Целое (9) Срок жизни ссылки в секундах. По умолчанию, 0 — бессрочно. 0
get_qr_img Целое (1)
Возможные значения: 0 (по умолчанию), 1.
0 — не генерировать QR код;
1 — сгенерировать QR код (в ответе придет base64-значение
сгенерированной картинки QR кода, содержащего в себе адрес
короткой ссылки).
0
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/GetShortLink
ИС ТСП отправляет Запрос webapi/GetShortLink в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST webapi/GetShortLink HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 121
Content-Type: application/x-www-form-urlencoded
signature=ZjE5OGVlYWVjYTY5NmMwMjM3MDZhMDgwNGUzODRlYjY=&sector=1&url=https://test.pa
ygine.com/webapi/P2PTransfer?sector=1
При обработке Запроса ПЦ проверяет, что в параметре url используется:
• Ссылка на тот же домен, что использован при вызове webapi/GetShortLink;
• То же значение параметра sector, что и в Запросе webapi/GetShortLink.
После обработки Запроса webapi/GetShortLink, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml следующего вида:
<?xml version="1.0" encoding="UTF-8"?>
<shorturl>
 <url>https://test.paygine.com/w/s?p1716l2</url>
 <lifeperiod>0</lifeperiod>
</shorturl>
Где:
<url> — короткая ссылка;
<lifeperiod> — срок жизни короткой ссылки.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 61 | 140
Запрос webapi/GetOperationConfirmation — ГЕНЕРАЦИЯ PDF-СПРАВКИ ПО ОПЕРАЦИИ
Используйте Запрос webapi/GetOperationConfirmation для получения справки в формате pdf с
подтверждением операции. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на
Платёжные страницы не используется.
Предупреждение: разрешение на использование Запроса предоставляется по согласованию с
Оператором. Для получения справок предоставьте Оператору электронный адрес.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 19. Параметры запроса webapi/GetOperationConfirmation
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ.
operation Целое (19) Уникальный идентификатор Операции в ПЦ.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, operation, password в указанном
порядке, см. Приложение №2.
Необязательные параметры
date Строка (10)
Дата для указания в тексте справки. Формат: ДД.ММ.ГГГГ
По умолчанию, в справке указывается текущая дата.
23.09.2022
email Строка (100) Адрес электронной почты отправителя, на который ему
придёт письмо с PDF-справкой о результате операции.
mail@some
site.com
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/GetOperationConfirmation
ИС ТСП отправляет Запрос webapi/GetOperationConfirmation в ПЦ методом HTTP GET или POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST webapi/GetOperationConfirmation HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 110
Content-Type: application/x-www-form-urlencoded
signature=Njc4ZjQyYmQ1YWQwMjBlNmJlYjkxZDhlZDhhNTNjNTA=&sector=893&id=3338889&operat
ion=1316160&date=03.10.2022
При обработке Запроса ПЦ проверяет, что:
• Операция принадлежит Заказу, указанному в запросе;
• И Операция, и Заказ принадлежат сектору, указанному в запросе.
После обработки Запроса webapi/GetOperationConfirmation, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Справка отправлена на электронный адрес ТСП. Приходит
сообщение в формате xml следующего вида:
<?xml version="1.0" encoding="UTF-8"?>
<GetOperationConfirmation>
 <result>OK</result>
</GetOperationConfirmation>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 62 | 140
Справка имеет следующий вид:
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос webapi/Ping — ОТСЛЕЖИВАНИЕ ДОСТУПНОСТИ
Используйте Запрос webapi/Ping для отслеживания доступности нашего платёжного приложения. Запрос
выполняется в режиме обмена данными «сервер-сервер». Параметры передавать не требуется. В ответ на
запрос webapi/Ping приходит строка Pong.
Важно: рекомендуется делать вызов сервиса не чаще, чем 1 раз в 30 секунд.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 63 | 140
Работа с Рекуррентными платежами (recurring payments)
Результаты выполнения Рекуррентных платежей можно посмотреть в Личном кабинете ТСП. Если запросить
информацию о Заказе через webapi/Order, то в xml-ответе ПЦ присылает все операции, которые были
сгенерированы в рамках Рекуррентного Заказа с их результатами.
Дополнительно, при каждом выполнении Рекуррентного платежа, может высылаться уведомление о
результате Операции, как на email, так и на URL, см. описание Операции PURCHASE.
Запрос webapi/Recurring — ПОВТОРНОЕ (АВТОМАТИЧЕСКОЕ) СПИСАНИЕ ПО КАРТЕ
Используйте Запрос webapi/Recurring для выполнения Операции RECURRING (автоплатеж). Запрос
выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
Предупреждение: функционал выполнения операций RECURRING предоставляется ТСП после
согласования с Оператором.
Запрос webapi/Recurring подразумевает ведение графика Рекуррентных платежей на стороне ТСП. Для
выполнения очередной попытки списания автоплатежа ТСП в нужную дату и время инициирует выполнение
запроса webapi/Recurring.
ПЦ не устанавливает ограничение ни на количество, ни на частоту Запросов webapi/Recurring в рамках
одного Заказа.
Запрос webapi/Recurring может быть выполнен только в отношении активированного Рекуррентного Заказа,
у которого значение параметра recurring_period равно 0.
Сумма Запроса webapi/Recurring может отличаться как в меньшую, так и в большую сторону от суммы
Рекуррентного Заказа, в рамках которого он выполняется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 20. Параметры запроса webapi/Recurring
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
amount Целое (12) Сумма Заказа в минимальных единицах валюты. Для рублей —
копейки. 15000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840 для
USD).
643
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, amount, currency, password в указанном
порядке, или sector, id, amount, fee, currency, password, если
параметр fee участвует в запросе. См. Приложение №2.
Необязательные параметры
fee Целое (12)
Эквайринговая комиссия в минимальных единицах валюты. Для
рублей — копейки. Взимается с Плательщика дополнительно к
основной сумме Заказа. 111
Предупреждение: порядок использования данного
параметра необходимо согласовать с Оператором.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 64 | 140
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/Recurring
ИС ТСП отправляет Запрос webapi/Recurring в ПЦ методом HTTP POST. Запрос выполняется в режиме
обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/Recurring HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 99
Content-Type: application/x-www-form-urlencoded
signature=MDNmZmVhN2M3Mzc0MjY2NzczZjRhMTY5ZjVkNGFlNWE=&sector=1&id=194594&amount=1
5000&currency=643
После обработки Запроса webapi/Recurring, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Придет сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 65 | 140
Запрос webapi/Cancel – ОТМЕНА РЕГУЛЯРНОГО ЗАКАЗА
Используйте сервис webapi/Cancel для отмены Рекуррентного Заказа. Запрос выполняется в режиме обмена
данными «сервер-сервер», редирект на Платёжные страницы не используется.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 21. Параметры запроса webapi/Cancel
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register, в рамках которого была
осуществлена первая операции PURCHASE с параметром
recurring_period.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/Cancel
ИС ТСП отправляет POST Запрос webapi/Cancel в ПЦ.
POST /webapi/Cancel HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 73
Content-Type: application/x-www-form-urlencoded
signature=N2NjMjdlNDc3ODhlZjQ3NzBkYjhkZDY2NGE1NTdhM2E=&sector=1&id=408206
В ответ на данный Запрос ПЦ присылает ответ в виде сообщения “ok” в формате text/plain.
Рекуррентный Заказ отменяется и Операции автоматически перестают формироваться.
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора), либо отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и
расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.

 Примечание: Регулярный Заказ также можно отменить операцией REVERSE, см. описание
соответствующего сервиса. При этом происходит возврат средств, указанных в Запросе webapi/Reverse,
на платёжную карту из последней успешной операции. После этого регулярный Заказ отменяется.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 66 | 140
Запрос webapi/ChangeRec — ИЗМЕНЕНИЕ ПАРАМЕТРОВ РЕГУЛЯРНОГО ЗАКАЗА
Используйте сервис webapi/ChangeRec для изменения параметров регулярного Заказа. Запрос выполняется
в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 22. Параметры запроса webapi/ChangeRec
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register. Только если ранее при регистрации
Заказа был передан параметр recurring_period=0.
12345
amount Целое (12) Сумма Операции в минимальных единицах валюты.
Для рублей — копейки. 15000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD).
643
recurring_period Целое (3) Код периода для регулярных платежей. 12
error_period Целое (3)
Период времени в сутках, через который
необходимо повторить попытку выполнить
регулярный платёж при неуспешном предыдущем.
По умолчанию — 1 сутки.
1
error_number Целое (3)
Количество попыток повторного выполнения
регулярного платежа при неуспешном предыдущем,
с интервалом из параметра error_period. После
исчерпания попыток регулярный Заказ
аннулируется. По умолчанию равно 3.
3
signature Строка
(255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, amount, currency,
password в указанном порядке, см. Приложение №2.
Необязательные параметры
fee Целое (12)
Эквайринговая комиссия в минимальных единицах
валюты. Для рублей — копейки. Взимается с
Плательщика дополнительно к основной сумме
Заказа. 111
Предупреждение: порядок использования
данного параметра необходимо согласовать с
Оператором.
remind_days_before Целое (3)
Количество дней, за которое Плательщику
отсылается уведомление на электронную почту об
очередном платеже (только для регулярных
платежей). Может принимать значения от 1 до 10.
3
start_date Строка (20) Дата начала действия регулярного платежа в
формате: yyyy.MM.dd HH:mm:ss
2015.07.01
00:00:00
end_date Строка (20) Дата окончания действия регулярного платежа в
формате: yyyy.MM.dd HH:mm:ss
2017.07.01
23:00:00
email Строка
(100)
Адрес электронной почты Плательщика для
отправки ему уведомлений о результатах
проводимых в рамках Заказа Операций.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 67 | 140
Перезаписывает значение email, присвоенное при
регистрации заказа.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/ChangeRec
ИС ТСП отправляет Запрос webapi/ChangeRec в ПЦ методом HTTP POST. Запрос выполняется в режиме
обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/ChangeRec HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 147
Content-Type: application/x-www-form-urlencoded
signature=NTVjMDVlYmFlM2E1YmY1NmIxNTA3MzA2ZjZiNTU5NTQ=&sector=1&id=70365&amount=800
0&currency=643&recurring_period=12&error_period=1&error_number=3
В ответ на этот Запрос ПЦ присылает сообщение “ok” в формате text/plain. Если результат
положительный, то данные в регулярном заказе меняются на те, которые переданы в Запросе
webapi/ChangeRec.
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора), либо отсутствует одно из обязательных полей, то приходит сообщение в формате xml с указанием
кода ошибки и расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.
Запрос webapi/ChangeRecCard — СМЕНА КАРТЫ РЕКУРРЕНТНОГО ПЛАТЕЖА
Используйте Запрос webapi/ChangeRecCard для смены карты, по которой проводятся списания
рекуррентного платежа. Запрос выполняется с перенаправлением (редиректом) Плательщика на Платёжные
страницы ПЦ.
При смене карты, привязанной к указанному в параметрах рекуррентному Заказу, происходит следующее:
1. ПЦ проводит Операцию AUTHORIZE на небольшую сумму.
2. Если AUTHORIZE завершается успешно, ПЦ проводит Операцию REVERSE для сделанной операции
AUTHORIZE.
Проведение этих операций никак не сказывается на сумме и статусе активности рекуррентного Заказа.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 23. Параметры запроса webapi/ChangeRecCard
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
cvc Строка (3) Проверочный код Карты Плательщика CVV2/CVC2/ППК2. Для
Карт Maestro может отсутствовать. 111
get_token Целое (1)
Запрос на предоставление токена (см. Работа с токеном карты)
использованной в Операции Платёжной карты в составе
уведомления на url. Возможные значения: 0, 1.
1
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 68 | 140
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
 Предупреждение: возможность получения и использования
токена Карты осуществляется по согласованию с Оператором.
token Строка (255)
Токен ранее зарегистрированной Платёжной карты
Плательщика. Позволяет Плательщику не вводить все
реквизиты Карты при повторной оплате, но при этом
поддерживает работу с 3DS (см. Работа с токеном карты).
action Строка (3)
Если action=pay, то ПЦ попытается провести Операцию на
основании параметров Запроса, без отображения Платёжной
формы Плательщику. При нехватке данных для проведения
Операции, Плательщику выводится Платёжная форма для
заполнения недостающих данных.
pay
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/ChangeRecCard
ИС ТСП отправляет Запрос webapi/ChangeRecCard в ПЦ методом HTTP GET или POST. ПЦ перенаправляет
Плательщика на Платёжную форму для ввода карточных данных.
POST /webapi/ChangeRecCard HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NTVjMDVlYmFlM2E1YmY1NmIxNTA3MzA2ZjZiNTU5NTQ=&sector=1&id=70365
В процессе обработки данных, полученных от Плательщика, а также в соответствии с настройками учетной
записи ТСП в ПЦ, Плательщик может быть перенаправлен на страницу прохождения 3DS аутентификации.
Если карта не подключена к 3DS, то происходит редирект на страницу ввода значения списанной суммы.
По результатам выполнения в ПЦ Операции AUTHORIZE и в зависимости от значений параметров url и
failurl, указанных ранее при регистрации Заказа (Запрос webapi/Register), Плательщику будет показан один
из следующих вариантов итоговой страницы:
• Вариант 1. Если параметр Заказа url не заполнен, Плательщику выводится типовая форма экранного
чека ПЦ, либо сообщение об ошибке.
HTTP/1.1 200 OK
(HTML c типовой формой экранного чека ПЦ)
• Вариант 2. Если параметры Заказа url / failurl заполнены, и Операция в ПЦ проведена без ошибок,
Плательщик методом HTTP GET перенаправляется на страницу, адрес которой был указан в Запросе
webapi/Register в значении параметра url (если операция одобрена), либо failurl (если получен
отказ).
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ;
например, на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code
=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 69 | 140
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
Если Операция AUTHORIZE завершена успешно, ПЦ формирует Операцию REVERSE для этой
Операции AUTHORIZE. ПЦ отправляет автоматическое уведомление о проведенной операции
REVERSE на адрес notify_url. Результат выполнения операции REVERSE не влияет на то, какая
страница будет выведена Плательщику в результате работы сервиса webapi/ChangeRecCard.
• Вариант 3. Если параметры Заказа url / failurl заполнены, и при проведении Операции в ПЦ
выявлены ошибки, то Плательщик методом HTTP GET перенаправляется на страницу, адрес которой
был указан в Запросе webapi/Register в значении параметра failurl (если параметр был задан), либо
url (если failurl не был задан).
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
 Важно: если в рамках бизнес-процесса ТСП требуется уточнить результат Операции (или
удостовериться в его точности) или получить информацию о состоянии Заказа, то ТСП может это сделать,
реализовав на своей стороне дополнительные Запросы webapi/Operation, webapi/Order к ПЦ для
получения детальной информации по нужной Операции или Заказу. Рекомендации использовать
дополнительные Запросы обусловлены требованиями повышения безопасности совершения платежей.

HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&erro
r=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 70 | 140
Запрос webapi/SetRec — ПЕРЕВОД СУЩЕСТВУЮЩЕГО ЗАКАЗА В РЕГУЛЯРНЫЙ
Используйте сервис webapi/SetRec для перевода уже существующего Заказа в Рекуррентный. Запрос
выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 24. Параметры запроса webapi/SetRec
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register. Только если ранее при
регистрации Заказа был передан параметр
recurring_period=0.
12345
amount Целое (12) Сумма Операции в минимальных единицах валюты.
Для рублей — копейки. 15000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD).
643
recurring_period Целое (3) Код периода для регулярных платежей. 12
error_period Целое (3)
Период времени в сутках, через который
необходимо повторить попытку выполнить
регулярный платёж при неуспешном предыдущем.
По умолчанию — 1 сутки.
1
error_number Целое (3)
Количество попыток повторного выполнения
регулярного платежа при неуспешном предыдущем,
с интервалом из параметра error_period. После
исчерпания попыток регулярный Заказ
аннулируется. По умолчанию равно 3.
3
signature Строка
(255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, amount, currency,
password в указанном порядке, см. Приложение
№2.
Необязательные параметры
fee Целое (12)
Эквайринговая комиссия в минимальных единицах
валюты. Для рублей — копейки. Взимается с
Плательщика дополнительно к основной сумме
Заказа. 111
Предупреждение: порядок использования
данного параметра необходимо согласовать с
Оператором.
remind_days_before Целое (3)
Количество дней, за которое Плательщику
отсылается уведомление на электронную почту об
очередном платеже (только для регулярных
платежей). Может принимать значения от 1 до 10.
3
start_date Строка (20) Дата начала действия регулярного платежа в
формате: yyyy.MM.dd HH:mm:ss
2015.07.01
00:00:00
end_date Строка (20) Дата окончания действия регулярного платежа в
формате: yyyy.MM.dd HH:mm:ss
2017.07.01
23:00:00
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 71 | 140
continuing_recurring true/false
Когда счетчик неуспешных попыток проведения
достигает значения error_number:
• Если continuing_recurring=false, то текущий
и все предстоящие Рекуррентные платежи
Заказа перестают списываться;
• Если continuing_recurring=true, то текущий
(неуспешный) Рекуррентный платеж
пропускается, счетчик неуспешных попыток
обнуляется, ПЦ ожидает наступления
следующего по графику Рекуррентного
платежа Заказа.
По умолчанию равен false.
false
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/SetRec
ИС ТСП отправляет Запрос webapi/SetRec в ПЦ методом HTTP POST. Запрос выполняется в режиме «серверсервер», редирект на Платёжные страницы не используется.
POST /webapi/SetRec HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 147
Content-Type: application/x-www-form-urlencoded
signature=NTVjMDVlYmFlM2E1YmY1NmIxNTA3MzA2ZjZiNTU5NTQ=&sector=1&id=70365&amount=8
000&currency=643&recurring_period=12&error_period=1&error_number=3
В ответ на этот Запрос ПЦ присылает сообщение “ok” в формате text/plain. Если результат
положительный, то данные в регулярном заказе меняются на те, которые переданы в Запросе
webapi/SetRec.
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора), либо отсутствует одно из обязательных полей, то приходит сообщение в формате xml с указанием
кода ошибки и расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.


Запрос webapi/ReverseKeepRec – ВОЗВРАТ РЕГУЛЯРНОГО ПЛАТЕЖА
Используйте сервис webapi/ReverseKeepRec для совершения возврата по рекуррентному Заказу без отмены
признака рекуррентности. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на
Платёжные страницы не используется.
Для возврата средств по конкретной операции укажите ее номер в параметре operation. Если этот параметр
не задан, то возврат производится по последней операции рекуррентного Заказа.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 25. Параметры запроса webapi/ReverseKeepRec
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор рекуррентного Заказа в ПЦ,
полученный по результатам Запроса webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, operation, amount, password в указанном
порядке, см. Приложение №2.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 72 | 140
Необязательные параметры
operation Целое (19)
Уникальный идентификатор операции, по которой требуется
возврат. Если не указан, то возврат производится по последней
операции рекуррентного Заказа.
amount Целое (12) Сумма возврата в минимальных единицах валюты. Для рублей
— копейки.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/ReverseKeepRec
ИС ТСП отправляет POST Запрос webapi/ReverseKeepRec в ПЦ.
POST /webapi/ReverseKeepRec HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 86
Content-Type: application/x-www-form-urlencoded
signature=OTc0MWIwYTI5ZTRkMmY3NTJhNzc1ZWM2OGQ2OWFhOGQ=&sector=893&id=463902&amount
=100
После обработки Запроса webapi/ReverseKeepRec, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Придет сообщение в формате xml
с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 73 | 140
Работа с токеном карты
Для инициирования платежей без ввода реквизитов карты, в ПЦ реализована работа с токеном карты.
Зачастую такие платежи используются, когда применение регулярных платежей невозможно из-за
ограничений платёжных систем и/или ввод реквизитов карты при каждом платеже не удобен или
невозможен, например, платежи из мобильных приложений.
Предупреждение: работа с токеном карты осуществляется по согласованию с Оператором.
Если Оператор предоставил ТСП такую возможность, то токен можно получить тремя способами:
1. Сделайте Запрос webapi/Operation с указанием параметра get_token по ранее совершенной и
успешной операции по карте.
2. Инициируйте операцию AUTHORIZE или PURCHASE с помощью сервисов webapi/Authorize,
webapi/Purchase или gateweb/Payment. Токен возвращается только если операция была успешна.
3. Воспользуйтесь специальным сервисом регистрации карты webapi/CardEnroll.
В качестве альтернативного варианта инициирования Рекуррентных платежей можете использовать сервис
webapi/RecurringByToken. Этот сервис использует токен ранее зарегистрированной карты для совершения
платежа. При этом, контроль над графиком списаний и суммой каждого платежа возлагается на ТСП.
Примечание: для того, чтобы выбрать наиболее подходящий для Вас способ работы с регулярными
платежами, пожалуйста обратитесь к специалистам ПЦ.
Запрос webapi/CardEnroll — РЕГИСТРАЦИЯ КАРТЫ И ПОЛУЧЕНИЕ ТОКЕНА
Используйте Запрос webapi/CardEnroll для регистрации карты и получения токена.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 26. Параметры запроса webapi/CardEnroll
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/CardEnroll
ИС ТСП отправляет Запрос webapi/CardEnroll в ПЦ методом HTTP GET или POST. ПЦ перенаправляет
Плательщика на Платёжную форму для ввода карточных данных.
POST /webapi/CardEnroll HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NjI4ZTk3MzIwOTQ3MTgyYWEwOWQ0NzE3OWM0YTk2Y2M=&sector=1&id=12345
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 74 | 140
При этом, Плательщику отображается платёжная форма с указанием суммы, установленной ТСП при
регистрации Заказа для данной операции. Это сделано для того, чтобы ТСП мог сам задать случайную
небольшую сумму и потом запросить её у Плательщика для подтверждения того, что карта принадлежит
Плательщику, а не стороннему лицу.
Примечание: мы рекомендуем генерировать случайную сумму в пределах 10 единиц валюты.
По результатам выполнения запроса webapi/CardEnroll формируется операция AUTHORIZE.
После успешной регистрации карты, мы рекомендуем откатить эту операцию с помощью Запроса
webapi/Reverse, чтобы у Плательщика не блокировалась данная сумма на длительный срок.
После выполнения операции, ПЦ перенаправит Плательщика обратно на страницу, указанную ранее при
регистрации Заказа, методом HTTP GET.
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ;
например, на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
Если в процессе обработки произошла какая-либо ошибка, то ПЦ не регистрирует операцию и
перенаправляет Плательщика на url из Заказа следующим запросом:
Есть два способа узнать результат выполнения Операции и получить токен карты:
1. ТСП самостоятельно запрашивает статус соответствующей Операции с помощью webapi/Operation.
2. Альтернатива: ТСП использует автоматические xml-уведомления от ПЦ. Они содержат цифровую
подпись, позволяющую проверить подлинность отправителя. Если операция была успешна (статус
APPROVED), то в уведомлении будет указан токен карты.
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&error=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное ИС
ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 75 | 140
Запросы webapi/PurchaseByToken и webapi/AuthorizeByToken — ОПЛАТА И
ХОЛДИРОВАНИЕ ПО ТОКЕНУ КАРТЫ
Используйте данные запросы для инициирования выполнения операций PURCHASE и AUTHORIZE с
использованием токена карты.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 27. Параметры запросов webapi/PurchaseByToken и webapi/AuthorizeByToken
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный
по результатам Запроса webapi/Register.
12345
token Строка
(255)
Токен ранее зарегистрированной карты (см. способы
получения токена выше)
signature Строка
(255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, token, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
cvc Строка (3)
CVV2/CVC2. Для большей безопасности, у Плательщика
может быть дополнительно запрошен код
безопасности карты перед выполнением операции.
111
originator Целое (19)
ID Операции в ПЦ (Purchase, Authorize), на основании
которой был получен токен карты. Наличие данного
параметра увеличивает конверсию регулярных
платежей и требуется при возникновении претензий
со стороны Плательщиков.
32111
applePaymentData
JSONобъект в
base64
Платежные данные Apple Pay в формате base64-
кодированной строки JSON. Значение параметра
paymentData, указанного в платежном токене Apple
(параметр paymentData внутри объекта класса
PKPaymentToken). Имеет более высокий приоритет над
полем applePaymentToken.
Параметр анализируется только вместе action=pay.
applePaymentToken Строка
(255)
JSON-объект с платёжными данными Apple Pay.
Значение платежного токена, полученного от Apple
(объект класса PKPaymentToken).
Параметр анализируется только вместе action=pay.
googleCryptogram
JSONобъект в
base64
Платежные данные Google Pay в формате base64-
кодированной строки JSON. Значение поля cryptogram,
полученного от Google. Параметр анализируется
только вместе action=pay.
yandexCryptogram
JSONобъект в
base64
Платежные данные Yandex Pay в формате base64-
кодированной строки JSON. Значение поля cryptogram,
полученного от Yandex. Параметр анализируется
только вместе action=pay.
samsung_ref_id Строка
(255)
Платёжные данные Samsung Pay. Значение
уникального референса запроса на получение
криптограммы карты. Параметр анализируется только
вместе action=pay.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 76 | 140
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/PurchaseByToken
ИС ТСП отправляет Запрос webapi/PurchaseByToken в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/PurchaseByToken HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 85
Content-Type: application/x-www-form-urlencoded
signature=MTM3MzcwMmYzOGExMDU4MGQ5OWMyMTZkZGM5ZWJhMjc=&sector=1&id=408206&token=5
8488b5e-287d-4157-8be9-3573011d6b3a
При поступлении данного Запроса, ПЦ генерирует операцию PURCHASE с реквизитами карты,
соответствующими указанному токену. Данные по сумме операции и заказу берутся из параметров Заказа.
В ответ на данный Запрос, ПЦ присылает xml-сообщение с результатом выполнения операции (см.
Приложение №1, п.2).
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора), либо отсутствует одно из обязательных полей, то ПЦ отправляет xml-сообщение с указанием кода
ошибки и расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать приложенный файл payments.xsd c
описанием структуры всех сообщений.
Предупреждение: некоторые Эмитенты могут запрещать операции через Интернет без проведения
дополнительной 3DS авторизации по некоторым типам карт, таким как Cirrus/Maestro, VISA Electron и т.д.
В связи с этим, операции с использованием токена карты могут отклоняться Эмитентом (статус Rejected,
Reason code = 4, см. таблицу Приложение №1, п.5). Для таких карт рекомендуется при получении отказа
предлагать выполнить операцию с использованием сервиса webapi/Purchase с редиректом на платёжную
страницу Paygine.

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 77 | 140
Запрос webapi/RecurringByToken — ИНИЦИИРОВАНИЕ РЕГУЛЯРНОГО ПЛАТЕЖА ПО
ТОКЕНУ КАРТЫ
Используйте Запрос webapi/RecurringByToken в качестве альтернативного варианта инициирования
регулярных платежей. Этот запрос использует токен ранее зарегистрированной карты для совершения
платежа. При этом, контроль за графиком списаний и суммой каждого платежа возлагается на ТСП.
В данном случае необходимо каждый раз создавать Заказ перед выполнением данного Запроса, см.
описание webapi/Register.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 28. Параметры запроса webapi/RecurringByToken
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
token Строка (255) Токен ранее зарегистрированной карты (см. способы получения
токена выше).
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, token, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
originator Целое (19)
ID Операции в ПЦ (Purchase, Authorize), на основании которой
был получен токен карты. Наличие данного параметра
увеличивает конверсию регулярных платежей и требуется при
возникновении претензий со стороны Плательщиков.
32111
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/RecurringByToken
ИС ТСП отправляет Запрос webapi/RecurringByToken в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/RecurringByToken HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 85
Content-Type: application/x-www-form-urlencoded
signature=MTM3MzcwMmYzOGExMDU4MGQ5OWMyMTZkZGM5ZWJhMjc=&sector=1&id=408206&token=584
88b5e-287d-4157-8be9-3573011d6b3a
При поступлении данного Запроса, ПЦ генерирует регулярную операцию PURCHASE с реквизитами карты,
соответствующими указанному токену. Данные по сумме операции и заказу берутся из параметров Заказа.
В ответ на данный Запрос, ПЦ присылает xml-сообщение с результатом выполнения операции (см.
Приложение №1, п.2).
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора), либо отсутствует одно из обязательных полей, то ПЦ отправляет xml-сообщение с указанием кода
ошибки и расшифровкой. Описание формата и список всех ошибок см. Приложение №1, п.4.
 Предупреждение: некоторые Эмитенты могут запрещать операции через Интернет без проведения
дополнительной 3DS авторизации по некоторым типам карт, таким как Cirrus/Maestro, VISA Electron и т.д.
В связи с этим, операции с использованием токена карты могут отклоняться Эмитентом (статус Rejected,
Reason code = 4, см. таблицу Приложение №1, п.5). Для таких карт рекомендуется при получении отказа
предлагать выполнить операцию с использованием сервиса webapi/Purchase с редиректом на платёжную
страницу Paygine.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 78 | 140
Запрос webapi/СheckToken — ПРОВЕРКА СТАТУСА ТОКЕНА
Используйте запрос webapi/CheckToken для проверки статуса ранее полученного токена. Запрос
выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на Платёжные
страницы ПЦ.
 Предупреждение: данный сервис доступен только по согласованию с Оператором.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 29. Параметры запроса webapi/CheckToken
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
token Строка (39) Ранее полученный токен.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, token, password в указанном порядке,
см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/CheckToken
ИС ТСП отправляет Запрос webapi/CheckToken в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/CheckToken HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 111
Content-Type: application/x-www-form-urlencoded
signature=MjgwZWIxODJlNzhhMGNkYTA0NTlmODI4YmVhMTAyNDc=&sector=1869&token=SPc6efe08
9-1b60-49cb-94fc-908d00cbf9f2
При получении запроса ПЦ проверяет правильность расчета подписи и корректность параметров запроса.
Если есть ошибки — ПЦ возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ отправляет xml-сообщение следующего вида:
<CheckToken>
<token>SPc6efe089-1b60-49cb-94fc-908d00cbf9f2</token>
<type>SBERPAY</type>
<state>ACTIVE</state>
<info>
<create_date>2023.07.24 13:17:40.565</create_date>
</info>
</CheckToken>

/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 79 | 140
Операции перевода с карты на карту (P2PTRANSFER)
Запрос webapi/P2PTransfer — ВЫПОЛНЕНИЕ ПЕРЕВОДА С КАРТЫ НА КАРТУ
Используйте Запрос webapi/P2PTransfer для проведения Операции P2PTRANSFER. Запрос выполняется с
перенаправлением (редиректом) Плательщика на Платёжные страницы ПЦ.
Запрос webapi/P2PTransfer можно выполнять как в рамках ранее зарегистрированного Заказа, так и без
предварительной регистрации Заказа. Если в Запросе не указан номер Заказа, для которого выполняется
операция, то ПЦ автоматически создаёт Заказ перед выполнением Операции на основании полученных в
Запросе данных.
Ниже перечислены параметры, которые могут быть использованы в Запросе webapi/P2PTransfer.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 30. Параметры запроса webapi/P2PTransfer
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
Обязательно при передаче хотя бы одного из параметров: id, token, token2, card2
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, token, token2,
card2, payer_id, password в указанном порядке,
см. Приложение №2.
Обязательно для перевода на иностранную карту
address Строка (100)
Адрес отправителя. Общий формат: название
улицы, номер дома, номер квартиры/офиса.
Заполняйте латиницей.
Shirokaya str, b. 2,
fl. 36
city Строка (100)
Название населённого пункта отправителя
(города, посёлка и т.д.).
Заполняйте латиницей.
Saint-Petersburg
post_code Строка (100) Индекс отправителя (ZIP code). 197022
countrynum Строка (3) Код страны резидентства отправителя (ISO
numeric).
643
name Строка (100) Имя на карте отправителя.
Заполняйте латиницей. Sender Name
receiver_name Строка (100) Имя получателя средств.
Заполняйте латиницей. Receiver Name
Необязательные параметры
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register.
12345
reference Строка (100) Номер Заказа на стороне ТСП (в ИС ТСП). 12345ABC
amount Целое (12) Сумма Операции в минимальных единицах
валюты. Для рублей — копейки. 1000
fee_value Целое (12)
Комиссия за осуществление перевода в
минимальных единицах валюты. Для рублей —
копейки. Взимается с отправителя
дополнительно к основной сумме Заказа.
100
currency Целое (3) Код валюты по ISO4217 (643 для RUB, 978 для
EUR, 840 для USD).
643
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 80 | 140
url Строка (500)
Адрес страницы на стороне ТСП, на которую по
завершении Операции переводится
отправитель вместо показа ему типового чека
ПЦ. При переводе отправителя url, ПЦ также
передает на этот адрес идентификаторы Заказа
и Операции.
Значение параметра необходимо заполнять
полностью, с указанием префикса (http:// или
https://).
http://www.ex.com/
accept.jsp
failurl Строка (500)
Адрес страницы на стороне ТСП, на которую
переводится отправитель в случае неуспешного
окончания проведения Операции (когда статус
Операции отличен от APPROVED, или Операция
не сформирована по причине какой-либо
ошибки). При переводе отправителя failurl, ПЦ
также передает на него идентификаторы
Заказа и Операции и код ошибки (при
наличии).
Если параметр failurl не указан, ПЦ считает его
равным значению url.
Если указан id Заказа, то значение failurl
берется из него.
Значение параметра необходимо заполнять
полностью, с указанием префикса (http:// или
https://).
http://www.ex.com/
Fail.jsp
token Строка (255)
Токен ранее зарегистрированной Платёжной
карты, заменяющий карту отправителя.
Позволяет отправителю не вводить все
реквизиты Карты при повторной оплате (см.
Работа с токеном карты).
token2 Строка (255)
Токен ранее зарегистрированной Платёжной
карты, заменяющий карту получателя перевода.
Позволяет отправителю не вводить номер
карты получателя перевода.
cvc Строка (3)
Проверочный код Карты Плательщика
CVV2/CVC2/ППК2. Для Карт Maestro может
отсутствовать.
111
card2 Строка (20) Номер карты получателя средств.
payer_id Строка (100) Идентификатор клиента на стороне ТСП.
email Строка (100) Адрес электронной почты отправителя
денежных средств.
email2 Строка (100)
Адрес электронной почты получателя
денежных средств. ПЦ может использовать
email2 для оповещения получателя средств о
совершенном в его пользу переводе.
mail@somesite.com
phoneTo Строка (100) Номер телефона получателя денежных средств. 79219999999
get_token Целое (1)
Запрос на предоставление токенов
использованных Платёжных карт в составе
xml-сообщений с информацией об Операции
(уведомление на url и запросы, содержащие
информацию по Операции).
Возможные значения: 0, 1.
0 (по умолчанию) — не возвращать токены;
1 — вернуть токены.
1
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 81 | 140
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
action Строка (3)
Если action=pay, то ПЦ попытается провести
Операцию на основании параметров Запроса,
без отображения Платёжной формы
отправителю. При нехватке данных для
проведения Операции, отправителю выводится
Платёжная форма для заполнения
недостающих данных.
pay
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/P2PTransfer
ИС ТСП отправляет Запрос webapi/P2PTransfer в ПЦ методом HTTP GET или POST. ПЦ перенаправляет
отправителя на Платёжную форму для ввода карточных данных.
POST /webapi/P2PTransfer HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 8
Content-Type: application/x-www-form-urlencoded
sector=1
В процессе обработки данных, полученных от отправителя, а также в соответствии с настройками учетной
записи ТСП в ПЦ, отправитель может быть перенаправлен на страницу прохождения 3DS аутентификации.
Если в Запросе не указан номер Заказа (параметр id), то ПЦ автоматически создаёт новый Заказ, в рамках
которого будет проводиться Операция. В параметрах созданного Заказа отражается часть значений
параметров Запроса. В том числе, параметры url и failurl принимают значения соответствующих
одноименных параметров Запроса webapi/P2PTransfer.
По результатам выполнения в ПЦ Операции P2PTRANSFER и в зависимости от заданных в Заказе значений
параметров url и failurl, отправителю будет показан один из следующих вариантов итоговой страницы:
• Вариант 1. Если параметр Заказа url не заполнен, отправителю выводится типовая форма экранного
чека ПЦ, либо сообщение об ошибке.
HTTP/1.1 200 OK
(HTML c типовой формой экранного чека ПЦ)
• Вариант 2. Если параметры Заказа url / failurl заполнены, и Операция в ПЦ проведена без ошибок,
отправитель методом HTTP GET перенаправляется на страницу, адрес которой был указан в Запросе
webapi/Register в значении параметра url (если операция одобрена), либо failurl (если получен
отказ).
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ;
например, на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code
=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 82 | 140
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 3. Если параметры Заказа url / failurl заполнены, и при проведении Операции в ПЦ
выявлены ошибки, то отправитель методом HTTP GET перенаправляется на страницу, адрес которой
был указан в Запросе webapi/Register в значении параметра failurl (если параметр был задан), либо
url (если failurl не был задан).
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
 Важно: если в рамках бизнес-процесса ТСП требуется уточнить результат Операции (или
удостовериться в его точности) или получить информацию о состоянии Заказа, то ТСП может это сделать,
реализовав на своей стороне дополнительные Запросы webapi/Operation, webapi/Order к ПЦ для
получения детальной информации по нужной Операции или Заказу. Рекомендации использовать
дополнительные Запросы обусловлены требованиями повышения безопасности совершения платежей.
Запрос gateweb/P2PTransfer — ВЫПОЛНЕНИЕ ПЕРЕВОДА С КАРТЫ НА КАРТУ
Используйте Запрос gateweb/P2PTransfer для выполнения Операций P2PTRANSFER. Запрос выполняется в
режиме обмена данными «сервер-сервер», без перенаправления отправителя на Платёжные страницы ПЦ.
Предупреждение: данный режим выполнения Операций P2PTRANSFER предоставляется ТСП после
согласования с Оператором, поскольку требует от ТСП соблюдения требований стандартов PCI DSS.
Перед выполнением Запроса не нужно регистрировать Заказ (webapi/Register). Заказ генерируется
системой автоматически, на основании данных, полученных в Запросе gateweb/P2PTransfer.
Ниже перечислены параметры, которые могут быть использованы в Запросе gateweb/P2PTransfer.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 31. Параметры запроса gateweb/P2PTransfer
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи
ТСП в ПЦ. 1
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&erro
r=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 83 | 140
amount Целое (12) Сумма Операции в минимальных единицах
валюты. Для рублей — копейки. 1000
fee Целое (12)
Комиссия за осуществления перевода в
минимальных единицах валюты. Для
рублей — копейки. Взимается с
отправителя дополнительно к основной
сумме Заказа.
200
currency Целое (3) Код валюты по ISO4217 (643 для RUB; 978
для EUR; 840 для USD).
643
signature Строка (255)
Цифровая подпись Запроса. В
формировании подписи участвуют
параметры: sector, pan1, token1, name,
month, year, cvc, pan2, token2, amount,
currency, transaction_id, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры
В запросе обязательно должны присутствовать карточные данные двух карт — Карты отправителя
(либо token1, либо параметры pan1, month и year) и Карты получателя (либо token2, либо pan2).
token1 Строка (255)
Токен ранее зарегистрированной карты.
Позволяет отправителю не вводить все
реквизиты Карты при повторной оплате
(см. Работа с токеном карты).
pan1 Строка (20) Номер Карты отправителя средств.
month Целое (2) Месяц срока действия Карты отправителя. 05
year Целое (4) Год срока действия Карты отправителя. 2023
token2 Строка (255)
Токен ранее зарегистрированной
Платёжной карты, заменяющий Карту
получателя перевода. Позволяет
отправителю не вводить номер карты
получателя (см. Работа с токеном карты).
pan2 Строка (20) Номер Карты получателя средств.
Обязательные параметры для перевода на иностранную карту
address Строка (100)
Адрес отправителя. Общий формат:
название улицы, номер дома, номер
квартиры/офиса.
Заполняйте латиницей.
Shirokaya str,
b. 2, fl. 36
city Строка (100)
Название населённого пункта отправителя
(города, посёлка и т.д.).
Заполняйте латиницей.
SaintPetersburg
post_code Строка (100) Индекс отправителя (ZIP code). 197022
countrynum Строка (3) Код страны резидентства отправителя (ISO
numeric).
name Строка (100)
Имя отправителя или имя на карте
отправителя.
Заполняйте латиницей.
Sender Name
receiver_name Строка (100) Имя получателя средств.
Заполняйте латиницей. Receiver Name
Обязательность зависит от настроек для ТСП в ПЦ
email Строка (100)
Адрес электронной почты отправителя, на
который ему придёт письмо с
информацией о результате операции.
mail@somesit
e.com
email2 Строка (100)
Адрес электронной почты получателя, на
который ему придёт письмо с
информацией о результате операции.
Может быть использован ПЦ для
mail@somesit
e.com
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 84 | 140
оповещения получателя средств о
совершенном в его пользу переводе.
phone Строка (100)
Телефон отправителя, необходимый для
исполнения операции и оповещения
отправителя о результате выполнения
операции.
79219999999
phone2 Строка (100)
Телефон получателя, необходимый для
исполнения операции и оповещения
получателя о результате выполнения
операции.
79219999999
first_name Строка (100) Имя Плательщика. Иван
last_name Строка (100) Фамилия Плательщика. Петров
bank_name Строка (100) Наименование банка-Эмитента
отправителя.
Сбербанк
region Строка (100)
Название региона (области, края)
отправителя. Для США указывается
название штата.
Ленинградская
обл.
country Строка (2) Двухсимвольный код страны Плательщика
в соответствии с ISO 3166-1.
RU
Необязательные параметры
reference Строка (100) Номер Заказа на стороне ТСП (в ИС ТСП). 12345ABC
transaction_id Строка (255)
Уникальный идентификатор цепочки 3DS2
запроса (значение <TransactionId> в ответе
на запрос gateweb/Verify).
cres Строка (255)
Значение параметра cres, полученного от
эмитента по итогам проведения
аутентификации на странице ввода
одноразового пароля.
get_token Целое (1)
Запрос на предоставление токенов
использованных Платёжных карт в составе
xml-сообщений с информацией об
Операции (уведомление на url и запросы,
содержащие информацию по Операции).
Возможные значения: 0, 1.
0 (по умолчанию) — не возвращать токены;
1 — вернуть токены.
 Предупреждение: возможность
получения и использования токена Карты
осуществляется по согласованию с
Оператором.
cvc Строка (3)
Проверочный код Карты Плательщика
CVV2/CVC2/ППК2. Для Карт Maestro может
отсутствовать.
md Строка (64)
Значение <MD>, полученное от Банкаэмитента в результате Запроса 3DS
авторизации
(см. ответ на запрос gateweb/Verify).
pares
Строка (5000)
Значение <PaRes>, полученное от Банкаэмитента в результате Запроса 3DS
авторизации (см. ответ на запрос
gateweb/Verify).
gw_cardholder_ip Строка (255) IP-адрес Плательщика.
gw_resolution Строка (255) Разрешение экрана на устройстве
плательщика. Формат: число + “x” + число
2560x1080
gw_user_agent Строка (255) Значение user-agent браузера
Плательщика в base64-encode.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 85 | 140
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса gateweb/P2PTransfer
ИС ТСП отправляет Запрос gateweb/P2PTransfer в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /gateweb/P2PTransfer HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 518
Content-Type: application/x-www-form-urlencoded
signature=MmMzM2JiN2VmNjg5NzY0MmJjMDAzM2M3YWY2NGEwNzA=&sector=1&amount=20000&fee=
236&currency=643&pan1=4321098765432109&name=CARDHOLDER
NAME&month=05&year=17&cvc=333&pan2=5321098765432109&email=zzz@zzz.zz&md=
0165820609523841,12,0000000000002109,05/17,0165820609523841&pares=eJxVkEFuAjEMRa9
iZd9JQqGlk7csoOxYlR4gyhgmUiaunIB6/A4itKrkjf3t923j5ntKcCUpkXOvbGcUUA48xHzu1edx/7RW
G4fHUYh2HxQuQg4PVIo/E8ShV8ZaY1/Ni3lbLZ8XS6scvouwOgxQNzO7BepHinSTtzyQW6H S
71hnZ7lslX4BNwJmCBiYWAEk2Ua4E4R776FAfwIbDc1oXKUEeC8kUhnmLwdbbrmsWDe3fZUfUXuqNJGH2
u3UVS62sK6naE/h3U/37wA74RbCk=
После обработки Запроса gateweb/P2PTransfer, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной операции (описание см. Приложение №1, п.2);
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<operation>
…
</operation>
(описание формата см. Приложение №1, п.2)
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
HTTP/1.1 200 OK
Content-Type: application/xml;charset=UTF-8
<?xml version="1.0" encoding="UTF-8"?>
<error>
…
</error>
(описание формата см. Приложение №1, п.4)
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать файл payments.xsd c описанием
структуры всех сообщений (предоставляется по запросу).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 86 | 140
Запрос webapi/P2PFee — РАСЧЕТ КОМИССИИ ЗА ПЕРЕВОД
Используйте Запрос webapi/P2PFee для вычисления комиссии к Операции P2PTRANSFER, а также для
получения данных по странам использованных в нём Платёжных карт. Запрос выполняется в режиме
обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
В запросе отсутствуют следующие проверки:
• Проверка подписи. Подпись не требуется;
• Проверка суммы на 0. Если требуется только определить страны эмитентов карт до того, как стала
известна сумма перевода, то можно отправлять 0 в поле суммы;
• Сравнение карт отправителя и получателя. Если сервис использовать для определения страны
только одной карты, можно отправлять ее и в поле pan1 и в поле pan2.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 32. Параметры запроса webapi/P2PFee
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
amount Целое (12) Сумма перевода в минимальных единицах валюты. Для
рублей — копейки. 1000
pan1 Строка (20) Номер Карты отправителя средств.
Параметр необязателен при передаче параметра token1.
pan2 Строка (20) Номер Карты получателя средств.
Параметр необязателен при передаче параметра token2.
Необязательные параметры
token1
Строка (255)
Токен ранее зарегистрированной карты. Позволяет
Плательщику не вводить все реквизиты Карты при
повторной оплате (см. Работа с токеном карты).
token2 Строка (255)
Токен ранее зарегистрированной карты. Позволяет
Плательщику не вводить все реквизиты Карты при
повторной оплате (см. Работа с токеном карты).
mode Целое (1)
Режим ответа на Запрос.
Возможные значения: 0, 2.
0 (значение по умолчанию) — короткий ответ: сумма
комиссии в копейках или -1, если возникла ошибка
расчета комиссии;
2 — xml с результатом расчета комиссии и
дополнительными параметрами.
2
ПРИМЕР – Обмен с ПЦ в рамках выполнения запроса webapi/P2PFee
ИС ТСП отправляет запрос webapi/P2PFee в ПЦ методом HTTP POST. Запрос выполняется в режиме «серверсервер», редирект на Платёжные страницы не используется.
POST /webapi/P2PFee HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 71
Content-Type: application/x-www-form-urlencoded
sector=1&pan1=4809386823367444&pan2=5570712729900562&amount=1000&mode=2
После обработки запроса webapi/P2PFee, ПЦ может прислать один из вариантов ответа:
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 87 | 140
• Вариант 1. Запрос успешно обработан:
o Если mode=0, приходит сумма комиссии в копейках;
3
o Если mode=2, приходит xml с результатом расчета комиссии и дополнительными
параметрами;
• Вариант 2. Обнаружена ошибка:
o Если mode=0 и возникла ошибка при расчёте комиссии:
-1
o Если mode=2, то при какой-либо ошибке, например, неверно указан ID сектора или
некорректный номер карты или отсутствует обязательное поле, ПЦ возвращает xml с
указанием кода ошибки и расшифровкой. Описание формата и список всех ошибок см.
Приложение №1, п.4.
Запрос webapi/P2PDebit — ДЕБЕТОВАЯ ЧАСТЬ ПЕРЕВОДА С КАРТЫ НА КАРТУ
Используйте запрос webapi/P2PDebit для инициирования выполнения операции P2PDEBIT.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 33. Параметры запроса webapi/P2PDebit
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
get_token Целое (1)
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
В дальнейшем токен может использоваться для инициирования
операций по карте без ввода ее реквизитов (см. Работа с
токеном карты).
1
<?xml version="1.0" encoding="UTF-8"?>
<p2pfee>
 <fee_value>3</fee_value>
 <bin1_country>643</bin1_country>
 <bin2_country>643</bin2_country>
</p2pfee>
Где:
<fee_value> — результат расчета комиссии;
<bin1_country> — страна карты отправителя;
<bin2_country> — страна карты получателя.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 88 | 140
 Предупреждение: возможность получения и использования
токена Карты осуществляется по согласованию с Оператором.
token Строка (255)
Токен ранее зарегистрированной карты. Позволяет
Плательщику не вводить все реквизиты Карты при повторной
оплате (см. Работа с токеном карты). При операции перевода на
карту, token приходит в ответном xml-сообщении или в
уведомлении на url.
cvc Строка (3) Проверочный код Карты Плательщика CVV2/CVC2/ППК2. Для
Карт Maestro может отсутствовать. 111
action Строка (3)
Если action=pay, то система работает без отображения
Платёжной страницы Плательщику при условии передачи token
и cvc.
pay
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/P2PDebit
ИС ТСП отправляет Запрос webapi/P2PDebit в ПЦ методом HTTP GET или POST. ПЦ перенаправляет
Плательщика на Платёжную форму для ввода карточных данных.
POST /webapi/P2PDebit HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NjI4ZTk3MzIwOTQ3MTgyYWEwOWQ0NzE3OWM0YTk2Y2M=&sector=1&id=12345
По результатам выполнения операции P2PDEBIT, ПЦ методом HTTP GET перенаправляет Плательщика
обратно на страницу, указанную ранее при регистрации Заказа:
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ; например,
на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное ИС
ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
Если в процессе обработки произошла какая-либо ошибка, то операция в ПЦ не регистрируется. Плательщик
перенаправляется на url из Заказа Запросом такого вида:
HTTP/1.1 302 Moved Temporarily
Location: htt
://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&error=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное ИС
ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 89 | 140
Дополнительно
Необходимость дополнительного Запроса обуславливается требованиями безопасности совершения
платежей.
Автоматические уведомления
Дополнительно, в личном кабинете ТСП можно настроить уведомления от ПЦ о результатах выполнения
Операции. Уведомления могут отправляться по email и через xml-сообщения методом HTTP POST на сервер
ТСП. Формат сообщения см. Приложение №1, п.2.
При этом, на отправленное методом HTTP POST уведомление, ПЦ ожидает от ТСП ответ “ok” в формате
text/plain. При неполучении ответа от сервера ТСП, ПЦ делает ещё две попытки отправить уведомление
с интервалом в 10 минут.
Xml-сообщения с результатами выполнения Операции подписываются цифровой подписью, что позволяет
проверить подлинность отправителя.
Код подтверждения перевода
Если операция P2PDEBIT была совершена успешно, Плательщику на email или phone (см. описание
webapi/Register) будет выслан чек с результатами операции и Кодом подтверждения перевода. Код
необходим для получения денежных средств на карту Получателя, см. описание операции P2PCOMPLETE
ниже. Плательщик должен самостоятельно передать данный код Получателю, чтобы тот смог получить
перевод.
Короткая ссылка для получения перевода
Если операция P2PDEBIT была совершена успешно, то Получателю на email2 или phone2 (см. описание
webapi/Register) будет выслано сообщение с короткой ссылкой для получения перевода. При нажатии на
ссылку откроется платежная форма операции P2PCOMPLETE для получения перевода, см. ниже.

Примечание: для того, чтобы узнать результат выполнения Операции и оплаты Заказа ТСП
необходимо самостоятельно запросить статус соответствующей Операции или Заказа (запросы
webapi/Operation и webapi/Order соответственно).
В качестве альтернативы дополнительного Запроса для подтверждения статуса Операции Вы можете
использовать автоматические xml-уведомления от ПЦ, которые содержат цифровую подпись,
позволяющую проверить подлинность отправителя, см. ниже.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 90 | 140
Запрос webapi/P2PComplete — КРЕДИТОВАЯ ЧАСТЬ ПЕРЕВОДА С КАРТЫ НА КАРТУ
Используйте Запрос webapi/P2PComplete для инициирования выполнения операции P2PCOMPLETE.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 34. Параметры запроса webapi/P2PComplete
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
signature Строка
(255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
Обязательно при action=pay
transfer_code Целое (6)
Код подтверждения перевода, сгенерированный на этапе
проведения дебетовой половинки P2P (см. операцию
P2PDebit).
123456
Необязательные параметры
get_token Целое (1)
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
В дальнейшем токен может использоваться для
инициирования операций по карте без ввода ее реквизитов
(см. Работа с токеном карты).
1
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
token Строка
(255)
Токен ранее зарегистрированной карты. Позволяет
Плательщику не вводить все реквизиты Карты при
повторной оплате (см. Работа с токеном карты). При
операции перевода на карту, token приходит в ответном
xml-сообщении или в уведомлении на url.
action Строка (3)
Если action=pay, то система работает без отображения
Платёжной страницы Плательщику при условии передачи
token.
pay
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса webapi/P2PComplete
ИС ТСП отправляет Запрос webapi/P2PComplete в ПЦ методом HTTP GET или POST. ПЦ перенаправляет
Плательщика на Платёжную форму для ввода данных Получателя средств: номера карты Получателя и кода
подтверждения.
POST /webapi/P2PComplete HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NjI4ZTk3MzIwOTQ3MTgyYWEwOWQ0NzE3OWM0YTk2Y2M=&sector=1&id=12345
Если код подтверждения перевода совпадет с тем, который был сгенерирован по результатам операции
P2PDEBIT, то будет совершена попытка зачислить денежные средства на карту Получателя. По результатам
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 91 | 140
выполнения операции P2PDEBIT в ПЦ Плательщику будет отображен результат совершения операции и
отправлен результат на email2 и phone2 из Заказа (см. webapi/Register).
Для открытия формы на получение перевода используйте короткую ссылку, отправленную Получателю на
email2 и phone2 из Заказа (см. webapi/Register).
Автоматические уведомления
Дополнительно, в личном кабинете ТСП можно настроить уведомления от ПЦ о результатах выполнения
Операции. Уведомления могут отправляться по email и через xml-сообщения методом HTTP POST на сервер
ТСП. Формат сообщения см. Приложение №1, п.2.
При этом, на отправленное методом HTTP POST уведомление, ПЦ ожидает от ТСП ответ “ok” в формате
text/plain. При неполучении ответа от сервера ТСП, ПЦ делает ещё две попытки отправить уведомление
с интервалом в 10 минут.
Xml-сообщения с результатами выполнения Операции подписываются цифровой подписью, что позволяет
проверить подлинность отправителя.
Запрос gateweb/P2PCredit — ЗАЧИСЛЕНИЕ СРЕДСТВ НА КАРТУ СО СЧЕТА ТСП
Используйте Запрос gateweb/P2PCredit для инициирования выполнения операции P2PCREDIT.
Примечание: перед выполнением gateweb/P2PCredit рекомендуется зарегистрировать Заказ (сервис
webapi/Register). Регистрация Заказа не обязательна, но позволит избежать случайного дублирования
операций выплат, инициируемых Мерчантом.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 35. Параметры запроса gateweb/P2PCredit
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе) в указанном порядке: sector, id, amount,
currency, pan, token, password. см. Приложение №2.
12345ABC
Условно-обязательные параметры
(Обязательно указать либо id, либо совокупность параметров amount, currency, reference.
Также, обязательно указать либо pan, либо token)
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса webapi/Register.
Необязательно при передаче параметров amount,
currency и reference.
12345
amount Целое (12)
Сумма новой Операции в минимальных единицах
валюты. Для рублей — копейки.
Необязательно при передаче параметра id.
1000
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR;
840 для USD).
Необязательно при передаче параметра id.
643
reference Строка (100) Номер заказа на стороне ТСП в его Системе
магазина.
123456
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 92 | 140
Необязательно при передаче параметра id.
pan Строка (20) Номер карты получателя средств.
Необязательно при передаче параметра token.
token Строка (255)
Токен ранее зарегистрированной карты получателя
средств.
Необязательно при передаче параметра pan.
Обязательно для перевода на иностранную карту
address Строка (100)
Адрес отправителя. Общий формат: название улицы,
номер дома, номер квартиры/офиса.
Заполняйте латиницей.
Shirokaya str,
b. 2, fl. 36
city Строка (100)
Название населённого пункта отправителя (города,
посёлка и т.д.).
Заполняйте латиницей.
SaintPetersburg
post_code Строка (100) Индекс отправителя (ZIP code). 197022
countrynum Строка (3) Код страны резидентства отправителя (ISO numeric). 643
name Строка (100) Имя на карте отправителя.
Заполняйте латиницей. Sender Name
receiver_name Строка (100) Имя получателя средств.
Заполняйте латиницей.
Receiver
Name
Необязательные параметры
get_token Целое (1)
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать токен;
1 — вернуть токен.
В дальнейшем токен может использоваться для
инициирования операций по карте без ввода ее
реквизитов (см. Работа с токеном карты).
1
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
email Строка (100)
Адрес электронной почты получателя, на который
ему высылается письмо с информацией о результате
операции.
mail@ex.com
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса gateweb/P2PCredit
ИС ТСП отправляет Запрос gateweb/P2PCredit в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /gateweb/P2PCredit HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 108
Content-Type: application/x-www-form-urlencoded
signature=ZGFmZWI0NTYwNDk5YmY0ZWE5NTMyM2ZmY2I4NmZkNTc=&sector=1&pan=432109876543210
9&amount=380&currency=643
В ответ на данный Запрос ПЦ присылает сообщение в формате xml с результатом выполнения операции
(см. Приложение №1, п.2).
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID
сектора), либо отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и
расшифровкой. Описание формата и список всех ошибок см. в Приложении №1, п.5.
Запрос webapi/P2PCreditBalance — БАЛАНС СЧЕТА СЕКТОРА
Используйте Запрос webapi/P2PCreditBalance для получения информации о доступном балансе на счету
виртуальной карты сектора. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на
Платёжные страницы не используется.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 93 | 140
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 36. Параметры запроса webapi/P2PCreditBalance
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
nonce Число (12)
Уникальный номер Запроса. Каждый очередной Запрос должен
иметь значение параметра nonce не меньшее, чем в
предыдущем Запросе.
4
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, nonce, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения запроса /webapi/P2PCreditBalance
ИС ТСП отправляет Запрос webapi/P2PCreditBalance в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/P2PCreditBalance HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 71
Content-Type: application/x-www-form-urlencoded
sector=1&nonce=123&signature=MzkxYzQ0YTQ4MjNhZDgzNmExMzA1NGNlOTY0NTQyOTk=
При получении Запроса, ПЦ выполняет следующие проверки:
• Подпись должна быть рассчитана правильно;
• Сектор должен быть активным;
• Параметр nonce Запроса должен быть больше, чем значение этого параметра, полученное от
сектора в предыдущем Запросе webapi/P2PCreditBalance;
• Сектор должен иметь виртуальную карту;
• Сектор должен иметь разрешение на использование Запроса.
Если все проверки пройдены успешно, после обработки Запроса webapi/P2PCreditBalance, ПЦ может
прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с балансом карты;
<?xml version="1.0" encoding="UTF-8"?>
<P2PCreditBalance>
<nonce>10</nonce>
<amount>2842261</amount>
<currency>643</currency>
<signature>YmQyMTU1MzQ5YjMzZTYxYTUzOWRhM2E4MGVkYjJlYmU2ZmYxYTNkYzRhYWRlYzQ
xZjQxYzMyYmQ0Mjc5MzI0Mg==</signature>
</P2PCreditBalance>
Где:
<nonce> — значение nonce из Запроса;
<amount> — сумма остатка по виртуальной карте сектора;
<currency> — валюта остатка по виртуальной карте сектора.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 94 | 140
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос gateweb/CardInfo — ПОЛУЧЕНИЕ ИНФОРМАЦИИ ПО КАРТЕ
Используйте Запрос gateweb/CardInfo для получения различной информации по конкретной карте от ПЦ
и Эмитента.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 37. Параметры запроса gateweb/CardInfo
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
pan Строка (20)
Номер Карты Плательщика.
Параметр необязателен при передаче параметра
token.
month Целое (2) Месяц срока действия Карты. 8
year Целое (4) Год срока действия Карты. 2015
signature Строка
(255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, pan, token, month,
year, cvc, password. Либо sector, pansha256, token,
month, year, cvc, password в указанном порядке,
см. Приложение №2
Необязательные параметры
get_token Целое (1)
Запрос на предоставление токена (см. Работа с
токеном карты) использованной в Операции
Платёжной карты в составе уведомления на url.
Возможные значения: 0, 1.
0 (значение по умолчанию) — не возвращать
токен;
1 — вернуть токен.
1
 Предупреждение: возможность получения и
использования токена Карты осуществляется по
согласованию с Оператором.
token Строка
(255)
Токен ранее зарегистрированной Платёжной
карты Плательщика. Позволяет Плательщику не
вводить все реквизиты Карты при повторной
оплате (см. Работа с токеном карты).
pan_sha256 Строка (20)
Хэш номера карты по алгоритму sha256.
Используется только при заданном pan. При
указании параметра, участвует в формировании
подписи вместо pan. При получении значения
pan_sha256, ПЦ сверяет его с аналогичным
хэшем, полученным от значения параметра pan.
cvc Строка (3) Код карты CVV2/CVC2. Используется только для
mode=1. Если не указан, не проверяется.
111
get_opercount_type Строка (12)
Поле для указания типа операций, которые нужно
подсчитать. Список допустимых значений:
1 — AUTHORIZE
8
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 95 | 140
2 — COMPLETE
3 — PURCHASE
4 — REVERSE
6 — RECURRING
7 — P2PTRANSFER
8 — P2PCREDIT
opercount_start Строка (20)
Начало периода, в котором необходимо
подсчитать операции в формате yyyy.MM.dd
HH:mm:ss Используется только при заданном
get_opercount_type. Если opercount_start не
задан, он считается равным первому числу
текущего месяца (00:00:00).
2015.07.01
00:00:00
opercount_end Строка (20)
Конец периода, в котором необходимо
подсчитать операции в формате yyyy.MM.dd
HH:mm:ss Используется только при заданном
get_opercount_type. Если opercount_end не задан,
он считается равным дате и времени получения
Запроса.
2015.07.01
23:00:00
get_p2pcredit_term Целое (1)
0 (по умолчанию) — признак онлайн-зачисления
<P2PcreditOnline> не возвращается в ответном
xml-сообщении;
1 — требуется в ответном xml-сообщении вернуть
признак онлайн-зачисления на карту в теге
<P2PcreditOnline>.
0
get_issuername Целое (1)
0 (по умолчанию) — название эмитента карты
<IssuerName> в ответном xml-сообщении не
требуется;
1 — требуется в ответном xml-сообщении вернуть
название эмитента карты в теге <IssuerName>.
0
mode Целое (1)
Если параметр mode=1, то ПЦ возвратит
сокращённую информацию только по Заказу, без
информации по каждой операции Заказа.
1
check_blacklist2 true/false
Запрос на дополнительную проверку номера
карты по спискам карт, запрещенных для
использования на данном секторе в качестве
карты зачисления. Возможные значения:
0 – (по умолчанию) — проверку не проводить;
1 — провести проверку.
0
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса gateweb/CardInfo
ИС ТСП отправляет Запрос gateweb/CardInfo в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /gateweb/CardInfo HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 103
Content-Type: application/x-www-form-urlencoded
signature=ZGFmZWI0NTYwNDk5YmY0ZWE5NTMyM2ZmY2I4NmZkNTc=&sector=1&pan=43210987654321
09&month=12&year=2020
В ответ на данный Запрос ПЦ присылает сообщение в формате xml:
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 96 | 140
<?xml version="1.0" encoding="UTF-8"?>
<cardInfo>
 <responseCode>001</responseCode>
 <responseMessage>Successful execution of financial
transactions</responseMessage>
 <approvalCode>501807</approvalCode>
 <cardType>D</cardType>
 <issuerName>JOINT STOCK COMMERCIAL BANK \MOSCOW INDUSTRIAL
BANK\""</issuerName>
 <p2pCreditTerms>true</p2pCreditTerms>
 <token>58488b5e-287d-4157-8be9-3573011d6b3a</token>
 <operationCount>
 <operationType>P2PCredit</operationType>
 <start>2016.09.01 00:00:00</start>
 <end>2016.09.16 20:46:51</end>
 <count>
 <approved>2</approved>
 <rejected>2</rejected >
 </count>
 </operationCount>
</cardInfo>
Где:
<IssuerName> — Эмитент карты;
<p2pCreditTerms> — признак онлайн-зачисления карты для операций p2p;
<ResponseCode> — код результата проверки карты у Эмитента;
<ResponseMessage> — расшифровка результата проверки карты у Эмитента.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 97 | 140
Работа с процедурами идентификации
Запрос webapi/b2puser/IdentificationStatus — ИДЕНТИФИКАЦИЯ ФИЗЛИЦА
Используйте запрос webapi/b2puser/IdentificationStatus для проведения идентификации физического лица
по его реквизитам паспорта и ФИО в ПЦ. Запрос выполняется в режиме обмена данными «сервер-сервер»,
без перенаправления Плательщика на Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 38. Параметры запроса webapi/b2puser/IdentificationStatus
Название Тип
(длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
first_name Строка (30) Имя физического лица. Иван
patronymic Строка (30) Отчество физического лица. Петрович
last_name Строка (30) Фамилия физического лица. Иванов
birth_date Строка (10) Дата рождения физического лица, которое нужно
идентифицировать. Формат: ГГГГ.ММ.ДД 2000.09.12
persondoc_number Строка (20) Серия и номер паспорта физического лица.
signature Строка
(255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, first_name, patronymic, last_name,
birth_date, persondoc_number, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
mode Целое (1)
Возможные значения: 0, 1.
0 (по умолчанию) — проверка всех документов.
1 — только проверка паспорта.
1
Предупреждение: разрешение на
использование параметра mode
предоставляется по согласованию с Оператором.
Рекомендуемый тайминг переотправки запросов
Во избежание перегрузки информационной системы, для получения конечного статуса по упрощённой
идентификации, рекомендуется использовать прогрессивную шкалу тайминга переотправки запросов.
Схема переопроса статуса идентификации (тайминг указан в минутах):
0 → 1 → 1 → 1 → 1 → 5 → 5 → 10 → 15 → 30 → 60 → 60 → 60 → ...
Где: 0 — первый запрос на идентификацию клиента, а 1, 5, 10, 15, 30, 60 — количество минут, спустя
которое, при неполучении конечного статуса <identification_state> (APPROVED или INN_NOT_FOUND),
рекомендуется отправить повторный запрос на уточнение статуса идентификации.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/IdentificationStatus
ИС ТСП отправляет Запрос webapi/b2puser/IdentificationStatus в ПЦ методом HTTP POST. Запрос
выполняется в режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/IdentificationStatus HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 167
Content-Type: application/x-www-form-urlencoded
signature=MWMwYjEyZWJmZWFkZTY1YzNlNGE3ZTA4ZjZjMTBjODk=&sector=1&first_name=Сидоров
&patronymic=Иван&last_name=Петрович&birth_date=2000.12.12&persondoc_number=4455777
888
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 98 | 140
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса.
В ответ на запрос, при успехе приходит один из следующих вариантов ответа:
• Вариант 1. Проверка только ИНН. Приходит xml с описанием текущего статуса идентификации
физического лица:
<identification_data>
 <identification_state>СТАТУС</identification_state>
 <inn>ИНН</inn>
 <signature>подпись ответа</signature>
</identification_data>
Поле <identification_state> отображает текущий статус идентификации физического лица.
Поле может содержать одно из следующих значений:
o UNKNOWN. Фасадная заглушка для статуса, который мы не умеем обрабатывать;
o PENDING. В очереди на проверку (данные на внешний сервис не отправлялись);
o APPROVED. ИНН есть;
o SENT. ИНН пока нет, ждем ответа от внешней системы (он же, если не удалось проверить
по таймауту);
o FORMAT_ERROR. Ошибка формата данных на проверку;
o INN_NOT_FOUND. ИНН не найден;
• Вариант 2. Проверка паспорта и ИНН. Приходит xml с описанием текущего статуса идентификации
физического лица:
<identification_data>
<persondoc_result>300 - Document validated</persondoc_result>
<signature>ZjViZmJjMTQ1ZTI3MDQ4NzEwZDNkYjg3NWRiM2MyYTEzMTYzMjAxNTgyYzR
hNDA5MzJkNWIwYzkzMTcxYmY5MA==</signature>
<identification_state>APPROVED</identification_state>
<inn>263450780409</inn>
<message>Inn successfully found</message>
<identification_level>40 - Паспорт валидный, ИНН
найден</identification_level>
<request_id>1061</request_id>
</identification_data>
• Вариант 3. Проверка только паспорта. Приходит xml с описанием текущего статуса идентификации
физического лица:
<identification_data>
<persondoc_result>300 - Document validated</persondoc_result>
<signature>MmM4MTM4YTA5MTUzMmExZTA3MGQyNWYzNTFlN2ZlZWFjNTA1NmFjM2VhYjR
iNWNmMDExNWQ5N2MzMGYxYTU1Mw==</signature>
<identification_state>INN_NOT_FOUND</identification_state>
<message>Inn not found. Check personal data</message>
<request_id>1068</request_id>
</identification_data>
 Предупреждение: Варианты 2 и 3 доступны только по согласованию с Оператором.
При неудаче приходит сообщение в формате xml с указанием кода ошибки и расшифровкой. Например,
если обнаружена ошибка значения какого-либо параметра запроса (допустим, ID сектора указан неверно),
либо если отсутствует одно из обязательных полей.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 99 | 140
При успешном запросе, но невозможности произвести идентификацию, в ответе придет параметр
persondoc_fail_reason, возможные значения см. в таблице ниже.
Таблица 39. Расшифровка возможных значений кодов ответа IdentificationStatus
Название Описание
Возможные значения <persondoc_result>
1 - No data Нет данных
300 - Document validated Документ валидирован
301 - Document validation failed Неуспешная валидация документа
302 - Document not found Документ не найден
Возможные значения <identification_level>
0 - паспорт недействителен, ИНН не проверяли
10 - паспорт не валидировался, ИНН не найден
20 - паспорт действителен, ИНН не найден
30 - паспорт не валидировался, ИНН найден
40 - паспорт валидный, ИНН найден
Возможные значения <persondoc_fail_reason>
601 - Expired Истёк срок действия
602 - Replaced with new Заменен на новый
603 - Issued incorrectly Выдан с нарушением
604 - Lost or stolen Числится в розыске
604 - Lost or stolen Изъят, уничтожен
606 - Owner is dead В связи со смертью владельца
607 - Technically defective Технический брак
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 100 | 140
Работа со скоринговым баллом
Запрос webapi/GetScoring — ПОЛУЧЕНИЕ СКОРИНГ-БАЛЛА КЛИЕНТА
Используйте запрос webapi/GetScoring для получения скоринг-балла клиента по ФИО и реквизитам карты.
Запрос выполняется в режиме обмена данными «сервер-сервер», без перенаправления Плательщика на
Платёжные страницы ПЦ.
Ниже перечислены параметры, которые могут быть использованы в запросе.
Таблица 40. Параметры запроса webapi/GetScoring
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
first_name Строка (100) Имя владельца карты. Иван
patronymic Строка (100) Отчество владельца карты. Петрович
last_name Строка (100) Фамилия владельца карты. Иванов
birth_date Строка (10) Дата рождения владельца карты.
Формат: ГГГГ-ММ-ДД 2000.09.12
phone Строка (100) Телефон владельца карты. 79219999999
received_at Строка (10) Дата получения согласия на выполнение запроса.
Формат: ГГГГ-ММ-ДД
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры (если они использованы в
запросе): sector, token (либо pan_sha256 или pan),
first_name, last_name, patronymic, birth_date, phone,
password в указанном порядке, см. Приложение №2.
Условно-обязательные параметры
(обязательно должен присутствовать либо token, либо pan_sha256,
либо реквизиты карты — параметры pan, month и year)
token Строка (255) Токен ранее зарегистрированной Платёжной карты
(см. Работа с токеном карты).
pan_sha256 Строка (20) Хэш номера карты по алгоритму sha256.
pan Строка (20) Номер карты.
month Целое (2) Месяц срока действия карты. 8
year Целое (4) Год срока действия карты. 2029
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/GetScoring
ИС ТСП отправляет Запрос webapi/GetScoring в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект не используется.
POST /webapi/GetScoring HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 264
Content-Type: application/x-www-form-urlencoded
sector=6744&pan_sha256=6B86B273FF34FCE19D6B804EFF5A3F5747ADA4EAA22F1D49C01E52DDB78
75000&first_name=ГАЛИНА&last_name=ВАСИЛЬКОВА&patronymic=ПЕТРОВНА&birth_date=1953-
04-08&signature=N2RmN2ZmZDdjZjVkYzUwZjU4ZjA4MTQwN2RiZDhiOTQ=&received_at=2021-01-
01&phone=79991001222
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 101 | 140
После обработки Запроса webapi/GetScoring, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит результат проверки скоринг-балла в формате xml
следующего вида:
<?xml version="1.0" encoding="UTF-8"?>
<scoring>
 <okb>
 <model_1>
 <score>1.0</score>
 <request_id>2117c0e0-670e-4c2d-badd-ef123e6b8c0b</request_id>
 </model_1>
 <model_2>
 <score>1.0</score>
 <request_id>fa0a9bf1-de37-46eb-bcc4-251898d4ba9b</request_id>
 </model_2>
 </okb>
</scoring>
Где:
<okb> — наименование вендора, через которого осуществлена проверка;
<model_1> — стратегия проверки кредитного риска физического лица;
<model_2> — стратегия проверки принадлежности карты физическому лицу;
<request_id> — уникальный идентификатор запроса проверки по выбранной стратегии.
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 102 | 140
Работа с смс
В ПЦ реализованы сервисы отправки смс на телефонные номера плательщиков и проверки статуса доставки
отправленных сообщений.
При отправке, каждому отправляемому сообщению ПЦ присваивает идентификационный номер, который
можно использовать для проверки статуса доставки сообщения.
По умолчанию, отправка сообщений осуществляется от имени Paygine. Это имя указывается в адресе
отправителя смс.
Предупреждение: услуга Работа с смс предоставляется по согласованию с Оператором.
Также, по согласованию с Оператором, у ТСП есть возможность изменить имя отправителя на другое
цифробуквенное значение, если оно соответствует требованиям Оператора.
Запрос gateweb/SmsSend — ОТПРАВКА СМС
Используйте Запрос gateweb/SmsSend для отправки смс-сообщений.
При указании номера телефона придерживайтесь международного формата: код_страны код_оператора
номер_телефона. Ведущий знак «+» указывать не нужно, цифры номера телефона по группам разбивать не
требуется. Для прямых городских номеров мобильных телефонов также рекомендуется использовать
полный, федеральный формат.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 41. Параметры запроса gateweb/SmsSend
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
message Строка (1000)
Текст сообщения. Длина одного сообщения:
• Латиница: не более 160 символов;
• Присутствует кириллица: не более 70
символов.
При превышении этих границ сообщение
автоматически разделяется на несколько частей,
каждая из которых не превышает 153 символа в
латинице и 67 символов при наличии кириллицы.
Спасибо за
сотрудничество
phones Строка (1000)
Список номеров телефонов получателей,
указанных через запятую. Формат номера:
код_страны код_оператора номер_телефона, без
ведущего знака «+», не более 20 символов в длину.
89219992211,89
119991111
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, message, phones,
password в указанном порядке, см. Приложение
№2.
Необязательные параметры
rus_param Целое (1)
Код режима обработки сообщения.
Возможные значения: 0, 1, 5.
0 (по умолчанию) — Кодировка Windows-1251.
Русские символы транслитерируются в латиницу.
Максимальное количество символов в одном
сообщении — 160 (153 для склеенного сообщения).
0
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 103 | 140
1 — Кодировка Windows-1251. Максимальное
количество символов в одном сообщении — 70 (67
для склеенного сообщения). Если сообщение
содержит только латиницу, максимальное
количество символов не меняется.
5 — Кодировка UTF-8. Максимальное количество
символов в одном сообщении — 70 (67 для
склеенного сообщения). Если сообщение содержит
только латиницу, максимальное количество
символов не меняется.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса gateweb/SmsSend
ИС ТСП отправляет Запрос gateweb/SmsSend в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /gateweb/SmsSend HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 94
Content-Type: application/x-www-form-urlencoded
signature=YmMxMDFiYTIzZTA1NWRiOGMyZTE1MWEwNTRjOWY4ZTU=&sector=1&message=hi&phones=
796018122211
При поступлении данного Запроса, ПЦ генерирует задания на отправку смс с текстом сообщения message
на телефоны из параметра phones.
В ответ на Запрос gateweb/SmsSend ПЦ присылает результат отправки в виде xml-сообщения:
<?xml version="1.0" encoding="UTF-8" standalone="true"?>
<sms_send>
 <packet_id>361</packet_id>
 <sender_name>Paygine</sender_name>
 <message>testtext</message>
 <message_infos>
 <message_info>
 <phone>89211112233</phone>
 <sms_id>341</sms_id>
 </message_info>
 </message_infos>
</sms_send>
Где:
<packet_id> — идентификатор пакета отправки;
<sender_name> — имя отправителя, которое будет показано получателю;
<sms_id> — идентификатор смс, отправленной на конкретный номер.
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID сектора)
или отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и расшифровкой.
Описание формата и список всех ошибок см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 104 | 140
Запрос gateweb/SmsStatus — ПРОВЕРКА СОСТОЯНИЯ ОТПРАВЛЕННЫХ СМС
Используйте сервис gateweb/SmsStatus для проверки состояния отправленных смс сообщений.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 42. Параметры запроса gateweb/SmsStatus
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
sms_id Строка (1000) Список идентификаторов, разделённых запятой. 7867
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, sms_id, password в указанном порядке, см.
Приложение №2.
ПРИМЕР – Обмен с ПЦ в рамках выполнения Запроса gateweb/SmsStatus
ИС ТСП отправляет Запрос gateweb/SmsStatus в ПЦ методом HTTP POST. Запрос выполняется в режиме
«сервер-сервер», редирект на Платёжные страницы не используется.
POST /gateweb/SmsStatus HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 75
Content-Type: application/x-www-form-urlencoded
signature=YmMxMDFiYTIzZTA1NWRiOGMyZTE1MWEwNTRjOWY4ZTU=&sector=1&sms_id=7867
При поступлении этого Запроса ПЦ опрашивает стxатусы отправленных смс с указанными
идентификаторами. В ответ на Запрос gateweb/SmsStatus ПЦ присылает информацию о статусах доставки
смс в виде сообщения в формате xml:
<?xml version="1.0" encoding="UTF-8" standalone="true"?>
<sms_status>
<sms>
 <sms_id>365</sms_id>
 <status>Delivered</status>
 <submition_date>2016-08-31 17:44:30</submition_date>
 <send_date>2016-08-31 17:44:30</send_date>
 <last_status_change_date>2016-08-31 17:45:00</last_status_change_date>
</sms>
</sms_status>
Где:
<packet_id> — идентификатор пакета отправки;
<status> — статус передачи сообщения;
<submition_date> — дата и время приёма сообщения в сервис отправки;
<send_date> — дата и время отправки сообщения оператору;
<last_status_change_date> — дата и время доставки или время последнего изменения
статуса сообщения.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 105 | 140
Таблица 43. Статусы доставки
Статус Значение Тип
Нет статуса (пустая строка) Нет данных Промежуточный
Buffered SMSC Доставляется Промежуточный
Delivered Доставлено Окончательный
Non Delivered Не доставлено Окончательный
Rejected Отказ в передаче Окончательный
Expired Просрочено Окончательный
Deleted Удалено Окончательный
Unknown status Неизвестный статус Окончательный
При работе с операторами используется время с точностью до минуты, поэтому значение
last_status_change_date всегда имеет нулевые секунды. Таким образом, возможна ситуация, когда время
отправки сообщения (send_date), например, равно 18:43:38, а время доставки сообщения получателю
(last_status_change_date) содержит значение 18:43:00. Следует учитывать это при работе с ответными xml.
Время доставки на российские и украинские номера телефонов передаётся в московском часовом поясе.
Время доставки на номера других стран передаётся в локальном часовом поясе абонента.
Статусы хранятся в течение двух дней. На попытки Запроса статусов сообщений, отправленных более двух
дней, назад будет возвращаться ошибка: no such message or this message does not belong to you.
Если обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно указан ID сектора)
или отсутствует одно из обязательных полей, ПЦ возвращает xml с указанием кода ошибки и расшифровкой.
Описание формата и список всех ошибок см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 106 | 140
Работа с QR-кодом СБП
Оплата QR-кодом СБП осуществляется с помощью мобильных приложений банков, участвующих в Системе
Быстрых Переводов (СБП). Инициация процесса оплаты происходит следующим образом:
1. Мобильное устройство проверяет вызываемые на нём ссылки, в том числе считанные
приложениями распознавания QR-кодов.
2. В случае обращения к ссылке, связанной с каким-то приложением, устройство предлагает
использовать это приложение для открытия ссылки.
ПЦ не участвует непосредственно в процессе оплаты, а проводит следующую процедуру:
1. Регистрирует в СБП намерение выполнить оплату с помощью QR-кода.
2. Одним из установленных способов передает в ТСП полученную от СБП ссылку на оплату. Время
жизни такой ссылки — 72 часа.
3. Получает от СБП информацию об успешной регистрации намерения об оплате.
4. В течение жизни платежной ссылки ПЦ уточняет актуальный статус оплаты.
5. Получив данные об изменении статуса, ПЦ отражает эти изменения в своей системе.
ТСП для выполнения оплаты с помощью QR-кода СБП может использовать один из следующих подходов:
Оплата без показа страниц ПЦ
Чтобы оплата прошла без показа страниц ПЦ, ТСП при выполнении запроса webapi/Register передает
значение параметра ps=11. Тогда вместе с регистрацией Заказа ПЦ сразу регистрирует у себя в системе
операцию PURCHASE_BY_QR и обращается в СБП для регистрации намерения оплаты и получения ссылки
для оплаты QR-кодом по данному Заказу.
В случае успешного обмена информацией с СБП, в ответе на запрос webapi/Register среди деталей
зарегистрированного Заказа придет информация об идентификаторе QR-кода и ссылка для оплаты QRкодом. ТСП может самостоятельно отдать эту ссылку своим Плательщикам одним из следующих способов:
• Формируя вызов ссылки на устройстве Плательщика;
• Генерируя QR-код (ISO/IEC 18004-2015);
• Переводя Плательщика на страницу ПЦ Запросом webapi/PurchaseSBP (в случае необходимости;
например, как запасной вариант).
Оплата с показом страниц ПЦ
Чтобы оплата прошла с показом страниц ПЦ, ТСП может использовать запрос webapi/Register, не заполняя
параметр ps значением 11 (либо заполнив, если нужна оплата только через QR-код СБП). После регистрации
Заказа ТСП нужно перевести Плательщика на страницу ПЦ Запросом webapi/PurchaseSBP.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 107 | 140
Запрос webapi/PurchaseSBP — ОПЛАТА QR-кодом СБП
Используйте Запрос webapi/PurchaseSBP для проведения Операции PURCHASE_BY_QR. Плательщик
перенаправляется на Платёжные страницы ПЦ до выполнения Запроса.
Ниже перечислены параметры, которые могут быть использованы в Запросе. Валюта, сумма и комиссия
Операции в Запросе не задаются, они берутся из Заказа (параметры currency, amount и fee Запроса
webapi/Register).
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 44. Параметры Запроса webapi/PurchaseSBP
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/PurchaseSBP
ИС ТСП перенаправляет Плательщика методом HTTP GET или POST с использованием Запроса
webapi/PurchaseSBP на Платёжную страницу ПЦ, где Плательщику будет показан QR-код для оплаты Заказа
и кнопка проверки статуса оплаты:
POST /webapi/PurchaseSBP HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 72
Content-Type: application/x-www-form-urlencoded
signature=NTVjMDVlYmFlM2E1YmY1NmIxNTA3MzA2ZjZiNTU5NTQ=&sector=1&id=70365
После этого Плательщик производит действия, необходимые для оплаты:
• Либо нажимает на картинку с QR-кодом (если Платежная страница открыта на мобильном
устройстве, поддерживающем оплату по QR-коду СБП);
• Либо сканирует QR-код мобильным устройством, поддерживающим оплату по QR-коду СБП.
В это время страница с QR-кодом остается открытой и с некоторой периодичностью проверяет статус оплаты
Заказа в СБП. Через некоторое время автоматические проверки статуса прекращаются. Для принудительной
проверки статуса можно использовать кнопку проверки статуса.
По результатам проверки статуса оплаты Заказа и в зависимости от значений параметров url и failurl,
указанных ранее при регистрации Заказа (Запрос webapi/Register), Плательщику будет показан один из
следующих вариантов итоговой страницы:
• Вариант 1. Если параметр Заказа url не заполнен, Плательщику выводится типовая форма экранного
чека ПЦ, либо сообщение об ошибке.
HTTP/1.1 200 OK
(HTML c типовой формой экранного чека ПЦ)
• Вариант 2. Если параметры Заказа url / failurl заполнены, и Операция в ПЦ проведена без ошибок,
Плательщик методом HTTP GET перенаправляется на страницу, адрес которой был указан в Запросе
webapi/Register в значении параметра url (если операция одобрена), либо failurl (если получен
отказ).
При успешном выполнении (операция была сформирована и одобрена):
HTTP/1.1 302 Moved Temporarily
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 108 | 140
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=229&reference=12345ABC
При неуспешном выполнении (операция была сформирована, но получен отказ;
например, на карте недостаточно средств):
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Fail.jsp?id=12345&operation=229&reference=12345ABC&code
=4
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ;
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
code — код ответа операции (Reason Code), см. Приложение №1, п.5.
 Примечание: при соответствующих настройках, сделанных в ЛК ТСП, на заданный адрес ПЦ
отправляет автоматическое уведомление о проведенной операции. Формат уведомления — xmlдокумент (описание см. в Приложении №1, п.2) с деталями Операции. Режим отправки
уведомления — один раз в 5 минут, но не более трех раз, либо до получения от адресата
сообщения “ok” в формате text/plain.
• Вариант 3. Если параметры Заказа url / failurl заполнены, и при проведении Операции в ПЦ
выявлены ошибки, то Плательщик методом HTTP GET перенаправляется на страницу, адрес которой
был указан в Запросе webapi/Register в значении параметра failurl (если параметр был задан), либо
url (если failurl не был задан).
Для упрощения разбора xml-сообщений от Процессингового центра Вы можете использовать файл
payments.xsd c описанием структуры всех сообщений (предоставляется по запросу).
 Важно: если в рамках бизнес-процесса ТСП требуется уточнить результат Операции (или
удостовериться в его точности) или получить информацию о состоянии Заказа, то ТСП может это сделать,
реализовав на своей стороне дополнительные Запросы webapi/Operation, webapi/Order к ПЦ для
получения детальной информации по нужной Операции или Заказу. Рекомендации использовать
дополнительные Запросы обусловлены требованиями повышения безопасности совершения платежей.
HTTP/1.1 302 Moved Temporarily
Location:
https://www.somesite.ru/Accept.jsp?id=12345&operation=0&reference=12345ABC&erro
r=127
Где:
id — идентификационный номер Заказа в ПЦ;
operation — идентификационный номер Операции в ПЦ (если 0 — Операция не
зарегистрирована);
reference — номер Заказа на стороне ТСП (значение параметра reference, заданное
ИС ТСП при выполнении Запроса webapi/Register);
error — код ошибки, см. Приложение №1, п.4.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 109 | 140
Запрос webapi/PurchaseSBPQRLink — ПОЛУЧЕНИЕ ССЫЛКИ НА QR-код СБП
Используйте Запрос webapi/PurchaseSBPQRLink для получения ссылки на QR-код СБП. Запрос выполняется
в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 45. Параметры Запроса webapi/PurchaseSBPQRLink
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
email Строка (100) Адрес электронной почты плательщика.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/PurchaseSBPQRLink
ИС ТСП отправляет Запрос webapi/PurchaseSBPQRLink в ПЦ методом HTTP GET или POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/PurchaseSBPQRLink HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 76
Content-Type: application/x-www-form-urlencoded
signature=ODQ3MjRjOWU1ZDY3ODc5ZDhmOWQxYmZlYzkwZTE4MjI=&sector=1869&id=458923
После обработки Запроса webapi/PurchaseSBPQRLink, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами ссылки
на QR-код;
<?xml version="1.0" encoding="UTF-8"?>
<data>
<sbpOperationId>3431</sbpOperationId>
<link>https://test.paygine.com/webapi/QRCodeForPurchase?sector=1869&amp;i
d=458923&amp;signature=ODQ3MjRjOWU1ZDY3ODc5ZDhmOWQxYmZlYzkwZTE4MjI=</link
>
<nspkLink>https://qr.nspk.ru/AD10003P8GIQFB4Q92U91CRO17EPOK55</nspkLink>
</data>
<success>true</success>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 110 | 140
Запрос webapi/RegisterSbpQRCash — РЕГИСТРАЦИЯ КАССОВОЙ ССЫЛКИ СБП
Используйте Запрос webapi/RegisterSbpQRCash для регистрации кассовой ссылки СБП. Запрос выполняется
в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 46. Параметры Запроса webapi/RegisterSbpQRCash
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, password в указанном порядке, см.
Приложение №2.
Необязательные параметры
description Строка (140)
Описание для регистрации кассовой ссылки в нашей
системе.
Значение по умолчанию: "Оплата в пользу
идентификатор мерчанта по кассовой ссылке на счет
номер счета"
url Строка (500) Ссылка для автоматического возврата Плательщика из
приложения Банка в приложение или на сайт ТСП.
get_qr_img Целое (1)
Возможные значения: 0 (по умолчанию), 1.
0 — не генерировать QR код;
1 — сгенерировать QR код (в ответе придет base64-
значение сгенерированной картинки QR кода,
содержащего в себе адрес короткой ссылки).
0
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/RegisterSbpQRCash
ИС ТСП отправляет Запрос webapi/RegisterSbpQRCash в ПЦ методом HTTP GET или POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/RegisterSbpQRCash HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 132
Content-Type: application/x-www-form-urlencoded
signature=ZWZmNTczMDViZTFmM2U0NzU0YWIzNTc0ZWRjNDdjMzg=&sector=893&amount=1000&cur
rency=643&description=desc&qr_ttl=1000&get_qr_img=1
После обработки Запроса webapi/RegisterSbpQRCash, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
зарегистрированной ссылки;
<?xml version="1.0" encoding="UTF-8"?>
<RegisterSbpQRSCash>
<date>2022.04.05 13:35:33</date>
<qrcId>AS1R0033R5OPJN0H84RBR83V53U25C2P</qrcId>
<code>RQ00000</code>
<payload>https://qr.nspk.ru/AS1R0033R5OPJN0H84RBR83V53U25C2P?type=01&amp
;bank=100000000010&amp;crc=5207</payload>
<image_data>iVBORw0KGgoAAAANSUhEUgA</image_data>
<description>Оплата в пользу MA0000000000 по кассовой ссылке на счет
40702810620010000000</description>
<id>1393</id>
<state>CREATED</state>
<message>Запрос обработан успешно</message>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 111 | 140
</RegisterSbpQRSCash>
• Вариант 2. Запрос обработан, но получен отказ от НСПК;
<?xml version="1.0" encoding="UTF-8"?>
<RegisterSbpQRSCash>
<id>1001</<id>
<date>2021.05.31 16:33:20</date>
<state>REJECTED</state>
<code>RQ03001</code>
<message>Wrong message format</message>
</RegisterSbpQRSCash>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос webapi/ActivateSbpQRCash — АКТИВАЦИЯ КАССОВОЙ ССЫЛКИ СБП
Используйте Запрос webapi/ActivateSbpQRCash для активации кассовой ссылки СБП. Запрос выполняется в
режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 47. Параметры Запроса webapi/ActivateSbpQRCash
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (9)
Номер зарегистрированного в ПЦ QRCash (значение
параметра id, полученного по итогам выполнения
webapi/RegisterSbpQRCash)
amount Целое (12) Сумма Операции в минимальных единицах валюты. Для
рублей — копейки.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, amount, currency, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
currency Целое (3)
Код валюты по ISO4217 (643 для RUB; 978 для EUR; 840
для USD).
643
reference Строка (100) Номер заказа на стороне ТСП в его Системе магазина. 123456
email Строка (100) Адрес электронной почты плательщика.
description Строка (140)
Описание для регистрации кассовой ссылки в нашей
системе. Если не задан — берётся значение параметра
description из webapi/RegisterSbpQRCash
qr_ttl Строка (2)
Cрок активности Кассовой ссылки в минутах.
Минимальное допустимое значение — 5 (значение по
умолчанию на стороне НСПК).
Максимальное допустимое значение — 20.
fiscalData JSON в base64 Фискальные данные.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 112 | 140
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/ActivateSbpQRCash
ИС ТСП отправляет Запрос webapi/ActivateSbpQRCash в ПЦ методом HTTP GET или POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/ActivateSbpQRCash HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 147
Content-Type: application/x-www-form-urlencoded
signature=N2JjMDhhZTQ3N2I3NjkxNjJjNjc0NjlhM2IyYWNjMDc=&sector=893&id=9852&amount=
1000&currency=643&reference=test&email=zzz@zzz.zz&description=test
После обработки Запроса webapi/ActivateSbpQRCash, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
активированной ссылки;
<?xml version="1.0" encoding="UTF-8"?>
<ActivateSbpQRCash>
<reference>test</reference>
<qrcId>AS10002Q29IQ0CEQ8FE8O4V4FILH4HN5</qrcId>
<paramsId>AP10003S5JHBH6O88L8Q3QQL5ER7VASE</paramsId>
<code>RQ05014</code>
<activate_state>OK</activate_state>
<message>Запрос обработан успешно</message>
<order_id>2926508</order_id>
</ActivateSbpQRCash>
• Вариант 2. Запрос обработан, но получен отказ от НСПК;
<?xml version="1.0" encoding="UTF-8"?>
<ActivateSbpQRCash>
<reference>test</reference>
<qrcId>AS10002Q29IQ0CEQ8FE8O4V4FILH4HN5</qrcId>
<code>RQ05014</code>
<activate_state>REJECT</activate_state>
<message>Значение qrcId не найдено</message>
<order_id>2926508</order_id>
</ActivateSbpQRCash>
• Вариант 3. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 113 | 140
Запрос webapi/DeactivateSbpQRCash — ДЕАКТИВАЦИЯ КАССОВОЙ ССЫЛКИ СБП
Используйте Запрос webapi/DeactivateSbpQRCash для деактивации кассовой ссылки по агентской схеме
СБП. Запрос выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 48. Параметры Запроса webapi/DeactivateSbpQRCash
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (9)
Номер зарегистрированного в ПЦ QRCash (значение
параметра id, полученного по итогам выполнения
webapi/RegisterSbpQRCash)
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, password в указанном порядке, см.
Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/DectivateSbpQRCash
ИС ТСП отправляет Запрос webapi/DeactivateSbpQRCash в ПЦ методом HTTP GET или POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/DeactivateSbpQRCash HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 73
Content-Type: application/x-www-form-urlencoded
signature=N2FiZGVmNTlmYTc5NDg3M2UxY2ZhZWY1NGI2NjdkZTQ=&sector=893&id=9865
После обработки Запроса webapi/DeactivateSbpQRCash, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с параметрами
деактивированной ссылки;
<?xml version="1.0" encoding="UTF-8"?>
<DeactivateSbpQRCash>
<qrcId>AS1R000CO7QN4GHG81OB3LV4IJ01DLJK</qrcId>
<code>RQ00000</code>
<message>Запрос обработан успешно</message>
</DeactivateSbpQRCash>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 114 | 140
Запрос webapi/GetSBPSubscription — РЕГИСТРАЦИЯ СБП-ПРИВЯЗКИ БЕЗ ОПЛАТЫ
Используйте Запрос webapi/GetSBPSubscription для регистрации функциональной СБП-ссылки для привязки
счёта плательщика к счёту ТСП без совершения оплаты. Запрос выполняется в режиме обмена данными
«сервер-сервер», редирект на Платёжные страницы не используется.
Для осуществления привязки, Плательщик переходит по ссылке из поля payload ответа
webapi/GetSBPSubscription и даёт согласие на привязку своего счета к счету ТСП. Статус привязки придет в
колбэке об изменении статуса СБП-привязки.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 49. Параметры Запроса webapi/GetSBPSubscription
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
description Строка (140)
Назначение привязки счета. Данная информация будет
отображаться на экране Плательщика при оформлении
привязки счета в приложении Банка Плательщика.
Рекомендуется предоставлять максимально
подробную информацию о привязке счета, включая,
если применимо, регулярность платежей, сумму
регулярных платежей и пр.
Привязка
счета для
оплат в
пользу АО
Кофеек,
регулярность
раз в месяц,
сумма 100
рублей
 Предупреждение: запрещается передавать в
description переносы строки и специальные символы.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, description, password в
указанном порядке, см. Приложение №2.
Необязательные параметры
url Строка (500)
Ссылка для автоматического возврата Плательщика из
приложения Банка в приложение или на сайт ТСП.
 Предупреждение: допускаются только символы в
кодировке ASCII. Формат должен соответствовать
спецификации RFC-3986.
life_period Целое (6)
Срок жизни ссылки в минутах. Если параметр не
определён, то время жизни ссылки составит 4320
минут (3 дня).
60
get_qr_img Целое (1)
Получение изображения QR-кода. Возможные
значения: 0, 1.
0 (по умолчанию) — не генерировать QR код;
1 — сгенерировать QR код (в ответе придет base64 -
значение сгенерированной картинки QR кода,
содержащего в себе адрес короткой ссылки).
1
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/GetSBPSubscription
ИС ТСП отправляет Запрос webapi/GetSBPSubscription в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/GetSBPSubscription HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 244
Content-Type: application/x-www-form-urlencoded
signature=OTA5NTJkNGMzMzAyYzczZTNkNWE1YWQwZDA4NzZlNDc=&sector=1869&description=Пр
ивязка счета для оплат в пользу АО Кофеек, регулярность раз в месяц, сумма 100
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 115 | 140
рублей&url=https://helpline.paygine.com/issues/355783&life_period=2500&get_qr_img
=0
После обработки Запроса webapi/GetSBPSubscription, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с СБП-ссылкой;
<?xml version="1.0" encoding="UTF-8"?>
<GetSBPSubscription>
<id>9652</id>
<date>2024.03.21 16:43:05</date>
<state>CREATED</state>
<message>Запрос обработан успешно</message>
<description>Привязка счета для оплат в пользу АО Кофеек, регулярность
раз в месяц, сумма 100 рублей</description>
<qrcId>BB1S002MRVDB143A8MTR97H5TNHHAOVT</qrcId>
<payload>https://sub.nspk.ru/BB1S002MRVDB143A8MTR97H5TNHHAOVT?type=03&ba
nk=100000000123&crc=4640</payload>
</GetSBPSubscription>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос webapi/PurchaseSBPByToken — БЕЗАКЦЕПТНАЯ ОПЛАТА ПО СБП-ПРИВЯЗКЕ
Используйте Запрос webapi/PurchaseSBPByToken для безакцептного списания средств со счета
Плательщика и последующего перевода средств на счет ТСП с использованием ранее выпущенной СБПпривязки. Помимо стандартных кодов ответа, по данному запросу может прийти один из кодов ответа для
оплат по ранее осуществленной СБП-привязке. Запрос выполняется в режиме обмена данными «серверсервер», редирект на Платёжные страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 50. Параметры Запроса webapi/PurchaseSBPByToken
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ, полученный
по результатам Запроса webapi/Register.
12345
token Строка (39)
СБП-токен, полученный ТСП во время осуществления
привязки. Поле token из колбэка об изменении статуса
СБП-привязки.
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, token, password в
указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/PurchaseSBPByToken
ИС ТСП отправляет Запрос webapi/PurchaseSBPByToken в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/PurchaseSBPByToken HTTP/1.1
Host: test.paygine.com
Accept: */*
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 116 | 140
Content-Length: 119
Content-Type: application/x-www-form-urlencoded
signature=ZjExZTg5YThlYjNlMTNhZGQ5ZmFhYzQxYWNjYTQ2MWU=&sector=1869&id=498002&toke
n=SBPebb46-ebf1-4bec-907c-545a36ea9f34
После обработки Запроса webapi/PurchaseSBPByToken, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<operation>
<order_id>498015</order_id>
<order_state>COMPLETED</order_state>
<reference>09b87b8b-f2e2-409b-a931-17ead12f4f4b</reference>
<id>459769</id>
<date>2024.05.13 18:41:19</date>
<type>PURCHASE_BY_QR</type>
<state>APPROVED</state>
<amount>1000</amount>
<fee>0</fee>
<currency>643</currency>
<token>SBP838e1-0083-49b2-89df-f2c5575dbd9c</token>
<sector_id>1869</sector_id>
<ps>11</ps>
<ofd_link>https://test.paygine.com/ofd/getReceipt?sector=1869&operationI
d=459769&signature=NGI4MjdlNjBlMTRhYTRhOTE5Y2Y5YTQ0M2UzNTBlZjc=</ofd_lin
k>
<ofd_state/>
<payload>https://qr.nspk.ru/BD100054FETM6IS990AAA4BMRQILISU3?type=02&ban
k=100000000123&sum=1000&cur=RUB&crc=5548</payload>
<multiple/>
<qrcId>BD100054FETM6IS990AAA4BMRQILISU3</qrcId>
<signature>Nzk0ZDk2NzFhYTI4NDRmYjk2MzcyY2U4MzdjZDg0ZWI=</signature>
</operation>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос test/SBPTestCase — ПРОВЕДЕНИЕ ТЕСТ-КЕЙСОВ СБП
Используйте Запрос test/SBPTestCase для проведения операций и тестовых кейсов по qrc_id. Запрос
выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
Предупреждение: данный сервис доступен только для запуска на тестовом стенде.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 51. Параметры Запроса test/SBPTestCase
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
case_id Строка (3)
Номер тест-кейса для запуска. Возможные варианты:
150 – Уведомление об успешном статусе Операции СБП;
151 – Уведомление о неуспешном статусе Операции СБП;
150
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 117 | 140
158 – Успешная оплата по QR-коду c осуществлением
привязки;
1581 – Успешная оплата по QR-коду с отказом в
проведении привязки;
154 – Успешное оформление привязки счёта;
155 – Неуспешное оформление привязки счёта;
301 – Успешный платеж QR Static (при amount= 1000301);
221 – Уведомление об успешном статусе Операции СБП
(QR Dynamic);
222 – Уведомление о неуспешном статусе Операции СБП
(QR Dynamic);
223 – Уведомление об успешном статусе Операции СБП
при задержке статуса операции (QR Static);
232 – Успешная оплата по Кассовой ссылке СБП;
233 – Неуспешная оплата по Кассовой ссылке СБП.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, case_id, qrc_id, order_id, password в
указанном порядке, см. Приложение №2.
Условно-обязательные параметры (один из них должен быть в запросе)
qrc_id Строка (32) Идентификатор зарегистрированной Функциональной
ссылки СБП.
order_id Целое (19) Номер заказа, который использовался для регистрации
QR-Dynamic.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса test/SBPTestCase
ИС ТСП отправляет Запрос test/SBPTestCase в ПЦ методом HTTP GET или POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /test/SBPTestCase HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 117
Content-Type: application/x-www-form-urlencoded
signature=MzJkMGZmYmM4NjUxYmIyMTg1MjZmMTkyM2ZmMTFjOWU=&sector=893&case_id=150&qrc
_id=AS1R000KOMEPGAIE9519CB1Q4PGN6ULN
После обработки Запроса test/SBPTestCase, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<?xml version="1.0" encoding="UTF-8"?>
<SBPTestCase>
<qrc_id>AS1R000KOMEPGAIE9519CB1Q4PGN6ULN</qrc_id>
<message>[00150: не запущен] Тестовый сценарий запущен</message>
</SBPTestCase>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос webapi/b2puser/GetSBPBankList — СПРАВОЧНИК БАНКОВ С СБП
Для получения системного справочника банков, поддерживающих СБП, используйте сервис
webapi/b2puser/GetSBPBankList. Запрос выполняется в режиме обмена данными «сервер-сервер» (без
перенаправления Плательщика на Платёжные страницы ПЦ).
Ниже перечислены параметры, которые могут быть использованы в запросе.
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 118 | 140
Таблица 52. Параметры запроса webapi/b2puser/GetSBPBankList
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
nonce Целое (16)
Уникальный номер Запроса. Каждый очередной Запрос
должен иметь значение параметра nonce не меньшее, чем
было указано в предыдущем Запросе.
201912311
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры (если они использованы в запросе): sector, nonce,
password в указанном порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/b2puser/GetSBPBankList
ИС ТСП отправляет Запрос webapi/b2puser/GetSBPBankList в ПЦ методом HTTP POST. Запрос выполняется
в режиме «сервер-сервер», редирект не используется.
POST /webapi/b2puser/GetSBPBankList HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 76
Content-Type: application/x-www-form-urlencoded
signature=ZmYwZWU5ZmIzNGFiNTM1NzZkNTAwYzVmOWU4YjQxYzQ=&sector=893&nonce=5133
При получении запроса ПЦ проверяет:
• Правильность расчета подписи и корректность параметров запроса. Если есть ошибки — ПЦ
возвращает ошибку выполнения запроса;
• Наличие разрешения сектора на использование сервиса. Если разрешение отсутствует, ПЦ
возвращает ошибку выполнения запроса.
Если ошибок нет, ПЦ отправляет xml-сообщение следующего вида:
<GetSBPBankList>
<nonce>1</nonce>
<dataList>
<row>
<id>100000000001</id>
<title>Газпромбанк</title>
<latinTitle>Gazprombank</latinTitle>
</row>
<row>
<id>100000000002</id>
<title>РНКО Платежный центр</title>
<latinTitle>RNKO Payment Center</latinTitle>
</row>
<row>
<id>100000000003</id>
<title>СКБ-банк</title>
<latinTitle>SKB-bank</latinTitle>
</row>
<row>
<id>100000000004</id>
<title>Тинькофф Банк</title>
<latinTitle>Tinkoff Bank</latinTitle>
</row>
</dataList>
<signature>ZDg2M2NmMWNjNTRlYzI0MzNjZWJiZWY2NWNlNDg4MGE=</signature>
</GetSBPBankList>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 119 | 140
Запрос webapi/sbp/SBPCreditPrecheck — ПРОВЕРКА ВОЗМОЖНОСТИ ВЫПЛАТЫ ЧЕРЕЗ
СБП
Используйте Запрос webapi/sbp/SBPCreditPrecheck для проверки возможности выплаты через СБП. Запрос
выполняется в режиме обмена данными «сервер-сервер», редирект на Платёжные страницы не
используется.
Для тестирования данного сервиса обратитесь к разделу Тестовые сценарии для сервисов СБП-выплат.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 53. Параметры Запроса webapi/sbp/SBPCreditPrecheck
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в
ПЦ. 1
id Целое (19)
Уникальный идентификатор Заказа в ПЦ,
полученный по результатам Запроса
webapi/Register.
12345
signature Строка (255)
Цифровая подпись. В формировании подписи
участвуют параметры: sector, id, recipientBankId,
phone, password в указанном порядке, см.
Приложение №2.
Условно-обязательные параметры (указывать либо phone и recipientBankId, либо token)
phone Строка (20)
Номер телефона Получателя. Если параметр
phone был задан при регистрации Заказа, то
значение берется из Заказа.
79219999999
recipientBankId Строка (100)
Идентификатор Банка Получателя из справочника
участников СБП.
token Строка (39)
СБП-токен, полученный ТСП во время
осуществления привязки. Чтобы осуществлять
выплаты по такому СБП-токену, необходимо
предварительно разово провести по нему
операцию списания с последующей отменой.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/sbp/SBPCreditPrecheck
ИС ТСП отправляет Запрос webapi/sbp/SBPCreditPrecheck в ПЦ методом HTTP GET или POST. Запрос
выполняется в режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/sbp/SBPCreditPrecheck HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 122
Content-Type: application/x-www-form-urlencoded
signature=OTliMDgzNDU1ZTQ4OTVhMjdkZTg0N2FlNmU1YTZiNzY=&sector=893&id=471174&recip
ientBankId=100000000091&phone=70130610091
После обработки Запроса webapi/sbp/SBPCreditPrecheck, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<?xml version="1.0" encoding="UTF-8"?>
<SBPCreditPrecheck>
 <precheck_id>b8777c68e0a041ada283c3e89c413636</precheck_id>
 <amount>1074</amount>
 <recipientBankId>100000000091</recipientBankId>
 <pam>Svetlana L</pam>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 120 | 140
</SBPCreditPrecheck>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос webapi/sbp/SBPCredit — B2C ВЫПЛАТЫ ЧЕРЕЗ СБП
Используйте Запрос webapi/sbp/SBPCredit для перевода средств со счёта ТСП на счёт клиента через систему
быстрых платежей по номеру телефона. Запрос выполняется в режиме обмена данными «сервер-сервер»,
редирект на Платёжные страницы не используется.
Для тестирования данного сервиса обратитесь к разделу Тестовые сценарии для сервисов СБП-выплат.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 54. Параметры Запроса webapi/sbp/SBPCredit
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
id Целое (19) Уникальный идентификатор Заказа в ПЦ, полученный по
результатам Запроса webapi/Register.
12345
precheck_id Строка (100)
Уникальный идентификатор проверки возможности
создания B2C перевода, полученный по результатам
запроса webapi/sbp/SBPCreditPrecheck.
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, id, precheck_id, password в указанном
порядке, см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/sbp/SBPCredit
ИС ТСП отправляет Запрос webapi/sbp/SBPCredit в ПЦ методом HTTP GET или POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/sbp/SBPCredit HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 120
Content-Type: application/x-www-form-urlencoded
signature=N2YwYTQ1N2QyZjcxZmZkNTNiMmM0NDZiZGYzMTdiMzE=&sector=893&id=471174&prech
eck_id=b8777c68e0a041ada283c3e89c413636
После обработки Запроса webapi/sbp/SBPCredit, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml;
<?xml version="1.0" encoding="UTF-8"?>
<operation>
<order_id>471174</order_id>
<order_state>COMPLETED</order_state>
<id>430484</id>
<date>2023-02-13T17:37:29.754+03:00</date>
<type>CREDIT_BY_QR</type>
<reference>2bb5ba4f-7ca6-476a-b805-ba9626f36aa1</reference>
<state>APPROVED</state>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 121 | 140
<reason_code>1</reason_code>
<message>Successful execution of financial transactions</message>
<pam>Svetlana L</pam>
<phone>70130610091</phone>
<recipient_bank_id>100000000091</recipient_bank_id>
<external_id>A30441436408270100000515C0C78A01</external_id>
<amount>1074</amount>
<currency>643</currency>
<signature>ODI4ZDkxMGNjYzc5Y2EyZmY0MjExZTUxNDYzZWM2ZGM=</signature>
</operation>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Запрос webapi/sbp/SBPCreditBalance — БАЛАНС СЧЕТА ТСП ДЛЯ СБП-ВЫПЛАТ
Используйте Запрос webapi/sbp/SBPCreditBalance для получения информации о доступном балансе на счете
ТСП для организации СБП-выплат. Запрос выполняется в режиме обмена данными «сервер-сервер»,
редирект на Платёжные страницы не используется.
Ниже перечислены параметры, которые могут быть использованы в Запросе.
 Важно: пишите названия параметров именно так, как они представлены в таблице ниже.
Неправильно: SECTOR, Start_Date, transaction_ID, p008_1
Правильно: sector, start_date, transaction_id, P008-1
Таблица 55. Параметры Запроса webapi/sbp/SBPCreditBalance
Название Тип (длина) Описание Пример
Обязательные параметры
sector Целое (19) Уникальный идентификатор учетной записи ТСП в ПЦ. 1
nonce Целое (12)
Уникальный номер Запроса. Каждый очередной Запрос
должен иметь значение параметра nonce не меньшее, чем
в предыдущем запросе.
15
signature Строка (255)
Цифровая подпись. В формировании подписи участвуют
параметры: sector, nonce, password в указанном порядке,
см. Приложение №2.
ПРИМЕР — Обмен с ПЦ в рамках выполнения Запроса webapi/sbp/SBPCreditBalance
ИС ТСП отправляет Запрос webapi/sbp/SBPCreditBalance в ПЦ методом HTTP POST. Запрос выполняется в
режиме «сервер-сервер», редирект на Платёжные страницы не используется.
POST /webapi/sbp/SBPCreditBalance HTTP/1.1
Host: test.paygine.com
Accept: */*
Content-Length: 74
Content-Type: application/x-www-form-urlencoded
signature=N2YwYTQ1N2QyZjcxZmZkNTNiMmM0NDZiZGYzMTdiMzE=&sector=893&nonce=28
После обработки Запроса webapi/sbp/SBPCreditBalance, ПЦ может прислать один из вариантов ответа:
• Вариант 1. Запрос успешно обработан. Приходит сообщение в формате xml с балансом или
ошибкой проверки баланса по всем доступным счетам ТСП. В данном примере у ТСП 2 счета: по
активному счету показан доступный баланс, а по второму счету получена ошибка со стороны банка
(не со стороны ПЦ);
<?xml version="1.0" encoding="UTF-8"?>
<SBPCreditBalance>
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 122 | 140
<nonce>12345</nonce>
<account>
 <id>*1234567</id>
 <bank>sbp-credit-random-bank</bank>
 <amount>6900</amount>
 <account_details>
 <currency>643</currency>
 <status>Активен</status>
 </account_details>
</account>
<account>
 <id>*7654321</id>
 <bank>sbp-credit-random-bank</bank>
 <error> // тег присутствует если по счёту была получена ошибка
 <description>Ошибка: Некорректный номер расчетного
счета</description>
 <сode>219</сode>
 </error>
</account>
</SBPCreditBalance>
• Вариант 2. Обнаружена ошибка в значении какого-либо параметра Запроса (например, неверно
указан ID сектора), либо отсутствует одно из обязательных полей. Приходит сообщение в формате
xml с указанием кода ошибки и расшифровкой (описание см. Приложение №1, п.4, там же список
возможных значений ошибок).
Тестовые сценарии для сервисов СБП-выплат
Для облегчения тестирования интеграции по СБП-выплатам, на стороне ПЦ реализован механизм,
имитирующий работу СБП-сервисов по основным тестовым сценариям. Тестовые сценарии доступны для
связки из следующих сервисов:
• webapi/sbp/SBPCreditPrecheck — проверка возможности выплаты через СБП;
• webapi/sbp/SBPCredit — перевод средств со счёта ТСП на счёт клиента через СБП по номеру
телефона.
 Предупреждение: данный функционал предназначен для использования исключительно на тестовом
стенде. Не используйте на боевом стенде.
Тестовые сценарии представляют собой разные варианты ответов ПЦ на вызов тестовых запросов в
зависимости от набора значений входящих параметров.
Для воспроизведения желаемого сценария, вызовите запрос webapi/sbp/SBPCreditPrecheck с указанными
параметрами phone и recipientBankId, а затем вызовите запрос webapi/sbp/SBPCredit с полученным
precheck_id.
Таблица 56. Тестовые сценарии для сервисов SBPCreditPrecheck и SBPCredit
Название сценария phone recipientBankId
Основной сценарий.
Успешный пречек c последующей успешной СБПвыплатой
Значения phone и recipientBankId не должны
соответствовать ни одному из
нижеперечисленных.
Успешный пречек c последующей СБП-выплатой в
статусе REJECTED
79110123456
100000000003
Успешный пречек c последующей СБП-выплатой в
статусе ERROR 100000000004
Успешный пречек c последующей СБП-выплатой в
статусе TIMEOUT 100000000005
/Confidential
И н т е г р а ц и я с П р о ц е с с и н г о в ы м Ц е н т р о м С т р а н и ц а 123 | 140
Успешный пречек c последующей СБП-выплатой в
статусе PENDING→APPROVED 100000000006
Успешный пречек c последующей СБП-выплатой в
статусе PENDING→REJECTED 100000000007
Неуспешный пречек с ошибкой 281 (Хост отклонил
запрос по причине неверных параметров)
100000000008
Неуспешный пречек с ошибкой 282
(Запрос не авторизован)
100000000009
Неуспешный пречек с ошибкой 283
(Запрашиваемый ресурс не найден)
100000000010
Неуспешный пречек с ошибкой 284 (Ошибка
выполнения операции на стороне банка-эквайера)
100000000011
Неуспешный пречек с ошибкой 285
(Банк-эквайер недоступен)
100000000012
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 124 | 140
Приложение №1. Описание форматов xml-сообщений от ПЦ
Для упрощения разбора xml-сообщений от ПЦ Вы можете использовать приложенный файл payments.xsd c
описанием структуры всех сообщений.
1. Формат xml-сообщения, присылаемого на операцию REGISTER
<?xml version="1.0" encoding="UTF-8"?>
<order>
 <id>457</id>
 <state>REGISTERED</state>
 <inprogress>0</inprogress>
 <date>2013.03.01 15:52:02</date>
 <amount>111</amount>
 <currency>643</currency>
 <email>mail@somesite.com</email>
 <phone>79219999999</phone>
 <reference>12345ABC</reference>
 <description>notebook</description>
 <url>http://www.somesite.com/Accept.jsp</url>
 <parameters number="1">
 <parameter>
 <name>mode</name>
 <value>1</value>
 </parameter>
 </parameters>
 <signature>NzA4MjllNTczMTZlMGZjN2RlNGNlMmQ2Njc5ZDJhMjU=</signature>
</order>
Где:
<id> — номер Заказа в ПЦ;
<state> — статус Заказа в ПЦ;
<inprogress> — признак нахождения Заказа в процессе оплаты (0 — в рамках Заказа
нет активных Операций; 1 — в рамках Заказа есть активная Операция);
<date> — дата и время регистрации Заказа в ПЦ;
<parameters number="1"> — тег, содержащий описание значений всех дополнительных
параметров, переданных в Запросе webapi/Register. Атрибут number задает количество
вложенных параметров;
<signature> — цифровая подпись сообщения. В подписи участвуют значения всех тегов
в порядке их следования и пароль для расчета цифровой подписи, предоставляемый ТСП
после его регистрации в ПЦ.
Если Заказ находится в процессе оплаты (inprogress=1), то новые Операции в рамках данного Заказа не
регистрируются во избежание дублированных оплат.
Важно: ТСП должен всегда проверять цифровую подпись для проверки целостности полученных
данных и идентификации отправителя сообщений, см. Приложение №2.
Остальные поля дублируют то, что было в Запросе на регистрацию Заказа. Если какие-то необязательные
поля в Запросе отсутствовали, то в ответном xml будут отсутствовать соответствующие теги.
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 125 | 140
2. Формат xml-уведомления по результатам выполнения операции, присылаемого ПЦ на
сервер ТСП методом HTTP POST
Этот же формат используется в ответных сообщениях на Запросы AUTHORIZE, COMPLETE, REVERSE,
OPERATION.
<?xml version="1.0" encoding="UTF-8"?>
<operation>
 <order_id>441</order_id>
 <order_state>AUTHORIZED</order_state>
 <reference>12345ABC</reference>
 <id>10427</id>
 <date>2013.02.28 00:23:19</date>
 <type>AUTHORIZE</type>
 <state>APPROVED</state>
 <reason_code>1</reason_code>
 <message>Successful financial transaction</message>
 <name>cardholder name</name>
 <pan>676531******0129</pan>
 <email>mail@somesite.com</email>
 <amount>111</amount>
 <currency>643</currency>
 <approval_code>739258</approval_code>
 <signature>OGRiNGEyNGI0ZjkzOGY5ODVjY2Q5ZTE4YzE1MzM4YjQ=</signature>
</operation>
Где:
<order_id> — идентификатор Заказа, в рамках которого была операция;
<order_state> — статус Заказа после выполнения Операции;
<reference> — номер Заказа на стороне ТСП в его Системе магазина;
<id> — идентификатор операции в ПЦ;
<date> — дата и время совершения операции в ПЦ;
<type> — тип операции, отправленной в ПЦ;
<state> — результат выполнения операции в ПЦ;
<reason_code> — код ответа на операцию ПЦ, см. п.6 ниже;
<message> — краткое описание кода ответа на операцию ПЦ;
<name> — имя на банковской карте Плательщика;
<pan> — маскированный номер банковской карты Плательщика;
<email> — электронная почта Плательщика;
<amount> — сумма операции;
<currency> — валюта операции;
<approval_code> — код авторизации, полученный в Банке на данную операцию;
<signature> — цифровая подпись сообщения. В подписи участвуют значения всех тегов
в порядке их следования и пароль для расчёта цифровой подписи, предоставляемый ТСП
после его регистрации в ПЦ.
Важно: ТСП должен всегда проверять цифровую подпись для проверки целостности полученных
данных и идентификации отправителя сообщений, см. Приложение №2.
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 126 | 140
Некоторых теги, такие как: <name>, <pan>, <pan2>, <email>, <approval_code>, <token>, <token2>,
<expdate>, могут присутствовать / отсутствовать в зависимости от типа и статуса операции.
Дополнительные теги, которые могут быть добавлены в ответ вида <operation> (по согласованию с
Оператором):
Запрос / операция Тег Описание
Операция P2PTRANSFER
<pan2> Маскированный номер карты получателя средств.
<fee>
Комиссия за осуществления перевода в
минимальных единицах валюты. Для рублей —
копейки.
Операция P2PDEBIT <transfer_code>
Код подтверждения перевода, сгенерированный на
этапе проведения дебетовой половинки P2P (см.
операцию P2PDebit).
Запросы webapi/Order,
webapi/Operation
<token> Токен карты (если в запросе передан get_token=1).
Запросы webapi/Order,
webapi/Operation,
webapi/Reverse и
webapi/ReverseKeepRec
при оплате через СБП
<payerId> Идентификатор плательщика от НСПК.
<sbp_phone> Телефон, к которому привязан счет СБП куда
вернутся средства.
<sbp_bank_id> Уникальный идентификатор банка.
<sbp_bank_name> Наименование банка, куда вернутся средства.
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 127 | 140
3. Формат xml-сообщения, присылаемого в ответ на Запрос ORDER
<?xml version="1.0" encoding="UTF-8"?>
<order>
 <id>441</id>
 <state>REGISTERED</state>
 <inprogress>0</inprogress>
 <date>2012.09.05 17:52:48</date>
 <amount>111</amount>
 <currency>643</currency>
 <email>mail@somesite.com</email>
 <phone>79219999999</phone>
 <reference>12345ABC</reference>
 <description>notebook</description>
 <url>http://www.somesite.com/Accept.jsp</url>
 <operations number="4">
 <operation>
 <id>2685</id>
 <date>2012-09-06 10:19:54</date>
 <type>PURCHASE</type>
 <state>TIMEOUT</state>
 <reason_code>14</reason_code>
 <message>Timeout operation</message>
 <name>Mr card holder</name>
 <pan>676531******0129</pan>
 <email>mail@somesite.com</email>
 <amount>12000</amount>
 <currency>643</currency>
 </operation>
 <operation>
 <id>2686</id>
 <date>2012-09-06 10:21:08</date>
 <type>PURCHASE</type>
 <state>APPROVED</state>
 <reason_code>1</reason_code>
 <message>Successful financial transaction</message>
 <name>Mr card holder</name>
 <pan>676531******0129</pan>
 <email>mail@somesite.com</email>
 <amount>12000</amount>
 <currency>643</currency>
 <approval_code>739258</approval_code>
 </operation>
 <operation>
 <id>2687</id>
 <date>2012-09-06 10:23:49</date>
 <type>REVERSE</type>
 <state>TIMEOUT</state>
 <reason_code>14</reason_code>
 <message>Timeout operation</message>
 <amount>12000</amount>
 <currency>643</currency>
 </operation>
 <operation>
 <id>2688</id>
 <date>2012-09-06 10:24:23</date>
 <type>REVERSE</type>
 <state>APPROVED</state>
 <reason_code>1</reason_code>
 <message>Successful financial transaction</message>
 <amount>12000</amount>
 <currency>643</currency>
 <approval_code>739258</approval_code>
 </operation>
 </operations>
 <signature>MjZiMjk2ZTU0YjM0ZTQzZGY0YTk1NmI3YWM4MTcyZGM=</signature>
</order>
Где:
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 128 | 140
<signature> — цифровая подпись сообщения. В подписи участвуют значения всех тегов
в порядке их следования и пароль для расчёта цифровой подписи, предоставляемый ТСП
после его регистрации в ПЦ.
Важно: ТСП должен всегда проверять цифровую подпись для проверки целостности полученных
данных и идентификации отправителя сообщений, см. Приложение №2.
Описание остальных тегов соответствует их описанию в п.1 и п.2 настоящего Приложения.
4. Формат xml-сообщения об ошибке
<?xml version="1.0" encoding="UTF-8"?>
<error>
 <description>Sector not found </description>
 <code>105</code>
</error>
Где:
<description> — текстовое сообщение об ошибке;
<code> — код ошибки.
Возможные варианты ошибок приведены в таблице ниже.
Таблица 57. Возможные варианты ошибок
Сообщение на русском Сообщение на английском Код
Неправильный ID операции Incorrect Operation ID 100
Неправильный ID заказа Incorrect Order ID 101
Неправильный ID сектора Incorrect Sector ID 102
Операция не найдена Operation not found 103
Заказ не найден Order not found 104
Сектор не найден Sector not found 105
Операция не принадлежит Заказу Operation does not belong to specified
Order 106
Операция не принадлежит сектору Operation does not belong to specified
Sector 107
Заказ не принадлежит Сектору Order does not belong to specified Sector 108
Неверная цифровая подпись Invalid signature 109
Отсутствует параметр ‘reference’ Missing reference 110
Отсутствует параметр 'amount' Missing amount 111
Отсутствует параметр 'currency' Missing currency 112
Валюта отличается от валюты Сектора Currency does not match Sector's currency 113
Отсутствует электронная почта Missing email 114
Неверная электронная почта Invalid email 115
Отсутствует телефон Missing phone 116
Неверный формат телефона Invalid phone 117
Заказ не зарегистрирован в базе данных ПЦ Order not registered in DB 118
ТСП не активирован в ПЦ Sector is not active 121
Длина параметра ‘description’ превышает
заданное ограничение
Description is too long 122
Длина параметра 'email' превышает заданное
ограничение
Email is too long 123
Длина параметра 'phone' превышает заданное
ограничение
Phone is too long 124
Длина параметра 'URL' превышает заданное
ограничение
URL is too long 125
Заказ уже находится в процессе оплаты Order is in progress 126
Плательщик отказался от совершения операции Canceled by Customer 127
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 129 | 140
Неправильная сумма операции Invalid amount 128
Валюта отличается от валюты Заказа Currency does not match Order's currency 129
Внутренняя ошибка Internal error 130
Заказ не авторизован Order not authorized 131
Оригинальная операция не найдена Original operation not found 132
Неправильный статус Заказа для указанной
Операции
Incorrect Order state for specified
Operation 133
Сумма Операции превышает сумму
оригинальной Операции
Operation amount exceeds the original
transaction amount 134
Сумма Возврата не равна сумме оригинальной
Операции
Reverse amount exceeds the original
transaction amount 135
Неправильный код валюты Invalid currency 136
Длина параметра 'reference' превышает
заданное ограничение
Reference is too long 137
Неверное значение параметра 'mode' Invalid mode 138
Неверное значение параметра Invalid parameter 139
Отсутствует параметр 'cvc/cvv2' Missing cvc/cvv2 140
Неверное значение параметра 'name' Invalid name 141
Неверное значение параметра 'pan' Invalid pan 142
Неверное значение параметра 'month' Invalid month 143
Неверное значение параметра 'year' Invalid year 144
ТСП не поддерживает операцию Authorize Sector does not support Authorize 145
Крипто модуль неактивен Crypto module not active 146
ТСП не поддерживает регулярные платежи Sector does not support Recurring 147
ТСП не поддерживает работу в режиме Gate Sector does not support Gate 148
ТСП не поддерживает работу с токеном карты Sector does not support card token 149
ТСП не поддерживает операцию P2P Sector does not support P2P 150
ТСП не поддерживает операцию Reverse Sector does not support Reverse 151
Токен 3DS не существует. 3DS token does not exist 152
ТСП не поддерживает операцию PayForm Sector does not support PayForm 153
Некорректный IP сервера Incorrect remote IP 154
Неверно задан период Invalid period 155
Неверно введена капча Wrong captcha 156
Неверно рассчитана комиссия Invalid fee 157
Карта не соответствует выбранной платёжной
системе
Invalid payment system 158
Неверный идентификатор кэша Invalid cache ID 159
Токен не был создан The token has not been created 160
ТСП не поддерживает операцию Card reg Sector does not support Card reg 161
Запрет операции по ссылке для данного сектора Refuse direct link for sector 162
Отключены cookies, для продолжения включите
cookies или воспользуйтесь другим браузером
Disable cookies, to continue to enable
cookies, or use a different browser 163
Не получается найти реквизиты для зачисления Cannot find details for enrollment 164
Карта отправителя совпадает с картой
получателя
The sender's card equals the receiver's card 165
ТСП не поддерживает операцию P2P credit Sector does not support P2P credit 166
Торговец не поддерживает операцию Sector does not support operation 167
Оригинальная операция не валидна Original operation is not valid 168
Превышено время, отведенное на проведение
операции
Time for completing operation has expired 169
Достигнут лимит попыток совершения операции Attempts limit for executing transaction
has been reached 170
Ошибка token2 Invalid token2 171
Количество вендор-полей не равно одному Number of vendor fields is not equal to one 172
Платеж не найден Bill not found 173
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 130 | 140
Невозможно привязать номер телефона к
пользователю B2P Cannot bind phone number to B2P user 174
Неправильный пароль Incorrect password 175
Телефон не уникален для сектора Phone not unique for sector 176
Пользователь не найден User not found 177
Превышено количество попыток выполнения
операции
Operation retry limit is exceeded 178
Был введен неправильный код СМС Incorrect SMS code was entered 179
Не найдено ни одной отправленной СМС с
кодом
Incorrect SMS code was entered 180
Превышено количество попыток ввода СМСкода. Попробуйте выполнить привязку телефона
заново
SMS-code enter attempts is exceeded.
Please, try to bind phone again 181
Достигнут лимит переотправки СМС SMS reattempt limit reached 182
Достигнут лимит регистрации телефона Phone registration limit reached 183
Ошибка протокола Fimi Fimi protocol error 184
Пользователь B2P не активен B2P user not active 185
Карта сектора не привязана Sector card is not binded 186
Операция запрещена для сектора Operation is forbidden for sector 187
Карта для вывода средств не привязана Receive card is not linked 188
Карта для вывода средств не совпадает с
привязанной картой Receive card doesn't match the linked card 189
Не удается зарегистрировать карту Cannot register card 190
Неверная длина параметра в предоставленных
фискальных данных
Invalid length of parameter in provided
fiscal data 191
Итоговая сумма в предоставленных фискальных
данных не совпадает с суммой заказа
Total amount in provided fiscal data
doesn't match order amount 192
Некорректный формат параметра в
предоставленных фискальных данных
Invalid format of parameter in provided
fiscal data 193
Ошибка идентификации пользователя User identification error 194
Ошибка ограничения уникальности Unique constraint error 195
3DS 2.0 Ошибка аутентификации 3DS 2.0 Authentication failed 196
Некорректное состояние пользователя B2P Incorrect B2P user state 197
Превышен лимит ввода пароля Password input overflow reached 198
Достигнут лимит ввода СМС-кода SMS code input limit reached 199
Запрещено для текущего статуса рекуррента Forbidden recurring state 200
Запрещено для текущей периодичности
рекуррента
Forbidden recurring frequency 201
Данные кредитной карты, привязанной к
сектору, не найдены Sector credit card not found 202
PAN не привязан к сектору Sector credit pan not binded 203
Данные кредитной карты сектора не найдены Sector credit card data not found 204
Неправильный pan или token Invalid pan or token 205
Банк не найден Bank not found 206
Банк не активирован в Процессинговом центре Bank not active 207
Неправильный ID Банка Incorrect bank ID 208
Банк не поддерживает операции через gate Bank do not support gate 209
Некорректный ID персоны Invalid person ID 210
Банк не поддерживает операцию Bank doesn't not support operation 211
Нет ключа для расшифровки No key for decryption 212
У пользователя B2P не существует кошелька B2P User Has No Wallet 213
Не задан MerchantID для мобильных платежей No MerchantID for mobile payment 214
Дублированные фискальные позиции Duplicated fiscal positions 215
Некорректный формат фискальных данных Invalid fiscal data format 216
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 131 | 140
Не переданы фискальные данные для операции
с частичной суммой
No fiscal data provided for the operation
with partial amount 217
Неизвестный БИК Unknown bank identification code 218
Некорректный номер расчетного счета Incorrect checking account number 219
Некорректные данные мультиплатежей Incorrect multipayment data 225
Заказ не регулярный Order is not recurring 226
Параметр count вне допустимого диапазона Parameter count out of range 227
Потеряна операция SafeDepositDebit Missing operation SafeDepositDebit 228
Потерянная транзакция Missing transaction 229
Потерян результат гейта Missing gate result 230
Не выбран гейт No gate selected 231
Token или clientRef не указаны Missing token or clientRef 232
Некорректный тип ответа Incorrect response type 233
Предотвращение излишних возвратов. В заказе
есть reverse со статусом timeout
Excessive refunding prevention. There is
timeouted reverse in the order 234
Неправильный clientRefStock Incorrect clientRefStock 235
Ошибка валидации Validation error 236
Потеряна операция SDPayInDebit SDPayInDebit operation lost 237
Пользователь B2P заблокирован B2P user is blocked 238
Превышено количество запросов в минуту / час Exceeded requests count per minute / hour 239
Операция оспаривается плательщиком The operation is disputed by the payer 240
Некорректная настройка сектора для
запрашиваемого действия
Sector setting is not set properly for the
action requested 241
Не удалось зарегистрировать отправителя в СБП Couldn't enroll sender to SBP 242
Не удалось получить данные получателя из СБП Couldn't get information about receiver
from SBP 243
Ошибка сочетания параметров запроса Invalid combination of request parameters 244
Недостаточно средств на балансе sdRef Not enough money on sdRef balance 245
Невозможно поменять статус. Срок действия
заказа истёк Unable to change status. Order has expired 246
Предотвращение излишних операций Excessive operations prevention
247,
248,
249
Команда не поддерживается Unsupported command 250
Неизвестная команда Unknown command 251
Мерчант аккаунт не зарегистрирован Merchant account is not registered 252
Некорректный мерчант аккаунт Incorrect merchant account 253
Мерчант аккаунт не верифицирован Merchant account is not verified 254
Сектор не поддерживает telegram платежи Sector does not support telegram payments 255
Пользователь не является владельцем бота Current user is not bot owner 256
Уже существует аккаунт с незавершенной
верификацией Merchant already has unverified account 257
Мерчант аккаунт уже зарегистрирован Merchant account has already been
registered 258
Невозможно разобрать сообщение Invalid answer parse 259
Несовпадение версий ФФД FFD version mismatch 260
sd_ref не найден sd_ref not found 261
Неверный код валюты гейта Invalid gate currency code 262
Отсутствует сумма в валюте гейта Missing amount in gate currency 263
Отсутствует комиссия в валюте гейта Missing fee in gate currency 264
Отсутствуют курсы валют Missing currency rates 265
Отсутствуют источники курсов валют Missing currency rates sources 266
Валюты сектора не найдены Sector currencies not found 267
Пречек не найден Precheck not found 268
Системная настройка не определена System setting undefined 269
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 132 | 140
Неподдерживаемая операция канала Channel unsupported operation 270
Карточный продукт для страны не найден Country product not found 271
Ассоциация не определена Association undefined 272
Ассоциация не разрешена Association not allowed 273
Не удалось получить информацию о карте Failed get card info 274
Неизвестная валюта Unknown currency 275
Курс покупки не найден Buy rate not found 276
Курс продажи не найден Sell rate not found 277
ФИО не определены FIO undefined 278
Возврат запрещен для операций Reverse forbidden for operations 279
Невозможно использовать эту карту Can not use this card 280
Хост отклонил запрос по причине неверных
параметров
Bank Acquiring Invalid Parameters 281
Запрос не авторизован Bank acquiring request forbidden 282
Запрашиваемый ресурс не найден Bank acquiring resource not found 283
Ошибка выполнения операции на стороне
банка-эквайера
Bank acquiring internal error 284
Банк-эквайер недоступен Bank acquiring not available 285
Неверное значение параметра 'address' Invalid address 286
Сервис недоступен для подписчика Service Unavailable For Subscriber 287
Достигнут лимит гейта Gate limit reached 288
Precheck_id не найден Precheck_id not found 289
Неверное значение параметра vendor_service Incorrect vendor_service parameter value 290
Недостаточно параметров для vendor_service Not enough parameters for vendor_service 291
Buyid уже используется Buyid is already in use 292
Достигнут лимит сектора Sector limit reached 293
Недостаточный баланс bankacct Invalid bankacct balance 294
Ошибка взаимодействия с внешними сервисами Error while interacting with external
service 295
Возврат запрещен для АФТ операций Reverse forbidden for AFT operations 296
Terminal set не установлен TerminalSetNotFound 297
Некорректная пара: токен и оригинатор incorrect token and originator pair 298
Неверный токен invalid token 299
Ошибка 3DS2 Challenge 3DS2 Challenge error 300
Внешняя система ответила ошибкой External system responded with error 301
Ошибка 3DS2 аутентификации 3DS2 authentication error 302
Ошибка взаимодействия с внешней системой Error communicating with external system 303
sd_ref / originator_id заблокирован sd_ref / originator_id is blocked / locked 304
Ошибка проверки хоста Host validation error 305
Сбп Legal_id не совпадают Sbp Legal_id mismatch 306
Некорректная короткая ссылка Invalid short URL 307
Срок действия короткой ссылки истёк Short URL expired 308
client_ref заблокирован client_ref is blocked 309
Отсутствует разрешение Qr capabilities Sbp Qr capabilities no permission 310
Некорректные настройки миграции Invalid migration settings 311
Неправильный sd_ref stock Incorrect sd_ref stock 312
Превышен дневной лимит использования.
Попробуйте позже
SBP Subscription usage day-limit exceeded.
Please try again later 313
Платежная система недоступна Processing payment system unavailable 314
Ошибка авторизации. Пожалуйста, повторите
попытку позже
Authorization error. Please, try again later 315
Фискальные данные содержат нулевое
количество
Fiscal data contains zero quantity 316
Достигнут лимит по SDPayIn SDPayIn limit reached 317
Достигнут лимит по SDPayOut SDPayOut limit reached 318
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 133 | 140
Достигнут лимит по SDBalance SDBalance limit reached 319
Не выбран процессор No processor selected 320
Не выбран продукт No product selected 321
Внутренняя ошибка канала Internal channel error 322
Внутренняя ошибка заказа Internal order error 323
Неуспешная проверка Precheck is not OK 324
Ошибка: precheck_id не соответствует id заказа Error: precheck_id not match order id 325
Отсутствует обязательный параметр Missing required parameter 326
QRC не найден QRC not found 327
Доступ запрещен Access denied 328
Недостаточно средств Insufficient funds 329
Достигнут лимит перевыпуска карты Client cards reissue limit reached 330
Достигнут лимит гейта Gate limit reached 331
Сектор назначения некорректно настроен to_sector is not properly configured 332
Данные счета не найдены Account data not found 333
Другой запрос с этим unique key уже находится
в обработке
Another request with unique key is in
progress
334
Некорректные данные сохраненного токена Invalid saved token data 335
Таймаут соединения: сервер не ответил в
отведенное время
Connection timed out: server did not
respond in time 336
Невалидный номер карты получателя денежных
средств
The recipient PAN is not valid 337
Валюта sd_ref/originator_id отличается от валюты
операции
sd_ref/originator_id currency mismatch 338
Ошибка по протоколу партнера Partner protocol error 339
Отказ от банка получателя Rejected by receiver's bank 340
Сумма реверса больше суммы Available reverse Reverse amount is greater than Available
reverse
341
Некорректные настройки кассы Invalid online cashier settings 342
Бенефициар уже существует The beneficiary already exists 343
Бенефициар не найден The beneficiary not found 344
Некорректный статус Бенефициара Incorrect Beneficiary status 345
Отказ от НСПК Rejected by OPKC 346
5. Описание возможных кодов ответов (Reason Code)
Каждой операции в ПЦ присваивается соответствующий код ответа.
Таблица 58. Описание возможных кодов ответов
Код Описание на русском Описание на
английском
Рекомендуемый текст сообщений для
плательщика
Общие коды ответа
1
Удачное выполнение
операции
Successful financial
transaction Ваш платёж проведён успешно.
2
Неверный срок действия
Банковской карты Card expired
Платёж отклонён. Возможные причины:
недостаточно средств на счёте, были
указаны неверные реквизиты карты, по
Вашей карте запрещены расчёты через
Интернет. Пожалуйста, попробуйте
выполнить платёж повторно или обратитесь
в Банк, выпустивший Вашу карту.
3
Неверный статус
Банковской карты на
стороне Эмитента
Invalid card status Платёж отклонён. Пожалуйста, обратитесь в
Банк, выпустивший Вашу карту.
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 134 | 140
4
Операция отклонена
Эмитентом
Transaction
declined by Issuer
5
Операция недопустима
для Эмитента
Invalid transaction.
Declined by Issuer.
6
Недостаточно средств на
счёте Банковской карты Insufficient funds
Платёж отклонён. Возможные причины:
недостаточно средств на счёте, были
указаны неверные реквизиты карты, по
Вашей карте запрещены расчёты через
Интернет. Пожалуйста, попробуйте
выполнить платёж повторно или обратитесь
в Банк, выпустивший Вашу карту.
7
Превышен установленный
для ТСП лимит на сумму
операций (дневной,
недельный, месячный) или
сумма операции выходит
за пределы установленных
границ
Merchant usage
limit checkup
failure
Платёж отклонён. Пожалуйста, обратитесь в
8 Интернет-магазин.
Операция отклонена по
причине срабатывания
системы предотвращения
мошенничества
Antifraud checkup
failure
9
Заказ уже находится в
процессе оплаты.
Операция, возможно,
задублировалась
Duplicated
transaction
11 Ошибка 3DS
аутентификации
3DS authentication
failure
12
Указано неверное
значение секретного кода
карты
Wrong CVV2/CVC
Платёж отклонён. Возможные причины:
недостаточно средств на счёте, были
указаны неверные реквизиты карты, по
Вашей карте запрещены расчёты через
Интернет. Пожалуйста, попробуйте
выполнить платёж повторно или обратитесь
в Банк, выпустивший Вашу карту.
13
Операция отклонена по
причине недоступности
Эмитента и/или Банкаэквайрера.
Timeout
Платёж отклонён. Пожалуйста, попробуйте
выполнить платёж позднее или обратитесь
в Интернет-магазин.
15
BIN платёжной карты
присутствует в черных
списках
Black list bin
checkup failure Платёж отклонён. Пожалуйста, обратитесь в
Интернет-магазин.
16
BIN 2 платёжной карты
присутствует в черных
списках
Black list bin 2
checkup failure
17 Заказ просрочен Order expired Время на оплату заказа истекло.
18 Неверно задан параметр
'month'/'reference'
Missing
month/reference
19 Операция оспаривается
плательщиком
The transaction is
disputed by the
payer. (Chargeback)
Операция оспаривается плательщиком.
20 Транзакция не может быть
выполнена
Transaction can not
be performed Невозможно выполнить операцию.
21
Операция отклонена по
временному ограничению
эмитента
pan is temporarily
blocked
Операция отклонена по временному
ограничению эмитента. Попробуйте позже.
/Confidential
П р и л о ж е н и е № 1 С т р а н и ц а 135 | 140
22 Операция отклонена по
требованию эмитента Pan Blocked Операция отклонена по требованию
эмитента.
0
Операция отклонена по
другим причинам.
Требуется уточнение у ПЦ.
Internal reason
code
Платёж отклонён. Пожалуйста, попробуйте
выполнить платёж позднее или обратитесь
в Интернет-магазин.
Коды ответа для оплат по ранее осуществленной СБП-привязке
6
Недостаточно средств на
счёте плательщика
(RQ05060)
Insufficient funds
in the payer's
account (RQ05060)
Недостаточно денежных средств для
проведения операции
8
Подозрение в
мошенничестве (RQ05063)
Suspected fraud
(RQ05063) Подозрение в мошенничестве
34
Выполнение операций в
данной категории ТСП
запрещено (RQ05064)
Performing
operations in this
category of TSP is
prohibited
(RQ05064)
Выполнение операций в данной категории
ТСП запрещено
35 Счет заблокирован
(RQ05065)
Payer's bank
account is blocked
(RQ05065)
Счет заблокирован
36 Счет закрыт (RQ05066)
Payer's bank
account is closed
(RQ05066)
Счет закрыт
37
Превышен лимит по сумме
операций по СБП
(RQ05061)
The limit on the
amount of SBP
transactions has
been exceeded
(RQ05061)
Превышен лимит по сумме операций по
СБП
38
Превышен лимит по
количеству операций по
СБП (RQ05062)
The limit on the
number of SBP
operations has
been exceeded
(RQ05062)
Превышен лимит по количеству операций
по СБП
39
Выполнение операции
запрещено по требованию
законодательства
(RQ05067)
The operation is
prohibited by law
(RQ05067)
Выполнение операции запрещено по
требованию законодательства
40
Отказ Банка Плательщика
в выполнении платежа
(RQ05032)
The bank of the
payer has refused
to process the
payment
(RQ05032)
Отказ Банка Плательщика в выполнении
платежа
41
Истекло время ожидания
решения Банка
Плательщика (RQ05035)
Timeout for the
Payer's Bank's
decision has
expired (RQ05035)
Истекло время ожидания решения Банка
Плательщика
42
Распоряжение от Банка
Плательщика не было
получено в ожидаемое
время (RQ05052)
The payment
request from the
Payer's financial
institution was not
received as
anticipated
(RQ05052)
Распоряжение от Банка Плательщика не
было получено в ожидаемое время
/Confidential
П р и л о ж е н и е № 2 С т р а н и ц а 136 | 140
Приложение №2. Формирование и проверка цифровой подписи.
Алгоритм формирования цифровой подписи
1. Формируется строка из значений заданных параметров для каждого вида Запросов/ответов и в конце
добавляется пароль ТСП для цифровой подписи.
2. Полученная строка преобразуется в хэш алгоритмом SHA256. Например, с использованием функции
CryptoJS.SHA256(str).toString() библиотеки crypto-js.min.js. При вычислении SHA256 для
правильного кодирования русских символов, необходимо использовать только кодировку UTF-8.
3. Полученное значение хеша кодируется алгоритмом Base64 (кодируется не его битовое представление, а
его шестнадцатеричное строковое представление в нижнем регистре) в итоговую цифровую подпись
signature. Например, с использованием функции Base64.encode(sha256) библиотеки
jquery.base64.js.
Пароль для расчёта цифровой подписи предоставляется Организацией после регистрации ТСП в ПЦ.
Важно: при расчете цифровой подписи сообщений от ПЦ учитывайте, что набор полей таких
сообщений не фиксирован и может изменяться путём добавления и исключения ПЦ тегов из
ответа/колбэка.
Примеры формирования подписи
REGISTER
Запрос:
 sector = 1
 amount = 100
 currency = 643
 email = info@mail.ru
 phone = 8911111111111
 reference = 1s23d333d333
 description = Оплата товара ноутбук ASUS X55A
Вычисление строки:
 str = sector + amount + currency + password
Получаем для примера:
 str = 1100643test
 sha256 = f665bf26a3d24e00b5646c829ea07cef67ed7a2af5eb1fbc258720c651136fee
 signature =
ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZ
Q==
Ответная xml:
 <?xml version="1.0" encoding="UTF-8"?>
 <order>
<id>561</id>
<state>REGISTERED</state>
<inprogress>0</inprogress>
<date>2014.07.10 15:07:45</date>
<amount>100</amount>
<currency>643</currency>
<email>info@mail.ru</email>
<phone>8911111111111</phone>
<reference>1s23d333d333</reference>
<description>Оплата товара ноутбук ASUS X55A</description>
<url/>
<signature>ZTBiMjk0NzBiMTcxYjUxMmQ2MzVjNTE5M2FiODNkZTk3N2FiZTFkMmQwNmY5YmEwZDd
jYmYxODJmODMxMjdlYg==</signature>
 </order>
Вычисление строки(str) происходит суммированием последовательно содержимого всех тегов
+ password
Получаем для примера:
/Confidential
П р и л о ж е н и е № 2 С т р а н и ц а 137 | 140
 str = 561REGISTERED02014.07.10
15:07:45100643info@mail.ru89111111111111s23d333d333Оплата товара ноутбук ASUS
X55Atest
 sha256 = e0b29470b171b512d635c5193ab83de977abe1d2d06f9ba0d7cbf182f83127eb
 signature =
ZTBiMjk0NzBiMTcxYjUxMmQ2MzVjNTE5M2FiODNkZTk3N2FiZTFkMmQwNmY5YmEwZDdjYmYxODJmODMxMjdlY
g==
PURCHASE, AUTHORIZE
Запрос:
sector = 1
id = 561
Вычисление строки:
 str = sector + id + password
Получаем для примера:
 str = 1561test
 sha256 = 31dcbf731f243e46fd95f873da4198fc96ade0a021ebb9e5fb4665bda5b6c6ac
 signature =
MzFkY2JmNzMxZjI0M2U0NmZkOTVmODczZGE0MTk4ZmM5NmFkZTBhMDIxZWJiOWU1ZmI0NjY1YmRhNWI2YzZhY
w==
Ответная xml:
 <?xml version="1.0" encoding="UTF-8"?>
 <operation>
<order_id>561</order_id>
<order_state>COMPLETED</order_state>
<reference>1s23d333d333</reference>
<id>664</id>
<date>2014.07.10 15:50:30</date>
<type>PURCHASE</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<name>TEST TESTOVICH</name>
<pan>676531******0202</pan>
<email>info@mail.ru</email>
<amount>100</amount>
<currency>643</currency>
<approval_code>775504</approval_code>
<signature>ZTRiNWYwMDNkMWM3ODIwNDkwNjIyN2VjMWY5NTgzNjAzOTFmNmQ1MTQ2ZmMzYzVmMG
U3ZjYwMWU4MDIzM2I1ZA==</signature>
 </operation>
Вычисление строки (str) происходит суммированием последовательно содержимого всех
тегов + password
Получаем для примера:
 str = 561COMPLETED1s23d333d3336642014.07.10 15:50:30PURCHASEAPPROVED1Successful
financial transactionTEST TESTOVICH676531******0202info@mail.ru100643775504test
 sha256 = e4b5f003d1c78204906227ec1f958360391f6d5146fc3c5f0e7f601e80233b5d
 signature =
ZTRiNWYwMDNkMWM3ODIwNDkwNjIyN2VjMWY5NTgzNjAzOTFmNmQ1MTQ2ZmMzYzVmMGU3ZjYwMWU4MDIzM2I1Z
A==
OPERATION
Запрос:
sector = 1
id = 561
operation = 664
Вычисление строки:
 str = sector + id + operation + password
Получаем для примера:
 str = 1561664test
 sha256 = 5367e9130f205b4b1bc801899233329e36202c0572cdc7bc960fc92642212e82
 signature =
NTM2N2U5MTMwZjIwNWI0YjFiYzgwMTg5OTIzMzMyOWUzNjIwMmMwNTcyY2RjN2JjOTYwZmM5MjY0MjIxMmU4M
g==
/Confidential
П р и л о ж е н и е № 2 С т р а н и ц а 138 | 140
Подпись в ответной xml рассчитывается аналогично Запросу AUTHORIZE.
COMPLETE, REVERSE
Запрос:
sector = 1
id = 561
amount = 100
currency = 643
Вычисление строки:
 str = sector + id + amount + currency + password
Получаем для примера:
 str = 1561100643test
 sha256 = bc9056788e8f55aa421d917009038fb883eaf2aa8ccba0063d308b2866d77258
 signature =
YmM5MDU2Nzg4ZThmNTVhYTQyMWQ5MTcwMDkwMzhmYjg4M2VhZjJhYThjY2JhMDA2M2QzMDhiMjg2NmQ3NzI1O
A==
Ответная xml:
 <?xml version="1.0" encoding="UTF-8"?>
 <operation>
<order_id>561</order_id>
<order_state>CANCELED</order_state>
<reference>1s23d333d333</reference>
<id>665</id>
<date>2014.07.10 16:00:30</date>
<type>REVERSE</type>
<state>APPROVED</state>
<reason_code>1</reason_code>
<message>Successful financial transaction</message>
<amount>100</amount>
<currency>643</currency>
<approval_code>248809</approval_code>
<signature>MTQ1NzcwYTc4YjkyZjRkZTkwMjU5ZGQ0YzgzNTlkOTFmZjBmNjRiMWRlYzM3MDg2Mj
BkZTE5MDY0MjQ2YTRlZg==</signature>
 </operation>
Вычисление строки (str) происходит суммированием последовательно содержимого всех
тегов + password
Получаем для примера:
 str = 561CANCELED1s23d333d3336652014.07.10 16:00:30REVERSEAPPROVED1Successful
financial transaction100643test
 sha256 = 145770a78b92f4de90259dd4c8359d91ff0f64b1dec3708620de19064246a4ef
 signature =
MTQ1NzcwYTc4YjkyZjRkZTkwMjU5ZGQ0YzgzNTlkOTFmZjBmNjRiMWRlYzM3MDg2MjBkZTE5MDY0MjQ2YTRlZ
g==
ORDER
Запрос:
sector = 1
id = 561
Вычисление строки:
 str = sector + id + password
Получаем для примера:
 str = 1561test
 sha256 = 31dcbf731f243e46fd95f873da4198fc96ade0a021ebb9e5fb4665bda5b6c6ac
 signature =
MzFkY2JmNzMxZjI0M2U0NmZkOTVmODczZGE0MTk4ZmM5NmFkZTBhMDIxZWJiOWU1ZmI0NjY1YmRhNWI2YzZhY
w==
Подпись в ответной xml рассчитывается аналогично Запросу REGISTER и AUTHORIZE: происходит
суммирование всех тегов из полученной xml.
/Confidential
П р и л о ж е н и е № 3 С т р а н и ц а 139 | 140
Приложение №3. Примеры сallback
Callback об операциях через СБП
При проведении любой операции через Систему Быстрых Платежей (СБП), приходит xml-сообщение
следующего вида:
<operation>
<order_id>461894488</order_id>
<order_state>COMPLETED</order_state>
<reference>test b2p</reference>
<id>685675100</id>
<date>2022.06.16 14:47:49</date>
<type>PURCHASE_BY_QR</type>
<state>APPROVED</state>
<email>roman@test.com</email>
<amount>1000</amount>
<fee>0</fee>
<currency>643</currency>
<qrcId>AD10004O2VQJVS7K8N6O65TOH9RTLNPI</qrcId>
<sbpTranId>B2167114748464070000176517BE1DD5</sbpTranId>
<signature>NzIxN2NlNzM5OTM5OWE0MjBkYmE1NmUyYjVhYTc3YWE=</signature>
</operation>
Также, по согласованию с Оператором, доступна отправка второго колбэка с дополнительной информацией
по СБП-операции:
• Вариант 1. Расширенный, с ФИО и номером телефона получателя:
<SBPOperationDetails>
 <order_id>506122</order_id>
 <operation_id>482668</operation_id>
 <operation_state>APPROVED</operation_state>
 <reference>9820911a-b795-4c7f-9dae-4b653443b7de</reference>
 <phone>79112223344</phone>
 <recipientFIO>Неиванов Неиван Н.</recipientFIO>
 <sbp_bank_id>100000000111</sbp_bank_id>
 <sector_id>1869</sector_id>
 <signature>ZjAwOTJkZmU0YmFjNDdkMzI0MjQ2ZTg3NzAwYWRiNTE=</signature>
</SBPOperationDetails>
• Вариант 2. Сокращенный, без данных о получателе, но с результатами проверки этих данных:
<SBPOperationDetails>
 <order_id>506123</order_id>
 <operation_id>482669</operation_id>
 <operation_state>APPROVED</operation_state>
 <reference>8104e8ee-b13d-4cb1-908e-a1748707acb7</reference>
 <sbp_bank_id>100000000111</sbp_bank_id>
 <sector_id>1869</sector_id>
 <signature>N2YwNWRmYzczYjAxYWM0MmE4OTQwNmY4NDU1ZjU4ZWI=</signature>
 <verified_phone>true</verified_phone>
 <verified_FIO>true</verified_FIO>
</SBPOperationDetails>

/Confidential
П р и л о ж е н и е № 3 С т р а н и ц а 140 | 140
Callback об изменении статуса СБП-привязки
При изменении статуса СБП-привязки (запрос webapi/GetSBPSubscription) ПЦ инициирует отправку колбэка,
содержащего qrcId и статус привязки.
В случае успешной привязки приходит xml-сообщение следующего вида, содержащее также СБП-токен:
<SBPSubscriptionState>
<date>2023.07.26 17:41:18.078</date>
<order_id>477847</order_id>
<qrcId>AD1P0069R8PCVG9S9F8P64CSGMC8LIKR</qrcId>
<subscription_state>ACCEPTED</subscription_state>
<token>SBP65949-e104-4bca-b1a0-5d609addd920</token>
<member_id>100000000003</member_id>
<signature>ZmU5N2ViMDY2M2U1OGQ0MGUxNGUxMThlOGJhNWY1MWI=</signature>
</SBPSubscriptionState>
При неуспешной привязке колбэк имеет следующий вид:
<SBPSubscriptionState>
<date>2023.07.26 18:08:04.103</date>
<order_id>477850</order_id>
<qrcId>AD1P00004GJ6J71N8QQRSH73GPN47IAM</qrcId>
<subscription_state>REJECTED</subscription_state>
<signature>YTQxMmNjYjE1YWEwNGE0MTAyYmZmMDE1M2Y0YzFkYTg=</signature>
</SBPSubscriptionState>
Callback об изменении остатка на счете в результате выполнения банковских проводок
По факту изменения остатка на счете после выполнения банковских проводок приходит xml-сообщение
следующего вида:
<BankOperation>
 <bank_id>21</bank_id>
 <account>30232810500005000941</account>
 <P008>ИВАНОВ ИВАН ИВАНОВИЧ г КРАСНОЯРСК УЛ КИРОВА 18 44</P008>
 <P024>ОПЛАТА УСЛУГ ХИМЧИСТКИ</P024>
 … // все P-поля и их значения
 <P060>0</P060>
 <signature>Y2FiYmNiYzAzNzMxMic3YjQ1ZDI5NjllYjMwMzIy