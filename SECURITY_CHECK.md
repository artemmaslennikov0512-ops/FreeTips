# Проверка на уязвимости (актуальная)

**Дата:** 2026-02-05. Обновлено: 2026-02-27.

## Результат: критических уязвимостей не обнаружено

Проверены основные векторы: инъекции, аутентификация, авторизация, CSRF, XSS, открытые редиректы, утечка секретов, path traversal, вебхук. Дополнительно (2026-02-27): в production без `NEXT_PUBLIC_APP_URL` baseUrl для редиректа не берётся из запроса (защита от open redirect); суперадмин может скачивать чеки любых выплат.

---

### Проверено

| Вектор | Статус |
|--------|--------|
| **SQL-инъекции** | Нет сырых запросов; везде Prisma (параметризованные запросы). |
| **XSS** | Нет `dangerouslySetInnerHTML` / `eval` в app; вывод через React. |
| **Открытый редирект** | Редиректы только на фиксированные пути (/, /login, /cabinet, /admin/dashboard). |
| **Секреты** | JWT/DATABASE/PAYMENT/SUPERADMIN только в `process.env`; `.env*` в .gitignore. |
| **CSRF** | Проверка origin + double-submit; исключения только для webhook и Bearer. |
| **Webhook** | При заданном `PAYMENT_WEBHOOK_SECRET` проверяется HMAC-SHA256; в production без секрета — отказ. |
| **Логи** | Контекст перед записью санитизируется (пароли, токены, authorization → `[REDACTED]`). |
| **Path traversal** | Пути к чекам строятся из UUID из БД, не из пользовательского ввода. |
| **IDOR** | Админские маршруты защищены по ролям; ID из URL — первичные ключи Prisma. |
| **Заголовки** | CSP, HSTS, X-Frame-Options, nosniff, object-src 'none'. |

Полный отчёт и история исправлений — в **SECURITY_AUDIT.md**.
