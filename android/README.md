# FreeTips — мобильное приложение (Android)

**Нативное приложение** (не WebView): экраны сделаны на Android, все запросы идут в API вашего сайта. Платежи и логика — на сервере, двойной интеграции нет.

## Вход по API-ключу из ЛК

- Пользователь копирует **API-ключ** в личном кабинете на сайте (Настройки → API ключ).
- В приложении вводит этот ключ на экране входа → проверка через `GET /api/profile` с заголовком `X-API-Key`.
- Ключ сохраняется в зашифрованном хранилище (EncryptedSharedPreferences). Дальше все запросы (профиль, выводы, операции, ссылки) идут с тем же заголовком.

## Экраны

1. **Вход** — поле для API-ключа, кнопка «Войти».
2. **Главная** — баланс, всего получено, число транзакций, заявок на вывод.
3. **Выводы** — список заявок, баланс, FAB «Вывести» (сумма + реквизиты).
4. **Операции** — история чаевых (транзакции).
5. **Ссылки** — список ссылок для чаевых (`/pay/slug`), длинное нажатие — копировать ссылку.
6. **Профиль** — логин, email, ФИО; кнопка «Выйти» (очистка API-ключа).

## Где что лежит

- **Исходники:** папка `android/` в корне репозитория.
- **Сборка APK:** из этой папки (Android Studio или `./gradlew assembleDebug`).
- **Размещение APK:** скопировать в `public/FreeTips.apk` и дать ссылку на сайте.

## Настройка перед сборкой

### 1. URL сайта

В `app/build.gradle.kts` укажите ваш домен:

```kotlin
buildConfigField("String", "BASE_URL", "\"https://ваш-домен.ru\"")
```

### 2. Подпись release-APK

**Build → Generate Signed Bundle / APK** — создать/выбрать keystore, указать пароли.

## Сборка

- **Android Studio:** открыть папку `android`, затем **Build → Build APK(s)**.
- **Командная строка:** из папки `android/` выполнить `./gradlew assembleDebug` (или `gradlew.bat` на Windows).

Готовый APK: `app/build/outputs/apk/debug/app-debug.apk` (или `release/app-release.apk`).

## Иконка

Иконка по умолчанию — в `app/src/main/res/drawable/`. Свою можно сгенерировать через **File → New → Image Asset** в Android Studio.

## Отладка вылетов

Если приложение вылетает при запуске, посмотрите логи — по ним видно причину (например, отсутствующий ресурс или ошибка при старте).

### Вариант 1: через Android Studio (удобнее)

1. Подключите телефон по USB, включите **отладку по USB** (Настройки → Для разработчиков).
2. В Android Studio откройте проект (папку `android`).
3. Внизу откройте вкладку **Logcat** (если не видна: **View → Tool Windows → Logcat**).
4. В выпадающем списке выберите ваше устройство и пакет приложения (`com.freetips.app` или `com.freetips.app.debug`).
5. В фильтре выберите уровень **Error** или в поле поиска введите `AndroidRuntime` — тогда будут видны только ошибки и падения.
6. Запустите приложение на телефоне (нажмите на иконку). После вылета в Logcat появятся красные строки с текстом исключения и стеком вызовов — скопируйте их для разбора.

### Вариант 2: через командную строку

Если Android Studio не установлена, можно смотреть лог с помощью **adb** (Android Debug Bridge). Команда `adb logcat -c && adb logcat *:E AndroidRuntime:E` очищает старый лог и выводит только сообщения уровня Error и от AndroidRuntime (т.е. падения приложения). Подключите телефон по USB с отладкой, выполните эту команду в терминале на ПК, затем запустите приложение на телефоне — в терминале появится стек ошибки.

В коде добавлена защита: при сбое создания канала уведомлений в `Application` приложение не падает, ошибка пишется в logcat с тегом `FreeTips.App`.
